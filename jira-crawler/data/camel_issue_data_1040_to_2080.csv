,Issue Key,Type,Priority,Affects Version/s,Component/s,Labels,Status,Resolution,Fix Version/s,Assignee,Reporter,Votes,Watchers,Created,Updated,Description,Comments
0,CAMEL-19312,Improvement,Minor,3.20.4,,"
None
",Resolved,Won't Fix,None,Unassigned,Aurélien Pupier,0,2,2023-05-03 07:56:26+00:00,2023-10-05 14:43:39+00:00,"when calling:



jbang camel@apache/camel config set camel-version=3.18.3.redhat-00022
jbang camel@apache/camel config set repos=https://maven.repository.redhat.com/ga
jbang camel@apache/camel run 'Test.java' --camel-version=3.20.3 --repos=https://packages.atlassian.com/maven-external



The camel-version from command-lmien is overriden by the configuration version:



Running integration with the following configuration:
    --camel-version=3.20.3
    --repos=https://packages.atlassian.com/maven-external
Running integration with the following configuration:
    --camel-version=3.18.3.redhat-00022
    --repos=https://packages.atlassian.com/maven-external




The repos value is correctly overridden.","davsclaus:1696488219:2023-10-05T14:43:39.539+0000:1696488219:2023-10-05T14:43:39.539+0000:Not worth the trouble.

You can set the version/repos in the config and just use them as-is.
Or not, and then provide CLI args all the time."
0,CAMEL-19311,Improvement,Major,4.0-M2,"3.21.0, 4.0-RC1, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-RC1, 4.0.0",Rhuan Rocha,Rhuan Rocha,0,1,2023-05-02 19:17:25+00:00,2023-07-17 11:16:33+00:00,"The SimpleLRUCache to become thread-safe. To know more about this discussion check this PR.


 


Related issue: https://issues.apache.org/jira/browse/CAMEL-19295",rhuanrocha:1684820605:2023-05-23T13:43:25.309+0000:1684820605:2023-05-23T13:43:25.309+0000:PR: https://github.com/apache/camel/pull/10157
0,CAMEL-19310,Improvement,Major,4.0-M2,,"
None
",Open,Unresolved,None,Rhuan Rocha,Rhuan Rocha,0,1,2023-05-02 19:15:50+00:00,2023-05-02 19:17:46+00:00,"The AbstractDynamicRegistry extends the ConcurrentHashMap which is a core Java Class. This issue is to re-evaluate how we do this to avoid tight coupling. To know more about this discussion check this PR.


 


Related issue: https://issues.apache.org/jira/browse/CAMEL-19295",
0,CAMEL-19309,New Feature,Major,None,"3.20.5, 3.21.0, 4.0-RC1, 4.0.0","
None
",Resolved,Fixed,"3.20.5, 3.21.0, 4.0-RC1, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-05-02 15:27:20+00:00,2023-05-05 08:55:11+00:00,"To make it possible to run camel-jbang from no files / empty folder, and then reload when new files are added.


camel run * --dev


And then you can drop new files in that folder.


Or run with a folder name


camel run myfolder --dev",
0,CAMEL-19308,New Feature,Major,4.0-M2,"4.0-RC1, 4.0.0","
None
",Resolved,Fixed,"4.0-RC1, 4.0.0",Nicolas Filotto,dpalmer,1,4,2023-05-02 14:52:23+00:00,2023-06-23 05:40:28+00:00,"Add support for SpringBoot 3 AOT native compile with graalVM for spring components. New feature with SpringBoot 3.


Native usage included for Quarkus could be added for spring as an extension of the native feature for Camel.","psoares1704:1683869266:2023-05-12T13:27:46.267+0000:1683869266:2023-05-12T13:27:46.267+0000:See discussion in https://camel.zulipchat.com/#narrow/stream/257301-camel-spring-boot/topic/springboot.203.2E0.2E6.20native.20-.20camel.20springboot.20starter.204.2E0.2E0-M3
nfilotto:1686905652:2023-06-16T16:54:12.602+0000:1686905652:2023-06-16T16:54:12.602+0000:Only basic support will be proposed for now, the goal of this task is to be able to launch a Camel SB application in native mode with routes written in Java, XML, and/or YAML DSL. This task doesn't cover the support of complex components, as a temporary workaround the Tracing agent can be used to generate the configuration files, see https://www.graalvm.org/latest/reference-manual/native-image/metadata/AutomaticMetadataCollection/ and https://docs.spring.io/spring-boot/docs/current/reference/html/native-image.html#native-image.advanced.using-the-tracing-agent for more details
davsclaus:1686959316:2023-06-17T07:48:36.092+0000:1686959316:2023-06-17T07:48:36.092+0000:Maybe we should have a doc page about spring boot AOT support where we can document the limitations.
And then you can also provide an example (or point to one of the existing examples that you can build as native)

nfilotto:1687223577:2023-06-20T09:12:57.208+0000:1687223577:2023-06-20T09:12:57.208+0000:I've just added a note to explain the limitations. I will add an example to {{camel-spring-boot-examples}} once the PR will be merged
nfilotto:1687430901:2023-06-22T18:48:21.185+0000:1687430901:2023-06-22T18:48:21.185+0000:The example https://github.com/apache/camel-spring-boot-examples/pull/111"
0,CAMEL-19307,New Feature,Major,None,"4.0-RC1, 4.0.0","
None
",Resolved,Fixed,"4.0-RC1, 4.0.0",Claus Ibsen,Claus Ibsen,1,2,2023-05-02 13:03:44+00:00,2023-06-09 09:31:28+00:00,To make routes dumper in yaml dsl also. Today we have xml dumper only.,"davsclaus:1683678391:2023-05-10T08:26:31.384+0000:1683678391:2023-05-10T08:26:31.384+0000:I have found a few minor mistakes in the model as well
davsclaus:1683693545:2023-05-10T12:39:05.431+0000:1683693545:2023-05-10T12:39:05.431+0000:Okay a little bit more challenging as our dumper code emits events in wrong order, so I need to fix this as well for XML and YAML
davsclaus:1683756172:2023-05-11T06:02:52.075+0000:1683756172:2023-05-11T06:02:52.075+0000:Okay so json model of the EIPs was wrong (a chance in 2020) caused a set of EIPs to have output = false

	modified:   src/generated/resources/org/apache/camel/model/aggregate.json
	modified:   src/generated/resources/org/apache/camel/model/circuitBreaker.json
	modified:   src/generated/resources/org/apache/camel/model/doCatch.json
	modified:   src/generated/resources/org/apache/camel/model/doFinally.json
	modified:   src/generated/resources/org/apache/camel/model/doTry.json
	modified:   src/generated/resources/org/apache/camel/model/filter.json
	modified:   src/generated/resources/org/apache/camel/model/idempotentConsumer.json
	modified:   src/generated/resources/org/apache/camel/model/intercept.json
	modified:   src/generated/resources/org/apache/camel/model/interceptFrom.json
	modified:   src/generated/resources/org/apache/camel/model/interceptSendToEndpoint.json
	modified:   src/generated/resources/org/apache/camel/model/kamelet.json
	modified:   src/generated/resources/org/apache/camel/model/loadBalance.json
	modified:   src/generated/resources/org/apache/camel/model/loop.json
	modified:   src/generated/resources/org/apache/camel/model/multicast.json
	modified:   src/generated/resources/org/apache/camel/model/onCompletion.json
	modified:   src/generated/resources/org/apache/camel/model/onException.json
	modified:   src/generated/resources/org/apache/camel/model/onFallback.json
	modified:   src/generated/resources/org/apache/camel/model/otherwise.json
	modified:   src/generated/resources/org/apache/camel/model/pipeline.json
	modified:   src/generated/resources/org/apache/camel/model/resequence.json
	modified:   src/generated/resources/org/apache/camel/model/route.json
	modified:   src/generated/resources/org/apache/camel/model/saga.json
	modified:   src/generated/resources/org/apache/camel/model/split.json
	modified:   src/generated/resources/org/apache/camel/model/step.json
	modified:   src/generated/resources/org/apache/camel/model/when.json
	modified:   src/generated/resources/org/apache/camel/model/whenSkipSendToEndpoint.json
davsclaus:1683759493:2023-05-11T06:58:13.518+0000:1683781201:2023-05-11T13:00:01.117+0000:Hmm we may take this opportunity to also rework 

    // doTry / doCatch (special)
    // circuitBreaker (special) 

as these EIPs use ""output"" as a hack and this causes the model json to be incorrect.

Created linked ticket about this
davsclaus:1684828735:2023-05-23T15:58:55.589+0000:1685835667:2023-06-04T07:41:07.823+0000:TODO: include outputs in EIPs that have output *DONE*
TODO: doTry / doCatch *DONE*
TODO: circuit breaker *DONE*
TODO: index for properties as they are written in map structure and parsers will be out of order *DONE*
davsclaus:1685839439:2023-06-04T08:43:59.477+0000:1686050542:2023-06-06T19:22:22.917+0000:TODO: beans that grzegorz added recently into the model *DONE*
davsclaus:1686050572:2023-06-06T19:22:52.335+0000:1686185911:2023-06-08T08:58:31.525+0000:The doTry / doCatch / doFinally is a bit harder and requires some ""hacky"" to make the yaml dump work correctly. *DONE*
davsclaus:1686187908:2023-06-08T09:31:48.780+0000:1686196473:2023-06-08T11:54:33.349+0000:TODO: routes that can have an array of route *DONE*
TODO: marshal/unmarshal *DONE*"
0,CAMEL-19306,Improvement,Minor,None,"3.20.5, 3.21.0, 4.0-RC1, 4.0.0","
None
",Resolved,Fixed,"3.20.5, 3.21.0, 4.0-RC1, 4.0.0",Unassigned,Claus Ibsen,0,1,2023-05-02 12:07:54+00:00,2023-05-02 16:41:03+00:00,"This example
https://github.com/igarashitm/misc/tree/main/camel/http-sql-separate-files


If we can run this without the beans.yaml file has a dummy route
https://camel.zulipchat.com/#narrow/stream/352237-camel-jbang/topic/beans.20only.20file",
0,CAMEL-19305,Bug,Major,3.20.4,4.x,"
None
",Resolved,Abandoned,4.x,Unassigned,Jeff,0,3,2023-05-01 17:57:27+00:00,2023-12-17 12:41:14+00:00,"After creating fresh Spring Boot project using Java 17 and adding the camel-cxf-soap-starter dependency per the docs, the application fails to start due to java.lang.ClassNotFoundException: javax.xml.soap.SOAPMessage.


Gradle build file (elided for brevity):


 
plugins 

{
id 'java'
id 'org.springframework.boot' version '2.7.11'
id 'io.spring.dependency-management' version '1.1.0'
}


ext 

{
camelVersion = '3.20.4'
}


dependencies {
implementation 'org.springframework.boot:spring-boot-starter'
implementation ""org.apache.camel.springboot:camel-spring-boot-starter:${camelVersion}""
implementation ""org.apache.camel.springboot:camel-cxf-soap-starter:${camelVersion}""


testImplementation 'org.springframework.boot:spring-boot-starter-test'
testImplementation ""org.apache.camel:camel-test-spring-junit5:${camelVersion}""
}
 
Upgrading to Spring Boot 3 and Camel 4.0.0-M2 removes the startup error but throws this error when attempting to use the CXF component in a Junit5 test:


java.lang.ClassNotFoundException: org.apache.camel.component.cxf.spring.jaxws.CxfSpringEndpointUtils","Federico Mariani:1682992030:2023-05-02T09:47:10.608+0000:1682992030:2023-05-02T09:47:10.608+0000:Hello [~fieldbradley], can you add 
* implementation ""org.apache.cxf:cxf-spring-boot-starter-jaxws:3.5.5""
with camel 3?
fieldbradley:1683018608:2023-05-02T17:10:08.276+0000:1683018608:2023-05-02T17:10:08.276+0000:I got this working in Camel 4.0.0-M2 and Spring Boot 3 with the following dependencies:

 
implementation ""org.apache.camel.springboot:camel-cxf-soap-starter""
implementation ""org.apache.cxf:cxf-rt-transports-http-jetty:${cxfVersion}""
 
There are still warnings about the missing *CxfSpringEndpointUtils* class whenever a cxf endpoint is called, but it doesn't appear to affect anything.
davsclaus:1684903196:2023-05-24T12:39:56.211+0000:1684903196:2023-05-24T12:39:56.211+0000:I wonder if you would be able to attach a sample project that demonstrates this, either as a .zip to this JIRA or put the code in github or someplace like that.
It would help us speedup investigate this problem."
0,CAMEL-19304,New Feature,Minor,None,"3.21.0, 4.0-RC1, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-RC1, 4.0.0",Unassigned,Jacek Szymański,0,2,2023-04-30 16:04:43+00:00,2023-05-02 16:39:20+00:00,"Camel JPA endpoint supports option maximumResults, but this is not enough to implement paging. Also, there is no way to specify offset apart from nativeQuery.


maximumResults is static on the endpoint; it may be specified dynamically only using toD, but this means creating dynamic endpoints.


This PR addresses the above:



adds support for firstResult
both maximumResults and firstResult may be specified in message headers, these override values specified on the endpoint, if any","davsclaus:1683003246:2023-05-02T12:54:06.278+0000:1683003246:2023-05-02T12:54:06.278+0000:I wonder if you can send a PR against `camel-3.x` branch so we can include this in upcoming 3.21 release. 
jsz:1683003469:2023-05-02T12:57:49.976+0000:1683003469:2023-05-02T12:57:49.976+0000:Sure I can, I'll do that in the evening."
0,CAMEL-19303,Improvement,Minor,None,,"
None
",Open,Unresolved,None,Unassigned,Claus Ibsen,0,1,2023-04-30 06:42:42+00:00,2023-04-30 06:42:42+00:00,"See SO
https://stackoverflow.com/questions/76119460/how-to-set-dircontext-bean-for-ldap-query-in-came-yaml-dsl/76126417?noredirect=1#comment134257808_76126417


You need to set that jndi factory, and we can set it to a sun implementation that comes in the JDK, that may be okay to connect to some LDAP servers.",
0,CAMEL-19302,Improvement,Minor,3.20.4,"3.20.5, 3.21.0, 4.0-RC1, 4.0.0","
None
",Resolved,Fixed,"3.20.5, 3.21.0, 4.0-RC1, 4.0.0",Unassigned,Aurélien Pupier,0,2,2023-04-28 08:55:46+00:00,2023-05-02 16:55:12+00:00,"Currently, when calling jbang run '-Dcamel.jbang.version=3.20.3' camel@apache/camel init 'demo.xml' the generated file is:



<?xml version=""1.0"" encoding=""UTF-8""?>
<!-- camel-k: language=xml -->

<routes xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance""
        xmlns=""http://camel.apache.org/schema/spring""
        xsi:schemaLocation=""
            http://camel.apache.org/schema/spring
            https://camel.apache.org/schema/spring/camel-spring.xsd"">

	<!-- Write your routes here, for example: -->
    <route id=""xml"">
        <from uri=""timer:xml?period={{time:1000}}""/>
        <setBody>
            <simple>Hello Camel from ${routeId}</simple>
        </setBody>
        <log message=""${body}""/>
    </route>

</routes>




it woudl be nice to have something like:



<?xml version=""1.0"" encoding=""UTF-8""?>
<!-- camel-k: language=xml -->

<routes xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance""
        xmlns=""http://camel.apache.org/schema/spring""
        xsi:schemaLocation=""
            http://camel.apache.org/schema/spring
            https://camel.apache.org/schema/spring/camel-spring.xsd"">

	<!-- Write your routes here, for example: -->
    <route id=""demo"">
        <from uri=""timer:xml?period={{time:1000}}""/>
        <setBody>
            <simple>Hello Camel from ${routeId}</simple>
        </setBody>
        <log message=""${body}""/>
    </route>

</routes>




It will mitigate the risk of having route id clash later on during development phase.


Alternatively we might use demo-xml",davsclaus:1683017428:2023-05-02T16:50:28.332+0000:1683017428:2023-05-02T16:50:28.332+0000:Its better to remote ids of routes in the init
0,CAMEL-19301,Dependency upgrade,Minor,None,"3.20.5, 3.21.0, 4.0-RC1, 4.0.0","
None
",Resolved,Fixed,"3.20.5, 3.21.0, 4.0-RC1, 4.0.0",Unassigned,Claus Ibsen,0,1,2023-04-28 07:14:07+00:00,2023-05-02 15:23:50+00:00,No Desc,
0,CAMEL-19300,Dependency upgrade,Major,None,"4.0-M3, 4.0.0","
None
",Resolved,Fixed,"4.0-M3, 4.0.0",Andrea Cosentino,Claus Ibsen,0,1,2023-04-28 06:35:45+00:00,2023-04-28 09:31:11+00:00,No Desc,
0,CAMEL-19299,New Feature,Major,None,"3.20.5, 3.21.0, 4.0-RC1, 4.0.0","
None
",Resolved,Fixed,"3.20.5, 3.21.0, 4.0-RC1, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-04-28 05:02:02+00:00,2023-05-07 10:01:29+00:00,This can help users to see what custom beans they have declared in the registry,
0,CAMEL-19298,Bug,Major,"3.18.6, 4.0-M3","3.18.7, 3.20.5, 3.21.0, 4.0-RC1, 4.0.0","
None
",Resolved,Fixed,"3.18.7, 3.20.5, 3.21.0, 4.0-RC1, 4.0.0",Jiri Ondrusek,Jiri Ondrusek,0,2,2023-04-27 12:51:27+00:00,2023-05-16 14:56:54+00:00,"In snmp component, users can use versions 0.1 and 2 (using values from the documentation).


Version 3 is not supported for several actions (like provide PDU or get next)
To support this version on component, different PDU class has to be used. (for example here https://github.com/apache/camel/blob/main/components/camel-snmp/src/main/java/org/apache/camel/component/snmp/SnmpProducer.java#L85)


There is a test coverage (creation in progress) in camel-quarkus, which could be used as a reproducer simulating missing scenarios - https://github.com/apache/camel-quarkus/issues/4843",
0,CAMEL-19297,Task,Major,4.0-M1,4.0-M3,"
None
",Resolved,Fixed,4.0-M3,Unassigned,Balavva Mirji,0,1,2023-04-26 07:23:48+00:00,2023-04-26 09:03:02+00:00,We want to provide ppc64le arch support to consul image in the camel-consul component.,bmirji:1682465668:2023-04-26T07:34:28.698+0000:1682465668:2023-04-26T07:34:28.698+0000:Power supported image: icr.io/ppc64le-oss/consul-ppc64le:1.9.4
0,CAMEL-19296,Bug,Minor,"3.20.3, 4.0-M2","3.20.5, 3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.20.5, 3.21.0, 4.0-M3, 4.0.0",Claus Ibsen,Dominik Jelinek,0,3,2023-04-25 14:51:50+00:00,2023-05-26 08:22:36+00:00,"jbang run -Dcamel.jbang.version=3.20.3 camel@apache/camel init foo.camel.xml

> Error: Unsupported file type: camel.xml



Tried also with latest camel version -Dcamel.jbang.version=4.0.0-M2","djelinek:1682405704:2023-04-25T14:55:04.864+0000:1682405704:2023-04-25T14:55:04.864+0000:[~davsclaus] I am sorry I did clone of previous reported same bug and it was cloned also with assignee which I cannot modify :(
davsclaus:1682416566:2023-04-25T17:56:06.816+0000:1682416566:2023-04-25T17:56:06.816+0000:This is only for yaml files where you have xxx.camel.yaml - for any other the files are single extension only.
apupier:1682466576:2023-04-26T07:49:36.576+0000:1682466576:2023-04-26T07:49:36.576+0000:Allowing xxx.camel.xml is helping integrations in VS Code. VS Code is allowing to base file type only on the filename, not on the content. For instance, it will allow to provide a specific icon in explorer, automatically open with a specific editor, filter commands in contextual menus, command palette and actions.

In a more general way, it would be even better to provide whatever xxx.yyy.xml as this is a valid pattern for xml filenames.
davsclaus:1682470915:2023-04-26T09:01:55.801+0000:1682470915:2023-04-26T09:01:55.801+0000:Okay that is better in this light to make it consistent for markup languages so xml and yaml can do the same file naming wise.
"
0,CAMEL-19295,Bug,Major,3.14.2,"3.21.0, 4.0-RC1, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-RC1, 4.0.0",Rhuan Rocha,Alan Dávila,0,4,2023-04-24 17:48:24+00:00,2023-05-28 10:23:09+00:00,"Hello everyone,


We have detected concurrency issues related to the dynamicMap attribute of the AbstractDynamicRegistry class. By default, dynamicMap is an object of the SimpleLRUCache class, which inherits from LinkedHashMap.


We have resolved the issue by creating our own LRUCacheFactory which returns a thread-safe synchronized map backed by the specified map.


Could you please review it?","rhuanrocha:1682333828:2023-04-24T18:57:08.289+0000:1682333828:2023-04-24T18:57:08.289+0000:Hi, I'm not sure if the issue is related to https://issues.apache.org/jira/browse/CAMEL-19014 which is already resolved. Is it happening just to 3.14.2? Have you tested with newer versions?
adavila:1682390795:2023-04-25T10:46:35.391+0000:1682390795:2023-04-25T10:46:35.391+0000:Hi, yes, I have also tried it in version 3.14.7 and the same error occurs. I have attached a code snippet to force the error.
rhuanrocha:1682436452:2023-04-25T23:27:32.539+0000:1682436452:2023-04-25T23:27:32.539+0000:Yes, but have you tried it in version 3.21.x or 4? The issue I sent solves the problem to 2.21.x and 4. I will try to test it with the reproducer you attached. 
adavila:1682468673:2023-04-26T08:24:33.454+0000:1682468701:2023-04-26T08:25:01.875+0000:Hi, yes, I have tried with version 3.20.3 and 4.0.0-M2 and the same error occurs. Creating LRUCacheFactory instance from this class serves as a stopgap solution for the tested versions.

 
{code:java}
public class SynchronizedLRUCacheFactory extends DefaultLRUCacheFactory {  
   
    ...

    @Override
    public <K, V> Map<K, V> createLRUCache(int maximumCacheSize) {
        return Collections.synchronizedMap(super.createLRUCache(maximumCacheSize));
    }

    ...

}{code}
 

 

 
davsclaus:1684457725:2023-05-19T08:55:25.702+0000:1684457725:2023-05-19T08:55:25.702+0000:You can just add camel-caffeine-lrucache to your classpath and Camel should automatic use this cache instead of SimpleLRUCache
nfilotto:1685008755:2023-05-25T17:59:15.697+0000:1685008755:2023-05-25T17:59:15.697+0000:The backport for 3.21 https://github.com/apache/camel/pull/10213"
0,CAMEL-19294,Task,Major,"3.18.6, 4.0-M2",None,"
None
",Resolved,Fixed,"3.18.7, 3.20.5, 3.21.0, 4.0-M3",Otavio Rodolfo Piske,Otavio Rodolfo Piske,0,1,2023-04-24 12:01:25+00:00,2023-04-24 14:39:10+00:00,"Even when the zookeeper.container property is set, the code does not use the requested container image.",orpiske:1682318350:2023-04-24T14:39:10.318+0000:1682318350:2023-04-24T14:39:10.318+0000:Fixed with the linked PRs.
0,CAMEL-19293,Bug,Major,4.0-M2,None,"
None
",Resolved,Fixed,"3.18.7, 3.20.5, 3.21.0, 4.0-M3, 4.0.0",Federico Mariani,Federico Mariani,0,1,2023-04-24 08:48:36+00:00,2023-04-24 14:27:46+00:00,"When using SB AutoConfiguration and the base is set by SB on the ldapTemplate, camel set the base twice.",
0,CAMEL-19292,Task,Major,None,"4.0-M3, 4.0.0","
None
",Resolved,Fixed,"4.0-M3, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-04-24 06:30:39+00:00,2023-04-25 14:25:16+00:00,"This was an experiment in the earlier phase with graalvm/quarkus.


We do not need this, and should remove it.


LightweightRuntimeCamelContext
LightweightCamelContext


There are a few places in jbang the lightweight is in use, but it can use default camel context instead.",
0,CAMEL-19291,Improvement,Minor,None,,"
None
",Resolved,Abandoned,None,Unassigned,Claus Ibsen,0,1,2023-04-24 05:16:53+00:00,2023-10-05 14:43:56+00:00,"If you use camel run foo.yaml --download=false then we have NPEs and the dependency resolution should use the maven downloader but in offline mode, as it can then use what already downloaded only - like mvn --offline mode.


        // offline mode selected using for example `camel run --download` option - should be online by default
        session.setOffline(false);


We need an option to set this true|false


Reported in chat at
https://camel.zulipchat.com/#narrow/stream/352237-camel-jbang/topic/camel-jbang.20--download.3Dfalse.20error",
0,CAMEL-19290,Task,Major,None,"4.0-RC1, 4.0.0","
None
",Resolved,Fixed,"4.0-RC1, 4.0.0",Andrea Cosentino,Claus Ibsen,0,3,2023-04-21 10:50:25+00:00,2023-05-31 16:41:59+00:00,We should deprecate it in v3 and remove it in v4,"davsclaus:1682046820:2023-04-21T11:13:40.934+0000:1682046820:2023-04-21T11:13:40.934+0000:Andrea would like to take a look and see if we can convert tests to test-container, and also need to drop some of the stuff in camel-solr that are deprecated and removed in solr v9. They changed how they use http-client which they use their own internal instead of apache http client and other stuff.
acosentino:1682475803:2023-04-26T10:23:23.714+0000:1682475803:2023-04-26T10:23:23.714+0000:I think we should remove it. It's really hard to keep the codebase clean with upgrading to 9.x. A rewrite would be welcome 
nfilotto:1685518476:2023-05-31T15:34:36.611+0000:1685518476:2023-05-31T15:34:36.611+0000:The corresponding PR/commits

* https://github.com/apache/camel/commit/4433c12a7765be78a876191541f267415b67ef4d
* https://github.com/apache/camel/commit/47143c6dd436924efc9832a15a014c56d1ad45ee
* https://github.com/apache/camel/commit/3625f5ab705e334137db722ab058c5cd6e612cbb
* https://github.com/apache/camel/pull/10250"
0,CAMEL-19289,Task,Major,None,"4.0-M3, 4.0.0","
None
",Resolved,Fixed,"4.0-M3, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-04-21 08:21:00+00:00,2023-04-25 09:43:38+00:00,Add an example how to use POJOs as inputs for SQL where you want to use getters on the POJOs with named parameters in the SQL statements.,
0,CAMEL-19288,Dependency upgrade,Major,None,"3.14.8, 3.18.7, 3.20.4, 3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.14.8, 3.18.7, 3.20.4, 3.21.0, 4.0-M3, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-04-21 08:12:18+00:00,2023-04-21 08:13:45+00:00,No Desc,
0,CAMEL-19287,Dependency upgrade,Major,None,"4.0-M3, 4.0-RC1, 4.0.0","
None
",Resolved,Fixed,"4.0-M3, 4.0-RC1, 4.0.0",Andrea Cosentino,Claus Ibsen,0,1,2023-04-21 08:03:30+00:00,2023-04-21 08:30:20+00:00,No Desc,
0,CAMEL-19286,Improvement,Major,None,"4.0-M3, 4.0.0","
None
",Resolved,Fixed,"4.0-M3, 4.0.0",Kengo Seki,Kengo Seki,0,1,2023-04-21 04:09:46+00:00,2023-04-21 08:02:45+00:00,"Currently, the Ignite Cache component doesn't support some operations provided by Ignite itself. I'd like to add the REPLACE operation to the producer as the first step.",
0,CAMEL-19285,Bug,Major,"3.20.2, 3.20.3","3.20.7, 3.21.1, 4.0.0","

help-wanted

",Resolved,Fixed,"3.20.7, 3.21.1, 4.0.0",Otavio Rodolfo Piske,Dylan Piergies,0,5,2023-04-20 16:36:21+00:00,2023-07-01 12:55:47+00:00,"The Kafka consumer does not respect reconnect backoff options when a TLS handshake fails if the consumer's pollOnError option is set to RECONNECT, resulting in reconnection attempts being made in a tight loop without delays, meaning that Camel applications consuming from Kafka topics can effectively mount a DDoS attack on the Kafka broker. This effect is amplified if concurrent consumers are in use, since each consumer thread is making its own connection attempts.


Naturally, we found this out the hard way, in production, when another team put in place a firewall rule to allow connections from our consumers. The amount of TLS handshake traffic generated was sufficient to overwhelm the broker, resulting in an outage.


I have created a small project to demonstrate the issue against a containerised Kafka broker here: https://github.com/dylanpiergies/kafka-camel-flood-issue


This issue does not occur when a connection fails for other reasons (e.g. connection refused, connection timeout); in these cases the reconnect backoff behaves as expected.","msharma:1682432066:2023-04-25T22:14:26.094+0000:1682432066:2023-04-25T22:14:26.094+0000:I can work on this issue.
davsclaus:1682455451:2023-04-26T04:44:11.231+0000:1682455451:2023-04-26T04:44:11.231+0000:Thanks help is welcome and send a PR if you have some code fixes
dylan.piergies:1682594641:2023-04-27T19:24:01.286+0000:1682594641:2023-04-27T19:24:01.286+0000:[~msharma] Many thanks. I was hoping to get around to a fix, but I haven't had time. Let me know if you need any help reproducing.
msharma:1682620531:2023-04-28T02:35:31.331+0000:1682620531:2023-04-28T02:35:31.331+0000:I am able to reproduce the issue and set up the debug environment. I hope to have a fix soon.
msharma:1682672093:2023-04-28T16:54:53.531+0000:1682683716:2023-04-28T20:08:36.311+0000:[~dylan.piergies]  I am able to run the code and see that reconnection is not happening in a tight loop. the sample you have provided has 
{code:java}
reconnect-backoff-ms=1000
reconnect-backoff-max-ms: 10000{code}
The backoff logic is as per [ExponentialBackoff |https://github.com/apache/kafka/blob/trunk/clients/src/main/java/org/apache/kafka/common/utils/ExponentialBackoff.java].

Based on this logic you should see that from the fourth retry onward, retries should happen approximately every 10sec. I am able to verify this from the sample you have provided.
dlp:1682691180:2023-04-28T22:13:00.016+0000:1682691180:2023-04-28T22:13:00.016+0000:It doesn't sound like the reproduction is completely reliable. What you're
describing is the correct behaviour. There's definitely a scenario that
leads to the reconnect occurring in a tight loop. Are you seeing SSL
handshake errors in the application and Kafka logs?



dlp:1682691293:2023-04-28T22:14:53.681+0000:1682691293:2023-04-28T22:14:53.681+0000:It doesn't sound like the issue has been reproduced. I've seen some intermittency myself, but there's definitely a scenario where the reconnection attempts occur in a tight loop. It might take some more investigation on my part to pin down the exact scenario. Are you seeing SSL handshake errors in the application and Kafka logs?
msharma:1682700044:2023-04-29T00:40:44.039+0000:1682700254:2023-04-29T00:44:14.605+0000:Yes I see TLS error, the error is like this
{code:java}
2023-04-28 16:11:27.399  INFO 24501 --- [mer[test-topic]] org.apache.kafka.clients.NetworkClient   : [Consumer clientId=consumer-00187c38-02c6-4914-82d7-53621ed2f645-1, groupId=00187c38-02c6-4914-82d7-53621ed2f645] Node -1 disconnected.
2023-04-28 16:11:27.400  WARN 24501 --- [mer[test-topic]] org.apache.kafka.clients.NetworkClient   : [Consumer clientId=consumer-00187c38-02c6-4914-82d7-53621ed2f645-1, groupId=00187c38-02c6-4914-82d7-53621ed2f645] Connection to node -1 (localhost/127.0.0.1:9092) terminated during authentication. This may happen due to any of the following reasons: (1) Authentication failed due to invalid credentials with brokers older than 1.0.0, (2) Firewall blocking Kafka TLS traffic (eg it may only allow HTTPS traffic), (3) Transient network issue. {code}
these errors can overload the broker depending on the number of consumers, they all will try to connect every 10 seconds with 20% jitter.
dylan.piergies:1682988554:2023-05-02T08:49:14.001+0000:1682990699:2023-05-02T09:24:59.511+0000:Yes, multiple consumers do amplify the problem, but I can still get much faster reconnects that configured with just a single consumer. I'll try to find some time to extract logs this afternoon and perhaps get to reproducing the problem more reliably.
dlp:1683199034:2023-05-04T19:17:14.177+0000:1683199052:2023-05-04T19:17:32.574+0000:Have reproduced again on a different system (though I did experience an odd issue with my docker-compose setup, which is now fixed). Here's a snippet of the log output from the Kafka broker:

kafka-camel-flood-issue-kafka-1      | [2023-05-04 19:12:09,170] INFO [SocketServer listenerType=ZK_BROKER, nodeId=1001] Failed authentication with /172.25.0.1 (channelId=172.25.0.3:9093-172.25.0.1:41098-61) (SSL handshake failed) (org.apache.kafka.common.network.Selector)
kafka-camel-flood-issue-kafka-1      | [2023-05-04 19:12:09,192] INFO [SocketServer listenerType=ZK_BROKER, nodeId=1001] Failed authentication with /172.25.0.1 (channelId=172.25.0.3:9093-172.25.0.1:41110-62) (SSL handshake failed) (org.apache.kafka.common.network.Selector)
kafka-camel-flood-issue-kafka-1      | [2023-05-04 19:12:09,210] INFO [SocketServer listenerType=ZK_BROKER, nodeId=1001] Failed authentication with /172.25.0.1 (channelId=172.25.0.3:9093-172.25.0.1:41114-62) (SSL handshake failed) (org.apache.kafka.common.network.Selector)
kafka-camel-flood-issue-kafka-1      | [2023-05-04 19:12:09,227] INFO [SocketServer listenerType=ZK_BROKER, nodeId=1001] Failed authentication with /172.25.0.1 (channelId=172.25.0.3:9093-172.25.0.1:41126-62) (SSL handshake failed) (org.apache.kafka.common.network.Selector)
kafka-camel-flood-issue-kafka-1      | [2023-05-04 19:12:09,245] INFO [SocketServer listenerType=ZK_BROKER, nodeId=1001] Failed authentication with /172.25.0.1 (channelId=172.25.0.3:9093-172.25.0.1:41136-63) (SSL handshake failed) (org.apache.kafka.common.network.Selector)
kafka-camel-flood-issue-kafka-1      | [2023-05-04 19:12:09,258] INFO [SocketServer listenerType=ZK_BROKER, nodeId=1001] Failed authentication with /172.25.0.1 (channelId=172.25.0.3:9093-172.25.0.1:41138-63) (SSL handshake failed) (org.apache.kafka.common.network.Selector)
kafka-camel-flood-issue-kafka-1      | [2023-05-04 19:12:09,273] INFO [SocketServer listenerType=ZK_BROKER, nodeId=1001] Failed authentication with /172.25.0.1 (channelId=172.25.0.3:9093-172.25.0.1:41140-63) (SSL handshake failed) (org.apache.kafka.common.network.Selector)
kafka-camel-flood-issue-kafka-1      | [2023-05-04 19:12:09,290] INFO [SocketServer listenerType=ZK_BROKER, nodeId=1001] Failed authentication with /172.25.0.1 (channelId=172.25.0.3:9093-172.25.0.1:41150-64) (SSL handshake failed) (org.apache.kafka.common.network.Selector)
kafka-camel-flood-issue-kafka-1      | [2023-05-04 19:12:09,304] INFO [SocketServer listenerType=ZK_BROKER, nodeId=1001] Failed authentication with /172.25.0.1 (channelId=172.25.0.3:9093-172.25.0.1:41162-64) (SSL handshake failed) (org.apache.kafka.common.network.Selector)
kafka-camel-flood-issue-kafka-1      | [2023-05-04 19:12:09,319] INFO [SocketServer listenerType=ZK_BROKER, nodeId=1001] Failed authentication with /172.25.0.1 (channelId=172.25.0.3:9093-172.25.0.1:41166-64) (SSL handshake failed) (org.apache.kafka.common.network.Selector)
kafka-camel-flood-issue-kafka-1      | [2023-05-04 19:12:09,333] INFO [SocketServer listenerType=ZK_BROKER, nodeId=1001] Failed authentication with /172.25.0.1 (channelId=172.25.0.3:9093-172.25.0.1:41176-65) (SSL handshake failed) (org.apache.kafka.common.network.Selector)
kafka-camel-flood-issue-kafka-1      | [2023-05-04 19:12:09,345] INFO [SocketServer listenerType=ZK_BROKER, nodeId=1001] Failed authentication with /172.25.0.1 (channelId=172.25.0.3:9093-172.25.0.1:41190-65) (SSL handshake failed) (org.apache.kafka.common.network.Selector)
kafka-camel-flood-issue-kafka-1      | [2023-05-04 19:12:09,360] INFO [SocketServer listenerType=ZK_BROKER, nodeId=1001] Failed authentication with /172.25.0.1 (channelId=172.25.0.3:9093-172.25.0.1:41192-65) (SSL handshake failed) (org.apache.kafka.common.network.Selector)
kafka-camel-flood-issue-kafka-1      | [2023-05-04 19:12:09,372] INFO [SocketServer listenerType=ZK_BROKER, nodeId=1001] Failed authentication with /172.25.0.1 (channelId=172.25.0.3:9093-172.25.0.1:41204-66) (SSL handshake failed) (org.apache.kafka.common.network.Selector)
kafka-camel-flood-issue-kafka-1      | [2023-05-04 19:12:09,387] INFO [SocketServer listenerType=ZK_BROKER, nodeId=1001] Failed authentication with /172.25.0.1 (channelId=172.25.0.3:9093-172.25.0.1:41218-66) (SSL handshake failed) (org.apache.kafka.common.network.Selector)
kafka-camel-flood-issue-kafka-1      | [2023-05-04 19:12:09,400] INFO [SocketServer listenerType=ZK_BROKER, nodeId=1001] Failed authentication with /172.25.0.1 (channelId=172.25.0.3:9093-172.25.0.1:41220-66) (SSL handshake failed) (org.apache.kafka.common.network.Selector)
kafka-camel-flood-issue-kafka-1      | [2023-05-04 19:12:09,413] INFO [SocketServer listenerType=ZK_BROKER, nodeId=1001] Failed authentication with /172.25.0.1 (channelId=172.25.0.3:9093-172.25.0.1:41224-67) (SSL handshake failed) (org.apache.kafka.common.network.Selector)
kafka-camel-flood-issue-kafka-1      | [2023-05-04 19:12:09,426] INFO [SocketServer listenerType=ZK_BROKER, nodeId=1001] Failed authentication with /172.25.0.1 (channelId=172.25.0.3:9093-172.25.0.1:41234-67) (SSL handshake failed) (org.apache.kafka.common.network.Selector)
kafka-camel-flood-issue-kafka-1      | [2023-05-04 19:12:09,441] INFO [SocketServer listenerType=ZK_BROKER, nodeId=1001] Failed authentication with /172.25.0.1 (channelId=172.25.0.3:9093-172.25.0.1:41238-67) (SSL handshake failed) (org.apache.kafka.common.network.Selector)
kafka-camel-flood-issue-kafka-1      | [2023-05-04 19:12:09,458] INFO [SocketServer listenerType=ZK_BROKER, nodeId=1001] Failed authentication with /172.25.0.1 (channelId=172.25.0.3:9093-172.25.0.1:41254-68) (SSL handshake failed) (org.apache.kafka.common.network.Selector)
kafka-camel-flood-issue-kafka-1      | [2023-05-04 19:12:09,477] INFO [SocketServer listenerType=ZK_BROKER, nodeId=1001] Failed authentication with /172.25.0.1 (channelId=172.25.0.3:9093-172.25.0.1:41258-68) (SSL handshake failed) (org.apache.kafka.common.network.Selector)
kafka-camel-flood-issue-kafka-1      | [2023-05-04 19:12:09,490] INFO [SocketServer listenerType=ZK_BROKER, nodeId=1001] Failed authentication with /172.25.0.1 (channelId=172.25.0.3:9093-172.25.0.1:41262-68) (SSL handshake failed) (org.apache.kafka.common.network.Selector)
kafka-camel-flood-issue-kafka-1      | [2023-05-04 19:12:09,502] INFO [SocketServer listenerType=ZK_BROKER, nodeId=1001] Failed authentication with /172.25.0.1 (channelId=172.25.0.3:9093-172.25.0.1:41270-69) (SSL handshake failed) (org.apache.kafka.common.network.Selector)
kafka-camel-flood-issue-kafka-1      | [2023-05-04 19:12:09,515] INFO [SocketServer listenerType=ZK_BROKER, nodeId=1001] Failed authentication with /172.25.0.1 (channelId=172.25.0.3:9093-172.25.0.1:41284-69) (SSL handshake failed) (org.apache.kafka.common.network.Selector)
kafka-camel-flood-issue-kafka-1      | [2023-05-04 19:12:09,529] INFO [SocketServer listenerType=ZK_BROKER, nodeId=1001] Failed authentication with /172.25.0.1 (channelId=172.25.0.3:9093-172.25.0.1:41292-69) (SSL handshake failed) (org.apache.kafka.common.network.Selector)
kafka-camel-flood-issue-kafka-1      | [2023-05-04 19:12:09,541] INFO [SocketServer listenerType=ZK_BROKER, nodeId=1001] Failed authentication with /172.25.0.1 (channelId=172.25.0.3:9093-172.25.0.1:41302-70) (SSL handshake failed) (org.apache.kafka.common.network.Selector)

It is visible from the timestamps that the backoff period is not being respected.
dlp:1683199258:2023-05-04T19:20:58.537+0000:1683199278:2023-05-04T19:21:18.751+0000:Additionally:

{{$ java -version}}
{{openjdk version ""17.0.7"" 2023-04-18}}
{{OpenJDK Runtime Environment (build 17.0.7+7)}}
{{OpenJDK 64-Bit Server VM (build 17.0.7+7, mixed mode)}}

The container we saw this issue with in production was using an Eclipse Temurin base image atthe same Java version.
msharma:1683204812:2023-05-04T20:53:32.530+0000:1683204812:2023-05-04T20:53:32.530+0000:Can you share the command you used  to run the Kafka container. 
dlp:1683209136:2023-05-04T22:05:36.226+0000:1683209325:2023-05-04T22:08:45.921+0000:I'm using the reproduction scenario I put up on GitHub; repository linked in the description: https://github.com/dylanpiergies/kafka-camel-flood-issue. The README contains a step-by-step to reproduce. The parameters used to start the Kafka broker (and ZooKeeper) are in the Docker Compose file.
orpiske:1687997305:2023-06-29T08:08:25.408+0000:1687997305:2023-06-29T08:08:25.408+0000:Looking into it ...
orpiske:1688010386:2023-06-29T11:46:26.268+0000:1688010402:2023-06-29T11:46:42.927+0000:Fixed with the linked PRs.

 

[~dylan.piergies] you are welcome to review the patch and try it on our environment. Thanks (and thanks for reporting the issue) !
orpiske:1688018485:2023-06-29T14:01:25.112+0000:1688018485:2023-06-29T14:01:25.112+0000:Fixed with the linked PRs. If the issue persists, please let us know.
dlp:1688187347:2023-07-01T12:55:47.462+0000:1688187347:2023-07-01T12:55:47.462+0000:[~orpiske] Have tested on build from {{camel-3.x}}. Flood issue has been resolved."
0,CAMEL-19284,New Feature,Minor,"3.20.3, 4.0-M2",None,"
None
",Open,Unresolved,None,Unassigned,Federico Mariani,0,1,2023-04-20 15:24:47+00:00,2023-04-20 15:25:36+00:00,"If camel-restdsl-openapi-plugin is used to generate DTOs, it would be nice to have type(..) and outType(..) set on the Rest DSL.


ex.




rest(""/v2"")
            .put(""/pet"")
                .id(""updatePet"")
                .consumes(""application/json,application/xml"")
                .produces(""application/xml,application/json"")
                _.type(Pet.class)_
                .param()
                    .name(""body"")
                    .type(RestParamType.body)
                    .required(true)
                    .description(""Pet object that needs to be added to the store"")
                .endParam()
                .to(""direct:updatePet"")




given




...
""/pet"": {
            ""put"": {
                ""requestBody"": {
                    ""description"": ""Pet object that needs to be added to the store"",
                    ""content"": {
                        ""application/json"": {
                            ""schema"": {
                                ""$ref"": ""#/components/schemas/Pet""
                            }
                        },
...",
0,CAMEL-19283,Bug,Major,None,4.0-M3,"
None
",Resolved,Won't Fix,4.0-M3,Claus Ibsen,Claus Ibsen,0,1,2023-04-20 11:56:48+00:00,2023-04-21 07:56:08+00:00,"May not work as expected, look into that",
0,CAMEL-19282,Dependency upgrade,Major,None,3.20.4,"
None
",Resolved,Fixed,3.20.4,Claus Ibsen,Claus Ibsen,0,1,2023-04-20 09:05:48+00:00,2023-04-20 09:39:42+00:00,To align to same version on core and karaf,
0,CAMEL-19281,Bug,Major,"3.19.0, 4.0-M2","3.20.5, 3.21.0, 4.0-RC1, 4.0.0","
None
",Resolved,Fixed,"3.20.5, 3.21.0, 4.0-RC1, 4.0.0",Rhuan Rocha,Artem,0,3,2023-04-19 15:50:29+00:00,2023-06-23 10:00:05+00:00,"As AWS2S3ConsumerHealthCheck and  Sqs2ConsumerHealthCheck working with 


SqsClient and S3Client, which extends AutoCloseble , meaning those have to be properly handled in terms of closing resources, we noticed that in our services invoking aws health checks leads to connection memory leak of org.apache.http.impl.conn.PoolingHttpClientConnectionManager , pls take a look","rhuanrocha:1681891170:2023-04-19T15:59:30.919+0000:1681891170:2023-04-19T15:59:30.919+0000:Hi [~artemtraier], thank you for reporting this issue. I will solve the issue.
davsclaus:1681903639:2023-04-19T19:27:19.269+0000:1681903639:2023-04-19T19:27:19.269+0000:Thanks for reporting
rhuanrocha:1684158376:2023-05-15T21:46:16.781+0000:1684158376:2023-05-15T21:46:16.781+0000:[~artemtraier], I'm not sure the health checker is generating the issue you have described. Could you attach a reproducer? Could you tell us the components used in your application?"
0,CAMEL-19280,New Feature,Minor,None,"4.0-M3, 4.0.0","
None
",Resolved,Fixed,"4.0-M3, 4.0.0",Unassigned,Stein Overtoom,0,2,2023-04-19 11:37:46+00:00,2023-04-20 07:35:12+00:00,"This proposed feature implements support for CoAP observe (rfc-7641) in the camel-coap component. 


rfc-7641: https://datatracker.ietf.org/doc/rfc7641/","steinov:1681876408:2023-04-19T11:53:28.316+0000:1681876408:2023-04-19T11:53:28.316+0000:Pull Request: https://github.com/apache/camel/pull/9898
davsclaus:1681947312:2023-04-20T07:35:12.574+0000:1681947312:2023-04-20T07:35:12.574+0000:Thanks for reporting and the PR"
0,CAMEL-19279,New Feature,Major,3.20.3,"3.22.0, 4.0.0","
None
",Resolved,Fixed,"3.22.0, 4.0.0",Unassigned,Petr Kuzel,0,3,2023-04-19 11:31:00+00:00,2023-07-26 11:48:45+00:00,"I have a new RFE which includes integrating Microsoft Azure Files over public Internet.


 


Initial findings and constraints:


 


  - Azure Files do not implement the FTP standard.


  - Azure Files could expose SMB protocol but SMB over public Internet is blacklisted by the security policy.


  - Azure Files could expose NFS protocol but its pricing is prohibitive (so security has not been even evaluated).


  - Azure Files have REST API <https://github.com/Azure/azure-rest-api-specs> and Java SDK <https://github.com/azure/azure-sdk-for-java>.


  - My team is used to Camel 3.x components (includes the FTP component).


 


In pre-discussions having a Camel Azure Files component that extends RemoteFileComponent<FTPFile> took preference over trying to use the Camel REST component as a client of the Azure Files REST API.  


 


The Camel Azure Files component that extends RemoteFileComponent<> does not exist yet.


 


This feature request is to develop the Camel Azure Files component that supports:


 


  - producer


  - consumer (polling unless Azure Java SDK allows event driven)


  - secure auth over public Internet


  - move and moveFailed


  - filters  


  - recursive


  - read locks  (the changed lock unless Azure Java SDK allows a superior)


  - timeouts (connect, read, write, changed lock)


  - retries


  - disconnect


  - multiple protocol versions (if applicable)


  - compatible with Camel 3.x


  - many files 


  - large files 


 





Appendix


The initial question on the users mailing list, that ended with the recommendation to enter new Camel feature request for a file-based component.   


 


Given that I see the two options:


 


  A: use Camel REST component.


  B: use Azure Files remote file component.


 


Neither seems easy. For the Camel REST component, I'd need to implement a polling consumer via REST and match the FTPS component-like capabilities. For Azure Files, I have not found a developed Camel remote file component so its development would be required, i.e. likely a continuation at the Camel dev list...","pkuzel:1684739043:2023-05-22T15:04:03.300+0000:1684739043:2023-05-22T15:04:03.300+0000:I have started working on it at [https://github.com/pekuz/camel] with intention to contribute eventually. 
davsclaus:1686645862:2023-06-13T16:44:22.966+0000:1686645862:2023-06-13T16:44:22.966+0000:How is it going?
pkuzel:1686648961:2023-06-13T17:36:01.964+0000:1686648961:2023-06-13T17:36:01.964+0000:The fork at [https://github.com/pekuz/camel/tree/camel-3.x/components/camel-azure/camel-azure-files] implements most of the initial scope. Coincidently today I have asked teammates to experiment it in real use cases and give feedback.

I'd be glad to get some feedback on the under cover, on the implementation, too.

   

Mimicking the FTP file component helped to ramp-up quickly but at the same time some remote file abstractions are not quite right and forced copy & pasting....   
pkuzel:1687414843:2023-06-22T14:20:43.581+0000:1687414843:2023-06-22T14:20:43.581+0000:Git PR https://github.com/apache/camel/pull/10460"
0,CAMEL-19278,Dependency upgrade,Minor,3.20.3,"3.20.4, 3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.20.4, 3.21.0, 4.0-M3, 4.0.0",Unassigned,Alexandru Neaţă,0,2,2023-04-19 08:28:56+00:00,2023-04-19 17:34:01+00:00,"We are using 11.4, 11.5 is out with fixes for some xslt transformations that fail on 11.4.",davsclaus:1681864819:2023-04-19T08:40:19.744+0000:1681864819:2023-04-19T08:40:19.744+0000:Thanks you are welcome to send a PR
0,CAMEL-19277,Improvement,Major,None,Future,"
None
",Open,Unresolved,Future,Unassigned,Claus Ibsen,1,1,2023-04-18 14:52:59+00:00,2023-05-24 05:07:20+00:00,"It would be good to have an unifed endpoint that report json data for a high level dashboard in camel-jbang that are the same for all runtimes (SB, Q, main). Today that depends on which runtime, and if you use micrometer, openetelemtry and so on.


We just need a set of standard high level metrics, that a quick dashboard for camel-jbang and other tools can use.",
0,CAMEL-19276,Improvement,Minor,None,"3.20.4, 3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.20.4, 3.21.0, 4.0-M3, 4.0.0",Andrea Cosentino,James Netherton,0,1,2023-04-18 12:55:57+00:00,2023-04-19 08:48:06+00:00,"Idea sparked from a question on the user mailing list:


https://lists.apache.org/thread/ldx4mcmj0b6mqq811x26rfy41m3kl6kg


The jackson-jq extras module contains some additional functions that folks may find useful to have in their JQ expressions.


It should be a simple case of adding net.thisptr:jackson-jq-extra to the component dependencies.",
0,CAMEL-19275,Dependency upgrade,Major,None,"3.20.4, 3.21.0","
None
",Resolved,Fixed,"3.20.4, 3.21.0",Gregor Zurowski,Claus Ibsen,0,1,2023-04-18 12:39:35+00:00,2023-04-21 07:07:48+00:00,No Desc,davsclaus:1682032064:2023-04-21T07:07:44.078+0000:1682032064:2023-04-21T07:07:44.078+0000:I have upgraded dependencies for SB 2.7.11
0,CAMEL-19274,Dependency upgrade,Minor,None,None,"
None
",Resolved,Fixed,"4.0-M3, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-04-18 11:42:33+00:00,2023-04-18 11:43:17+00:00,We are using 2.4.x and should upgrade to 3.x.,
0,CAMEL-19273,New Feature,Major,None,"4.0-RC1, 4.0.0","
None
",Resolved,Fixed,"4.0-RC1, 4.0.0",Andrea Cosentino,Andrea Cosentino,2,1,2023-04-18 10:18:47+00:00,2023-05-10 14:55:36+00:00,"So we could do something like


docker run apache/camel-jbang:<version> run route.yaml
podman run apache/camel-jbang:<version> run route.yaml",
0,CAMEL-19272,Improvement,Minor,None,"4.0-M3, 4.0.0","
None
",Resolved,Fixed,"4.0-M3, 4.0.0",Unassigned,Claus Ibsen,0,1,2023-04-17 07:57:43+00:00,2023-04-17 07:58:09+00:00,"camel version get


And also in PLATFORM column when doing camel get / camel top",
0,CAMEL-19271,Bug,Minor,None,"4.0-M3, 4.0.0","
None
",Resolved,Fixed,"4.0-M3, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-04-16 15:18:55+00:00,2023-04-17 08:50:01+00:00,Check if it works as expected as it appears that --latest waits for new incoming message instead of taking last complete,
0,CAMEL-19270,New Feature,Major,None,"3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M3, 4.0.0",Unassigned,Ivan Mashtak,0,2,2023-04-14 17:29:01+00:00,2023-04-15 10:32:14+00:00,Usecase: interprocess communication on the same host machine.,davsclaus:1681525934:2023-04-15T10:32:14.069+0000:1681525934:2023-04-15T10:32:14.069+0000:Thanks for contributing
0,CAMEL-19269,Improvement,Major,None,"4.0-M3, 4.0.0","
None
",Resolved,Fixed,"4.0-M3, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-04-14 13:30:30+00:00,2023-04-16 14:49:23+00:00,"jackson-databind have some wrapper types such as IntNode etc.
We should have converters for these to standard Java types


com.fasterxml.jackson.databind.node.IntNode
LongNode and so on",
0,CAMEL-19268,Dependency upgrade,Major,None,"4.0-M3, 4.0.0","
None
",Resolved,Fixed,"4.0-M3, 4.0.0",Unassigned,Claus Ibsen,0,1,2023-04-14 06:36:26+00:00,2023-04-21 12:38:57+00:00,No Desc,
0,CAMEL-19267,Bug,Major,3.20.3,3.20.4,"
None
",Resolved,Fixed,3.20.4,Claus Ibsen,Claus Ibsen,0,1,2023-04-13 16:48:26+00:00,2023-04-16 11:19:22+00:00,"Just a placeholder that to look into if this is a problem, where a custom java processor ends up in src/main/resources/camel instead of src/main/java","davsclaus:1681606602:2023-04-16T08:56:42.888+0000:1681608080:2023-04-16T09:21:20.207+0000:Cannot reproduce this on v4 and 3.21 branch but it fails with 3.20.3
davsclaus:1681615162:2023-04-16T11:19:22.324+0000:1681615162:2023-04-16T11:19:22.324+0000:Okay we had already fixed this since the 3.20.3 release"
0,CAMEL-19266,Improvement,Major,None,None,"
None
",Resolved,Fixed,"3.21.0, 4.0-M3",Andrea Cosentino,Andrea Cosentino,0,1,2023-04-13 16:19:32+00:00,2023-04-14 10:01:01+00:00,No Desc,
0,CAMEL-19265,Dependency upgrade,Major,None,"3.20.4, 3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.20.4, 3.21.0, 4.0-M3, 4.0.0",Mrinal,Claus Ibsen,0,2,2023-04-13 10:41:03+00:00,2023-04-17 16:38:38+00:00,No Desc,"msharma:1681452505:2023-04-14T14:08:25.850+0000:1681452505:2023-04-14T14:08:25.850+0000:Please assign to me
davsclaus:1681690663:2023-04-17T08:17:43.904+0000:1681690663:2023-04-17T08:17:43.904+0000:Are you able to send a PR for this later this week
msharma:1681712235:2023-04-17T14:17:15.976+0000:1681712235:2023-04-17T14:17:15.976+0000:Yes, I will finish it.
msharma:1681713041:2023-04-17T14:30:41.774+0000:1681713041:2023-04-17T14:30:41.774+0000:[Pull Request 9884|https://github.com/apache/camel/pull/9884] "
0,CAMEL-19264,Task,Minor,None,,"
None
",Resolved,Not A Problem,None,Unassigned,Dmitrii Kriukov,0,2,2023-04-13 10:07:12+00:00,2023-04-14 06:31:21+00:00,"Line 36:


String answer = scheme + "":http://"" + host;
Is it worth making it configurable? Leaving http as a default value for backward compatibility.","davsclaus:1681353697:2023-04-13T10:41:37.313+0000:1681353697:2023-04-13T10:41:37.313+0000:What is your use-case?
dkryukov:1681359692:2023-04-13T12:21:32.545+0000:1681359692:2023-04-13T12:21:32.545+0000:For now no use case. Just an alert from code inspection,
davsclaus:1681425081:2023-04-14T06:31:21.746+0000:1681425081:2023-04-14T06:31:21.746+0000:Okay so its not a problem as it should be as-is"
0,CAMEL-19263,Bug,Major,3.20.3,,"
None
",Closed,Fixed,None,Unassigned,Mrinal,0,2,2023-04-12 13:52:44+00:00,2023-04-12 14:16:20+00:00,"Current value is 




value: 'jdbc:oracle:thin://{{serverName}}:{{serverPort}}/{{databaseName}}' 



Expected value is




value: 'jdbc:oracle:thin:@{{serverName}}:{{serverPort}}/{{databaseName}}'","davsclaus:1681279206:2023-04-12T14:00:06.794+0000:1681279206:2023-04-12T14:00:06.794+0000:If its related to one of the kamelets, then you should create a ticket in that github issue tracker
https://github.com/apache/camel-kamelets

This JIRA is for the general Apache Camel project (core)
msharma:1681280029:2023-04-12T14:13:49.857+0000:1681280029:2023-04-12T14:13:49.857+0000:Thanks for the clarification. Closing this ticket.
msharma:1681280180:2023-04-12T14:16:20.417+0000:1681280180:2023-04-12T14:16:20.417+0000:Refer to https://github.com/apache/camel-kamelets/issues/1443"
0,CAMEL-19232,Improvement,Major,None,"4.0-M3, 4.0.0","
None
",Resolved,Fixed,"4.0-M3, 4.0.0",Marat Gubaidullin,Marat Gubaidullin,0,1,2023-03-31 14:11:23+00:00,2023-03-31 15:25:03+00:00,No Desc,
0,CAMEL-19231,Improvement,Minor,None,"3.20.4, 3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.20.4, 3.21.0, 4.0-M3, 4.0.0",Marat Gubaidullin,Marat Gubaidullin,0,2,2023-03-31 13:45:07+00:00,2023-04-05 07:39:49+00:00,No Desc,"davsclaus:1680247569:2023-03-31T15:26:09.219+0000:1680247569:2023-03-31T15:26:09.219+0000:We need PR for main branch (v4)
davsclaus:1680651589:2023-04-05T07:39:49.526+0000:1680651589:2023-04-05T07:39:49.526+0000:merged to main also"
0,CAMEL-19230,New Feature,Major,None,"4.0-M3, 4.0.0","
None
",Resolved,Fixed,"4.0-M3, 4.0.0",Zineb Bendhiba,Zineb Bendhiba,0,2,2023-03-31 09:56:59+00:00,2023-04-28 06:36:54+00:00,"Optaplanner team have already releases beta versions of Optaplanner 9, compatible with Jakarta EE 10.


Time to bring back Optaplanner for Camel 4","davsclaus:1682465898:2023-04-26T07:38:18.499+0000:1682465898:2023-04-26T07:38:18.499+0000:I have added camel-spring-boot starter for this. So I guess we are done on core + SB and the CEQ project can add an extension.
davsclaus:1682470963:2023-04-26T09:02:43.290+0000:1682470963:2023-04-26T09:02:43.290+0000:Zineb is there more work on the camel core project or if not then we can resolve this ticket
zbendhiba:1682635014:2023-04-28T06:36:54.119+0000:1682635014:2023-04-28T06:36:54.119+0000:thanks it's fine"
0,CAMEL-19229,Task,Major,4.0.0,4.1.0,"
None
",Resolved,Fixed,4.1.0,Otavio Rodolfo Piske,Otavio Rodolfo Piske,0,3,2023-03-31 09:26:16+00:00,2023-09-28 07:50:48+00:00,Hash ID for the bisect result: 95b4f51a8e0491c6af30df98d14350fa041d6316.,orpiske:1695858648:2023-09-28T07:50:48.780+0000:1695858648:2023-09-28T07:50:48.780+0000:Fixed with the linked PRs. 
0,CAMEL-19228,Task,Minor,None,,"

help-wanted

",Open,Unresolved,None,Unassigned,Otavio Rodolfo Piske,0,1,2023-03-31 07:00:48+00:00,2023-11-14 13:19:28+00:00,"Most of our integration tests work unreliably with Couchbase version 7. Investigating the logs, it seems to be caused by permissions or a similar problem preventing the bucket from being created.",
0,CAMEL-19227,Improvement,Major,None,"3.20.4, 3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.20.4, 3.21.0, 4.0-M3, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-03-30 17:20:50+00:00,2023-03-31 12:57:48+00:00,We forgot at add <pluginRepository> as maven plugins have their own setting,
0,CAMEL-19226,Improvement,Major,None,"3.20.4, 3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.20.4, 3.21.0, 4.0-M3, 4.0.0",Claus Ibsen,Claus Ibsen,1,1,2023-03-30 14:05:17+00:00,2023-03-31 13:45:25+00:00,We should add --repos to export command so you can provide 3rd party repos as well,
0,CAMEL-19225,Improvement,Major,None,4.0.0,"
None
",Resolved,Fixed,4.0.0,Zheng Feng,Zheng Feng,0,2,2023-03-30 13:43:24+00:00,2023-08-04 06:24:28+00:00,All related set/get method should be moved to DefaultTransactionStrategy which depends on spring-tx to do the transaction operations (commit / rollback). And make spring-tx as optional dependency.,"davsclaus:1690171458:2023-07-24T12:04:18.220+0000:1690171458:2023-07-24T12:04:18.220+0000:Any update on this as we are getting much closer to releasing 4.0
zhfeng:1690933326:2023-08-02T07:42:06.280+0000:1690933326:2023-08-02T07:42:06.280+0000:Yeah, I open a PR  for removing transactionManager property."
0,CAMEL-19224,Bug,Major,3.20.3,"3.20.4, 3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.20.4, 3.21.0, 4.0-M3, 4.0.0",Unassigned,Idorasi Paul,0,2,2023-03-30 13:19:37+00:00,2023-04-03 13:44:07+00:00,"When using prefix on azure endpoints the correct returned results should be all blobs starting with provided prefix, instead all blobs are retrieved. The issue is described in Zulip chat thread","davsclaus:1680219207:2023-03-31T07:33:27.893+0000:1680219207:2023-03-31T07:33:27.893+0000:Are you working on a PR
ipaulbogdan:1680225141:2023-03-31T09:12:21.391+0000:1680225141:2023-03-31T09:12:21.391+0000:Yes, on it.
ipaulbogdan:1680481937:2023-04-03T08:32:17.650+0000:1680481937:2023-04-03T08:32:17.650+0000:https://github.com/apache/camel/pull/9773
davsclaus:1680500647:2023-04-03T13:44:07.623+0000:1680500647:2023-04-03T13:44:07.623+0000:Thanks for the PR"
0,CAMEL-19223,Improvement,Minor,None,"4.0-M3, 4.0.0","
None
",Resolved,Fixed,"4.0-M3, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-03-30 08:49:28+00:00,2023-03-30 18:48:18+00:00,"It can help during development / trouble shooting to be able to know the current position from an input stream (cached).


Only some of the implementation will be able to expose this as the JDK often only has this information internally.",
0,CAMEL-19222,Improvement,Major,"3.20.3, 4.0-M2","3.21.0, 4.0-M3","
None
",Resolved,Fixed,"3.21.0, 4.0-M3",Andrea Cosentino,Andrea Cosentino,0,1,2023-03-30 06:01:07+00:00,2023-04-18 15:52:11+00:00,This will help in Kamelets and in general. We should avoid POJO in component/endpoint configuration as much as possible.,
0,CAMEL-19221,Task,Trivial,None,"4.0-M3, 4.0.0","
None
",Resolved,Fixed,"4.0-M3, 4.0.0",Unassigned,Dmitrii Kriukov,0,1,2023-03-29 18:47:44+00:00,2023-03-30 06:52:37+00:00,No Desc,dkryukov:1680086913:2023-03-29T18:48:33.978+0000:1680086913:2023-03-29T18:48:33.978+0000:I will handle that myself
0,CAMEL-19220,Bug,Minor,None,"4.0-M3, 4.0.0","
None
",Resolved,Fixed,"4.0-M3, 4.0.0",Nicolas Filotto,Nicolas Filotto,0,1,2023-03-29 14:00:35+00:00,2023-03-29 16:15:40+00:00,"The changes made for CAMEL-19212 cause runtime errors in native mode https://github.com/apache/camel-quarkus/issues/4712 of the following type: 



2023-03-29T09:15:06.5898355Z Caused by: org.codehaus.groovy.runtime.typehandling.GroovyCastException: Cannot cast object 'null' with class 'null' to class 'int'. Try 'java.lang.Integer' instead
2023-03-29T09:15:06.5901668Z 	at org.codehaus.groovy.runtime.typehandling.DefaultTypeTransformation.castToNumber(DefaultTypeTransformation.java:186)
2023-03-29T09:15:06.5902449Z 	at org.codehaus.groovy.runtime.typehandling.DefaultTypeTransformation.intUnbox(DefaultTypeTransformation.java:92)
2023-03-29T09:15:06.5903768Z 	at org.apache.camel.quarkus.component.groovy.generated.Expression668axhkmpOfBwe2iixBEtT194721N7sqMJrOlgVZAJVxs61.run(org.apache.camel.quarkus.component.groovy.generated.Expression668axhkmpOfBwe2iixBEtT194721N7sqMJrOlgVZAJVxs61:5)
2023-03-29T09:15:06.5907252Z 	at org.apache.camel.language.groovy.GroovyExpression.evaluate(GroovyExpression.java:53)
2023-03-29T09:15:06.5907829Z 	at org.apache.camel.support.ExpressionSupport.matches(ExpressionSupport.java:36)
2023-03-29T09:15:06.5913250Z 	at org.apache.camel.processor.FilterProcessor.matches(FilterProcessor.java:89)
2023-03-29T09:15:06.5913967Z 	at org.apache.camel.processor.ChoiceProcessor.process(ChoiceProcessor.java:71)
2023-03-29T09:15:06.5914600Z 	at org.apache.camel.processor.errorhandler.RedeliveryErrorHandler$SimpleTask.run(RedeliveryErrorHandler.java:474)
2023-03-29T09:15:06.5916861Z 	at org.apache.camel.impl.engine.DefaultReactiveExecutor$Worker.schedule(DefaultReactiveExecutor.java:181)
2023-03-29T09:15:06.5917520Z 	at org.apache.camel.impl.engine.DefaultReactiveExecutor.scheduleMain(DefaultReactiveExecutor.java:59)
2023-03-29T09:15:06.5922296Z 	at org.apache.camel.processor.Pipeline.process(Pipeline.java:164)
2023-03-29T09:15:06.5922898Z 	at org.apache.camel.impl.engine.CamelInternalProcessor.process(CamelInternalProcessor.java:378)
2023-03-29T09:15:06.5926160Z 	at org.apache.camel.component.direct.DirectProducer.process(DirectProducer.java:96)
2023-03-29T09:15:06.5927374Z 	at org.apache.camel.impl.engine.SharedCamelInternalProcessor.process(SharedCamelInternalProcessor.java:213)
2023-03-29T09:15:06.5932016Z 	at org.apache.camel.impl.engine.SharedCamelInternalProcessor$1.process(SharedCamelInternalProcessor.java:110)
2023-03-29T09:15:06.5934733Z 	at org.apache.camel.impl.engine.DefaultAsyncProcessorAwaitManager.process(DefaultAsyncProcessorAwaitManager.java:81)
2023-03-29T09:15:06.5940964Z 	at org.apache.camel.impl.engine.SharedCamelInternalProcessor.process(SharedCamelInternalProcessor.java:107)
2023-03-29T09:15:06.5944226Z 	at org.apache.camel.support.cache.DefaultProducerCache.send(DefaultProducerCache.java:164)
2023-03-29T09:15:06.5944848Z 	at org.apache.camel.impl.engine.DefaultProducerTemplate.send(DefaultProducerTemplate.java:176)
2023-03-29T09:15:06.5950089Z 	at org.apache.camel.impl.engine.DefaultProducerTemplate.send(DefaultProducerTemplate.java:172)
2023-03-29T09:15:06.5950820Z 	at org.apache.camel.impl.engine.DefaultProducerTemplate.requestBody(DefaultProducerTemplate.java:413)",nfilotto:1680070041:2023-03-29T14:07:21.059+0000:1680070041:2023-03-29T14:07:21.059+0000:Fix for https://github.com/apache/camel/pull/9692
0,CAMEL-19219,Improvement,Major,None,"3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M3, 4.0.0",Kengo Seki,Kengo Seki,0,1,2023-03-29 13:24:49+00:00,2023-03-29 18:06:06+00:00,"In addition to CAMEL-19216, I'd like to add the following functionalities to the scan operation of the Kudu producer for more efficient scanning:



filter columns
limit the number of results",
0,CAMEL-19218,New Feature,Major,None,4.1.0,"
None
",Resolved,Fixed,4.1.0,James Netherton,Zineb Bendhiba,0,3,2023-03-29 09:54:59+00:00,2023-09-19 12:37:01+00:00,I'm currently  investigating on adding this feature,"davsclaus:1682471948:2023-04-26T09:19:08.793+0000:1682471948:2023-04-26T09:19:08.793+0000:What is the status
zbendhiba:1682634991:2023-04-28T06:36:31.997+0000:1682634991:2023-04-28T06:36:31.997+0000:Hello I'm still working on this. Not ready yet for M3.

 
jamesnetherton:1695092439:2023-09-19T11:00:39.005+0000:1695092439:2023-09-19T11:00:39.005+0000:I have looked into this a bit so I can take this issue."
0,CAMEL-19217,Task,Major,None,,"
None
",Closed,Won't Fix,None,Unassigned,Dmitrii Kriukov,0,1,2023-03-29 09:25:03+00:00,2023-03-29 17:13:09+00:00,Will create a commit per code issue type. Most of them are related to performance,
0,CAMEL-19216,Improvement,Major,None,"3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M3, 4.0.0",Kengo Seki,Kengo Seki,0,1,2023-03-29 06:50:59+00:00,2023-03-29 12:48:14+00:00,"Currently, the scan operation of the Kudu producer scans entire table and sets the whole result to the message body. It's inefficient or not practical if the table is large, so I'd like to add predicate support.",
0,CAMEL-19215,New Feature,Major,None,,"
None
",Open,Unresolved,None,Unassigned,Claus Ibsen,0,2,2023-03-29 04:17:59+00:00,2023-04-10 11:34:36+00:00,"https://stackoverflow.com/questions/75379744/produce-long-kafka-header-with-apache-camel


We can look at the ""spring_json_header_types"" header that they include with spring-kafka that specifies what types for each header is (long, boolean, string, etc.)


We could have


1) add support for reading/writing spring_json_header_types
2) add support for a camel specific header as well (or just use the spring name)
3) option to turn this on|off","bfrisco:1680803635:2023-04-07T01:53:55.680+0000:1680803635:2023-04-07T01:53:55.680+0000:Hi - I can work on this if nobody else currently is.
davsclaus:1681097676:2023-04-10T11:34:36.531+0000:1681097676:2023-04-10T11:34:36.531+0000:Brice, you are welcome to work on this, thanks."
0,CAMEL-19214,Improvement,Major,None,"3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M3, 4.0.0",Kengo Seki,Kengo Seki,0,1,2023-03-29 01:12:50+00:00,2023-03-29 04:00:43+00:00,"The HDFS component support most of Hadoop Writables corresponding to Java primary types, but it only doesn't support ShortWritable for some reason.",
0,CAMEL-19213,Task,Minor,None,"4.0-M3, 4.0.0","

documentation-update

",Resolved,Fixed,"4.0-M3, 4.0.0",Unassigned,Ashish,0,3,2023-03-28 09:38:54+00:00,2023-03-29 15:30:52+00:00,"This documentation page is missing the reference to groovy-dsl


It is giving the impression to many that groovy-dsl is not officially supported whereas this is not the case as groovt-dsl is alive and kicking 


https://camel.apache.org/components/3.20.x/others/groovy-dsl.html",nfilotto:1680074991:2023-03-29T15:29:51.177+0000:1680074991:2023-03-29T15:29:51.177+0000:Fixed by https://github.com/apache/camel/pull/9665
0,CAMEL-19212,New Feature,Minor,None,"3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M3, 4.0.0",Unassigned,Claus Ibsen,0,1,2023-03-28 05:23:23+00:00,2023-03-29 14:07:35+00:00,https://github.com/apache/camel/pull/9648,
0,CAMEL-19211,Improvement,Minor,None,"3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M3, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-03-28 04:37:31+00:00,2023-03-28 05:13:23+00:00,https://stackoverflow.com/questions/75446926/apache-camel-sqlendpoint-configure-a-custom-beanpropertyrowmapper,
0,CAMEL-19210,Improvement,Minor,None,"3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M3, 4.0.0",Unassigned,Alastair Burr,0,2,2023-03-27 20:17:23+00:00,2023-03-29 21:00:07+00:00,"Description


Support for delayed delivery pulsar messages using deliverAt


Proposed change


To add in the ability to set the delayed delivery of Pulsar messages by use of a header. This would use the deliverAt() functionality on the Pulsar producer which simply takes in the a timestamp in milliseconds based on UTC


https://pulsar.apache.org/api/client/2.11.x/org/apache/pulsar/client/api/TypedMessageBuilder.html#deliverAt(long)


Background:


Delayed delivery is a very useful feature within Pulsar that can be used for a number of scenarios where you want the message to be picked up at a particular time.


There is additionally a deliverAfter() method on the Pulsar producer where you can specify a time period instead of a specific time, but the implementation behind the scenes just turns this into a timestamp then uses that. As such just implementing deliverAt() provides enough flexibility to the clients.",davsclaus:1680046429:2023-03-29T07:33:49.281+0000:1680046429:2023-03-29T07:33:49.281+0000:Thanks for reporting and the PR
0,CAMEL-19209,New Feature,Major,None,None,"
None
",Resolved,Fixed,"4.0-M3, 4.0.0",Unassigned,Claus Ibsen,0,1,2023-03-27 14:33:46+00:00,2023-03-27 16:10:23+00:00,"We need this PR to be ported to main
https://github.com/apache/camel-spring-boot/pull/784


SB is a little bit different on its auto configuration so a little adjustment is needed.","davsclaus:1679900139:2023-03-27T14:55:39.931+0000:1679900139:2023-03-27T14:55:39.931+0000:And we need the observation example ported to Camel v4 main branch also
https://github.com/apache/camel-spring-boot-examples/pull/98"
0,CAMEL-19208,Test,Major,4.0-M1,4.0.0,"
None
",Resolved,Fixed,4.0.0,Otavio Rodolfo Piske,Balavva Mirji,0,2,2023-03-27 12:43:21+00:00,2023-06-30 12:28:13+00:00,"Camel-zookeeper component has a dependency on image zookeeper:3.5, which is not supported on ppc64le architecture.
To execute test suites for camel-zookeeper component on power arch, we want to add a zookeeper image which has power support.
Link for the same: https://github.com/apache/camel/blob/main/test-infra/camel-test-infra-zookeeper/src/test/java/org/apache/camel/test/infra/zookeeper/services/ZooKeeperContainer.java#L26","bmirji:1679892756:2023-03-27T12:52:36.962+0000:1679892756:2023-03-27T12:52:36.962+0000:Link for the zookeeper image which has power support: [icr.io/ppc64le-oss/zookeeper-ppc64le:v3.8.0-bv|http://icr.io/ppc64le-oss/zookeeper-ppc64le:v3.8.0-bv]
orpiske:1679893757:2023-03-27T13:09:17.639+0000:1679893757:2023-03-27T13:09:17.639+0000:You can do this in one of the two ways:

 
 # By setting the zookeeper.container property on the build command line: `{{{}mvn -Dzookeeper.container=name test{}}}`
 # Or by configuring the same property on the Maven Surefire or Maven Failsafe plugin on the pom.xml file of the component you want to support on PPC 64. Similar to the following:

 

 
{code:java}
<profiles>
        <profile>
            <id>ppc64le</id>
            <activation>
                <os>
                    <arch>PUT HERE WHATEVER IS RETURNED BY System.getProperty(""os.arch"") on PPC 64 LE</arch>
                </os>
            </activation>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-failsafe-plugin</artifactId>
                        <configuration>
                            <skipITs>${skipTests}</skipITs>
                            <reuseForks>true</reuseForks>
                            <systemPropertyVariables>
                                 <zookeeper.container>icr.io/ppc64le-oss/zookeeper-ppc64le:v3.8.0-bv</zookeeper.container>
                           </systemPropertyVariables>
                        </configuration>
                    </plugin>
                </plugins>
            </build>
        </profile>
    </profiles>
{code}
 

 

The second option is better for a permanent solution / CI / etc. The first one is for adhoc testing.

 

Obs.: Please make sure to also to try on both x86 to make sure it doesn't break.

 
bmirji:1679910208:2023-03-27T17:43:28.603+0000:1679910208:2023-03-27T17:43:28.603+0000:[~orpiske] Thanks for sharing info, I will take a look into it and do changes accordingly.
bmirji:1688094180:2023-06-30T11:03:00.866+0000:1688094180:2023-06-30T11:03:00.866+0000:ppc64le supported zookeeper-image: icr.io/ppc64le-oss/zookeeper-ppc64le:3.5.10
Tested locally on ppc64le node for both camel-zookeeper & camel-zookeeper-master components, test suites are passing.
bmirji:1688095147:2023-06-30T11:19:07.698+0000:1688095147:2023-06-30T11:19:07.698+0000:[^camel-zookeeper-master-logs.txt]
bmirji:1688095177:2023-06-30T11:19:37.958+0000:1688095177:2023-06-30T11:19:37.958+0000:[^camel-zookeeper-test-logs.txt]
orpiske:1688097915:2023-06-30T12:05:15.329+0000:1688097915:2023-06-30T12:05:15.329+0000:I think we can close this ticket. Right?
orpiske:1688099293:2023-06-30T12:28:13.988+0000:1688099293:2023-06-30T12:28:13.988+0000:Based on the comments, I think we can close this. Thanks for your contribution!"
0,CAMEL-19207,Task,Minor,3.20.3,"3.20.6, 3.21.0","
None
",Resolved,Fixed,"3.20.6, 3.21.0",Unassigned,Thomas Cunningham,0,3,2023-03-27 11:41:31+00:00,2023-08-17 05:19:42+00:00,"Hitting an error trying to run camel-spring-boot-examples against 3.20.3 - a dependencyManagement version might need to be added to camel-spring-boot-dependencies.    Would probably be good to also add a version for org.codehaus.mojo:build-helper-maven-plugin although that is just causing warnings (not errors).


[ERROR] [ERROR] Some problems were encountered while processing the POMs:
[ERROR] 'dependencies.dependency.version' for mysql:mysql-connector-java:jar is missing. @ line 106, column 21
[WARNING] 'build.plugins.plugin.version' for org.codehaus.mojo:build-helper-maven-plugin is missing. @ line 89, column 12
[ERROR] 'dependencies.dependency.version' for mysql:mysql-connector-java:jar is missing. @ line 111, column 21
[WARNING] 'build.plugins.plugin.version' for org.codehaus.mojo:build-helper-maven-plugin is missing. @ line 135, column 12
[WARNING] 'build.plugins.plugin.version' for org.codehaus.mojo:build-helper-maven-plugin is missing. @ line 89, column 12
[WARNING] 'build.plugins.plugin.version' for org.codehaus.mojo:build-helper-maven-plugin is missing. @ line 108, column 12
[WARNING] 'dependencies.dependency.(groupId:artifactId:type:classifier)' must be unique: org.apache.camel.springboot:camel-amqp-starter:jar -> duplicate declaration of version  @ line 92, column 21
[WARNING] 'build.plugins.plugin.version' for org.codehaus.mojo:build-helper-maven-plugin is missing. @ line 97, column 12
 @


 


[ERROR] The build could not read 2 projects -> [Help 1]
[ERROR]
[ERROR]   The project org.apache.camel.springboot.example:spring-boot-jta-jpa:3.20.3 (/private/tmp/camel-spring-boot-examples/spring-boot-jta-jpa/pom.xml) has 1 error
[ERROR]     'dependencies.dependency.version' for mysql:mysql-connector-java:jar is missing. @ line 106, column 21
[ERROR]
[ERROR]   The project org.apache.camel.springboot.example:camel-example-spring-boot-rest-jpa:3.20.3 (/private/tmp/camel-spring-boot-examples/rest-jpa/pom.xml) has 1 error
[ERROR]     'dependencies.dependency.version' for mysql:mysql-connector-java:jar is missing. @ line 111, column 21
[ERROR]
[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.
[ERROR] Re-run Maven using the -X switch to enable full debug logging.","tcunning:1679888745:2023-03-27T11:45:45.650+0000:1679888761:2023-03-27T11:46:01.489+0000:I tried using the camel-spring-boot-examples 3.20.0 tag here and changed all the versions to 3.20.3.    It looks like in the main branch of camel-spring-boot-examples, rest-jpa and spring-boot-jta-jpa have been removed.     If they are unsupported for 3.20.3, maybe this issue is invalid.
davsclaus:1679889581:2023-03-27T11:59:41.138+0000:1679889581:2023-03-27T11:59:41.138+0000:Just add the mysql driver in the examples you want to use. 
tcunning:1679890917:2023-03-27T12:21:57.506+0000:1679890917:2023-03-27T12:21:57.506+0000:Hitting the same issue for camel-3.20.x branch on camel-spring-boot-examples - I think we at the least need a change in that branch.
nfilotto:1679891336:2023-03-27T12:28:56.238+0000:1679891551:2023-03-27T12:32:31.514+0000:Maybe it is because the mysql driver is under a GPL v2 license which is not compatible with an Apache License https://www.apache.org/licenses/GPL-compatibility.html ? I guess that if the scope is set to ""provided"", it should be good
davsclaus:1679952494:2023-03-28T05:28:14.470+0000:1679952494:2023-03-28T05:28:14.470+0000:Ah yeah that too. Maybe we can use another database that has ASF friendly license"
0,CAMEL-19206,Dependency upgrade,Minor,None,4.0.0,"
None
",Resolved,Fixed,4.0.0,Unassigned,Claus Ibsen,0,1,2023-03-27 10:08:11+00:00,2023-07-26 07:51:21+00:00,"This causes a test error


UndertowHttpsSpringTest.testSSLConsumer:63 » CamelExecution Exception occurred during execution on the exchange: Exchange[]",davsclaus:1690329081:2023-07-26T07:51:21.510+0000:1690329081:2023-07-26T07:51:21.510+0000:We have upgraded to 2.3.7
0,CAMEL-19205,Improvement,Minor,None,None,"
None
",Resolved,Fixed,"3.21.0, 4.0-M3, 4.0.0",Claus Ibsen,Claus Ibsen,0,2,2023-03-27 08:49:16+00:00,2023-03-28 11:22:50+00:00,"The tags is a Map<String, Object> type. We can make it a multi-valued so end users can configure tags in uris more easily.",
0,CAMEL-19204,Improvement,Minor,None,4.x,"
None
",Open,Unresolved,4.x,Unassigned,Steve Storck,0,2,2023-03-26 21:00:09+00:00,2023-11-22 20:04:34+00:00,"Claus Ibsen - here's a sort of proposal:


Some minor edits to org.apache.camel.maven.packaging.PropertyConfigurerGenerator will generate the case statements in the Java 17 style.  I am proposing this, rather than simply doing it and submitting a pull request, because this affects a lot of things.  But, since Camel has moved to Java 17 for version 4, it might be good to update how generated code looks, so that it conforms to the more modern standard.  I also did a bit of code cleanup in the class which could also be kept or discarded, depending on what you think about it.


I am attaching the modified class to this ticket.  Should this change be introduced?  Since it affects so much, is there a preferred way of doing this?","davsclaus:1679952665:2023-03-28T05:31:05.323+0000:1679952665:2023-03-28T05:31:05.323+0000:It makes backporting harder as the generated code cannot be cherry picked to 3.x. Lets wait until 3.21 is released and look at this in 6 months.
davsclaus:1700654671:2023-11-22T20:04:31.566+0000:1700654671:2023-11-22T20:04:31.566+0000:Okay 3.22 is the last Java 11 release, so we can consider this after we have released 3.22"
0,CAMEL-19203,Task,Minor,None,"4.0-M3, 4.0.0","
None
",Resolved,Fixed,"4.0-M3, 4.0.0",Unassigned,Dmitrii Kriukov,0,1,2023-03-26 17:24:10+00:00,2023-03-28 05:30:08+00:00,"Line 61


dir = PackageHelper.findCamelDirectory(baseDir, ""etc"");
The value from dir isn't used below.
Is it safe to delete rhis line or does it have side effects?",
0,CAMEL-19202,Task,Minor,None,"3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M3, 4.0.0",Claus Ibsen,Dmitrii Kriukov,0,1,2023-03-26 17:11:32+00:00,2023-03-27 08:31:08+00:00,"Line 88 in createProcessor()


Is it safe to remove lines 86-89?
Module camel-core-reifier",
0,CAMEL-19201,Task,Minor,None,"3.14.8, 3.18.6, 3.20.4, 3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.14.8, 3.18.6, 3.20.4, 3.21.0, 4.0-M3, 4.0.0",Claus Ibsen,Dmitrii Kriukov,0,2,2023-03-26 16:51:09+00:00,2023-03-26 17:04:20+00:00,"Line 122
Should the entire if block be removed?","davsclaus:1679820962:2023-03-26T16:56:02.445+0000:1679820962:2023-03-26T16:56:02.445+0000:Ah no it should be like this

        if (maxDeep == 0) {
            // disable it
            this.maxDeep = -1;
        } else {
            this.maxDeep = maxDeep;
        }
"
0,CAMEL-19200,Task,Minor,None,"3.20.4, 3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.20.4, 3.21.0, 4.0-M3, 4.0.0",Claus Ibsen,Dmitrii Kriukov,0,2,2023-03-26 16:31:32+00:00,2023-03-26 16:44:12+00:00,"Line 283 contains the unused assignment - should var s be returned?  
The result: method 


getLast(Row r) always returns empty string.",davsclaus:1679820252:2023-03-26T16:44:12.072+0000:1679820252:2023-03-26T16:44:12.072+0000:Thanks for reporting
0,CAMEL-19199,Bug,Minor,3.20.2,None,"
None
",Resolved,Fixed,"3.20.4, 3.21.0, 4.0-M3, 4.0.0",Claus Ibsen,Ghazanfar Ali,0,2,2023-03-26 09:13:25+00:00,2023-06-06 10:20:57+00:00,"I am using ModbusPal to create the Virtual modbus.


I am using the endpoint URI as:


 




plc4x:modbus-tcp://localhost:502?unitId=1&dataType=holding-register&addresses=1



Following is the screenshot of Modbus holding registers:





But when starting camel context it throws NullPointerException.


 




java.lang.NullPointerException
    at org.apache.camel.component.plc4x.Plc4XConsumer.startUnTriggered(Plc4XConsumer.java:89)
    at org.apache.camel.component.plc4x.Plc4XConsumer.doStart(Plc4XConsumer.java:81)
    at org.apache.camel.support.service.BaseService.start(BaseService.java:119) 



I debugged it and found the problem is with this line in PLC4XConsumer line 89:


 




for (Map.Entry<String, Object> tag : tags.entrySet()) {



 


Here tags are null, so it might be that I am not configuring the endpoint correctly.


So, I tried by configuring the endpoint by creating an instance of Plc4XEndpoint and then configuring the tags there, it works like:




Map<String, Object> map = new HashMap<>();
            map.put(""value-1"", ""holding-register:1"");
            
            Plc4XEndpoint plc4xEndpoint = new Plc4XEndpoint(""plc4x:modbus-tcp://localhost:502"",
                    getContext().getComponent(""plc4x""));
            plc4xEndpoint.setTags(map);
            from(plc4xEndpoint).log(""value : ${body}""); 



But why it is not working if I configure the endpoint as just String?


Note:


I tried with below endpoint and it is also not working:




plc4x:modbus-tcp://localhost:502?tags={unitId=1&dataType=holding-register&addresses=1}","davsclaus:1679877751:2023-03-27T08:42:31.390+0000:1679877751:2023-03-27T08:42:31.390+0000:Yes for tags you need to refer to a Map bean. However ideally the option should have been multivalued, so you could do

tag=foo=123&tag=bar&456&tag=aaa=222

mdanish98:1679879604:2023-03-27T09:13:24.437+0000:1679879700:2023-03-27T09:15:00.106+0000:Just for clarification, so this would work in the next release i.e. 3.20.4?
Or this should work in 3.20.2 as well?

I tried this as below but still not working:
{code:java}
from(""plc4x:modbus-tcp://localhost:502?tag=value-1=holding-register:1""){code}
The tags attribute is still null.
!image-2023-03-27-11-14-56-624.png!

 

*There is a requirement in my project that the endpoint should be String i.e. all the configurations should be in URI only and not as of type Endpoint.*
davsclaus:1679979558:2023-03-28T12:59:18.931+0000:1679979558:2023-03-28T12:59:18.931+0000:Yes in 3.21 release you can specify tags more easier, see  CAMEL-19205 "
0,CAMEL-19198,Bug,Minor,"3.18.3, 3.20.0",None,"

dynamic-router-eip

",Resolved,Fixed,"3.18.6, 3.20.4, 3.21.0, 4.0-M3, 4.0.0",Steve Storck,Steve Storck,0,2,2023-03-25 15:22:57+00:00,2023-03-26 12:22:07+00:00,"After switching the list of filters from a list to a map, the component no longer evaluates filter by order of their priority attribute.  Filter evaluation needs to ensure sorting by priority.","Steve973:1679730253:2023-03-25T15:44:13.414+0000:1679730253:2023-03-25T15:44:13.414+0000:[~davsclaus] which branches should also get a pull request for this?  My update to change the list of filters into a map was in 3.20.0 and 3.18.3.  My current pull request is for v4.
davsclaus:1679733881:2023-03-25T16:44:41.612+0000:1679733881:2023-03-25T16:44:41.612+0000:camel-3.x branch. Then we can cherry-pick to older branches.
Steve973:1679734254:2023-03-25T16:50:54.682+0000:1679734254:2023-03-25T16:50:54.682+0000:[~davsclaus] Thank you!  I just submitted a pull request for that, too.

I have been using this component at work, and we just found this bug this week.  By the way, thank you (and everyone working on it) for all of the work you are all doing for v4.
Steve973:1679800892:2023-03-26T11:21:32.513+0000:1679800892:2023-03-26T11:21:32.513+0000:Hi, [~davsclaus].  Do you need me to do the cherry-picking and submit pull requests?  Or is that something that you have done?  I haven't done a back-port here on Camel before.
davsclaus:1679804527:2023-03-26T12:22:07.084+0000:1679804527:2023-03-26T12:22:07.084+0000:I have done that, its easy when the cherry pick can be applied without problems. So all is good."
0,CAMEL-19197,Improvement,Major,4.0-M2,"4.0-M3, 4.0.0","
None
",Resolved,Fixed,"4.0-M3, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-03-25 12:30:13+00:00,2023-03-25 12:32:04+00:00,No Desc,
0,CAMEL-19196,Bug,Major,None,None,"
None
",Resolved,Invalid,None,Unassigned,Dmitrii Kriukov,0,1,2023-03-24 19:40:53+00:00,2023-03-24 21:05:00+00:00,"Observed with Kaspersky Antivirus
Issue/vulnarability UDS:Hoax.JS.ExtMsg.a",
0,CAMEL-19195,Task,Minor,None,,"
None
",Resolved,Not A Bug,None,Unassigned,Dmitrii Kriukov,0,2,2023-03-24 19:22:21+00:00,2023-03-24 21:14:02+00:00,But this field is read. Found in code inspection,davsclaus:1679663642:2023-03-24T21:14:02.556+0000:1679663642:2023-03-24T21:14:02.556+0000:The field is used in reset when pooled exchange is enabled where it uses system array copy
0,CAMEL-19194,Task,Minor,None,"4.0-M3, 4.0.0","
None
",Resolved,Fixed,"4.0-M3, 4.0.0",Unassigned,Dmitrii Kriukov,0,2,2023-03-24 18:26:35+00:00,2023-03-28 17:03:49+00:00,"It was found during code inspection. The condition 


equal && x < len
in line 167 is always false.",davsclaus:1679663547:2023-03-24T21:12:27.484+0000:1679663547:2023-03-24T21:12:27.484+0000:Yeah thanks. I am not sure if that compareTo method is even in use at all. Its a candidate for removal. The code is from 2010 ;)
0,CAMEL-19193,Improvement,Major,None,"3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M3, 4.0.0",Claus Ibsen,Dylan Piergies,0,3,2023-03-24 14:14:11+00:00,2023-10-22 08:51:31+00:00,"Change Micrometer component's default naming strategy to use Micrometer meter names that follow the Micrometer meter naming convention: https://micrometer.io/docs/concepts#_naming_meters


At present, the metrics are being published with names following the JavaClassNamingConvention.","dylan.piergies:1679638473:2023-03-24T14:14:33.876+0000:1679638473:2023-03-24T14:14:33.876+0000:I'll create a PR for this once the fix version(s) are assigned.
dylan.piergies:1679642444:2023-03-24T15:20:44.387+0000:1679642444:2023-03-24T15:20:44.387+0000:Created PR for {{{}main{}}}: https://github.com/apache/camel/pull/9633
davsclaus:1679663179:2023-03-24T21:06:19.487+0000:1679820047:2023-03-26T16:40:47.360+0000:Can you also update the 4.x migration guide, add a section to camel-micrometer and tell about this change
https://github.com/apache/camel/blob/main/docs/user-manual/modules/ROOT/pages/camel-4-migration-guide.adoc *DONE*
dylan.piergies:1679878540:2023-03-27T08:55:40.002+0000:1679878540:2023-03-27T08:55:40.002+0000:Was just getting round to updating the docs, but it seems [~davsclaus] beat me to it. Thanks for doing that.
gfournie:1680564175:2023-04-04T07:22:55.660+0000:1680564175:2023-04-04T07:22:55.660+0000:Hello, nice to see this done.

Is it an issue that can have a backport to a 3.x version or are the 3.x limited to fixes/CVEs ? If it is something that can be accepted I can take care of it.
davsclaus:1680564357:2023-04-04T07:25:57.062+0000:1680564369:2023-04-04T07:26:09.033+0000:Only in 3.21 (eg camel-3.x branch) and you need to add in the 3.21 upgrade about this change.
gfournie:1680566107:2023-04-04T07:55:07.818+0000:1680566107:2023-04-04T07:55:07.818+0000:Thank you [~davsclaus]  3.21 in enough for me. What exactly do you mean by ""you need to add in the 3.21 upgrade about this change"" ? 
davsclaus:1680566409:2023-04-04T08:00:09.643+0000:1680566409:2023-04-04T08:00:09.643+0000:https://github.com/apache/camel/blob/main/docs/user-manual/modules/ROOT/pages/camel-3x-upgrade-guide-3_21.adoc"
0,CAMEL-19192,Task,Minor,None,"4.0-M3, 4.0.0","
None
",Resolved,Fixed,"4.0-M3, 4.0.0",Unassigned,Dmitrii Kriukov,0,2,2023-03-24 13:51:37+00:00,2023-03-28 05:34:42+00:00,"Line 233, method 


public JettyConfigurationBuilder withSslContext(Supplier<SSLContext> contextSupplier) 
I set low priority since this method is unused according to my IDE",davsclaus:1679663864:2023-03-24T21:17:44.110+0000:1679663864:2023-03-24T21:17:44.110+0000:You are welcome to send a PR to fix this. The method should just be removed.
0,CAMEL-19191,Dependency upgrade,Major,None,"4.0-M3, 4.0.0","
None
",Resolved,Fixed,"4.0-M3, 4.0.0",Nicolas Filotto,Claus Ibsen,0,2,2023-03-24 13:02:58+00:00,2023-03-24 16:32:02+00:00,"SB works with 5.1.x, and 5.2.x is not backwards compabile. You get a ClassNotFoundException if running on SB.


If you run this example (remove the http client dependencies in pom.xml) to reproduce
https://github.com/apache/camel-spring-boot-examples/tree/main/kamelet-chucknorris


If we downsgrade to 5.1.x in camel-http then this should work OOTB",nfilotto:1679641683:2023-03-24T15:08:03.675+0000:1679641683:2023-03-24T15:08:03.675+0000:The corresponding PR https://github.com/apache/camel/pull/9632
0,CAMEL-19190,Bug,Major,None,"3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M3, 4.0.0",James Netherton,James Netherton,0,1,2023-03-24 12:01:57+00:00,2023-03-27 06:39:16+00:00,"While adding some more test coverage for vertx-websocket in Camel Quarkus, I noticed the logic to find connected peers on the local server when using the sendToAll option or the CamelVertxWebsocket.connectionKey header is a bit flawed. It can fail to find the correct peer, or incorrectly find matches for the wrong peers.


There's some more background in this Camel Quarkus issue:


https://github.com/apache/camel-quarkus/issues/4628",jamesnetherton:1679644430:2023-03-24T15:53:50.834+0000:1679644430:2023-03-24T15:53:50.834+0000:Fixed this for 4.x. Before resolving the ticket I'll check if it's feasible to backport the changes to other branches.
0,CAMEL-19189,Task,Major,None,"4.0-M3, 4.0.0","
None
",Resolved,Fixed,"4.0-M3, 4.0.0",Nicolas Filotto,Nicolas Filotto,0,1,2023-03-23 18:58:29+00:00,2023-03-23 20:57:57+00:00,"To use the Groovy language in native, we need to adapt the current code to be able to provide all the pre-compiled groovy classes at build time.",nfilotto:1679569436:2023-03-23T19:03:56.526+0000:1679569436:2023-03-23T19:03:56.526+0000:The corresponding PR https://github.com/apache/camel/pull/9620
0,CAMEL-19188,New Feature,Major,None,"3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M3, 4.0.0",Unassigned,Felix Hoßfeld,0,2,2023-03-22 19:15:17+00:00,2023-03-27 18:48:30+00:00,"We are trying to access Pimcore through the camel-graphql component. It requires that an API-Key ist either send as a Query-Parameter (by appending ""?apikey=123456"" to the uri) or as a Header ("".setHeader('x-api-key', constant('123456'))"").


At the moment neither approaches work because the additional parameter triggers the following error:


 There are 1 parameters that couldn't be set on the endpoint. Check the uri if the parameters are spelt correctly and that they are properties of the endpoint. Unknown parameters=[{apikey=123456} And the headers in the incoming message are simply ignored.


I think two approaches are possible to fix this: Either the component should support the Exchange.HTTP_QUERY-Header and append this to the uri or there should be an option to copy headers to the http message - preferable with a list or regex to limit the headers sent.


What approaches do you recommend/prefer? I would be willing to provide a path for either.","davsclaus:1679520667:2023-03-23T05:31:07.312+0000:1679520821:2023-03-23T05:33:41.601+0000:The component can become lenient properties like http components, so you can append any kind of parameters you like in the uri. And yeah also support for custom headers via a header is a good idea. 

Using HTTP_QUERY may not be idea if you do

from x
  to http
  to graphql

or 

from servlet/platform-http
   to graphql

As then HTTP_QUERY headers from the http component may interfere. We may use a new header in graphql only for this instead.
fhossfel:1679536890:2023-03-23T10:01:30.154+0000:1679536890:2023-03-23T10:01:30.154+0000:Making the component lenient is sufficient for my use case. What do I have to change to make this happen. Is
{code:java}
@UriEndpoint(lenientProperties = true) {code}
and

 
{code:java}
@Override
public boolean isLenientProperties() {
    return true;    
} {code}
sufficient?

Regarding Exchange.HTTP_QUERY: Lots of other components use HTTP_QUERY for exactly the same purpose. If a HTTP_QUERY header is only intended for the a previous step then a .removeHeaders(Exchange.HTTP_QUERY) call seems warranted.
davsclaus:1679555357:2023-03-23T15:09:17.504+0000:1679555357:2023-03-23T15:09:17.504+0000:1)
Yes that is what you need for lenient. And then you also need to extract the ""left over properties"" when creating the endpoint which then becomes the query parameters.
Its not super easy, maybe look at some of the other lenient components and see what they do

2)
Yeah add support for that HTTP_QUERY as well

3)
Add unit tests

fhossfel:1679902599:2023-03-27T15:36:39.733+0000:1679902599:2023-03-27T15:36:39.733+0000:I have filed [PR 9655|https://github.com/apache/camel/pull/9655] to address point 1.) and 2.)

Point 2.) I would add later if necessary. Or use-case can be solved by inserting properties into the uri.
davsclaus:1679914110:2023-03-27T18:48:30.816+0000:1679914110:2023-03-27T18:48:30.816+0000:Thanks"
0,CAMEL-19187,Improvement,Major,None,"3.20.4, 3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.20.4, 3.21.0, 4.0-M3, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-03-22 18:58:19+00:00,2023-03-22 19:43:28+00:00,"~/workspace/deleteme/csv ❯ camel version                                                                                                                                                        ✘ INT 13s
Camel JBang version: 4.0.0-SNAPSHOT
User configuration:
    camel-version = 3.20.2
~/workspace/deleteme/csv ❯ camel dependency list --fresh
org.apache.camel:camel-main:4.0.0-SNAPSHOT
org.apache.camel:camel-bean:4.0.0-SNAPSHOT
org.apache.camel:camel-csv:4.0.0-SNAPSHOT
org.apache.camel:camel-direct:4.0.0-SNAPSHOT
org.apache.camel:camel-file:4.0.0-SNAPSHOT
org.apache.camel:camel-health:4.0.0-SNAPSHOT
org.apache.camel:camel-log:4.0.0-SNAPSHOT
org.apache.camel:camel-rest:4.0.0-SNAPSHOT",
0,CAMEL-19186,Improvement,Major,None,"3.20.3, 3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.20.3, 3.21.0, 4.0-M3, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-03-22 14:04:34+00:00,2023-03-22 15:10:28+00:00,Reported on user forum,
0,CAMEL-19185,Improvement,Trivial,"3.20.1, 3.20.2","3.20.3, 3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.20.3, 3.21.0, 4.0-M3, 4.0.0",Luigi De Masi,Luigi De Masi,0,1,2023-03-22 10:59:58+00:00,2023-03-24 21:19:40+00:00,No Desc,
0,CAMEL-19184,Test,Major,4.0-M3,"4.0-M3, 4.0.0","
None
",Resolved,Fixed,"4.0-M3, 4.0.0",Nicolas Filotto,Jiri Ondrusek,0,2,2023-03-22 10:23:56+00:00,2023-03-22 15:19:58+00:00,"During upgrading camel-quarkus to the current camel version I noticed a http test, which is failing.


I did some investigation:



test case using basic auhentication with`httpContext` is not part of the camel test suite
test is failing on camel
when I reverted to the revision before upgrade of http component to 5.x, test worked



Here is the commit with upgrade of http components to 5.x (commit)
Here is the added before the upgrade - test succeeds. (branch)
Here is the same test after upgrade of http components - test fails. (branch)


I'd suggest to add this test to the camel test suite a fix the behavior of http component (it is possible that the tested scenario has to be configured differently after upgrade. If so, migration guide should be updated)","jondruse:1679451964:2023-03-22T10:26:04.707+0000:1679451964:2023-03-22T10:26:04.707+0000:[~davsclaus] This might be a regression. (may be the priority should be higher) 

( [~essobedo] FYI)
nfilotto:1679455481:2023-03-22T11:24:41.326+0000:1679455481:2023-03-22T11:24:41.326+0000:[~jondruse]Thanks for reporting and the test case, let me chek
nfilotto:1679456477:2023-03-22T11:41:17.804+0000:1679456477:2023-03-22T11:41:17.804+0000:[~jondruse]I don't understand your use case, why do you change the password? https://github.com/JiriOndrusek/camel/commit/b76048832feb8780003d209fcf7c5283a5ee3f17#diff-5027ce3bc96107739783be9286c05fc5edfeeb24d748e4084b9a1f40c3d89797R89-R90
nfilotto:1679456532:2023-03-22T11:42:12.762+0000:1679456532:2023-03-22T11:42:12.762+0000:If I use {{password.toCharArray()}} as password, the test passes
nfilotto:1679464837:2023-03-22T14:00:37.898+0000:1679464837:2023-03-22T14:00:37.898+0000:The PR https://github.com/apache/camel/pull/9607 to add the test case"
0,CAMEL-19183,New Feature,Minor,None,"4.0-M3, 4.0.0","
None
",Resolved,Fixed,"4.0-M3, 4.0.0",James Netherton,James Netherton,0,1,2023-03-22 09:53:35+00:00,2023-03-22 14:45:22+00:00,"Many frameworks (springdoc-openapi, SmallRye OpenAPI etc) have an option to specify a default produces / consumes content type for Swagger / OpenAPI documentation.


It could be useful to have something similar in Camel and allow it to be overridable via the usual .consumes() & .produces() REST DSL options.


It would fix a slight quirk of how the OpenAPI v3 doc generation is done. If you specify an input body for a verb and omit consumes, then the body config never gets configured and rendered in the API docs (expected since consumes is mandatory when there's a body). But there's no hint in Camel that the consumes part was required. Thus having a default would allow it to always work and you get better dev feedback by being able to have the body content available via the Swagger UI.


I've seen from posts on stackoverflow.com and elsewhere, where the lack of a default has been a source of confusion for folks when they don't provide produces / consumes in their REST config, and wonder why the API docs are not rendered as expected.",
0,CAMEL-19152,Improvement,Minor,3.20.2,"3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M3, 4.0.0",Unassigned,Andreas Klug,0,1,2023-03-15 09:34:58+00:00,2023-03-22 14:32:22+00:00,"a) The datalake component has a createFile operation, which returns a response of type 
DataLakeFileClient, which represents inherently a specific directory. The issue is that subsequent operations do not make use of that instance, resulting in the fact that the directory seems to be always root. The proposal is



to add a new exchange header on createFile, that can be used for further operations
if that new exchange header is set for file operations, use the client from the header
That would allow to seamlessly use createFile, append, ... together while considering directories.
b) Furthermore, there is an additional flush option on the append operation, which IMHO might make sense to add
 
I created the pull request https://github.com/apache/camel/pull/9541 for these changes.",
0,CAMEL-19151,Bug,Minor,3.20.2,"3.18.6, 3.20.3, 3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.18.6, 3.20.3, 3.21.0, 4.0-M3, 4.0.0",Claus Ibsen,Eduard Gomoliako,0,2,2023-03-15 09:16:50+00:00,2023-03-15 15:04:20+00:00,"The 'ignoreInvalidEndpoint' option for the WireTap component has no effect on the non-dynamic endpoints.


The worst thing is that there is no warning that the set option is going to be ignored.


I'm not sure about the design decision here, but from the user point of view it's confusing and not what one can expect.


 


My use case:


I defined a route configuration that by default does some processing of the intercepted messages and also sends them to a preconfigured endpoint. In my design this endpoint is optional and a route for it could be defined only if the default processing isn't enough. 


But because the endpoint URI is static and the 'ignoreInvalidEndpoint' has no effect, I get the messages stuck in-flight.","davsclaus:1678843942:2023-03-15T09:32:22.881+0000:1678843942:2023-03-15T09:32:22.881+0000:Invalid endpoints is supposed for dynamic uris only.
If you have static urls then they are intended to be correct and valid.
davsclaus:1678844218:2023-03-15T09:36:58.664+0000:1678844218:2023-03-15T09:36:58.664+0000:I am updating the documentation on that option to better say that its only for dynamic urls
davsclaus:1678845020:2023-03-15T09:50:20.911+0000:1678845020:2023-03-15T09:50:20.911+0000:Ah its actually better to make wiretap use the ignore invalid option even for static urls, then its consistent, and there is little harm as the option is default false.
Gomoliako:1678857337:2023-03-15T13:15:37.101+0000:1678857337:2023-03-15T13:15:37.101+0000:Yes, I find it better this way as well. I'd suggest also considering the other similar places to have the same behavior, so it's consistent throughout the whole system.

Let me know if you'd need a hand with that, I can prepare the relevant pull requests.
davsclaus:1678859975:2023-03-15T13:59:35.619+0000:1678859975:2023-03-15T13:59:35.619+0000:Okay have you found other places where the option is not in use for static uris?
Gomoliako:1678863860:2023-03-15T15:04:20.120+0000:1678863860:2023-03-15T15:04:20.120+0000:I checked the places where such a setting is used throughout the Camel codebase, and it seems that the WireTap was the only one with such a condition.

 

Hence, I guess fixing just it will make it all consistent."
0,CAMEL-19150,Bug,Minor,"3.18.5, 3.20.2, 4.0-M2","3.14.8, 3.18.6, 3.20.3, 3.21.0, 4.0-M3","
None
",Resolved,Fixed,"3.14.8, 3.18.6, 3.20.3, 3.21.0, 4.0-M3",Zheng Feng,James Netherton,0,1,2023-03-15 07:36:17+00:00,2023-03-22 10:59:29+00:00,"When using olingo4://read and providing the queryParams option, it seems the value is not handled correctly. The toString() value of the provided map is used as query parameters to the odata service.


There's some more detail in the original Camel Quarkus issue here:


https://github.com/apache/camel-quarkus/issues/4654",
0,CAMEL-19149,Task,Minor,3.14.8,,"
None
",Resolved,Won't Fix,None,Unassigned,Jack J. Woehr,0,2,2023-03-14 17:48:53+00:00,2023-03-28 17:10:13+00:00,"examples/google/google-pubsub fails with the following error:


11:36:10.500 [Camel (Google-PubSub) thread #2 - timer://tick] ERROR org.apache.camel.processor.errorhandler.DefaultErrorHandler - Failed delivery for (MessageId: E311BB5126FDF04-0000000000000017 on ExchangeId: E311BB5126FDF04-0000000000000017). Exhausted after delivery attempt: 1 caught: java.util.concurrent.ExecutionException: com.google.gson.stream.MalformedJsonException: Use JsonReader.setLenient(true) to accept malformed JSON at line 1 column 1 path $",davsclaus:1679994613:2023-03-28T17:10:13.875+0000:1679994613:2023-03-28T17:10:13.875+0000:You need to set correct credentials in the application.proprties
0,CAMEL-19148,Bug,Major,None,,"
None
",Closed,Not A Bug,None,Unassigned,Federico Mariani,0,3,2023-03-14 15:33:04+00:00,2023-03-15 08:25:59+00:00,"When camel-version is set (same for custom camel-version) the log file is not created, seems like that log4j2*.properties files are not taken in account when specifying a camel-version, therefore, commands like camel-log cannot be used.","davsclaus:1678783134:2023-03-14T16:38:54.920+0000:1678820803:2023-03-15T03:06:43.167+0000:You need a newer Camel version to have camel log working, eg 3.20.2 or higher. You cannot have this working with older Camel versions.
fmariani:1678839947:2023-03-15T08:25:47.239+0000:1678839947:2023-03-15T08:25:47.239+0000:Thanks for the reply, it totally makes sense, I tried camel-version=3.20.1"
0,CAMEL-19147,Task,Minor,3.20.0,,"
None
",Resolved,Won't Fix,None,Unassigned,Vivian Kong,0,2,2023-03-14 13:42:47+00:00,2023-03-28 17:08:35+00:00,"Encountered the following errors in v3.20.0:


in camel-example-spring-security:
org.springframework.beans.factory.BeanDefinitionStoreException: Unexpected exception parsing XML document from class path resource [camel-context.xml]; nested exception is java.lang.NoClassDefFoundError: org/springframework/security/web/session/DisableEncodeUrlFilter


in camel-example-spring-ws:
javax.servlet.ServletException: org.springframework.web.util.NestedServletException: Request processing failed; nested exception is org.springframework.ws.soap.SoapMessageCreationException: Could not create message from InputStream: Unable to internalize message; nested exception is com.sun.xml.messaging.saaj.SOAPExceptionImpl: Unable to internalize message


Please update the versions for the following dependencies in camel-example to match the ones in Camel:


spring-security-version to 5.7.5 in examples/pom.xml
com.sun.xml.messaging.saaj to 1.5.3 in examples/spring-ws/pom.xml


Thank you.","davsclaus:1678820940:2023-03-15T03:09:00.912+0000:1678820940:2023-03-15T03:09:00.912+0000:You are welcome to send PRs for the 3.x branch and main
https://github.com/apache/camel-examples/tree/camel-3.x/examples/spring-security
davsclaus:1679994515:2023-03-28T17:08:35.477+0000:1679994515:2023-03-28T17:08:35.477+0000:The examples are taking dependencies from the release. There is a new 3.20.3 on the way."
0,CAMEL-19146,Bug,Major,3.18.2,,"
None
",Closed,Not A Problem,None,Unassigned,Alexander Anpilov,0,2,2023-03-14 12:57:21+00:00,2023-08-11 09:15:01+00:00,"When I was using camel-http:3.15.0 this endpoint worked fine:


.to(""http://some-url?authHost={{http.ntlmAuthHost}}&authDomain={{http.ntlmAuthDomain}}&authUsername={{http.ntlmAuthUsername}}&authPassword={{http.ntlmAuthPassword}}"")


 


Arter that fix ""CAMEL-18355"" ntlm auth not working.


Problem started from version 3.18.2


I have tested all versions to 3.20.2.


 


Maybe I need to change URI for new versions?","aanpilov:1678772595:2023-03-14T13:43:15.453+0000:1678772595:2023-03-14T13:43:15.453+0000:After some debug i have found that problem was with authHost property.

I supposed that we must set domain-controller host for NTLM auth here.

But it seems that this is host for which we should NTLM auth.

After removing property everything is fine.
akvel:1691716501:2023-08-11T09:15:01.312+0000:1691716501:2023-08-11T09:15:01.312+0000:In my case for NTLM auth correct works - authHost must set to some-url's hostname

Example:
{code:java}
http://my-host.test.com/test/path?authHost=my-host.test.com&authDomain={{http.ntlmAuthDomain}}&authUsername={{http.ntlmAuthUsername}}&authPassword={{http.ntlmAuthPassword}}{code}"
0,CAMEL-19145,Improvement,Minor,None,"3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M3, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-03-14 11:51:29+00:00,2023-03-15 09:29:38+00:00,"Instead of the full url we can have a set of known repos (atlassian, and others) which you can refer by a id instead of the full url.",
0,CAMEL-19144,Improvement,Major,None,"3.20.3, 3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.20.3, 3.21.0, 4.0-M3, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-03-14 08:30:59+00:00,2023-03-14 10:29:58+00:00,"This allows us to know what Camel releases we have done, and at what time, and when they are EOL.",
0,CAMEL-19143,New Feature,Minor,3.20.1,"3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M3, 4.0.0",Unassigned,Brice Frisco,0,1,2023-03-13 20:23:07+00:00,2023-12-26 12:30:30+00:00,"Given a POJO such as:




@CsvRecord(generateHeaderColumns = true, separator = "","")
public class SomeOutput {
    @DataField(columnName = ""hello"", pos = 1)
    private String hello = ""Hello,"";
    @DataField(columnName = ""world"", pos = 2)
    private String world = ""World!"";

    // getters and setters
}



And a route such as:




from(""timer://test?repeatCount=1"")
    .setBody(constant(new SampleOutput()))
    .marshal(CSV_FORMAT)
    .log(""${body}""); 



Bindy produces this output:




hello,world
Hello,,World! 



Which looks like the following in CSV format:





 


Fields which contain the chosen separator are not automatically escaped or quoted. One workaround to this is to add `quoting=true` to the `CsvRecord`, which will quote all fields.


I think it would be nice if an option existed that would quote fields only when it is necessary, which can reduce the file size. This method of dynamic quoting is the way it is handled by default in Excel on Windows systems.","bfrisco:1678710233:2023-03-13T20:23:53.186+0000:1678710233:2023-03-13T20:23:53.186+0000:I can work on this, if you all think it would be a good addition.
bfrisco:1678801947:2023-03-14T21:52:27.714+0000:1678801947:2023-03-14T21:52:27.714+0000:Expanding on this, according to RFC 4180 2.6:
{noformat}
https://www.ietf.org/rfc/rfc4180.txt

6.  Fields containing line breaks (CRLF), double quotes, and commas
       should be enclosed in double-quotes.  For example:
       ""aaa"",""b CRLF
       bb"",""ccc"" CRLF
       zzz,yyy,xxx{noformat}
 

So, this option would enable quoting a field *if and only if* that field:
 * contains the configured `crlf` character OR
 * contains the configured `quote` character OR
 * contains the configured `separator` character

 "
0,CAMEL-19142,Task,Major,None,"4.0-M3, 4.0.0","
None
",Resolved,Fixed,"4.0-M3, 4.0.0",Unassigned,Claus Ibsen,0,1,2023-03-13 19:52:34+00:00,2023-03-24 21:51:15+00:00,Some examples need changes to pom.xml,
0,CAMEL-19141,Dependency upgrade,Major,None,"4.0-M3, 4.0.0","
None
",Resolved,Fixed,"4.0-M3, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-03-13 19:38:36+00:00,2023-03-17 15:51:17+00:00,No Desc,
0,CAMEL-19140,Bug,Minor,None,,"
None
",Resolved,Invalid,None,Unassigned,Yuri V,0,2,2023-03-13 18:43:50+00:00,2023-06-03 06:11:57+00:00,"It was originally fixed in CAMEL-6881, but then broken by https://github.com/apache/camel/commit/d3cc93f0942e16876970c2ad7e3845e723eeac0f",davsclaus:1678706974:2023-03-13T19:29:34.996+0000:1678706974:2023-03-13T19:29:34.996+0000:Can you explain better what you think is wrong!
0,CAMEL-19139,Task,Major,None,"4.0-M3, 4.0.0","
None
",Resolved,Fixed,"4.0-M3, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-03-13 13:34:55+00:00,2023-04-19 09:02:19+00:00,"It would be good to include yyyy-MM-dd in the MANIFEST.MF so we know when JARs was build, and therefore released.


We need this for tooling as they can use that to tell users when a Camel version was released, and also whether its EOL or not etc. (1 year since release).


Today the information is manually entered in camel-website in the release archive.","davsclaus:1680049615:2023-03-29T08:26:55.749+0000:1680049615:2023-03-29T08:26:55.749+0000:For example in camel-arangodb 

Manifest-Version: 1.0
Created-By: Maven JAR Plugin 3.3.0
Build-Jdk-Spec: 17
Implementation-Title: Camel :: ArangoDB
Implementation-Version: 4.0.0-SNAPSHOT
Implementation-Vendor: The Apache Software Foundation
Build-Date: 2023-03-29
davsclaus:1680053342:2023-03-29T09:29:02.819+0000:1680053342:2023-03-29T09:29:02.819+0000:also done for camel-spring-boot
davsclaus:1681866139:2023-04-19T09:02:19.404+0000:1681866139:2023-04-19T09:02:19.404+0000:Okay we found another way, so disabling Build-Date in the JARs"
0,CAMEL-19138,Task,Major,3.21.0,"3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M3, 4.0.0",Grzegorz Grzybek,Grzegorz Grzybek,0,1,2023-03-13 13:23:39+00:00,2023-03-14 12:36:46+00:00,[ERROR] Failed to execute goal net.revelc.code:impsort-maven-plugin:1.6.0:check (check) on project camel-tooling-util: Execution check of goal net.revelc.code:impsort-maven-plugin:1.6.0:check failed: A required class was missing while executing net.revelc.code:impsort-maven-plugin:1.6.0:check: org/codehaus/plexus/util/DirectoryScanner,"ggrzybek:1678765704:2023-03-14T11:48:24.022+0000:1678765704:2023-03-14T11:48:24.022+0000:Fixed [here|https://github.com/apache/camel/commit/5a652008ee1ef2f1eb9f34fcc01f3d973880a945] in camel-3.x branch.
ggrzybek:1678768606:2023-03-14T12:36:46.546+0000:1678768606:2023-03-14T12:36:46.546+0000:{{main}} branch was fine after https://github.com/apache/camel/commit/a6e94a37b4830."
0,CAMEL-19137,Improvement,Minor,3.18.3,"3.20.3, 3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.20.3, 3.21.0, 4.0-M3, 4.0.0",Unassigned,Adriano Marcondes Machado,0,1,2023-03-12 22:29:16+00:00,2023-03-13 06:34:07+00:00,"When Spring Boot detects more than one instance of `MeterRegistry` in the application context configuration (for example, both `meter-registry-jmx` and `meter-registry-prometheus` are on the classpath and the actuator endpoint for Prometheus is enabled), the auto-configuration adds an instance of `CompositeMeterRegistry` and configures it as the primary bean.


When the micrometer component starts, it looks for an instance of `MeterRegistry` on Camel registry with the name `MicrometerConstants.METRICS_REGISTRY_NAME`. If not found, the component tries to locate a single instance of any `MeterRegistry` object on the registry.


In the previous example configuration, there will be 3 instances of `MeterRegistry`, and the current behavior is to create a new instance of `MeterRegistry` to use.


This changes the default behavior to look first for instances of `CompositeMeterRegistry` before looking for instances of `MeterRegistry`.",ammachado:1678631528:2023-03-12T22:32:08.599+0000:1678631528:2023-03-12T22:32:08.599+0000:There's a PR available for this issue: https://github.com/apache/camel/pull/9513
0,CAMEL-19136,Bug,Major,"3.20.0, 3.20.1, 3.20.2","3.20.3, 3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.20.3, 3.21.0, 4.0-M3, 4.0.0",Claus Ibsen,Max,0,2,2023-03-12 19:41:50+00:00,2023-03-19 11:06:09+00:00,"From discussion  in zulip https://camel.zulipchat.com/#narrow/stream/257298-camel/topic/springboot.20micrometer.20http.20metrics.20issue/near/340948367


in https://issues.apache.org/jira/browse/CAMEL-18754 https://github.com/apache/camel-spring-boot/commit/ac318f0418e55c56d0fb426607c67a5ceb1f6742 new configuration has been introduced MicrometerTagsAutoConfiguration.


Request uri with placeholders in the metrics tag is replaced with actual value e.g.




 @RequestMapping(value = ""/users/{id}"" method = RequestMethod.GET)




instead of 




http_server_requests_seconds_bucket{application=""my-app"",exception=""None"",method=""GET"",outcome=""SUCCESS"",status=""200"",uri=""/users/{id}"",le=""0.894784851"",} 9999.0




is reported as 




http_server_requests_seconds_bucket{application=""my-app"",exception=""None"",method=""GET"",outcome=""SUCCESS"",status=""200"",uri=""/users/1"",le=""0.894784851"",} 1.0
http_server_requests_seconds_bucket{application=""my-app"",exception=""None"",method=""GET"",outcome=""SUCCESS"",status=""200"",uri=""/users/2"",le=""0.894784851"",} 1.0
http_server_requests_seconds_bucket{application=""my-app"",exception=""None"",method=""GET"",outcome=""SUCCESS"",status=""200"",uri=""/users/3"",le=""0.894784851"",} 1.0
http_server_requests_seconds_bucket{application=""my-app"",exception=""None"",method=""GET"",outcome=""SUCCESS"",status=""200"",uri=""/users/999999"",le=""0.894784851"",} 1.0




and of course will end up a lot of tags which is bad for prometheus.


and spring reports warning




logger_name     org.springframework.boot.actuate.autoconfigure.metrics.OnlyOnceLoggingDenyMeterFilter
message     Reached the maximum number of URI tags for 'http.server.requests'.
How can we preserve original uri tag? We combine camel with spring boot, so rest api layer is provided by spring boot but integration layer (messaging, http client etc.. ) is done by camel, so would love to keep camel route stats but keep spring boot reported metrics




basically




@Bean
    WebMvcTagsProvider webMvcTagsProvider() {
....
return Tags.concat(
                        super.getTags(request, response, handler, exception),
                        Tags.of(Tag.of(""uri"", uri))
                );




makes out of /users/{id} -> /users/1
by excluding 




@SpringBootApplication(exclude = {MicrometerTagsAutoConfiguration.class}) 




we get the original behavior. But the risk is that if future versions add more beans into MicrometerTagsAutoConfiguration they will be ignored


How can we preserve original uri tag or make it configurable?
may be regex/whitelist/blacklist on which it should apply?","davsclaus:1679108904:2023-03-18T11:08:24.474+0000:1679108904:2023-03-18T11:08:24.474+0000:Okay its turned off and you can enable it

camel.metrics.uriTagEnabled=true"
0,CAMEL-19135,Improvement,Major,None,"4.0-RC1, 4.0.0","
None
",Resolved,Fixed,"4.0-RC1, 4.0.0",Claus Ibsen,Claus Ibsen,0,2,2023-03-12 10:26:39+00:00,2023-05-23 15:26:05+00:00,"spi-tooling has Category as enum.


We should reduce the number of different we have and make the category more general, eg:


hl7 + mllp => health
rss ?
soap -> webservice
tcp + udp + websocket -> networking
support ?
datamining ?
hadoop -> bigdata
bitcoin -> blockchain
compute | computing ?
container ?
deeplearning -> ai
deployment ?
eventbus -> messaging
identity -> security
ldap -> security
log ?
nosql | sql -> database
payment -> finance
printing ?
process ?
queue -> messaging
reporting ? -> document
rpc -> networking
sheets -> document
spring ?
swagger ?
process -> workflow","davsclaus:1684815828:2023-05-23T12:23:48.662+0000:1684815828:2023-05-23T12:23:48.662+0000:    DATAMINING(""datamining""),
    AI(""ai""),
    API(""api""),
    AZURE(""azure""),
    BATCH(""batch""),
    BIGDATA(""bigdata""),
    BITCOIN(""bitcoin""),
    BLOCKCHAIN(""blockchain""),
    CACHE(""cache""),
    CHAT(""chat""),
    CLOUD(""cloud""),
    CLUSTERING(""clustering""),
    CMS(""cms""),
    COMPUTE(""compute""),
    COMPUTING(""computing""),
    CONTAINER(""container""),
    CORE(""core""),
    CRM(""crm""),
    DATA(""data""),
    DATABASE(""database""),
    DATAGRID(""datagrid""),
    DEEPLEARNING(""deeplearning""),
    DEPLOYMENT(""deployment""),
    DOCUMENT(""document""),
    ENDPOINT(""endpoint""),
    ENGINE(""engine""),
    EVENTBUS(""eventbus""),
    FILE(""file""),
    HADOOP(""hadoop""),
    HCM(""hcm""),
    HL7(""hl7""),
    HTTP(""http""),
    IDENTITY(""identity""),
    IOT(""iot""),
    JAVA(""java""),
    LDAP(""ldap""),
    LEDGER(""ledger""),
    LOCATION(""location""),
    LOG(""log""),
    MAIL(""mail""),
    MANAGEMENT(""management""),
    MESSAGING(""messaging""),
    MLLP(""mllp""),
    MOBILE(""mobile""),
    MONITORING(""monitoring""),
    NETWORKING(""networking""),
    NOSQL(""nosql""),
    OPENAPI(""openapi""),
    PAAS(""paas""),
    PAYMENT(""payment""),
    PLANNING(""planning""),
    PRINTING(""printing""),
    PROCESS(""process""),
    QUEUE(""queue""),
    REACTIVE(""reactive""),
    REPORTING(""reporting""),
    REST(""rest""),
    RPC(""rpc""),
    RSS(""rss""),
    SAP(""sap""),
    SCHEDULING(""scheduling""),
    SCRIPT(""script""),
    SEARCH(""search""),
    SECURITY(""security""),
    SERVERLESS(""serverless""),
    SHEETS(""sheets""),
    SOAP(""soap""),
    SOCIAL(""social""),
    SPRING(""spring""),
    SQL(""sql""),
    STREAMS(""streams""),
    SUPPORT(""support""),
    SWAGGER(""swagger""),
    SYSTEM(""system""),
    TCP(""tcp""),
    TESTING(""testing""),
    TRANSFORMATION(""transformation""),
    UDP(""udp""),
    VALIDATION(""validation""),
    VOIP(""voip""),
    WEBSERVICE(""webservice""),
    WEBSOCKET(""websocket""),
    WORKFLOW(""workflow"");

davsclaus:1684818976:2023-05-23T13:16:16.378+0000:1684821009:2023-05-23T13:50:09.407+0000:Reduced from 83 to 37 categories
rhuanrocha:1684826008:2023-05-23T15:13:28.302+0000:1684826406:2023-05-23T15:20:06.231+0000:Can we consider the log component as observability? Maybe, log, swagger, etc, we can define as observability type. Does it make sense?
davsclaus:1684826765:2023-05-23T15:26:05.059+0000:1684826765:2023-05-23T15:26:05.059+0000:Yeah we have MONITORING today but using OBSERVABILITY is a better name. A PR to rename is welcome."
0,CAMEL-19134,Dependency upgrade,Minor,None,"4.0-M3, 4.0.0","
None
",Resolved,Fixed,"4.0-M3, 4.0.0",James Netherton,Claus Ibsen,0,2,2023-03-12 09:12:13+00:00,2023-03-30 13:14:37+00:00,No Desc,"jamesnetherton:1680130474:2023-03-30T06:54:34.181+0000:1680130474:2023-03-30T06:54:34.181+0000:I can try to do this. We need it for Camel Quarkus:

https://github.com/apache/camel-quarkus/issues/4651

Would also be good to take the opportunity to clean up some usage of deprecated kubernetes-client APIs. E.g usage of 'replace' and instead use 'update'."
0,CAMEL-19133,Bug,Minor,3.20.2,"3.20.3, 3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.20.3, 3.21.0, 4.0-M3, 4.0.0",Claus Ibsen,geyipeng,0,2,2023-03-11 01:28:16+00:00,2023-03-11 07:12:08+00:00,"my code:


@Component
public class MyRouter extends RouteBuilder {
@Value(""${server.port}"")
String port;


@Override
public void configure() throws Exception {
getCamelContext().addRoutePolicyFactory(new ServiceRegistrationRoutePolicyFactory());
from(""direct:1"")
.routeProperty(ServiceDefinition.SERVICE_META_NAME, ""addHello"")
.routeProperty(ServiceDefinition.SERVICE_META_ID, ""my-id"" + port)
.routeProperty(ServiceDefinition.SERVICE_META_PORT, port)
.process(new Processor() {
@Override
public void process(Exchange exchange) throws Exception {
exchange.getMessage().setBody(exchange.getMessage().getBody() + ""hello"");
}
})
.log(""${body}"");
from(""timer://foo?fixedRate=true&period=1000"")
.serviceCall()
.name(""addHello"")
.zookeeperServiceDiscovery()
.nodes(""127.0.0.1"")
.basePath(""/config"")
.end()
.log(""${body}"");
}
}


issue:


The service registration function of zookeeper will carry type information during serialization
{{ }}
and an error will be reported due to different MetaData during deserialization
{{ }}
solution:
The internal class MetaData in the ZooKeeperServiceDiscovery and ZooKeeperServiceRegistry needs to be extracted
This is my modified patch in the camel-3.20.2 revision of the camel-zookeeper project",davsclaus:1678489928:2023-03-11T07:12:08.419+0000:1678489928:2023-03-11T07:12:08.419+0000:Thanks for reporting and the patch.
0,CAMEL-19132,Improvement,Major,None,"3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M3, 4.0.0",Claus Ibsen,Claus Ibsen,0,3,2023-03-10 17:50:32+00:00,2023-11-07 19:19:17+00:00,No Desc,"davsclaus:1678445095:2023-03-10T18:44:55.887+0000:1678583473:2023-03-12T09:11:13.497+0000:TODO: deprecate in 3.21 *DONE*
TODO: remove directvm in v4 *DONE*
TODO: remove vm in v4 *DONE*
TOOD: stub extend seda instead of vm in v4 *DONE*
nfilotto:1679359738:2023-03-21T08:48:58.765+0000:1679359738:2023-03-21T08:48:58.765+0000:[~davsclaus] Hi, with the removal of vm, if we want to get the same behavior (cross contexts queues), are we supposed to inject manually the queues in the SedaComponents?
nfilotto:1679360532:2023-03-21T09:02:12.791+0000:1679360685:2023-03-21T09:04:45.164+0000:I found a better way, I simply had to register the same {{SedaComponent}} instance on each context like in [this commit|https://github.com/apache/camel/pull/9587/commits/95758a44795a80287854c0b2e4d2041999d17657]
artnaseef:1699355957:2023-11-07T19:19:17.796+0000:1699355957:2023-11-07T19:19:17.796+0000:Anyone else reaching this as I did - in camel 3 support for mulitple camel contexts was dropped.  So the answer is, ""there is no direct alternative to this component"" and ""merge all of the camel contexts into one"".

[https://camel.apache.org/manual/camel-3-migration-guide.html]

 "
0,CAMEL-19131,Dependency upgrade,Minor,None,None,"
None
",Resolved,Fixed,"3.21.0, 4.0-M3, 4.0.0",Marat Gubaidullin,Marat Gubaidullin,0,1,2023-03-10 14:25:58+00:00,2023-03-10 17:07:16+00:00,No Desc,
0,CAMEL-19130,Dependency upgrade,Major,None,"4.0-M3, 4.0.0","
None
",Resolved,Fixed,"4.0-M3, 4.0.0",Nicolas Filotto,Nicolas Filotto,0,3,2023-03-10 09:47:18+00:00,2023-06-22 18:43:59+00:00,No Desc,"nfilotto:1679051660:2023-03-17T19:14:20.250+0000:1687426630:2023-06-22T17:37:10.806+0000:Corresponding PR
* 4.0: https://github.com/apache/camel/pull/9572
davsclaus:1687405402:2023-06-22T11:43:22.397+0000:1687405402:2023-06-22T11:43:22.397+0000:[~nfilotto] its IMHO better to revert this for Camel 3.21 as all the OSGi karaf features fail, they need to use 1.33
nfilotto:1687405668:2023-06-22T11:47:48.316+0000:1687405668:2023-06-22T11:47:48.316+0000:If we upgrade Jackson as suggested in the other ticket, it should not be needed to downgrade 
davsclaus:1687406375:2023-06-22T11:59:35.012+0000:1687406375:2023-06-22T11:59:35.012+0000:I think we need more time to adjust for this, IMHO lets move this to 3.22, so we can get 3.21 out of the door now.

1.33 works with karaf/osgi and SB. And we are not affected by any CVE (we use safe constructor and whatnot)
nfilotto:1687406532:2023-06-22T12:02:12.628+0000:1687406532:2023-06-22T12:02:12.628+0000:If I fix all the problems today, can we keep it as it is?
davsclaus:1687409392:2023-06-22T12:49:52.420+0000:1687409392:2023-06-22T12:49:52.420+0000:> If I fix all the problems today, can we keep it as it is?

Yeah of course.

In the mean time I have tested the backport and it works fine on Karaf / SB
nfilotto:1687411451:2023-06-22T13:24:11.831+0000:1687411451:2023-06-22T13:24:11.831+0000:Good to know, If I can't find a way to fix all the issues, I will revert the upgrade.

Re-setting the status to ""resolved"" as it is resolved for 4.0, If I need to revert it, I will simply remove 3.21 from the fix versions
nfilotto:1687426562:2023-06-22T17:36:02.684+0000:1687426562:2023-06-22T17:36:02.684+0000:I could not find an easy way to resolve the problem in a so short period of time so let's revert it for 3.21"
0,CAMEL-19129,Improvement,Minor,3.20.2,,"
None
",Closed,Fixed,None,Lukas Lowinger,Lukas Lowinger,0,3,2023-03-09 19:41:56+00:00,2023-06-06 10:32:46+00:00,"Camel CXF documentation could be improved, here are some ideas:


1. Out of date content


Some sections may explain problems or use cases that do not exist anymore and could thus be removed:



HOW TO MAKE THE CAMEL-CXF COMPONENT USE LOG4J INSTEAD OF JAVA.UTIL.LOGGING - is this still an issue?
Remove CONFIGURING THE CXF ENDPOINTS WITH APACHE ARIES BLUEPRINT - blueprint is not supported since Camel 4, is it?
HOW TO OVERRIDE THE CXF PRODUCER ADDRESS FROM MESSAGE HEADER probably doesn't need to be under high level use cases and can be removed, as this header is described under headers section



2. Spring-specific parts that should be moved to a Spring-specific documentation page


This points to a more general problem, that Camel component documentation is oftentimes Spring-centric, although the given component can be used on a number of different runtimes or even with plain Camel. The Spring details may confuse users who do not use Spring. There should be a separate place for Spring specific details. It could perhaps work the same way like with Camel Quarkus, where each extension hast its own page documenting Quarkus specific GAV, configuration, limitations, etc.



CONFIGURE THE CXF ENDPOINTS WITH SPRING



3. General



Link to PersonProcessor at HOW TO CONSUME A MESSAGE FROM A CAMEL-CXF ENDPOINT IN POJO DATA FORMAT doesn't exist
Shouldn't be artifactId = camel-cxf-soap ?
Inconsistent definition of dataFormats in QUERY PARAMETERS and DESCRIPTIONS OF THE DATAFORMATS
Make consistent section names - eg. ""HOW TO DEAL WITH THE MESSAGE"" vs ""HOW TO CONSUME A MESSAGE""
What does ""Both SOAP with Attachment and MTOM are supported. However, SOAP with Attachment is not tested."" mean in ATTACHMENT SUPPORT ?
This sentence ""To enable MTOM, set the CXF endpoint property ""mtom-enabled"" to true. (I believe you can only do it with Spring.)"" at ATTACHMENT SUPPORT should be ideally rewritten
Maybe re-order the sections, so it starts with some really simple example of consumer/producer (WSDL first/Java first approaches) and not with ""How to ... "" - as it seems more like corner cases sections
Nice to have - having some best practice security section","ppalaga:1678403402:2023-03-10T07:10:02.927+0000:1678404594:2023-03-10T07:29:54.532+0000:I have added some background to the description.
ppalaga:1678406571:2023-03-10T08:02:51.850+0000:1678406571:2023-03-10T08:02:51.850+0000:bq. HOW TO MAKE THE CAMEL-CXF COMPONENT USE LOG4J INSTEAD OF JAVA.UTIL.LOGGING

This is still an issue. I found this in [CXF source tree|https://github.com/apache/cxf/blob/main/core/src/main/java/org/apache/cxf/common/logging/LogUtils.java#L42]:

{quote}By default, CXF logs to java.util.logging. An application can change this. To log to another system, the application must provide an object that extends AbstractDelegatingLogger, and advertise that class via one of the following mechanisms:
* Create a file, in the classpath, named META-INF/cxf/org.apache.cxf.Logger. This file should contain the fully-qualified name of the class, with no comments, on a single line
* Call  setLoggerClass(Class) with a Class<?> reference to the logger class.

CXF provides Slf4jLogger to use slf4j instead of java.util.logging.{quote}

Camel is quite opinionated about logging, isn't it? I wonder whether Camel should not have the META-INF/cxf/org.apache.cxf.logger file with org.apache.cxf.common.logging.Log4jLogger by default?
davsclaus:1679994760:2023-03-28T17:12:40.323+0000:1679994760:2023-03-28T17:12:40.323+0000:Thanks, anyone is welcome to rework the camel-cxf documentation - its a lot of old docs from 10+ years when Spring XML <beans> rules the world.

CXF uses the dreadful java.util.logging so its not something we can do anything about.
llowinge:1681205607:2023-04-11T17:33:27.408+0000:1681205607:2023-04-11T17:33:27.408+0000:[~davsclaus]  I'm planning to work on this item, can you put me as assignee ? I will then send PR for review.
llowinge:1682074438:2023-04-21T18:53:58.108+0000:1682074438:2023-04-21T18:53:58.108+0000:[https://github.com/apache/camel/pull/9850] was merged to main.

 

Missing parts:
 * What to do with the Spring example ? (The Spring details may confuse users who do not use Spring. There should be a separate place for Spring specific details.)
 * Having some best practice security section

 

[~davsclaus] Could you help with the Spring stuff ? Should i create followups for both items ?

 

Thanks
davsclaus:1684474221:2023-05-19T13:30:21.060+0000:1684474221:2023-05-19T13:30:21.060+0000:Yeah a spring specific section would be good.

CXF is becoming more general purpose, and users with Java DSL, Yaml DSL, Quarkus etc are not in the old world of Spring XML <beans> and <cxf> XML stuff.

The CXF component has been in Camel for a very long time and the docs is therefore a lot of stuff added over time. So its a big task to cleanup and separate this, so thank you very much.
davsclaus:1684474264:2023-05-19T13:31:04.057+0000:1684474264:2023-05-19T13:31:04.057+0000:[~ffang] is CXF export in case you need help from him, and also if he could take a look at the doc changes
llowinge:1686018760:2023-06-06T10:32:40.120+0000:1686018760:2023-06-06T10:32:40.120+0000:[~davsclaus] [~freeman.fang] I've created CAMEL-19419 and CAMEL-19420. This one can be closed."
0,CAMEL-19128,New Feature,Major,None,"3.20.3, 3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.20.3, 3.21.0, 4.0-M3, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-03-09 09:27:59+00:00,2023-03-13 15:24:32+00:00,"camel version


Should show the current camel-jbang CLI version, and also if user configuration have set a default version


$ camel version
camel-jbang: 4.0.0
camel-version (user configuration): 3.20.3


We can have version commands to list Camel releases (discover via maven)


$ camel version list
4.0.0
3.21.1
3.21.0
3.20.3
3.20.2
3.20.1
...


We should stop after N versions back (we can have options to show all.) camel jbang supports 3.18 as lowest (better with 3.20) etc.


And we also need this for runtime


$ camel version list --runtime=spring-boot
4.0.0
3.21.1
3.21.0
3.20.3
3.20.2
3.20.1
...


$ camel version list --runtime=quarkus
3.0.0
2.16.4
2.16.3
2.15.0
2.14.0
2.13.3
...


The version should take --repos as argument to allow scanning in 3rd party maven repos as well for custom Camel distros","davsclaus:1678595204:2023-03-12T12:26:44.878+0000:1678595204:2023-03-12T12:26:44.878+0000:For quarkus then we need to find out what the camel version is for quarkus version ala
https://camel.apache.org/camel-quarkus/2.16.x/

davsclaus:1678690921:2023-03-13T15:02:01.818+0000:1678692087:2023-03-13T15:21:27.263+0000:TODO: main *DONE*
TODO: camel-3.x *DONE*
TODO: camel-3.20.x *DONE*"
0,CAMEL-19127,Bug,Minor,3.20.2,4.0-M3,"
None
",Closed,Cannot Reproduce,4.0-M3,Unassigned,geyipeng,0,3,2023-03-09 08:25:50+00:00,2023-03-11 00:48:05+00:00,"When I want to listen for events dynamically adding routes while the camel is running and use ScheduledRoutePolicy to manage the start and stop times of routes, I find that when dynamically created routes are set to noAutoStartup, this will not work. Here is the sample code:


import org.apache.camel.builder.RouteBuilder;
import org.apache.camel.routepolicy.quartz.SimpleScheduledRoutePolicy;
import org.springframework.stereotype.Component;


import java.util.Date;


@Component
public class TestRouteBuilder extends RouteBuilder {
    @Override
    public void configure() {
        from(""direct:listenEvent"").process(exchange -> getContext().addRoutes(new RouteBuilder() {
            @Override
            public void configure() {
                SimpleScheduledRoutePolicy simpleScheduledRoutePolicy = new SimpleScheduledRoutePolicy();
                simpleScheduledRoutePolicy.setRouteStartDate(new Date(System.currentTimeMillis() + 5000));
                from(""direct:"" + System.currentTimeMillis()).routePolicy(simpleScheduledRoutePolicy).noAutoStartup().log(""${body}"");
            }
        }));
    }
}","davsclaus:1678322259:2023-03-09T08:37:39.323+0000:1678322259:2023-03-09T08:37:39.323+0000:Can you put together a full sample project that demonstrates what you think is a problem. The sample code above is not sufficient
acosentino:1678322997:2023-03-09T08:49:57.493+0000:1678322997:2023-03-09T08:49:57.493+0000:Please don't change the priority. This is not a critical issue and it's not a blocker one.
davsclaus:1678429780:2023-03-10T14:29:40.424+0000:1678429780:2023-03-10T14:29:40.424+0000:Added unit test in camel-quartz. Cannot reproduce this.
ggboy:1678466885:2023-03-11T00:48:05.835+0000:1678466885:2023-03-11T00:48:05.835+0000:my mistake"
0,CAMEL-19126,Dependency upgrade,Major,None,"4.0-M3, 4.0.0","
None
",Resolved,Fixed,"4.0-M3, 4.0.0",Unassigned,Francesco Mongiardo,0,1,2023-03-08 15:58:23+00:00,2023-03-08 17:19:21+00:00,upgrade camel-fhir component to consume 6.4.2,
0,CAMEL-19125,Dependency upgrade,Minor,None,"3.20.3, 4.0-M3","
None
",Resolved,Fixed,"3.20.3, 4.0-M3",Unassigned,Claus Ibsen,0,1,2023-03-08 15:00:05+00:00,2023-03-08 20:28:53+00:00,No Desc,
0,CAMEL-19124,Bug,Major,"3.20.2, 3.x, 4.0.0","3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M3, 4.0.0",Unassigned,Marcin Grzejszczak,0,2,2023-03-07 15:50:06+00:00,2023-03-27 10:03:46+00:00,"As discussed in the PR it seems that the `Tracer`component from `camel-tracing` is not continuing spans if a `AbstractInternalSpanDecorator` is being created. So for the following route




from(""direct://foo"")
				.log(""hello"")
				.to(""direct://bar"")
				.to(""http://example.org"");
		from(""direct://bar"")
				.log(""hello"")
				.to(""direct://micrometer"")
				.to(""http://example.org"");
		from(""direct://micrometer"")
				.setHeader(MicrometerConstants.HEADER_METRIC_NAME, constant(""new.name""))
				.setHeader(MicrometerConstants.HEADER_METRIC_TAGS, constant(Tags.of(""dynamic-key"", ""dynamic-value"")))
				.to(""micrometer:counter:name.not.used?tags=key=value"")
				.to(""direct://baz"");
		from(""direct://baz"")
				.log(""hello"")
				.to(""bean:com.example.cameldemo.MyBean"")
				.to(""exec:wc?args=--words /usr/share/dict/words"")
				.process(exchange -> {
					// Use the Camel Exec String type converter to convert the ExecResult to String
					// In this case, the stdout is considered as output
					String wordCountOutput = exchange.getIn().getBody(String.class);
					// do something with the word count
					System.out.println(wordCountOutput);
				})
				.to(""file:///tmp/camel-outputdir?flatten=true"")
				.to(""http://example.org"");




you will get multiple traces since the `direct` components are not linked together (they are treated as a start of a new trace).


  


I think we agreed that for this route example, multiple routes are linked together but all in all they form a single trace. So if `org.apache.camel.tracing.Tracer.TracingEventNotifier#shouldExclude` would be changed from 




private boolean shouldExclude(SpanDecorator sd, Exchange exchange, Endpoint endpoint) {
            return sd instanceof AbstractInternalSpanDecorator || !sd.newSpan()
                    || isExcluded(exchange, endpoint);
        }




to




private boolean shouldExclude(SpanDecorator sd, Exchange exchange, Endpoint endpoint) {
            return !sd.newSpan()
                    || isExcluded(exchange, endpoint);
        }




then the span parent-child relationship gets maintained the way it should",davsclaus:1679882626:2023-03-27T10:03:46.387+0000:1679882626:2023-03-27T10:03:46.387+0000:Thanks for all the hard work on this
0,CAMEL-19123,Dependency upgrade,Major,None,"3.21.0, 4.0-M2, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M2, 4.0.0",Grzegorz Grzybek,Grzegorz Grzybek,0,1,2023-03-07 12:46:13+00:00,2023-03-14 13:25:02+00:00,No API changes between 1.9.4 and 1.9.5.,"ggrzybek:1678239244:2023-03-08T09:34:04.236+0000:1678239262:2023-03-08T09:34:22.815+0000:Also it's worth noting that the wagon transport is marked as _ancient_ and native HTTP transport should be used: https://maven.apache.org/guides/mini/guide-http-settings.html

While there's no need to switch entire Camel to rely on Maven 3.9.x, when using maven-resolver 1.9.x I'll try to use it in the modern way.

cc: [~davsclaus]
ggrzybek:1678685863:2023-03-13T13:37:43.524+0000:1678685881:2023-03-13T13:38:01.615+0000:PR for Camel 3.x: https://github.com/apache/camel/pull/9518
ggrzybek:1678765666:2023-03-14T11:47:46.708+0000:1678765666:2023-03-14T11:47:46.708+0000:Fixed [here|https://github.com/apache/camel/commit/1cae5b76126ebbf3e4c2eb607e121e19dbbf2064] in camel-3.x branch.
ggrzybek:1678771498:2023-03-14T13:24:58.131+0000:1678771498:2023-03-14T13:24:58.131+0000:Fixed [here|https://github.com/apache/camel/commit/a47c5971232891ba33a1cee4f3ac6a7395663741] in main branch."
0,CAMEL-19122,Improvement,Major,None,"3.20.3, 3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.20.3, 3.21.0, 4.0-M3, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-03-06 16:29:20+00:00,2023-03-07 07:14:49+00:00,"If you have existing java code with package name, then do an export. Then this code may have moved into another package.


Created ticket to look into this if its still a problem.",
0,CAMEL-19121,Improvement,Major,None,"4.0-RC2, 4.0.0","
None
",Resolved,Fixed,"4.0-RC2, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-03-06 14:56:07+00:00,2023-07-21 05:03:19+00:00,"We should adapt to v4 on main branch



java 17 (remove java 11)
spring boot 3.x
quarkus 3.x



Also it may be that export to camel-main as runtime generates a pom.xml that cannot build with v4.",davsclaus:1689857440:2023-07-20T20:50:40.551+0000:1689884973:2023-07-21T04:29:33.935+0000:TODO: quarkus gradle project *DONE*
0,CAMEL-19120,New Feature,Major,None,"3.20.3, 3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.20.3, 3.21.0, 4.0-M3, 4.0.0",Federico Mariani,Federico Mariani,0,1,2023-03-06 14:38:34+00:00,2023-03-08 07:46:00+00:00,"Make templates file used by export configurable from classpath, so that camel-spring-boot or camel-quarkus can provide custom implementation and/or overrides",
0,CAMEL-19119,Task,Minor,3.20.2,"3.20.3, 3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.20.3, 3.21.0, 4.0-M3, 4.0.0",Unassigned,Lucia Drozdová,0,1,2023-03-06 10:07:24+00:00,2023-03-06 12:52:47+00:00,"There are several examples missing in jdbc component documentation:


https://camel.apache.org/components/3.20.x/jdbc-component.html#_samples



First we register our datasource in the Camel registry as testdb:
Then we configure a route that routes to the JDBC component, so the SQL will be executed. Note how we refer to the testdb datasource that was bound in the previous step:
Or you can create a DataSource in Spring like this:
We create an endpoint, add the SQL query to the body of the IN message, and then send the exchange. The result of the query is returned in the OUT body:",
0,CAMEL-19118,Improvement,Major,None,"3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M3, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-03-06 09:00:43+00:00,2023-03-06 09:53:14+00:00,"Almost all health checks should be readiness checks for connectivity. A liveness check is harder to write as its unforseen errors such as running out of memory / file descriptors / or something that requires restarting the JVM.


See also
https://github.com/apache/camel/pull/9417",
0,CAMEL-19117,Task,Major,None,"4.0-M2, 4.0.0","
None
",Resolved,Fixed,"4.0-M2, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-03-05 20:30:19+00:00,2023-03-06 05:44:01+00:00,"We do not use archetypeAsXml in CamelCatalog.


This causes a problem with build order as archetypes then need to be built before catalog, and we want to avoid that.",
0,CAMEL-19116,Task,Minor,None,,"
None
",Resolved,Won't Fix,None,Unassigned,Shmakov Alexey,0,1,2023-03-04 09:31:05+00:00,2023-07-16 12:00:51+00:00,"Please, remove AvoidStarImport from CheckStyle (https://checkstyle.sourceforge.io/config_imports.html#AvoidStaticImport)


In Intelij Idea by default enabled wildcard imports for 5 classes from same package


https://www.jetbrains.com/help/idea/creating-and-optimizing-imports.html#disable-wildcard-imports


 


I think, we need to either remove this restriction, or add a description of the settings for IDEA in the instructions for contributors. This IDE is very popular and for me personally it was not at all obvious that this feature could be disabled. At first I had to suffer and edit the code in a regular notepad in order to pass the style check, and only after that I guessed to look for a solution to the issue on the Internet.


I think this will ease the entry threshold for new contributors.",
0,CAMEL-19115,Task,Minor,None,,"
None
",Resolved,Not A Problem,None,Unassigned,Shmakov Alexey,0,2,2023-03-03 22:22:07+00:00,2023-06-27 16:23:55+00:00,"Now in main branch 


<jdk.version>17</jdk.version>


<maven.compiler.source>${jdk.version}</maven.compiler.source>
<maven.compiler.target>${jdk.version}</maven.compiler.target>


 


Maybe limit the source version to be able to copy changes from the main branch to others LTS (3.x, etc)?


<jdk.version>17</jdk.version>


<maven.compiler.source>11</maven.compiler.source>
<maven.compiler.target>${jdk.version}</maven.compiler.target>","orpiske:1687854235:2023-06-27T16:23:55.584+0000:1687854235:2023-06-27T16:23:55.584+0000:Although the suggestion is correct, closing as not a problem as this would cause some of the current code that uses JDK 17 to fail. We'll adjust the code as needed when/if cherry-picking."
0,CAMEL-19114,Task,Minor,None,,"

help-wanted

",Resolved,Invalid,None,Unassigned,Shmakov Alexey,0,2,2023-03-03 21:35:17+00:00,2023-07-18 13:57:40+00:00,"```
File ""buildingtools\src\main\resources\camel-checkstyle-suppressions.xml"" contains list of style check supressions
The path mask (""files"" field) for supressions is based on the Java regex pattern and for platform-independent processing it is required to write path separators as '\\\/', not '/'. Now, in the part of the supressions in this file, the separators are written as needed '\\\/', and in the part - as in Linux '/'. As a result, style check fails for Windows OS.
```","orpiske:1687854274:2023-06-27T16:24:34.888+0000:1687854274:2023-06-27T16:24:34.888+0000:Is this still a problem?
orpiske:1689659860:2023-07-18T13:57:40.666+0000:1689659860:2023-07-18T13:57:40.666+0000:This has become invalid after the build changes that modified how checkstyle and code formatting work. If that's not the case, please reopen the ticket."
0,CAMEL-19113,Bug,Major,"3.18.5, 3.20.2","3.18.6, 3.20.3, 3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.18.6, 3.20.3, 3.21.0, 4.0-M3, 4.0.0",Jiri Ondrusek,Jiri Ondrusek,0,2,2023-03-03 13:52:04+00:00,2023-03-07 12:52:15+00:00,"When rest DSL defines following endpoint




rest().get(""/test"")
        .consumes(""application/json,application/xml"")
        .produces(""application/json,application/xml"") 



requests with `content-type` header `application/json` or `application/xml` should be accepted. (works on camel-platform-htpp)",davsclaus:1678154375:2023-03-07T09:59:35.589+0000:1678154375:2023-03-07T09:59:35.589+0000:We need to backport this
0,CAMEL-19112,Bug,Minor,"3.20.2, 4.0-M1","3.20.3, 3.21.0, 4.0-M2, 4.0.0","
None
",Resolved,Fixed,"3.20.3, 3.21.0, 4.0-M2, 4.0.0",Claus Ibsen,Dominik Jelinek,0,1,2023-03-03 09:58:27+00:00,2023-04-25 14:51:50+00:00,"jbang run -Dcamel.jbang.version=3.20.2 camel@apache/camel init foo.camel.yaml

> Error: Unsupported file type: camel.yaml



Tried also with latest camel version -Dcamel.jbang.version=4.0.0-M1",
0,CAMEL-19111,Bug,Major,3.20.2,"3.20.3, 3.21.0, 4.0-M2, 4.0.0","
None
",Resolved,Fixed,"3.20.3, 3.21.0, 4.0-M2, 4.0.0",Claus Ibsen,Chirag Sanghavi,0,1,2023-03-02 15:27:18+00:00,2023-03-03 07:28:50+00:00,"This scenario works with XML DSL


Here is XML DSL




<?xml version=""1.0"" encoding=""UTF-8""?>
<!-- camel-k: language=xml --><routes xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance""
        xmlns=""http://camel.apache.org/schema/spring""
        xsi:schemaLocation=""
            http://camel.apache.org/schema/spring
            https://camel.apache.org/schema/spring/camel-spring.xsd"">    <!-- Write your routes here, for example: -->
    
    <route>
        <from uri=""file:///c://work//batchsplit//in""/>
        <split streaming=""true"">
            <xtokenize mode=""w"">//BatchMaster</xtokenize>
            <to uri=""file:///c://work//batchsplit//out?fileName=${exchangeId}.xml""/>
        </split>
    </route></routes>
 



Here is Yaml version that I tried:




- route: 
    id: route-a6b4
    from: 
      uri: file:/work/batchsplit/in
      id: from-d1ca
      steps: 
        - split: 
            id: split-6d45
            expression: //Batchmaster
            xtokenize: 
                id: xtokenize-460a
                mode: w
            streaming: true
            steps: 
              - to: 
                  uri: file:/work/batchsplit/out?fileName=${exchangeId}.xml
                  id: to-1a10




I have tried to run this thru camel-jbang.","chirag884:1677756472:2023-03-02T19:27:52.530+0000:1677756472:2023-03-02T19:27:52.530+0000:Error received with YAML is:
{code:title=Exception Received|borderStyle=solid}

C:\work\batchsplit>camel run batchsplitversion1.camel.yaml
2023-03-02 14:24:07.387  INFO 8680 --- [           main] org.apache.camel.main.MainSupport   : Apache Camel (JBang) 3.20.2 is starting
2023-03-02 14:24:07.653  INFO 8680 --- [           main] org.apache.camel.main.MainSupport   : Using Java 19.0.1 with PID 8680. Started by csanghavi in C:\work\batchsplit
2023-03-02 14:24:07.678  INFO 8680 --- [           main] mel.cli.connector.LocalCliConnector : Camel CLI enabled (local)
org.apache.camel.RuntimeCamelException: Error pre-parsing resource: file:batchsplitversion1.camel.yaml      
        at org.apache.camel.dsl.yaml.YamlRoutesBuilderLoader.preParseRoute(YamlRoutesBuilderLoader.java:766)
        at org.apache.camel.impl.engine.DefaultRoutesLoader.preParseRoute(DefaultRoutesLoader.java:138)     
        at org.apache.camel.main.RoutesConfigurer.configureModeline(RoutesConfigurer.java:283)
        at org.apache.camel.main.BaseMainSupport.modelineRoutes(BaseMainSupport.java:629)
        at org.apache.camel.main.BaseMainSupport.autoconfigure(BaseMainSupport.java:485)
        at org.apache.camel.main.MainSupport.autoconfigure(MainSupport.java:74)
        at org.apache.camel.main.KameletMain.autoconfigure(KameletMain.java:466)
        at org.apache.camel.main.BaseMainSupport.postProcessCamelContext(BaseMainSupport.java:693)
        at org.apache.camel.main.MainSupport.initCamelContext(MainSupport.java:404)
        at org.apache.camel.main.KameletMain.doInit(KameletMain.java:265)
        at org.apache.camel.support.service.BaseService.init(BaseService.java:83)
        at org.apache.camel.support.service.BaseService.start(BaseService.java:111)
        at org.apache.camel.dsl.jbang.core.commands.Run.runKameletMain(Run.java:732)
        at org.apache.camel.dsl.jbang.core.commands.Run.run(Run.java:564)
        at org.apache.camel.dsl.jbang.core.commands.Run.call(Run.java:218)
        at org.apache.camel.dsl.jbang.core.commands.Run.call(Run.java:77)
        at picocli.CommandLine.executeUserObject(CommandLine.java:2041)
        at picocli.CommandLine.access$1500(CommandLine.java:148)
        at picocli.CommandLine$RunLast.executeUserObjectOfLastSubcommandWithSameParent(CommandLine.java:2461)
        at picocli.CommandLine$RunLast.handle(CommandLine.java:2453)
        at picocli.CommandLine$RunLast.handle(CommandLine.java:2415)
        at picocli.CommandLine$AbstractParseResultHandler.execute(CommandLine.java:2273)
        at picocli.CommandLine$RunLast.execute(CommandLine.java:2417)
        at picocli.CommandLine.execute(CommandLine.java:2170)
        at org.apache.camel.dsl.jbang.core.commands.CamelJBangMain.run(CamelJBangMain.java:134)
        at main.CamelJBang.main(CamelJBang.java:36)
Caused by: mapping values are not allowed here
 in file:batchsplitversion1.camel.yaml, line 10, column 24:
                  xtokenize:
                           ^

        at org.snakeyaml.engine.v2.scanner.ScannerImpl.fetchValue(ScannerImpl.java:822)
        at org.snakeyaml.engine.v2.scanner.ScannerImpl.fetchMoreTokens(ScannerImpl.java:333)
        at org.snakeyaml.engine.v2.scanner.ScannerImpl.checkToken(ScannerImpl.java:192)
        at org.snakeyaml.engine.v2.parser.ParserImpl$ParseBlockMappingKey.produce(ParserImpl.java:616)
        at org.snakeyaml.engine.v2.parser.ParserImpl.lambda$produce$0(ParserImpl.java:181)
        at java.base/java.util.Optional.ifPresent(Optional.java:178)
        at org.snakeyaml.engine.v2.parser.ParserImpl.produce(ParserImpl.java:181)
        at org.snakeyaml.engine.v2.parser.ParserImpl.peekEvent(ParserImpl.java:189)
        at org.snakeyaml.engine.v2.comments.CommentEventsCollector$1.peek(CommentEventsCollector.java:58)
        at org.snakeyaml.engine.v2.comments.CommentEventsCollector$1.peek(CommentEventsCollector.java:44)
        at org.snakeyaml.engine.v2.comments.CommentEventsCollector.collectEvents(CommentEventsCollector.java:134)
        at org.snakeyaml.engine.v2.comments.CommentEventsCollector.collectEvents(CommentEventsCollector.java:114)
        at org.snakeyaml.engine.v2.composer.Composer.composeScalarNode(Composer.java:230)
        at org.snakeyaml.engine.v2.composer.Composer.composeNode(Composer.java:200)
        at org.snakeyaml.engine.v2.composer.Composer.composeValueNode(Composer.java:311)
        at org.snakeyaml.engine.v2.composer.Composer.composeMappingChildren(Composer.java:302)
        at org.snakeyaml.engine.v2.composer.Composer.composeMappingNode(Composer.java:289)
        at org.snakeyaml.engine.v2.composer.Composer.composeNode(Composer.java:204)
        at org.snakeyaml.engine.v2.composer.Composer.composeValueNode(Composer.java:311)
        at org.snakeyaml.engine.v2.composer.Composer.composeMappingChildren(Composer.java:302)
        at org.snakeyaml.engine.v2.composer.Composer.composeMappingNode(Composer.java:289)
        at org.snakeyaml.engine.v2.composer.Composer.composeNode(Composer.java:204)
        at org.snakeyaml.engine.v2.composer.Composer.composeSequenceNode(Composer.java:256)
        at org.snakeyaml.engine.v2.composer.Composer.composeNode(Composer.java:202)
        at org.snakeyaml.engine.v2.composer.Composer.composeValueNode(Composer.java:311)
        at org.snakeyaml.engine.v2.composer.Composer.composeMappingChildren(Composer.java:302)
        at org.snakeyaml.engine.v2.composer.Composer.composeMappingNode(Composer.java:289)
        at org.snakeyaml.engine.v2.composer.Composer.composeNode(Composer.java:204)
        at org.snakeyaml.engine.v2.composer.Composer.composeValueNode(Composer.java:311)
        at org.snakeyaml.engine.v2.composer.Composer.composeMappingChildren(Composer.java:302)
        at org.snakeyaml.engine.v2.composer.Composer.composeMappingNode(Composer.java:289)
        at org.snakeyaml.engine.v2.composer.Composer.composeNode(Composer.java:204)
        at org.snakeyaml.engine.v2.composer.Composer.composeValueNode(Composer.java:311)
        at org.snakeyaml.engine.v2.composer.Composer.composeMappingChildren(Composer.java:302)
        at org.snakeyaml.engine.v2.composer.Composer.composeMappingNode(Composer.java:289)
        at org.snakeyaml.engine.v2.composer.Composer.composeNode(Composer.java:204)
        at org.snakeyaml.engine.v2.composer.Composer.composeSequenceNode(Composer.java:256)
        at org.snakeyaml.engine.v2.composer.Composer.composeNode(Composer.java:202)
        at org.snakeyaml.engine.v2.composer.Composer.next(Composer.java:161)
        at org.snakeyaml.engine.v2.composer.Composer.getSingleNode(Composer.java:123)
        at org.apache.camel.dsl.yaml.YamlRoutesBuilderLoader.preParseRoute(YamlRoutesBuilderLoader.java:763)
        ... 25 more

{code}
"
0,CAMEL-19110,Dependency upgrade,Major,None,"4.0-M2, 4.0.0","
None
",Resolved,Fixed,"4.0-M2, 4.0.0",Gregor Zurowski,Claus Ibsen,0,2,2023-03-02 15:22:45+00:00,2023-03-04 06:34:51+00:00,SB is released tomorrow,"gzurowski:1677865919:2023-03-04T01:51:59.354+0000:1677865919:2023-03-04T01:51:59.354+0000:Spring Boot 3.0.4 has been released: https://github.com/spring-projects/spring-boot/releases/tag/v3.0.4

PR for Camel Spring Boot: https://github.com/apache/camel-spring-boot/pull/771
PR for dependency updates on Camel core: https://github.com/apache/camel/pull/9467"
0,CAMEL-19109,Improvement,Major,"3.18.5, 3.20.2, 4.0-M1","3.18.6, 3.20.3, 3.21.0, 4.0-M2, 4.0.0","
None
",Resolved,Fixed,"3.18.6, 3.20.3, 3.21.0, 4.0-M2, 4.0.0",James Netherton,James Netherton,0,2,2023-03-02 11:34:29+00:00,2023-03-03 09:28:48+00:00,"There's the potential to block the Vert.x event loop if route processing coming after the vertx-websocket consumer does blocking operations. E.g like:




from(""vertx-websocket:localhost:8080/slow"")
    .delay(5000).syncDelayed()
    .to(""mock:result"");




We should do like what happens with camel-platform-http-vertx and wrap the exchange processing in a Vert.x blocking handler.","davsclaus:1677805612:2023-03-03T09:06:52.218+0000:1677805612:2023-03-03T09:06:52.218+0000:Have you backported this to the 3.x branches?
jamesnetherton:1677805764:2023-03-03T09:09:24.564+0000:1677805764:2023-03-03T09:09:24.564+0000:Working on it now. For 3.20 & 3.18, it's not a simple cherry-pick, thus taking some extra time to avoid screwing it up.

I'll resolve the ticket when I'm done."
0,CAMEL-19108,Improvement,Minor,None,"3.20.4, 3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.20.4, 3.21.0, 4.0-M3, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-03-02 09:31:06+00:00,2023-04-12 09:50:47+00:00,"More work from CAMEL-19093


If you have a local .jar in the folder (no maven dependency). For example a JDBC driver etc or custom JAR. Then we should during export



create a lib folder DONE
copy JARs to lib folder DONE
add <dependency> in pom.xml that refer to local file DONE
scan the JAR in case its a maven built as then it contains GAV we can use as placeholder  in <dependency> DONE
gradle build ??? DONE",
0,CAMEL-19107,Improvement,Minor,None,,"
None
",Resolved,Won't Fix,None,Unassigned,Shmakov Alexey,0,2,2023-03-01 19:38:51+00:00,2023-03-02 08:17:57+00:00,"Now style check fail after each failed module in CI


If you add ""-fae"" at the end of the maven command, the style check will go through all modules and an error will occur at the end. As a result, it will be possible to find out about all style errors in the project, and not just in the first failure module


 


Now mvn command is


mvn -l checkstyle.log -Dmvnd.threads=2 -V -Dhttp.keepAlive=false -Dmaven.wagon.http.pool=false -Dmaven.wagon.httpconnectionManager.ttlSeconds=120 --no-transfer-progress -Dcheckstyle.failOnViolation=true -e checkstyle:checkstyle


 


Need


mvn -l checkstyle.log -Dmvnd.threads=2 -V -Dhttp.keepAlive=false -Dmaven.wagon.http.pool=false -Dmaven.wagon.httpconnectionManager.ttlSeconds=120 --no-transfer-progress -Dcheckstyle.failOnViolation=true -e checkstyle:checkstyle -fae","davsclaus:1677716277:2023-03-02T08:17:57.334+0000:1677716277:2023-03-02T08:17:57.334+0000:That will take too long to run on CI for every PRs - you can quickly check CS locally as well in case of an error

mvn checkstyle:checkstyle -Dcheckstyle.failOnViolation=true"
0,CAMEL-19106,Task,Minor,None,3.21.0,"
None
",Closed,Invalid,3.21.0,Unassigned,Shmakov Alexey,0,1,2023-03-01 19:13:24+00:00,2023-03-03 21:44:55+00:00,"Checkstyle plugin fails for several components with next error in the  branch camel-3.x


[ERROR] E:\camel-forkcomponents\camel-spring-ws\src\test\resources\org\apache\camel\component\spring\ws\addresing\ProducerParamsBasicTest-context.xml:54: Line is longer than 250 characters (found 261). [LineLength]


 


It is necessary to exclude test resources test/resources/.xml from the style check in maven-checkstyle-plugin  - they are not important anyway, but this will fix the project build


 


I spent several hours (due to a weak computer) to fix the test files in different components one by one, but I ran into an unsolvable problem, I don’t know how to shorten the next line in the test file components\camel-spring-ws\src\test\resources\org\apache\camel\component\spring\ws\addresing\ProducerParamsBasicTest-context.xml:60


<to uri=""spring-ws:http://google.com?wsAddressingAction=http://wsaAction.com&webServiceTemplate=#webServiceTemplate&replyTo=mailto://replyTo@chocolatejar.eu&endpointMapping=#endpointMapping&faultTo=http://fault.to&messageIdStrategy=#staticId"" />


 


The string is longer than 250 characters and I don't know how to shorten it so as not to break the tests. I consider it most reasonable to exclude test files from the general rule","shmakovaa:1677763518:2023-03-02T21:25:18.242+0000:1677763518:2023-03-02T21:25:18.242+0000:[https://github.com/apache/camel/pull/9461]

 
shmakovaa:1677849830:2023-03-03T21:23:50.271+0000:1677849830:2023-03-03T21:23:50.271+0000:The cause of the problem is completely different.
shmakovaa:1677851095:2023-03-03T21:44:55.373+0000:1677851095:2023-03-03T21:44:55.373+0000: The cause of the problem - https://issues.apache.org/jira/browse/CAMEL-19114"
0,CAMEL-19105,Bug,Minor,3.20.1,,"
None
",Resolved,Not A Bug,None,Claus Ibsen,Darren Coleman,0,2,2023-03-01 14:32:26+00:00,2023-03-02 10:08:30+00:00,"I set up a route to load a simple script via an HTTP endpoint and, as far as I  can tell, the contentCache option isn't checked. When calling the endpoint language:simple:http://localhost:8080/simple, the LanguageProducer.process() method calls directly on ResourceHelper.resolveMandatoryResourceAsInputStream() (line 79) instead of calling on the endpoint's getResourceAsInputStream() method that handles the caching.


 


The following code sets up a REST endpoint to return a simple script, and the language endpoint is called twice. I would expect the the REST route to log output for the first call only.


 




public class CamelLanguageHttpTest {
    
    public static void main(String[] args) throws Exception {
        CamelContext context = new DefaultCamelContext();
        context.addRoutes(new RouteBuilder() {
            @Override
            public void configure() throws Exception {
                restConfiguration().component(""netty-http"")
                    .host(""localhost"").port(8080);
                rest(""/"")
                    .get(""simple"").to(""direct:simple"");
                from(""direct:simple"")
                    .transform()
                    .constant(""Hello ${body}!"").to(""stream:out"");
            }
        });
        context.start();
        ProducerTemplate producer = context.createProducerTemplate();
        String endpoint = ""language:simple:http://localhost:8080/simple"";          String result = producer.requestBody(endpoint, ""SimpleHttp"", String.class);
        producer.requestBody(endpoint, ""SimpleHttp"", String.class);
        
        context.stop();
        context.close();
    }
}
// Output:
// Hello ${body}!
// Hello ${body}!","davsclaus:1677715995:2023-03-02T08:13:15.002+0000:1677715995:2023-03-02T08:13:15.002+0000:You need to specify that this is a resource if you want to have content caching etc, otherwise its a script that is evaluated each time, something ala:

language:simple:resource:http://localhost:...
djcoleman:1677722910:2023-03-02T10:08:30.691+0000:1677722910:2023-03-02T10:08:30.691+0000:Ah thanks Claus, that worked a treat!"
0,CAMEL-19104,Improvement,Major,None,"4.0-M3, 4.0.0","
None
",Resolved,Fixed,"4.0-M3, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-03-01 11:55:36+00:00,2023-04-04 10:19:17+00:00,"See CAMEL-19098


When invoking a method 


myBean?method=foo(hello)


Then Camel will match by type (was implemented first), eg to see if the method has a parameter of type 'hello'. 


This is intended for


myBean?method=foo(String, int)


To match a method that has String, int as types.


However users want to pass in that as parameter values instead (implemented later). So instead lets move the parameter type matching away


myBean?method=foo&parameterTypes=String,int","davsclaus:1680304651:2023-04-01T07:17:31.912+0000:1680304651:2023-04-01T07:17:31.912+0000:It's likely better to force types declared with .class, eg 

method=foo(String.class, int.class)

And anything without .class, is considered a value, eg

method=foo(Hello, 3)

And for string literals its best to quote (single or double)

method=foo('Hello', 3)

davsclaus:1680310649:2023-04-01T08:57:29.697+0000:1680310649:2023-04-01T08:57:29.697+0000:You should now use .class style, eg String.class, com.foo.MyOrder.class"
0,CAMEL-19103,Bug,Major,3.20.1,"3.20.3, 3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.20.3, 3.21.0, 4.0-M3, 4.0.0",Federico Mariani,Federico Mariani,0,1,2023-03-01 10:58:22+00:00,2023-03-14 11:12:54+00:00,"Integration test like https://github.com/Croway/camel/blob/jbang-test/dsl/camel-jbang/camel-jbang-core/src/test/java/org/apache/camel/dsl/jbang/BackgroundTest.java fails when a command that uses ProcessHandle.current().info().commandLine().orElse(null); is executed.


In my e2e camel-jbang test suite I'm using a docker image with camel-jbang installed, but when ProcessHandle.current().info().commandLine().orElse(null); I get the same behavior as the integration tests.",Federico Mariani:1678763545:2023-03-14T11:12:25.803+0000:1678763545:2023-03-14T11:12:25.803+0000:Solved with https://github.com/apache/camel/commit/5aedf26b2cc6227638dbb08f581b8ef5cc097a5d
0,CAMEL-19072,Improvement,Major,4.0-M1,"4.0-M2, 4.0.0","
None
",Resolved,Fixed,"4.0-M2, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-02-17 17:32:57+00:00,2023-02-17 17:43:43+00:00,For v4 we can drop that special backwards parser,
0,CAMEL-19071,Improvement,Major,None,"3.21.0, 4.0-M2, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M2, 4.0.0",Claus Ibsen,Claus Ibsen,0,2,2023-02-17 13:04:25+00:00,2023-02-18 10:58:08+00:00,"camel run foo.yaml


and you have application.properties where you can configure component / kamelets also (and some other bits). Then if you change application.properties we should reload all routes.","davsclaus:1676610305:2023-02-17T13:05:05.949+0000:1676610305:2023-02-17T13:05:05.949+0000:for example

camel.kamelet.chuck-norris-source.period=1234
davsclaus:1676684423:2023-02-18T09:40:23.184+0000:1676684423:2023-02-18T09:40:23.184+0000:camel.kamelet.xxx works because the kamelet component loads properties via the properties component.

However for general component configuration then we need to re-create these components on re-load."
0,CAMEL-19070,Task,Major,4.0-M1,"4.0-M2, 4.0.0","
None
",Resolved,Fixed,"4.0-M2, 4.0.0",Nicolas Filotto,Otavio Rodolfo Piske,0,2,2023-02-17 08:59:32+00:00,2023-02-18 09:26:44+00:00,"It seems that ElasticSearch tests are flaky on CI. It could be that the CI nodes don't have enough resources to run the tests (needs to be investigated and then to ask infra if they can adjust the parameters).


 


Attached logs: camel-elasticsearch-test.log","nfilotto:1676603902:2023-02-17T11:18:22.349+0000:1676603902:2023-02-17T11:18:22.349+0000:Should be fixed by https://github.com/apache/camel/pull/9372
nfilotto:1676626904:2023-02-17T17:41:44.980+0000:1676626904:2023-02-17T17:41:44.980+0000:Let's see if the ES integration tests pass on [Jenkins with this fix|https://ci-builds.apache.org/job/Camel/job/Camel%20JDK17/job/main/610/] before closing it."
0,CAMEL-19069,New Feature,Major,Future,"3.21.0, 4.0-M2, 4.0.0","

camel
camel-minio

",Closed,Fixed,"3.21.0, 4.0-M2, 4.0.0",Unassigned,Hitesh C,0,1,2023-02-17 04:48:40+00:00,2023-02-17 20:57:18+00:00,"Minio components for s2 (aws2-s3) google cloud storage, azure blob storage all have createDownloadLink functionality


operation: createDownloadLink in gcp-storage and aws2-s3


operation: downloadLink in azure storage


 


This particular functionality is missing camel-minio component.
We have already added a couple of features in minio-camel which we would like contribute back to the main repo


 
createDownloadLink - To generate a presigned download url with user defined expiry time, the operation name is maintained same to have parity with s3 component
createUploadLink - To generate presigned upload urls with user defined expiry, which help us in certain workflows involving large files which users can upload directly bypassing the intermediate layers.
 
Both use the same method to generate respective urls, with a default expiry time of 60 min.",
0,CAMEL-19068,Bug,Major,None,None,"

saga

",Resolved,Fixed,4.2.0,Zheng Feng,Zheng Feng,0,2,2023-02-17 04:47:17+00:00,2023-10-21 11:34:55+00:00,"This test is failing after commiting the fix for CAMEL19031. It seems that after completing the saga, the next route is still have SAGA_LONG_RUNNING_ACTION header",
0,CAMEL-19067,Bug,Minor,3.20.2,"3.20.3, 3.21.0, 4.0-M2, 4.0.0","
None
",Resolved,Fixed,"3.20.3, 3.21.0, 4.0-M2, 4.0.0",Claus Ibsen,Chirag Sanghavi,0,2,2023-02-16 21:28:31+00:00,2023-02-17 08:36:11+00:00,"Error while running camel init
 I am noticing that file is getting created - but then it  is erroring out


C:\work\jb>jbang --version
0.101.0
C:\work\jb>camel -V
3.20.2


It seems to not resolve sys:pid variable?


Here is complete stacktrace:




C:\work\jb>camel init b.xml

2023-02-16 12:53:30,548 main ERROR FileManager
(C:\Users\myuser/.camel/${sys:pid}.log) java.io.IOException: The
filename, directory name, or volume label syntax is incorrect
java.io.IOException: The filename, directory name, or volume label
syntax is incorrect
        at java.base/java.io.WinNTFileSystem.canonicalize0(Native Method)
        at java.base/java.io.WinNTFileSystem.canonicalize(WinNTFileSystem.java:465)
        at java.base/java.io.File.getCanonicalPath(File.java:626)
        at java.base/java.io.File.getCanonicalFile(File.java:651)
        at org.apache.logging.log4j.core.util.FileUtils.makeParentDirs(FileUtils.java:139)
        at org.apache.logging.log4j.core.appender.FileManager$FileManagerFactory.createManager(FileManager.java:436)
        at org.apache.logging.log4j.core.appender.FileManager$FileManagerFactory.createManager(FileManager.java:423)
        at org.apache.logging.log4j.core.appender.AbstractManager.getManager(AbstractManager.java:144)
        at org.apache.logging.log4j.core.appender.OutputStreamManager.getManager(OutputStreamManager.java:100)
        at org.apache.logging.log4j.core.appender.FileManager.getFileManager(FileManager.java:183)
        at org.apache.logging.log4j.core.appender.FileAppender$Builder.build(FileAppender.java:99)
        at org.apache.logging.log4j.core.appender.FileAppender$Builder.build(FileAppender.java:52)
        at org.apache.logging.log4j.core.config.plugins.util.PluginBuilder.build(PluginBuilder.java:124)
        at org.apache.logging.log4j.core.config.AbstractConfiguration.createPluginObject(AbstractConfiguration.java:1133)
        at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:1058)
        at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:1050)
        at org.apache.logging.log4j.core.config.AbstractConfiguration.doConfigure(AbstractConfiguration.java:659)
        at org.apache.logging.log4j.core.config.AbstractConfiguration.initialize(AbstractConfiguration.java:257)
        at org.apache.logging.log4j.core.config.AbstractConfiguration.start(AbstractConfiguration.java:303)
        at org.apache.logging.log4j.core.LoggerContext.setConfiguration(LoggerContext.java:621)
        at org.apache.logging.log4j.core.LoggerContext.reconfigure(LoggerContext.java:694)
        at org.apache.logging.log4j.core.LoggerContext.reconfigure(LoggerContext.java:711)
        at org.apache.logging.log4j.core.LoggerContext.start(LoggerContext.java:253)
        at org.apache.logging.log4j.core.impl.Log4jContextFactory.getContext(Log4jContextFactory.java:155)
        at org.apache.logging.log4j.core.impl.Log4jContextFactory.getContext(Log4jContextFactory.java:47)
        at org.apache.logging.log4j.LogManager.getContext(LogManager.java:196)
        at org.apache.logging.log4j.spi.AbstractLoggerAdapter.getContext(AbstractLoggerAdapter.java:137)
        at org.apache.logging.slf4j.Log4jLoggerFactory.getContext(Log4jLoggerFactory.java:55)
        at org.apache.logging.log4j.spi.AbstractLoggerAdapter.getLogger(AbstractLoggerAdapter.java:47)
        at org.apache.logging.slf4j.Log4jLoggerFactory.getLogger(Log4jLoggerFactory.java:33)
        at org.slf4j.LoggerFactory.getLogger(LoggerFactory.java:363)
        at org.slf4j.LoggerFactory.getLogger(LoggerFactory.java:388)
        at org.apache.camel.util.FileUtil.<clinit>(FileUtil.java:39)
        at org.apache.camel.dsl.jbang.core.commands.Init.call(Init.java:85)
        at org.apache.camel.dsl.jbang.core.commands.Init.call(Init.java:44)
        at picocli.CommandLine.executeUserObject(CommandLine.java:2041)
        at picocli.CommandLine.access$1500(CommandLine.java:148)
        at picocli.CommandLine$RunLast.executeUserObjectOfLastSubcommandWithSameParent(CommandLine.java:2461)
        at picocli.CommandLine$RunLast.handle(CommandLine.java:2453)
        at picocli.CommandLine$RunLast.handle(CommandLine.java:2415)
        at picocli.CommandLine$AbstractParseResultHandler.execute(CommandLine.java:2273)
        at picocli.CommandLine$RunLast.execute(CommandLine.java:2417)
        at picocli.CommandLine.execute(CommandLine.java:2170)
        at org.apache.camel.dsl.jbang.core.commands.CamelJBangMain.run(CamelJBangMain.java:134)
        at main.CamelJBang.main(CamelJBang.java:36)

2023-02-16 12:53:30,556 main ERROR Could not create plugin of type
class org.apache.logging.log4j.core.appender.FileAppender for element
File: java.lang.IllegalStateException: ManagerFactory
[org.apache.logging.log4j.core.appender.FileManager$FileManagerFactory@f99f5e0]
unable to create manager for [C:\Users\myuser/.camel/${sys:pid}.log]
with data [org.apache.logging.log4j.core.appender.FileManager$FactoryData@6aa61224]
java.lang.IllegalStateException: ManagerFactory
[org.apache.logging.log4j.core.appender.FileManager$FileManagerFactory@f99f5e0]
unable to create manager for [C:\Users\myuser/.camel/${sys:pid}.log]
with data [org.apache.logging.log4j.core.appender.FileManager$FactoryData@6aa61224]
        at org.apache.logging.log4j.core.appender.AbstractManager.getManager(AbstractManager.java:146)
        at org.apache.logging.log4j.core.appender.OutputStreamManager.getManager(OutputStreamManager.java:100)
        at org.apache.logging.log4j.core.appender.FileManager.getFileManager(FileManager.java:183)
        at org.apache.logging.log4j.core.appender.FileAppender$Builder.build(FileAppender.java:99)
        at org.apache.logging.log4j.core.appender.FileAppender$Builder.build(FileAppender.java:52)
        at org.apache.logging.log4j.core.config.plugins.util.PluginBuilder.build(PluginBuilder.java:124)
        at org.apache.logging.log4j.core.config.AbstractConfiguration.createPluginObject(AbstractConfiguration.java:1133)
        at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:1058)
        at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:1050)
        at org.apache.logging.log4j.core.config.AbstractConfiguration.doConfigure(AbstractConfiguration.java:659)
        at org.apache.logging.log4j.core.config.AbstractConfiguration.initialize(AbstractConfiguration.java:257)
        at org.apache.logging.log4j.core.config.AbstractConfiguration.start(AbstractConfiguration.java:303)
        at org.apache.logging.log4j.core.LoggerContext.setConfiguration(LoggerContext.java:621)
        at org.apache.logging.log4j.core.LoggerContext.reconfigure(LoggerContext.java:694)
        at org.apache.logging.log4j.core.LoggerContext.reconfigure(LoggerContext.java:711)
        at org.apache.logging.log4j.core.LoggerContext.start(LoggerContext.java:253)
        at org.apache.logging.log4j.core.impl.Log4jContextFactory.getContext(Log4jContextFactory.java:155)
        at org.apache.logging.log4j.core.impl.Log4jContextFactory.getContext(Log4jContextFactory.java:47)
        at org.apache.logging.log4j.LogManager.getContext(LogManager.java:196)
        at org.apache.logging.log4j.spi.AbstractLoggerAdapter.getContext(AbstractLoggerAdapter.java:137)
        at org.apache.logging.slf4j.Log4jLoggerFactory.getContext(Log4jLoggerFactory.java:55)
        at org.apache.logging.log4j.spi.AbstractLoggerAdapter.getLogger(AbstractLoggerAdapter.java:47)
        at org.apache.logging.slf4j.Log4jLoggerFactory.getLogger(Log4jLoggerFactory.java:33)
        at org.slf4j.LoggerFactory.getLogger(LoggerFactory.java:363)
        at org.slf4j.LoggerFactory.getLogger(LoggerFactory.java:388)
        at org.apache.camel.util.FileUtil.<clinit>(FileUtil.java:39)
        at org.apache.camel.dsl.jbang.core.commands.Init.call(Init.java:85)
        at org.apache.camel.dsl.jbang.core.commands.Init.call(Init.java:44)
        at picocli.CommandLine.executeUserObject(CommandLine.java:2041)
        at picocli.CommandLine.access$1500(CommandLine.java:148)
        at picocli.CommandLine$RunLast.executeUserObjectOfLastSubcommandWithSameParent(CommandLine.java:2461)
        at picocli.CommandLine$RunLast.handle(CommandLine.java:2453)
        at picocli.CommandLine$RunLast.handle(CommandLine.java:2415)
        at picocli.CommandLine$AbstractParseResultHandler.execute(CommandLine.java:2273)
        at picocli.CommandLine$RunLast.execute(CommandLine.java:2417)
        at picocli.CommandLine.execute(CommandLine.java:2170)
        at org.apache.camel.dsl.jbang.core.commands.CamelJBangMain.run(CamelJBangMain.java:134)
        at main.CamelJBang.main(CamelJBang.java:36)

2023-02-16 12:53:30,564 main ERROR Unable to invoke factory method in
class org.apache.logging.log4j.core.appender.FileAppender for element
File: java.lang.IllegalStateException: No factory method found for
class org.apache.logging.log4j.core.appender.FileAppender
java.lang.IllegalStateException: No factory method found for class
org.apache.logging.log4j.core.appender.FileAppender
        at org.apache.logging.log4j.core.config.plugins.util.PluginBuilder.findFactoryMethod(PluginBuilder.java:260)
        at org.apache.logging.log4j.core.config.plugins.util.PluginBuilder.build(PluginBuilder.java:136)
        at org.apache.logging.log4j.core.config.AbstractConfiguration.createPluginObject(AbstractConfiguration.java:1133)
        at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:1058)
        at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:1050)
        at org.apache.logging.log4j.core.config.AbstractConfiguration.doConfigure(AbstractConfiguration.java:659)
        at org.apache.logging.log4j.core.config.AbstractConfiguration.initialize(AbstractConfiguration.java:257)
        at org.apache.logging.log4j.core.config.AbstractConfiguration.start(AbstractConfiguration.java:303)
        at org.apache.logging.log4j.core.LoggerContext.setConfiguration(LoggerContext.java:621)
        at org.apache.logging.log4j.core.LoggerContext.reconfigure(LoggerContext.java:694)
        at org.apache.logging.log4j.core.LoggerContext.reconfigure(LoggerContext.java:711)
        at org.apache.logging.log4j.core.LoggerContext.start(LoggerContext.java:253)
        at org.apache.logging.log4j.core.impl.Log4jContextFactory.getContext(Log4jContextFactory.java:155)
        at org.apache.logging.log4j.core.impl.Log4jContextFactory.getContext(Log4jContextFactory.java:47)
        at org.apache.logging.log4j.LogManager.getContext(LogManager.java:196)
        at org.apache.logging.log4j.spi.AbstractLoggerAdapter.getContext(AbstractLoggerAdapter.java:137)
        at org.apache.logging.slf4j.Log4jLoggerFactory.getContext(Log4jLoggerFactory.java:55)
        at org.apache.logging.log4j.spi.AbstractLoggerAdapter.getLogger(AbstractLoggerAdapter.java:47)
        at org.apache.logging.slf4j.Log4jLoggerFactory.getLogger(Log4jLoggerFactory.java:33)
        at org.slf4j.LoggerFactory.getLogger(LoggerFactory.java:363)
        at org.slf4j.LoggerFactory.getLogger(LoggerFactory.java:388)
        at org.apache.camel.util.FileUtil.<clinit>(FileUtil.java:39)
        at org.apache.camel.dsl.jbang.core.commands.Init.call(Init.java:85)
        at org.apache.camel.dsl.jbang.core.commands.Init.call(Init.java:44)
        at picocli.CommandLine.executeUserObject(CommandLine.java:2041)
        at picocli.CommandLine.access$1500(CommandLine.java:148)
        at picocli.CommandLine$RunLast.executeUserObjectOfLastSubcommandWithSameParent(CommandLine.java:2461)
        at picocli.CommandLine$RunLast.handle(CommandLine.java:2453)
        at picocli.CommandLine$RunLast.handle(CommandLine.java:2415)
        at picocli.CommandLine$AbstractParseResultHandler.execute(CommandLine.java:2273)
        at picocli.CommandLine$RunLast.execute(CommandLine.java:2417)
        at picocli.CommandLine.execute(CommandLine.java:2170)
        at org.apache.camel.dsl.jbang.core.commands.CamelJBangMain.run(CamelJBangMain.java:134)
        at main.CamelJBang.main(CamelJBang.java:36)

2023-02-16 12:53:30,574 main ERROR Null object returned for File in Appenders.
2023-02-16 12:53:30,575 main ERROR Unable to locate appender ""file""
for logger config ""root""","chirag884:1676568493:2023-02-17T01:28:13.721+0000:1676568493:2023-02-17T01:28:13.721+0000:sys:pid was introduced as part of CAMEL-18538, it may need refactoring. 

Reading a similar issue:

[https://github.com/spring-projects/spring-boot/pull/16174] - it may require changing to %pid?
davsclaus:1676592088:2023-02-17T08:01:28.198+0000:1676592088:2023-02-17T08:01:28.198+0000:Hmm so its log4j that is told to use logger file
appender.file.fileName = ${sys:user.home}/.camel/${sys:pid}.log

And it uses StrSubstitutor to parse that line above, and on my system it detects sys which invokes SystemPropertiesLookup and then grabs the correct pid, set via 

            long pid = ProcessHandle.current().pid();
            System.setProperty(""pid"", """" + pid);

davsclaus:1676593149:2023-02-17T08:19:09.236+0000:1676593149:2023-02-17T08:19:09.236+0000:Okay I think I can see now that due to camel init uses FileUtil from camel-core that uses log4j logger then it setup logging but the log with pid file is not pre-configured for the init command. This is done for run command. So we need to setup the logging for all commands just in case.

So on linux a null pid did not cause log4j to blow up like on windows"
0,CAMEL-19066,Bug,Minor,"3.18.5, 3.20.2","3.18.6, 3.20.3, 3.21.0, 4.0-M2, 4.0.0","
None
",Resolved,Fixed,"3.18.6, 3.20.3, 3.21.0, 4.0-M2, 4.0.0",Claus Ibsen,hgarus,0,2,2023-02-16 20:37:02+00:00,2023-02-22 12:43:14+00:00,"When copying the result onto the original Exchange the Multicast EIP and related EIPs like Split and RecipientList copy the result back to the original Exchange, this copy includes the correlationId of the subexchange.


This can be somewhat confusing, especially with FlexibleAggregationStrategy which aggregates the result in an Exchange which is correlated to a different Exchange than the original Exchange.


Example:




from(""direct:foo"")
    .log(""Before split: exchangeId:'${exchangeId}' CorrelationId:'${exchangeProperty.CamelCorrelationId}'"")
    .split(body(), AggregationStrategies.flexible().pick(body()).accumulateInCollection(ArrayList.class))
    .log(""In split: exchangeId:'${exchangeId}' CorrelationId:'${exchangeProperty.CamelCorrelationId}'"")
    .end()
    .log(""After split: exchangeId:'${exchangeId}' CorrelationId:'${exchangeProperty.CamelCorrelationId}'""); 



Which produces the following Logging output for a two-Element List:




Before split: exchangeId:'742F0530A58A761-0000000000000000' CorrelationId:''
In split: exchangeId:'742F0530A58A761-0000000000000001' CorrelationId:'742F0530A58A761-0000000000000000'
In split: exchangeId:'742F0530A58A761-0000000000000002' CorrelationId:'742F0530A58A761-0000000000000000'
In split: exchangeId:'742F0530A58A761-0000000000000003' CorrelationId:'742F0530A58A761-0000000000000000'
After split: exchangeId:'742F0530A58A761-0000000000000000' CorrelationId:'742F0530A58A761-0000000000000001'","davsclaus:1676629952:2023-02-17T18:32:32.523+0000:1676629952:2023-02-17T18:32:32.523+0000:[~hgarus] would you add an unit test for enrich EIP also, and look at fixing org.apache.camel.processor.Enrich is a similar way.
BTW you should only restore the correlation id if its != null.
hgarus:1676897327:2023-02-20T20:48:47.040+0000:1676897327:2023-02-20T20:48:47.040+0000:[~davsclaus] done, I just opened [https://github.com/apache/camel/pull/9392] ."
0,CAMEL-19065,Bug,Major,3.20.2,,"
None
",Closed,Not A Bug,None,Zheng Feng,Jose A. Iñigo,0,2,2023-02-16 15:32:46+00:00,2023-02-22 06:18:49+00:00,"As reported in the camel.zulipchat.com #camel stream, it seems that camel saga async workflows using the Kafka component might be losing the correlation between the original LRA header value since the Kafka component doesn't automatically turn it back into a String.


Given the following route:




        from(""direct:bookings"")
            .saga()
            .propagation(MANDATORY)
           .log(""LOG1 \${headers}"")
            .to(""kafka:booking-requests?brokers=localhost:9092"")

       from(""kafka:booking-responses?brokers=localhost:9092"")
            .saga()
            .propagation(MANDATORY)
            .log(""LOG2 \${headers}"") 



When printing the headers we can see the Long-Running-Action with a String value:


 




LOG1 ...,Long-Running-Action=90EA3C7D191D45E-0000000000000001, ... 



 


This headers are serialized as bytes by the Kafka Producer and sent to a topic booking-requests where a processing application reads them and writes them back to booking-responses.


The problem shows up in the second log statement, where the Long-Running-Action header is not 90EA3C7D191D45E-0000000000000001 anymore:


 




LOG2 Long-Running-Action=[B@4d4b56e8 



The Camel Saga component isn't automatically reformating the header value into a String.


As a workaround we can provide a KafkaHeaderDeserializer to reconstruct it as a String:


 




       from(""kafka:booking-responses?brokers=localhost:9092&headerDeserializer=#kafkaHeaderStringDeserializer"")
            .saga()
            .propagation(MANDATORY)
            .log(""LOG2 \${headers}"") 



 


Here's a sample project where you can check this behaviour: https://github.com/codependent/booking-service","zhfeng:1676870448:2023-02-20T13:20:48.019+0000:1676870448:2023-02-20T13:20:48.019+0000:This should work since converting *byte[]* to *String* has been added in [IOConverter|https://github.com/apache/camel/blob/f955a62d128804b45791d4f7e40b58ead58c866b/core/camel-base/src/main/java/org/apache/camel/converter/IOConverter.java#L147-L150].

You need to use
{code}
.log(""LRA id is \${headers.Long-Running-Action}"")
{code}

to convert it to String explicitly. *log(""LOG \${headers}"")* does not convert each header."
0,CAMEL-19064,Improvement,Major,None,"4.0-M2, 4.0.0","
None
",Resolved,Fixed,"4.0-M2, 4.0.0",Andrea Cosentino,Andrea Cosentino,0,1,2023-02-16 13:55:26+00:00,2023-02-16 14:04:05+00:00,"https://freemarker.apache.org/docs/pgui_config_incompatible_improvements.html#autoid_51


We should specify a concrete version.


On the Spring-boot generator maven plugin we should avoid using configuration.getVersion as parameter for the configuration",
0,CAMEL-19063,Improvement,Minor,None,"4.0-RC2, 4.0.0","

help-wanted

",Resolved,Fixed,"4.0-RC2, 4.0.0",Claus Ibsen,James Netherton,0,1,2023-02-16 13:16:19+00:00,2023-07-18 10:51:05+00:00,"Some background to this from this Camel Quarkus issue:


 https://github.com/apache/camel-quarkus/issues/4515


Maybe we could use this project:


https://github.com/w3stling/rssreader


We'd obviously need to check whether the current feature set of camel-atom / camel-rss could be retained.",
0,CAMEL-19062,Task,Major,None,"4.0-M3, 4.0.0","
None
",Resolved,Fixed,"4.0-M3, 4.0.0",Andrea Cosentino,Andrea Cosentino,0,1,2023-02-16 10:07:32+00:00,2023-04-03 11:35:08+00:00,During the years the Camel Parent POM has been polluted with multiple dependencies like it was a BOM. Must of them are also non-camel specific. I would like to clean it up and make it a bit smaller.,
0,CAMEL-19061,Task,Minor,3.20.2,4.0.0,"
None
",Resolved,Fixed,4.0.0,Claus Ibsen,Lucia Drozdová,0,1,2023-02-16 09:40:42+00:00,2023-07-26 07:17:41+00:00,"It seems that there are few broken links in https://camel.apache.org/components/3.20.x/azure-servicebus-component.html documentation. I would fix it myself but I'm not sure, what is the right way to do it. ServiceBus documentation is not the only one, where these links doesn't work. 


For example:


disableAutoComplete parameter: in the description, there is _

{link ServiceBusReceiverAsyncClient#complete(ServiceBusReceivedMessage) completed}

_


another broken links in ServiceBus docs are in these parameters:


maxAutoLockRenewDuration


prefetchCount{}",
0,CAMEL-19060,Task,Major,"3.18.5, 4.0-M1",None,"
None
",Resolved,Fixed,4.0-RC1,Otavio Rodolfo Piske,Otavio Rodolfo Piske,0,2,2023-02-16 07:32:16+00:00,2023-08-31 09:05:47+00:00,"When using the Seda producer/consumer on a large core count machine, it seems that Camel's throughput peak at around 9 producer / 9 consumer threads and after that starts to decrease [1]. This seems to indicate some kind of coherence issue - the cost to keep the threads coherent exceeds the system's ability to handle the load / use the system's free capacity.


 


1. This, of course, taking in consideration that the thread pool had been adjusted and the machine has enough capacity. Both of which were true.


The attachments contains `perf` reports of the analysis of Camel 3.18.5, but similar patterns also happen w/ 4.0.0-M1. In particular, note the low ""Instruction per cycle"" reported on the attachment perf-stats.txt and the high incidence of Last Level Cache (LLC) misses to Remote Cache (HITM) in the attachment stats.txt.","orpiske:1676504526:2023-02-16T07:42:06.441+0000:1676505408:2023-02-16T07:56:48.403+0000:Some *hypothesis* that need to be investigated and tested:
 * Additional / non-reported impacts due to CAMEL-19058
 * Excessive locks and/or their granularity
 * Maybe overhead due to multiple volatile variables causing cache invalidation
 * False sharing

 

 

 
orpiske:1676506191:2023-02-16T08:09:51.295+0000:1676512483:2023-02-16T09:54:43.094+0000:Supporting links for interpreting the reports:
 * [Detecting false sharing|https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/monitoring_and_managing_system_status_and_performance/detecting-false-sharing_monitoring-and-managing-system-status-and-performance#detecting-false-sharing-with-perf-c2c_detecting-false-sharing] from Red Hat Enterprise Linux 8.
 * Joe Mario's [blog post|https://joemario.github.io/blog/2016/09/01/c2c-blog/] about detecting false sharing.
 * [What If|https://github.com/RedHatPerf/type-pollution-agent/blob/master/benchmarks/WHATIF.md] guide from Francesco Nigro, from Red Hat Middleware Performance team.

 

Other relevant links:
 * A blog post about [Type Check Scalability|https://redhatperf.github.io/post/type-check-scalability-issue/] (which may be related).

 
davsclaus:1683431893:2023-05-07T11:58:13.894+0000:1683431893:2023-05-07T11:58:13.894+0000:TODO: The LongAdder

I think this may break stuff, I can now see jbang have incorrect inflight exchanges

out in 5 seconds. Inflights per route: [route2 = 26]
2023-05-07 13:53:14.719 INFO 39678 --- [ - ShutdownTask] impl.engine.DefaultShutdownStrategy : Waiting as there are still 26 inflight and pending exchanges to complete, timeout in 4 seconds. Inflights per route: [route2 = 26]
2023-05-07 13:53:15.721 INFO 39678 --- [ - ShutdownTask] impl.engine.DefaultShutdownStrategy : Waiting as there are still 26 inflight and pending exchanges to complete, timeout in 3 seconds. Inflights per route: [route2 = 26]
2023-05-07 13:53:16.727 INFO 39678 --- [ - ShutdownTask] impl.engine.DefaultShutdownStrategy : Waiting as there are still 26 inflight and pending exchanges to complete, timeout in 2 seconds. Inflights per route: [route2 = 26]
2023-05-07 13:53:17.731 INFO 39678 --- [ - ShutdownTask] impl.engine.DefaultShutdownStrategy : Waiting as there are still 26 inflight and pending exchanges to complete, timeout in 1 seconds. Inflights per route: [route2 = 26]
orpiske:1684984072:2023-05-25T11:07:52.171+0000:1684984072:2023-05-25T11:07:52.171+0000:This was greatly improved on M2, M3 and in the upcoming RC1, therefore closing it."
0,CAMEL-19059,Dependency upgrade,Major,None,"4.0-M2, 4.0.0","
None
",Resolved,Fixed,"4.0-M2, 4.0.0",Andrea Cosentino,Claus Ibsen,0,1,2023-02-16 06:20:23+00:00,2023-02-16 09:49:35+00:00,We can use org.snmp:snmp directly as its in maven central,
0,CAMEL-19058,Task,Major,None,"4.0-RC1, 4.0.0","
None
",Resolved,Fixed,"4.0-RC1, 4.0.0",Otavio Rodolfo Piske,Otavio Rodolfo Piske,0,2,2023-02-16 06:13:49+00:00,2023-08-22 16:43:00+00:00,"Camel 3.x as well as 4.0.0-M1 reportedly have multiple cases of the type-check scalability described in this post. 


This can affect the the scalability of Camel when running with multiple threads and incur in extra unnecessary work.


See the attachment sample-trace-for-m1.txt for a report of the possible cases for M1 (triggered by running a simple application using seda). 


The initial set of patches for CAMEL-15105 have helped a great deal to remove these, but there's still a few to resolve.","davsclaus:1689480211:2023-07-16T12:03:31.431+0000:1689480211:2023-07-16T12:03:31.431+0000:Is all of this work done, and we can close this ticket ?
orpiske:1689556883:2023-07-17T09:21:23.293+0000:1689556883:2023-07-17T09:21:23.293+0000:Oh. I think we can close this for now. There may be other cases of the type check issue, but I can create separate tickets as needed.
orpiske:1689556933:2023-07-17T09:22:13.896+0000:1689556933:2023-07-17T09:22:13.896+0000:This issue should be resolved for now (a summary of the improvements are available on the blog: https://camel.apache.org/blog/2023/05/camel-4-performance-improvements/)"
0,CAMEL-19057,Improvement,Major,None,4.x,"
None
",Open,Unresolved,4.x,Freeman Yue Fang,Freeman Yue Fang,0,1,2023-02-15 20:49:25+00:00,2023-09-23 11:39:33+00:00,So we can easily define the cxfrs endpoint java code bean in spring boot runtime,
0,CAMEL-19056,Task,Major,None,,"
None
",Open,Unresolved,None,Otavio Rodolfo Piske,Otavio Rodolfo Piske,0,3,2023-02-15 16:56:50+00:00,2023-02-17 18:38:40+00:00,"After we finish streamlining the extensions interface on the CamelContext, we can evaluate creating a fluent interface API for building contexts. Therefore, we could try to separate the context configuration from the instantiation and provide the context configuration that is suitable for the user / scenario.


For instance, today users have to do something like this:




CamelContext context = new DefaultContext();
 
context.setName(""something"");
context.setDescription(""another thing"");

// an so on.




 


In concrete terms, we could investigate modifying the configuration to look like this:




CamelContext context = ContextConfigurationBuilder
      .newDefaultConfiguration()
      .withName(""something"")
      .withDescription(""another thing"")
      .build()
 
// No need for setters on the context -> make it immutable




 


We can also provide configurationBuilders for scenarios where immutability is undesired as well as allowing the build of contexts with the older API for users converting to 4.x




 
CamelContext context = ContextConfigurationBuilder
      .newDefaultConfiguration()
      .withName(""something"")
      .withDescription(""another thing"")
      .buildLegacy();  // returns a context instance with all the setters / getters that the users may expect 



 


The main goals are to:
1. Allow the creation of contexts that are truly immutable
2. Simplify removing / abstracting runtime configuration that may not be needed in some cases (thus helping keeping the context lightweight for Quarkus, Camel K and other scenarios)","orpiske:1676451553:2023-02-15T16:59:13.084+0000:1676451553:2023-02-15T16:59:13.084+0000:[~davsclaus] [~acosentino] I've been thinking about this as one of the future improvements for the CamelContext API (naturally, with a layer to allow users to transition smoothly). What do you think?
acosentino:1676524419:2023-02-16T13:13:39.087+0000:1676524419:2023-02-16T13:13:39.087+0000:I think this is interesting. It would be nice to understand if we could automatically generate the fluent builder.
orpiske:1676596766:2023-02-17T09:19:26.336+0000:1676596766:2023-02-17T09:19:26.336+0000:[~acosentino] In theory we could. My idea is to have extension points (defined by an Extension interface), so I think we could parse it in a similar way that we do w/ the components and endpoints.
davsclaus:1676630320:2023-02-17T18:38:40.452+0000:1676630320:2023-02-17T18:38:40.452+0000:Yeah a modern fluent builder would be nice, for the advanced end users that build and run Camel manually (not using SB / Q / camel-jbang). And a generate builder will help maintain this.
If you are able to build a general builder source generator, then I am interrested to use it in camel-main as we have 100 options in the configuration class, that we add fluent builders manual today.

"
0,CAMEL-19055,Improvement,Major,None,"4.0-M2, 4.0.0","
None
",Resolved,Fixed,"4.0-M2, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-02-15 14:41:01+00:00,2023-02-15 15:31:53+00:00,This can be useful to know which thread is processing the message at the given node,
0,CAMEL-19054,Task,Major,None,None,"
None
",Resolved,Fixed,"4.0-M2, 4.0.0",Andrea Cosentino,Andrea Cosentino,0,1,2023-02-15 11:35:00+00:00,2023-02-15 11:37:19+00:00,There is a compatible version with v1 https://github.com/alibaba/fastjson2#fastjson-v1%E5%85%BC%E5%AE%B9%E6%A8%A1%E5%9D%97,
0,CAMEL-19053,Task,Major,None,,"
None
",Resolved,Fixed,None,Otavio Rodolfo Piske,Otavio Rodolfo Piske,0,1,2023-02-15 11:30:14+00:00,2023-06-13 13:41:47+00:00,No Desc,orpiske:1686634907:2023-06-13T13:41:47.011+0000:1686634907:2023-06-13T13:41:47.011+0000:This was completed as part of the work on CAMEL-15105.
0,CAMEL-19052,Task,Major,None,None,"
None
",Resolved,Fixed,"4.0-RC1, 4.0.0",Unassigned,Andrea Cosentino,0,1,2023-02-15 09:06:50+00:00,2023-05-24 08:00:29+00:00,https://github.com/eclipse-ee4j/angus-mail/releases/tag/2.0.0,"acosentino:1676424258:2023-02-15T09:24:18.191+0000:1676424258:2023-02-15T09:24:18.191+0000:This will need also to move to different mock javamail.
acosentino:1676424316:2023-02-15T09:25:16.061+0000:1676424316:2023-02-15T09:25:16.061+0000:I'm not completely sure it really worth to do the switch, but let's see."
0,CAMEL-19051,Bug,Major,4.0-M1,None,"
None
",Resolved,Fixed,"4.0-M2, 4.0.0",Unassigned,Andrea Cosentino,0,1,2023-02-15 08:47:02+00:00,2023-02-15 10:53:55+00:00,"A problem occures when using opentelemetry 4.0.0-M1 with spring-boot auto configuration.


The autoconfiguration works as expected and the resulting openTelemetry bean is as expected.
But when the first request comes in, the autoconfigured bean is not used and another openTelemetry configured with OpenTelemetry.noop() is used.


org.apache.camel.opentelemetry.OpenTelemetryTracer#startExchangeBeginSpan uses GlobalOpenTelemetry.get(), which in turn looks into it's io.opentelemetry.api.GlobalOpenTelemetry#globalOpenTelemetry which was not set and so it creates the noop implementation.


First step to fix without side effects is to allow the explicit setting of the ContextPropagators which then can be used by org.apache.camel.opentelemetry.starter.OpenTelemetryAutoConfiguration#openTelemetryEventNotifier to use the proper autoconfigured instances.


https://camel.zulipchat.com/#narrow/stream/257301-camel-spring-boot/topic/opentelemetry/near/327478493",
0,CAMEL-19050,New Feature,Major,None,None,"
None
",Resolved,Fixed,"3.21.0, 4.0-M3, 4.0.0",Unassigned,Claude Mamo,0,2,2023-02-14 20:10:49+00:00,2023-03-15 03:09:50+00:00,The DHIS2 team is maintaining an Apache Camel component that leverages the DHIS2 Java SDK to integrate Apache Camel with the DHIS2 Web API. We'd like to add this component to the Apache Camel distribution. PRs contributing the component will be opened soon on the main and 3.x branches.,"davsclaus:1678604374:2023-03-12T14:59:34.477+0000:1678613998:2023-03-12T17:39:58.630+0000:TODO: camel-dhis2-starter for 3.x *DONE*
TODO: camel-dhis2-starter for main *DONE*
davsclaus:1678685742:2023-03-13T13:35:42.702+0000:1678685742:2023-03-13T13:35:42.702+0000:Is there more work for this?
claude.mamo:1678689950:2023-03-13T14:45:50.511+0000:1678689950:2023-03-13T14:45:50.511+0000:I've opened the last PR on the main branch."
0,CAMEL-19049,Bug,Minor,3.14.6,,"
None
",Resolved,Won't Fix,None,Unassigned,Rastislav Papp,0,2,2023-02-14 14:55:51+00:00,2023-11-09 12:33:22+00:00,"After upgrading from 3.14.4 to 3.14.6 we can no longer call camel bean method on an instance of OSGI service which implements an interface. This is caused by the changes introduced in CAMEL-18411.


Example:


route:




public class TestRoute extends RouteBuilder {

    @BeanInject
    private MyInterface myInterface;

    @Override
    public void configure() {
        from(""..."")
            .bean(myInterface, ""reinit"");

    }

}




The MyInterface is:




public interface MyInterface {
    void reinit();
}




The object injected is a proxy reference to OSGI service, injected by blueprint in karaf runtime.


Stacktrace:




org.apache.camel.component.bean.AmbiguousMethodCallException: Ambiguous method invocations possible: [public void Proxyb113d9d3_4aac_4ac9_b619_9bb68d221255.reinit(), public abstract void foo.bar.MyInterface.reinit()] on the exchange: Exchange[92BC3141E43445D-000000000000003F] at org.apache.camel.component.bean.BeanInfo.createInvocation(BeanInfo.java:246) at org.apache.camel.component.bean.AbstractBeanProcessor.process(AbstractBeanProcessor.java:126) at org.apache.camel.component.bean.BeanProcessor.process(BeanProcessor.java:81) at org.apache.camel.processor.errorhandler.RedeliveryErrorHandler$RedeliveryTask.doRun(RedeliveryErrorHandler.java:818) at org.apache.camel.processor.errorhandler.RedeliveryErrorHandler$RedeliveryTask.run(RedeliveryErrorHandler.java:726) at org.apache.camel.impl.engine.DefaultReactiveExecutor$Worker.schedule(DefaultReactiveExecutor.java:193) at org.apache.camel.impl.engine.DefaultReactiveExecutor.scheduleMain(DefaultReactiveExecutor.java:64) at org.apache.camel.processor.Pipeline.process(Pipeline.java:185) at




The ambiguousness is caused by the reinit() method detected twice - once from the interface, and one from the Proxy class.


I'm working on a solution.


cc: AWeickel","rastislav.papp:1676508101:2023-02-16T08:41:41.945+0000:1676508101:2023-02-16T08:41:41.945+0000:[~bjornomy], [~AWeickel], [~davsclaus], I've tracked this down to this change in {{BeanInfo}}:
 !screenshot-1.png! 

Adding the exclusion for methods of synthetic classes to {{#findMostSpecificOverride}}. When the class is a Proxy created by aries-proxy (e.g. referenced osgi service in karaf runtime), the BeanInfo finds 2 methods with the same name, one in the original class and one in the synthetic Proxy, and decides they do not override each other. Therefore it throws AmbiguousMethodCallException, when trying to invoke the method.


Robert Schulte:1689549950:2023-07-17T07:25:50.369+0000:1689549950:2023-07-17T07:25:50.369+0000:Our project (Karaf, Aries) is affected by this as well. We recently updated from 3.11 to 3.21 and started to see failing exchanges when the bean component is used.
I wonder why this has been set to minor priority, since bean is a core component and there is no simple workaround.
Robert Schulte:1690245288:2023-07-25T08:34:48.250+0000:1690245288:2023-07-25T08:34:48.250+0000:I have done some cross-testing and I think I can narrow the issue down.
I tried to create a minimal example that turned out to work just fine on vanilla Karaf (with feature camel-blueprint 3.21.0). To my suprise, it also worked in our customized Karaf distro:

[^test.xml]

By now, I am pretty sure that there is no general issue with using a bean that resolves from the OSGi service registry. In our case, it is the probably the combination with Apache Aries JPA blueprint that causes the issue. I need to do some more tests, but my guess would be that I get the AmbiguousMethodCallException when using http://aries.apache.org/xmlns/transactions regardless of declaring a bean locally or retrieving it via the service registry.

[~rastislav.papp], are we experiencing similar issues or is your case different? Does {{@BeanInject}} work for you, if reference something simple like org.apache.karaf.system.SystemService 's getVersion method? Does the implementation of your service use Aries JPA?  "
0,CAMEL-19048,Improvement,Major,None,Future,"
None
",In Progress,Unresolved,Future,Unassigned,Claus Ibsen,0,1,2023-02-14 11:25:10+00:00,2023-12-15 17:49:25+00:00,"The ListTrace has color output.


We should make all commands output in color. And have some util method to make this easy to avoid copying to much code around.


We should also make it possible to not output in color


--color=false


And later when we have settings then the user can default choose to turn it on or off


Something ala:
camel config set color=false","davsclaus:1678588292:2023-03-12T10:31:32.779+0000:1678588292:2023-03-12T10:31:32.779+0000:picolli also has support for colors
https://picocli.info/#_ansi_colors_and_styles

"
0,CAMEL-19047,Bug,Major,4.0-M1,"4.0-M2, 4.0.0","
None
",Resolved,Fixed,"4.0-M2, 4.0.0",Jiri Ondrusek,Jiri Ondrusek,0,1,2023-02-14 09:09:38+00:00,2023-02-15 08:47:08+00:00,"There is a code in `CamelTestSupport` which verifies whether the right test parent is used in Quarkus or Spring-boot (code). 
These checks should be move above the `if` condition, to be called even if `Lifecycle.PER_CLASS` is used.",
0,CAMEL-19046,Improvement,Major,None,Future,"
None
",Open,Unresolved,Future,Unassigned,Claus Ibsen,0,1,2023-02-14 08:01:32+00:00,2023-07-24 11:51:50+00:00,"We would like to be able to categorize an error (exception thrown) by Camel routing engine whether that error happend in the consumer/source, during processing (routing) or in the producer/sink (sending to external system).


This can better assist where a problem lies, i.e. source and sink are related to external systems, processing is related to Camel or custom end user integration/business logic.


We can also have some kind of SPI to introspect the thrown exception and error message, to enrich error details.",
0,CAMEL-19045,Improvement,Major,3.18.1,,"
None
",Resolved,Information Provided,None,Unassigned,Ciprian Ciubotariu,0,2,2023-02-14 00:30:54+00:00,2023-02-16 08:38:18+00:00,"So, I've made this the last year, based on camel-3.18.1, and it works perfectly fine with aries-cdi (CDI 2.0). At this stage it still is pretty dirty. I thought I should contribute it and ask for directions on how to separate the OSGi function from the non-osgi camel-cdi code.


However, I have noticed that the roadmap to camel-4 is dropping both camel-cdi and moving away all of the OSGi support.


So I guess the question now would be I should contribute this here, or maybe it would be better to attempt to submit this to camel-karaf, along with the rest of camel-cdi.",davsclaus:1676413185:2023-02-15T06:19:45.568+0000:1676413185:2023-02-15T06:19:45.568+0000:See PR
0,CAMEL-19044,New Feature,Minor,"3.20.2, 3.21.0, 4.0-M1","3.21.0, 4.0-M2, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M2, 4.0.0",Marat Gubaidullin,Marat Gubaidullin,0,1,2023-02-13 22:28:10+00:00,2023-02-15 19:42:48+00:00,No Desc,
0,CAMEL-19043,Improvement,Major,None,"4.0-M2, 4.0.0","
None
",Resolved,Fixed,"4.0-M2, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-02-12 19:16:21+00:00,2023-02-13 13:02:53+00:00,No Desc,
0,CAMEL-19042,Improvement,Minor,None,"3.21.0, 4.0-M2, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M2, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-02-12 15:11:04+00:00,2023-02-12 15:19:37+00:00,"Argh they use weird versions that do not exists. Should have ben 1.0.0 instead.


 camel-quarkus-core        Stable   0.0.1  Uses an existing expression from the registry.
 camel-quarkus-core        Stable   0.0.1  Evaluates a Camel simple expression.
 camel-quarkus-core        Stable   0.0.1  Tokenize text payloads using delimiter patterns.",
0,CAMEL-19041,New Feature,Major,None,4.x,"
None
",Open,Unresolved,4.x,Unassigned,Claus Ibsen,0,2,2023-02-12 10:06:07+00:00,2023-09-23 11:39:37+00:00,So you can do camel run foo.java --runtime=spring-boot,"ggrzybek:1678082658:2023-03-06T14:04:18.214+0000:1678082658:2023-03-06T14:04:18.214+0000:[~davsclaus] I had CAMEL-18662 on my todo list, but not before resolving CAMEL-18189. 
davsclaus:1678085540:2023-03-06T14:52:20.522+0000:1678085540:2023-03-06T14:52:20.522+0000:Ok no problem I just assigned you this ticket ;)
ggrzybek:1687754398:2023-06-26T12:39:58.426+0000:1687754398:2023-06-26T12:39:58.426+0000:[~davsclaus], I'm unassigning this from myself - I have no idea how to switch the runtime with single {{jbang run camel}} option... Picking up target runtime should be more conscious decision than just an option:
* for Quarkus, much is happening at build time, so we need Maven (or Gradle?) for this
* for Spring Boot we'd need to create the Camel context itself using Spring bean (instead of instantiating DefaultCamelContext using camel-main (and camel-kamelet-main)"
0,CAMEL-19040,Improvement,Major,None,"4.0-M2, 4.0.0","
None
",Resolved,Fixed,"4.0-M2, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-02-12 10:03:33+00:00,2023-02-13 13:02:32+00:00,"For tracing we need to capture more information to allows users to trouble shoot better. Today we only capture message header/body.


We need to also add



exception
exchange properties



We can make this an option to enable to turn on|off","davsclaus:1676245628:2023-02-13T07:47:08.178+0000:1676264522:2023-02-13T13:02:02.476+0000:- exchange properties *DONE*
- exception *DONE*
davsclaus:1676264552:2023-02-13T13:02:32.574+0000:1676264552:2023-02-13T13:02:32.574+0000:We many consider backporting this to 3.21 to make UX for tracing better such as when using camel-jbang"
0,CAMEL-19039,Dependency upgrade,Minor,None,"3.21.0, 4.0-M2, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M2, 4.0.0",Unassigned,Claus Ibsen,0,1,2023-02-11 09:48:52+00:00,2023-03-01 10:17:02+00:00,No Desc,
0,CAMEL-19038,New Feature,Major,None,,"
None
",Resolved,Won't Fix,None,Unassigned,Claus Ibsen,0,1,2023-02-11 09:14:23+00:00,2023-12-22 11:20:28+00:00,"You can group routes together with `routeGroup`. 


It would be good if we have a mbean that represent each group with statistics.",
0,CAMEL-19037,New Feature,Major,None,Future,"
None
",Open,Unresolved,Future,Unassigned,Claus Ibsen,0,1,2023-02-10 17:04:25+00:00,2023-02-10 17:04:25+00:00,"We should look at if we can build native binaries of camel-jbang CLI so we can release that and have it as downloads - like the Camel K kamel CLI.


We can then get it distributed in various package manager.


jrelease is a project that can do that.",
0,CAMEL-19036,Improvement,Major,None,,"
None
",Resolved,Fixed,None,Unassigned,Claus Ibsen,0,1,2023-02-10 16:57:09+00:00,2023-02-11 14:58:40+00:00,The tracer should keep last N messages (based on exchange id) so you always can see what happened to those last messages.,
0,CAMEL-19035,Bug,Minor,3.10.0,,"
None
",Resolved,Won't Fix,None,Nicolas Filotto,Xilai Dai,0,2,2023-02-10 13:57:38+00:00,2023-10-19 09:03:49+00:00,"Given a json payload e.g:




{
	""ABC"": ""A"",
	""VERSION_NO"": ""BASE"",
	""DEF"": [
		{
			""GGG"": 1,
			""HHH"": ""N"",
			""OOO"": [
				{
					""PPP"": 1,
					""QQQ"": 555.55,
					""RRR"": 666.66,
					""SSS"": 0,
					""TTT"": 777.77
				},
				{
					""PPP"": 3,
					""QQQ"": .05,
					""RRR"": .10,
					""SSS"": 0,
					""TTT"": .10
				}
			]
		}
	]
}




In case of there is something e.g invalid integer value (.05) in the payload



.jsonpath(""$.VERSION_NO"") works as expected in Camel version less than 3.10.0.
.jsonpath(""$.VERSION_NO"") will throw parse exception in Camel version great than or equal 3.10.0.



Investigation shows that this regression was starting happening after CAMEL-16389.
https://github.com/apache/camel/commit/b59a96ddf1ba647b979f937f5bd956bba32173ee


Now camel-jsonpath is trying to parse whole json payload.


Attached test-jsonpath.zip for test/reproduce this issue.","nfilotto:1676270733:2023-02-13T14:45:33.557+0000:1676271577:2023-02-13T14:59:37.224+0000:To avoid this exception, you need to configure a custom {{ObjectMapper}} in order to enable the feature 
{{ALLOW_LEADING_DECIMAL_POINT_FOR_NUMBERS}} which is meant for this kind of use case. Since Camel 3.17.0 thanks to https://issues.apache.org/jira/browse/CAMEL-17956, it is possible to register a custom {{ObjectMapper}} directly in the Camel registry to configure once for all the expected behavior of the Jackson parser.
xldai:1676318381:2023-02-14T03:59:41.246+0000:1676318381:2023-02-14T03:59:41.246+0000:[~nfilotto] , Thanks for your analysis results above!
But the really issue is a regression after 3.10.0 with [https://github.com/apache/camel/commit/e9e8ed2057f0122f30664eb123ca00775a69c538]
""now the whole json payload is getting parsed""
{{.05}} is just an example number value in the json.
in case of e.g. there is another invalid Date type value in the json, the issue still happening.
nfilotto:1676384780:2023-02-14T22:26:20.854+0000:1676419449:2023-02-15T08:04:09.171+0000:Camel changed of default {{jsonProvider}} from {{json-smart}} ({{com.jayway.jsonpath.spi.json.JsonSmartJsonProvider}}) to {{Jackson}} ({{com.jayway.jsonpath.spi.json.JacksonJsonProvider}}). The behavior change comes from [the commit|https://github.com/apache/camel/commit/b59a96ddf1ba647b979f937f5bd956bba32173ee] corresponding to https://issues.apache.org/jira/browse/CAMEL-16389. The change is due to a vulnerability issue [CVE-2021-27568|https://nvd.nist.gov/vuln/detail/CVE-2021-27568] in {{json-smart}} that is the reason why {{com.jayway.jsonpath.spi.json.JsonSmartJsonProvider}} is no more used and {{net.minidev.json-smart}} is excluded from the dependencies. Even if it has been fixed in 2.4.7 (version used by {{json-path}}), the library https://github.com/netplex/json-smart-v2 is no more active (no real activity in the past year) so it has been decided to switch definitively to the Jackson Json provider.
xldai:1676406855:2023-02-15T04:34:15.743+0000:1676406855:2023-02-15T04:34:15.743+0000:Yes, I confirm this issue is start happening after https://github.com/apache/camel/commit/b59a96ddf1ba647b979f937f5bd956bba32173ee
(Updated the Jira description and linked with CAMEL-16389)
xldai:1697656234:2023-10-19T03:10:34.567+0000:1697656234:2023-10-19T03:10:34.567+0000:[~nfilotto],
The ""ALLOW_LEADING_DECIMAL_POINT_FOR_NUMBERS"" property is not taken into account in case of spring-boot class loading.
(attached test-jsonpath-springboot.zip)
Any idea how to get it works in this case?
nfilotto:1697670528:2023-10-19T07:08:48.877+0000:1697670706:2023-10-19T07:11:46.031+0000:SpringBoot automatically registers an {{ObjectMapper}} so as you register another {{ObjectMapper}}, Camel finds 2 ObjectMappers instead of one so it doesn't know which one to use, in that case, it ignores both, and uses a default one hence the behavior you get.
To fix that you need to avoid registering your own {{ObjectMapper}} and configure the {{ObjectMapper}} managed by SpringBoot.
There are at least 2 ways to configure the {{ObjectMapper}} managed by SpringBoot:

1. By configuration: In the {{application.properties}} simply adds {{spring.jackson.parser.allow-leading-decimal-point-for-numbers=true}}
2. By code: In your class add a method of the following type:


{code:java}
@Bean
public ObjectMapper customJson(){
	ObjectMapper om = new com.fasterxml.jackson.databind.ObjectMapper();
	om.configure(JsonReadFeature.ALLOW_LEADING_DECIMAL_POINT_FOR_NUMBERS.mappedFeature(), true);
	return om;
}
{code}


xldai:1697677429:2023-10-19T09:03:49.058+0000:1697677429:2023-10-19T09:03:49.058+0000:Thank you Nicolas!
Both solutions above work for me."
0,CAMEL-19034,Bug,Major,None,"3.14.8, 3.18.6, 3.20.3, 3.21.0, 4.0-M2, 4.0.0","
None
",Resolved,Fixed,"3.14.8, 3.18.6, 3.20.3, 3.21.0, 4.0-M2, 4.0.0",Andrea Cosentino,Andrea Cosentino,0,1,2023-02-10 11:41:50+00:00,2023-02-10 13:25:46+00:00,"See 


https://camel.zulipchat.com/#narrow/stream/257298-camel/topic/aws2-s3.20getObject.20no.20metadata


GetObject doens't copy the metadata after setting the body.",
0,CAMEL-19033,New Feature,Major,None,"3.21.0, 4.0-M2, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M2, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-02-10 10:42:59+00:00,2023-02-11 19:19:24+00:00,Requires CAMEL-19027,
0,CAMEL-19032,Improvement,Major,3.19.0,4.x,"

saga

",Resolved,Fixed,4.x,Unassigned,adam chen,0,3,2023-02-10 03:03:32+00:00,2023-12-22 11:23:49+00:00,"In my test result isn't like offical explanation (All participants (e.g. credit service, order service) can set their own timeout. The minimum value of those timeouts is taken as timeout for the saga when they are composed together.) In my result show that saga timeut value is depending on first participant's timeout value, not the minimum vlaue of participants.  Test code","zhfeng:1676331553:2023-02-14T07:39:13.642+0000:1676331553:2023-02-14T07:39:13.642+0000:I also recommend to use LRASagaService and narayana-lra-coordinator. Please check [MicroProfile LRA Spec|https://download.eclipse.org/microprofile/microprofile-lra-1.0/microprofile-lra-spec-1.0.html#timing-out-lras-and-compensators] for the timeout handling. And yeah, the doc should be improved. Do you like to contribute with a docoment fix? [~chen19980]
chen19980:1676340469:2023-02-14T10:07:49.572+0000:1676340469:2023-02-14T10:07:49.572+0000:[~zhfeng] yeah, I think the doc should be fixed.
davsclaus:1689560073:2023-07-17T10:14:33.629+0000:1689560073:2023-07-17T10:14:33.629+0000:Help with improving the docs is appreciated
davsclaus:1703215429:2023-12-22T11:23:49.249+0000:1703215429:2023-12-22T11:23:49.249+0000:Doc has been updated"
0,CAMEL-19031,Bug,Major,3.19.0,None,"

saga

",Resolved,Fixed,"3.14.8, 3.18.6, 3.20.3, 3.x, 4.0-M2",Zheng Feng,adam chen,0,3,2023-02-10 02:38:42+00:00,2023-02-17 07:56:43+00:00,"The problem is : I find that when actionA is timeout and it executed compensated, In theory the saga route should be stopped, not continue to call the next actionB.  In my test show that when the first task can't complete before its timeout, it will run compensation but the saga route don't stop, it still run second task and third task. In my opinion, I think when the first task can't complete and run compensation, the second and third task shouldn't run.  [Test Code|https://github.com/chen19980/SAGA_timeout_test]","zhfeng:1676245457:2023-02-13T07:44:17.528+0000:1676245457:2023-02-13T07:44:17.528+0000:It seems that InMemorySagaCoordinator::beginStep does not check the current status. So even the status is not *RUNNING*, it still add the step. Then a potential fix could be to add a status checking. I create a patch as an attachement, [~chen19980] can you verify it? [^InMemorySagaCoordinator.patch] 
chen19980:1676251259:2023-02-13T09:20:59.892+0000:1676251315:2023-02-13T09:21:55.103+0000:[~zhfeng]  This is my test result.

!2023-02-13 17 03 13.jpg|width=559,height=264!!2023-02-13 17 04 02.jpg|width=561,height=227!

I think that the test result is right. And the result also throw exception, is it a normal condition ? How do you think about this test result?
nfilotto:1676510076:2023-02-16T09:14:36.203+0000:1676510076:2023-02-16T09:14:36.203+0000:I reopen it as the PR has not been merged yet
chen19980:1676513638:2023-02-16T10:13:58.854+0000:1676513638:2023-02-16T10:13:58.854+0000:[~nfilotto]  ok! Thanks~
zhfeng:1676518904:2023-02-16T11:41:44.163+0000:1676518904:2023-02-16T11:41:44.163+0000:yeah, we aslo need to bakcport to 3.20.x"
0,CAMEL-19030,New Feature,Major,None,"3.21.0, 4.0-M2, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M2, 4.0.0",Claus Ibsen,Claus Ibsen,1,1,2023-02-09 19:03:40+00:00,2023-02-12 12:19:27+00:00,So you can look at docs for different versions than the CLI default version.,
0,CAMEL-19029,Dependency upgrade,Minor,4.0-M1,4.0-M2,"
None
",Resolved,Fixed,4.0-M2,Nicolas Filotto,Nicolas Filotto,0,1,2023-02-09 18:00:50+00:00,2023-02-10 11:14:12+00:00,"The version currently used (7) is not Jakarta-compatible, we need to upgrade it to a version >= 9.1 according to https://github.com/twilio/twilio-java/issues/713.",nfilotto:1675993337:2023-02-10T09:42:17.181+0000:1675993337:2023-02-10T09:42:17.181+0000:The corresponding PR https://github.com/apache/camel/pull/9327
0,CAMEL-19028,Test,Minor,None,4.0.0,"
None
",Resolved,Fixed,4.0.0,Claus Ibsen,Claus Ibsen,0,2,2023-02-09 16:05:06+00:00,2023-11-14 12:46:05+00:00,"[WARNING] Flakes:
[WARNING] org.apache.camel.processor.WireTapAbortPolicyTest.testSend
[ERROR]   Run 1: WireTapAbortPolicyTest.testSend:60 Task should be rejected
[ERROR]   Run 2: WireTapAbortPolicyTest.testSend:60 Task should be rejected
[INFO]   Run 3: PASS


It can lead to failing 3 in a row. So lets check if we can make it less flaky","orpiske:1699937156:2023-11-14T12:45:56.921+0000:1699937156:2023-11-14T12:45:56.921+0000:This was [fixed|https://github.com/apache/camel/commit/9dd5d8061a15165b1bcd88c00953a61fd891f2b8] during the test cleanup efforts prior to Camel 4 release.

"
0,CAMEL-19027,New Feature,Major,None,"3.21.0, 4.0-M2, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M2, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-02-09 13:20:04+00:00,2023-02-10 11:47:23+00:00,No Desc,"davsclaus:1675992060:2023-02-10T09:21:00.015+0000:1675992060:2023-02-10T09:21:00.015+0000:When --trace --console --dev is enabled in camel jbang then we should turn on backlog tracer as well, or keep it on always. There is a slight overhead of dumping every messages during routing."
0,CAMEL-19026,Bug,Minor,3.20.2,None,"
None
",Resolved,Fixed,"3.20.3, 3.21.0, 4.0-M2, 4.0.0",Claus Ibsen,Claus Ibsen,1,1,2023-02-08 19:49:03+00:00,2023-07-07 08:55:16+00:00,The backlog is in context but is disabled. It should be enabled when set this option.,"davsclaus:1675858393:2023-02-08T20:13:13.074+0000:1675858393:2023-02-08T20:13:13.074+0000:Ah yeah you need to enable it explicit - it sits there in the background waiting - eg hawtio enables it when you start using it.
davsclaus:1675893618:2023-02-09T06:00:18.469+0000:1675893618:2023-02-09T06:00:18.469+0000:We should add
camel.main.backlogTracingStandby

Then it works similar to regular tracing (logging only)


"
0,CAMEL-19025,Improvement,Minor,None,"3.20.3, 3.21.0, 4.0-M2, 4.0.0","
None
",Resolved,Not A Bug,"3.20.3, 3.21.0, 4.0-M2, 4.0.0",Unassigned,Claus Ibsen,0,1,2023-02-08 19:41:57+00:00,2023-02-08 20:07:33+00:00,"camel doc main --filter=trace


should find trace and ignore case, so you also find backlogTracing",
0,CAMEL-19024,Improvement,Minor,3.20.2,"3.20.7, 3.21.1, 3.22.0","
None
",Resolved,Fixed,"3.20.7, 3.21.1, 3.22.0",Claus Ibsen,Piotr Klimczak,0,4,2023-02-08 17:08:37+00:00,2023-08-02 18:07:38+00:00,"1st of all wanted to thank Apache Camel community for keeping Camel Karaf going.


Below were introduced in camel 3.18, in this PR: https://github.com/apache/camel/pull/7904
 
org.apache.camel/camel-cxf-spring-common
org.apache.camel/camel-cxf-spring-rest
org.apache.camel/camel-cxf-spring-soap
org.apache.camel/camel-cxf-spring-transport


 


-------------------------------------------------------------


FIX PR: https://github.com/apache/camel-karaf/pull/237","davsclaus:1675856784:2023-02-08T19:46:24.432+0000:1675856784:2023-02-08T19:46:24.432+0000:You are welcome to send a PR against 3.x for stuff that you think needs added to the features file
https://github.com/apache/camel-karaf/tree/camel-karaf-3.x
davsclaus:1675856845:2023-02-08T19:47:25.235+0000:1675856845:2023-02-08T19:47:25.235+0000:Ah okay, so on Karaf we do not support Spring XML, but OSGi Blueprint instead. So the features is likely correct as-is today.
nannou9:1675860164:2023-02-08T20:42:44.647+0000:1675865169:2023-02-08T22:06:09.330+0000:Ahh got it. Thanks Claus.
It is really regretful that spring is not ""officially"" supported as we are using Spring successfully with Blueprint/Spring bridge on Karaf 4.2.5, 4.3.1 and now migrating to 4.4.3.

I have created few patches to Aries community over a year ago to allow Spring successfully work with Karaf and Camel, but they are all hanging without even comments on them: ARIES-2045 and ARIES-2046.

So in all honesty Camel + Spring + Karaf is just few patches away, just can't get community to merge my PRs :D.
And it fully works, including osgi features from Spring- OSGi references, services, config admin based properties, etc.
Pretty much it all works like with Spring 3 and Spring-DM (old good days) :D.

What do you think Claus, do we really want such combination to die?
(BTW. I am not keen on blueprint app context)

I will try to open discussion on Karaf project: KARAF-7668
jbonofre:1675990956:2023-02-10T09:02:36.517+0000:1675990956:2023-02-10T09:02:36.517+0000:That's not fully correct: Karaf still supports Spring XML (I don't talk about spring-dm which has been replaced by blueprint, but pure Spring XML).
nannou9:1676011922:2023-02-10T14:52:02.066+0000:1676011997:2023-02-10T14:53:17.637+0000:Thanks [~jbonofre] for your update, it is very helpful.

[~davsclaus] basing on above answer I think it would make sense to reopen this- hope you don't mind.
TBH I was considering reopening it anyway (or creating new jira) since all above spring projects define osgi imports and there are some mistakes there too.
I appreciate that Spring+Karaf support might not be your main focus, but since those modules has some level of OSGi support, it sounds sensible to keep it there and fix it.

I will be more than happy to provide PR with fixes as we make those fixes anyway.
Just give us few more days to finish testing and submit some PR which fixes all issues- like said we have approx 200 Karaf + Camel + Spring integrations, so we should be able to come up with nice test sample for this functionality and all fixes needed.

Also just to keep us on the same page:
In vanilla Karaf indeed there is Blueprint Spring project which is responsible for discovering Spring contexts in META-INF.
Then there is Blueprint Spring Extender which serves same purpose like Spring DM.
From that perspective Karaf does support Spring.

[~jbonofre] or do you mean some other way of using Spring context?

Thanks both for your contribution so far.
Really appreciated.
nannou9:1676023732:2023-02-10T18:08:52.664+0000:1676023732:2023-02-10T18:08:52.664+0000:""You are welcome to send a PR against 3.x for stuff that you think needs added to the features file""
I should have clarified that we're not expecting community to fix it. We will fix all issues ourselves as we have to.
We're more after asking community to kindly accept our fixes, which hopefully will make Camel better and us having less diffs to maintain.
nannou9:1677402020:2023-02-26T17:00:20.484+0000:1677407308:2023-02-26T18:28:28.618+0000:There was some long delay with linking PRs with Jira.
Created and closed multiple PRs thinking that my PRs are wrong, now we have multiple PRs linked with some of them closed. Sorry.
Right PR: [https://github.com/apache/camel-karaf/pull/237]"
0,CAMEL-19023,New Feature,Major,None,"3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M3, 4.0.0",Unassigned,Marcin Grzejszczak,1,2,2023-02-08 13:15:20+00:00,2023-03-28 17:12:59+00:00,"I'm a co-maintainer of Spring Cloud Sleuth and Micrometer projects (together with Tommy Ludwig and Jonatan Ivanov). 


Micrometer Observation is coming as part of the Micrometer 1.10 release and Micrometer Tracing is a new project. The idea of Micrometer Observation is that you instrument code once but you get multiple benefits out of it - e.g. you can get tracing, metrics, logging or whatever you see fit).


Since Camel already supports Micrometer I was curious if there's interest in adding Micrometer Observation support so that automatically (when on classpath) except for metrics, spans could be created and tracing context propagation could happen too. In other words metrics and tracing of Camel itself could be created + if there are Micrometer Observation compatible projects, then they will join the whole graph (e.g. whole Spring Framework 6 is, Apache Dubbo, Resilience4j etc.).


If there's interest in adding that feature, I can provide a PR.","davsclaus:1675893455:2023-02-09T05:57:35.763+0000:1675893455:2023-02-09T05:57:35.763+0000:Thanks for reaching out to the Camel community and informing about whats coming ahead in micrometer.
This is very welcome and we would be happy to have Camel work with these new features. 

The Camel code base is big, so if you have any questions etc then reach out. We also have a chat room [1] that sometimes can be quicker. And on github there is of course also possible to discuss on PRs

[1] https://camel.zulipchat.com/
davsclaus:1678244617:2023-03-08T11:03:37.028+0000:1678244617:2023-03-08T11:03:37.028+0000:TODO: spring boot starter for observation
TODO: port this to v4 main branch"
0,CAMEL-18992,Improvement,Major,None,None,"
None
",Resolved,Fixed,4.0.0,Claus Ibsen,Andrea Cosentino,0,3,2023-02-01 14:21:32+00:00,2023-07-27 08:32:15+00:00,"As of today we are able to exclude from health check some consumers in this way


camel.health.exclude-pattern = consumer:aws-s3-*


But it would be nice to be able to do something like


camel.component.aws-s3.health.disabled = true
camel.component.aws-s3.health.consumers.disabled = true
camel.component.aws-s3.health.producer.disabled = false


I'm adding 4.0, 3.21.0 and 3.20.2 as fix version, since 3.20 will be an LTS for a long time and this would be a useful feature.","rhuanrocha:1675792165:2023-02-08T01:49:25.331+0000:1675792165:2023-02-08T01:49:25.331+0000: Hi [~acosentino],

I'm getting this issue as I have worked on implementing the health check to the AWS components. Is it ok?

 
acosentino:1675807340:2023-02-08T06:02:20.521+0000:1675807340:2023-02-08T06:02:20.521+0000:This will need some design guidance from [~davsclaus]. So maybe let's have a discussion on the how and the design 
davsclaus:1675820482:2023-02-08T09:41:22.870+0000:1675820482:2023-02-08T09:41:22.870+0000:producer health checks is not so useable and are better let to fail when invoked by Camel.

Can we find out how many specific producer health checks we have currently.
We can then maybe
- disable them by default
- remove them ???

And yeah with this new configuration we can have consumer enable by default, and producer disabled.
But if we only have 2 producer checks we could also remove them, and only include consumer checks OOTB
rhuanrocha:1675956577:2023-02-09T23:29:37.785+0000:1675969503:2023-02-10T03:05:03.512+0000:Hi [~davsclaus] 

Some AWS components are using the Health Checker inside the Endpoint. Thus, it will be applied to both consumers and producers.

I think the checker is applied to many AWS producers. About the disabling of checkers to the producer as default, I agree. 

 

These are the AWS components with Health Checker inside the Endpoint: SNS, SES, MSK, MQ, Lambda, IAM, EventBridge, EKS, ECS, EC2, DDB, CW2, Athena, and Secrets-Manager
acosentino:1675978628:2023-02-10T05:37:08.944+0000:1675978628:2023-02-10T05:37:08.944+0000:For the moment I removed the instantiation and registration to the repository to all the health check related to producer only component. If we want to completely remove them and focus on consumer only just let me know.
rhuanrocha:1683404990:2023-05-07T04:29:50.695+0000:1683404990:2023-05-07T04:29:50.695+0000:Does Camel have a class to handle something like 'camel.health.exclude-pattern' as suggested?
davsclaus:1690163385:2023-07-24T09:49:45.582+0000:1690163385:2023-07-24T09:49:45.582+0000:Okay this is more complex so I will take a stab at this so we have something for 4.0 GA
davsclaus:1690164785:2023-07-24T10:13:05.266+0000:1690165307:2023-07-24T10:21:47.153+0000:AWS components with health-checks

- ec2 (producer) disabled in code
- s3 (consumer)  *DONE*
- aws2-athena (producer) disabled in code
- aws-cloudtrail (consumer) *DONE*
- aws2-cw (producer) disabled in code
- aws2-ddb (producer) disabled in code
- aws2-ddbstream (consumer) *DONE*
- aws2-ecs (producer) disabled in code
- aws2-eks (producer) disabled in code
- aws2-eventbridge (producer) disabled in code
- aws2-iam (producer) disabled in code
- aws2-kinesis (consumer) *DONE*
- aws2-kinesis (producer) no health check
- aws2-lambda (producer) disabled in code
- aws2-mq (producer) disabled in code
- aws-secrets-manager (producer) *DONE*
- aws2-ses (producer) disabled in code
- aws2-sns (producer) disabled in code
- aws2-sqs (consumer) *DONE*
- aws2-sqs (producer) no health check
- aws2-translate (producer) disabled in code
davsclaus:1690165883:2023-07-24T10:31:23.212+0000:1690165883:2023-07-24T10:31:23.212+0000:Google component with health checks

- google-storage (consumer) *DONE*
- google-storage (producer) no health checks

davsclaus:1690165909:2023-07-24T10:31:49.343+0000:1690165909:2023-07-24T10:31:49.343+0000:Other components with health checks

- camel-kafka (consumer) *DONE*
- camel-kafka (producer) *DONE*

davsclaus:1690178291:2023-07-24T13:58:11.275+0000:1690178291:2023-07-24T13:58:11.275+0000:Created a ticket to consider if we should add back the producer based checks. But for 4.0 we can keep it as-is now.
"
0,CAMEL-18991,Sub-task,Major,None,"3.20.2, 3.21.0, 4.0-M2","
None
",Resolved,Fixed,"3.20.2, 3.21.0, 4.0-M2",Andrea Cosentino,Andrea Cosentino,0,1,2023-02-01 09:49:32+00:00,2023-02-01 09:54:15+00:00,No Desc,
0,CAMEL-18990,Improvement,Major,None,"3.20.2, 3.21.0, 4.0-M2, 4.0.0","
None
",Resolved,Fixed,"3.20.2, 3.21.0, 4.0-M2, 4.0.0",Claus Ibsen,Claus Ibsen,1,1,2023-02-01 05:57:31+00:00,2023-02-02 15:07:08+00:00,"You need to set


quarkus.native.resources.includes = < list of resources here >",
0,CAMEL-18989,New Feature,Major,None,"3.20.2, 3.21.0, 4.0-M2, 4.0.0","
None
",Resolved,Fixed,"3.20.2, 3.21.0, 4.0-M2, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-01-31 18:30:07+00:00,2023-02-02 15:07:21+00:00,camel run for custom Camel versions,
0,CAMEL-18988,Test,Major,4.0-M1,4.0-M2,"
None
",Resolved,Fixed,4.0-M2,Otavio Rodolfo Piske,Otavio Rodolfo Piske,0,2,2023-01-31 12:13:29+00:00,2023-03-02 15:19:27+00:00,"Since we upgraded to surefire + failsafe M8, some of our tests have started to fail with OnOutOfMemoryError.


The logs from the Jenkins node are attached:



camel-core-test.log
jenkins-full-console.log



 


The last job that failed with this issue was 552.","orpiske:1675149687:2023-01-31T15:21:27.237+0000:1675149687:2023-01-31T15:21:27.237+0000:Log level temporarily increased to debug in order to help identify the problem
nfilotto:1677058969:2023-02-22T17:42:49.727+0000:1677058969:2023-02-22T17:42:49.727+0000:Related PR https://github.com/apache/camel/pull/9398
nfilotto:1677116542:2023-02-23T09:42:22.424+0000:1677116542:2023-02-23T09:42:22.424+0000:Second part of the fix https://github.com/apache/camel/pull/9399
orpiske:1677739803:2023-03-02T14:50:03.915+0000:1677739803:2023-03-02T14:50:03.915+0000:I believe we may be able to close this one, right [~essobedo] ?
nfilotto:1677741119:2023-03-02T15:11:59.345+0000:1677741119:2023-03-02T15:11:59.345+0000:TBH, I did not really check regularly if it occurred again, I only check a couple of times but I guess it can be closed.
nfilotto:1677741517:2023-03-02T15:18:37.946+0000:1677741517:2023-03-02T15:18:37.946+0000:No OOME happened in camel-core tests in the last 7 builds that could run the tests
nfilotto:1677741556:2023-03-02T15:19:16.779+0000:1677741556:2023-03-02T15:19:16.779+0000:Let's resolve it
orpiske:1677741567:2023-03-02T15:19:27.140+0000:1677741567:2023-03-02T15:19:27.140+0000:Thanks! "
0,CAMEL-18987,Dependency upgrade,Minor,None,"4.0-M2, 4.0.0","
None
",Resolved,Fixed,"4.0-M2, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-01-30 16:02:35+00:00,2023-01-30 18:55:53+00:00,"We were on an old 3.5.x release, lets updated to latest.",
0,CAMEL-18986,Improvement,Major,3.20.1,"3.21.0, 4.0-M2, 4.0.0","
None
",Resolved,Won't Fix,"3.21.0, 4.0-M2, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-01-30 12:25:29+00:00,2023-01-30 12:41:43+00:00,"These two are not the same




	@Test
	@DisplayName(""This one is ok"")
	@Order(2)
	public void repoCaseOk() throws Exception{
		producer1.sendBody(""hello"");
	}

	@Test
	@DisplayName(""This one fails with 3.20.1"")
	@Order(2)
	public void repoCaseFail() throws Exception{
		var exchange=
			ExchangeBuilder
				.anExchange(context)
				.withBody  (""hello"")
				.build     ();
		logger.info(""From endpoint: {}"",exchange.getFromEndpoint());
		producer1.send(exchange);
	}","davsclaus:1675053703:2023-01-30T12:41:43.628+0000:1675053703:2023-01-30T12:41:43.628+0000:fromEndpoint is only set when its a consumer/endpoinnt that creates the exchange, and not when its pre-created via ExchangeBuilder"
0,CAMEL-18985,Bug,Major,"3.18.5, 3.19.0, 3.20.0, 3.20.1, 4.0-M2","3.18.7, 3.20.5, 3.21.0, 4.0-M3","
None
",Resolved,Fixed,"3.18.7, 3.20.5, 3.21.0, 4.0-M3",Otavio Rodolfo Piske,Oleg Pershai,0,2,2023-01-30 01:59:41+00:00,2023-04-26 15:31:30+00:00,"Description:


Messages are getting lost with ""breakOnFirstError=true"" when processing of a particular message failed several times in a raw.


 


Configuration:



autoCommitEnable=false
allowManualCommit=true
breakOnFirstError=true
autoOffsetReset=earliest
maxPollRecords is greater than one (e.g. 5 in this test)



 


Test Scenario:



inbound-topic contains 10 messages: 0,1,2,3,4,5,6,7,8,9
camel-route polls 5 messages: 0,1,2,3,4
camel-route successfully processes message=0 and manually commits offset
camel-route successfully processes message=1 and manually commits offset
camel-route fails with processing message=2 first time
breakOnFirstError=true causes camel-route to reconnect and poll from the committed offset
camel-route polls 5 messages: 2,3,4,5,6
camel-route fails with processing message=2 second time
ACTUAL: camel-route reconnects and polls messages 7,8,9 - as result messages 3,4,5,6 are never processed



EXPECTED: camel-route should do the following on the step 9:



reconnect and poll the same 5 messages again: 2,3,4,5,6
process message=2 third time (the test is configured to succeed on the 3rd attempt)
continue with processing messages 3,4,5,6...



 


GitHub project reproducing the issue:


https://github.com/opershai/camel-kafka-lost-messages-demo 


Test-runs:



3.18.5 (failing): https://github.com/opershai/camel-kafka-lost-messages-demo/actions/runs/4039702564 
3.19.0 (failing): https://github.com/opershai/camel-kafka-lost-messages-demo/actions/runs/4039815226 
3.20.0 (failing): https://github.com/opershai/camel-kafka-lost-messages-demo/actions/runs/4039709753 
3.20.1 (failing): https://github.com/opershai/camel-kafka-lost-messages-demo/actions/runs/4039673222 
2.25.4 (passing): https://github.com/opershai/camel-kafka-lost-messages-demo/actions/runs/4057277373 



 


Impact:


It seems ""breakOnFirstError"" is not fully reliable in LTS versions of Camel Kafka component at the moment:



3.20.x - due to this bug
3.18.x - due to this bug
3.14.x - due to another bug https://issues.apache.org/jira/browse/CAMEL-17925 as fix was not back-ported to the 3.14.x","orpiske:1675040629:2023-01-30T09:03:49.649+0000:1675040681:2023-01-30T09:04:41.125+0000:I am assigning this one to me, so I can keep it my radar. But I don't have an ETC yet about when I'll be able to fix it, as I have a lot on the queue right now. 

Obs.: anyone with time/interest on working this, just drop a note here and feel free to work on it.
opershai:1675162088:2023-01-31T18:48:08.356+0000:1675162088:2023-01-31T18:48:08.356+0000:Just a quick note that old Camel Kafka Component v2.25.4 works as expected: [https://github.com/opershai/camel-kafka-lost-messages-demo/actions/runs/4057277373] 
opershai:1682430540:2023-04-25T21:49:00.644+0000:1682430540:2023-04-25T21:49:00.644+0000:Hi [~orpiske] 

I've created [pull request|https://github.com/apache/camel/pull/9932]. Could you please take a look whether the suggested fix makes sense for you?

Thank you
orpiske:1682492543:2023-04-26T15:02:23.350+0000:1682492543:2023-04-26T15:02:23.350+0000:Fixed on main and back-ported to multiple branches."
0,CAMEL-18984,Task,Major,None,"4.0-M2, 4.0.0","
None
",Resolved,Fixed,"4.0-M2, 4.0.0",Unassigned,Claus Ibsen,0,1,2023-01-29 15:02:08+00:00,2023-02-07 08:55:35+00:00,"[ERROR] Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:3.10.1:compile (default-compile) on project camel-undertow-spring-security-starter: Compilation failure: Compilation failure:
[ERROR] /Users/davsclaus/workspace/camel-spring-boot/components-starter/camel-undertow-spring-security-starter/src/main/java/org/apache/camel/undertow/spring/boot/UndertowSpringSecurityCustomizer.java:[36,72] cannot find symbol
[ERROR]   symbol:   class WebSecurityConfigurerAdapter
[ERROR]   location: package org.springframework.security.config.annotation.web.configuration
[ERROR] /Users/davsclaus/workspace/camel-spring-boot/components-starter/camel-undertow-spring-security-starter/src/main/java/org/apache/camel/undertow/spring/boot/UndertowSpringSecurityCustomizer.java:[85,52] cannot find symbol
[ERROR]   symbol:   class WebSecurityConfigurerAdapter
[ERROR]   location: class org.apache.camel.undertow.spring.boot.UndertowSpringSecurityCustomizer","davsclaus:1674976326:2023-01-29T15:12:06.220+0000:1674976326:2023-01-29T15:12:06.220+0000:https://www.baeldung.com/spring-deprecated-websecurityconfigureradapter
davsclaus:1674976445:2023-01-29T15:14:05.844+0000:1674976445:2023-01-29T15:14:05.844+0000:Had to remove the module because the build system will generate BOM with this included. So to fix this then revert this commit first: a1b2af71dace2279b5743a4d0fc3921f6d0f8bfe"
0,CAMEL-18983,Improvement,Major,None,"3.21.0, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-01-29 08:19:02+00:00,2023-04-05 07:47:48+00:00,"You need to add their maven repo as they do not release to maven central.
Reported on user mailing list


Caused by: org.eclipse.aether.resolution.ArtifactResolutionException:
The following artifacts could not be resolved:
com.atlassian.sal:sal-api:jar:4.4.2, com.atlassian.jira:j
ira-rest-java-client-api:jar:5.2.4,
com.atlassian.jira:jira-rest-java-client-core:jar:5.2.4: Could not
find artifact com.atlassian.sal:sal-api:jar:4.4.2 in central
(https://r
epo1.maven.org/maven2)
at org.eclipse.aether.internal.impl.DefaultArtifactResolver.resolve(DefaultArtifactResolver.java:431)
~[maven-resolver-impl-1.8.2.jar:1.8.2]
at org.eclipse.aether.internal.impl.DefaultArtifactResolver.resolveArtifacts(DefaultArtifactResolver.java:235)
~[maven-resolver-impl-1.8.2.jar:1.8.2]
at org.eclipse.aether.internal.impl.DefaultRepositorySystem.resolveDependencies(DefaultRepositorySystem.java:357)
~[maven-resolver-impl-1.8.2.jar:1.8.2]
at org.apache.camel.main.download.MavenDependencyDownloader.resolveDependenciesViaAether(MavenDependencyDownloader.java:1190)
~[camel-kamelet-main-3.20.1.jar:3.20.1]
at org.apache.camel.main.download.MavenDependencyDownloader.lambda$doDownloadDependency$0(MavenDependencyDownloader.java:365)
~[camel-kamelet-main-3.20.1.jar:3.20.1]",
0,CAMEL-18982,Task,Major,None,"4.0-M2, 4.0.0","
None
",Resolved,Fixed,"4.0-M2, 4.0.0",Guillaume Nodet,Claus Ibsen,0,1,2023-01-28 14:34:16+00:00,2023-01-30 09:05:49+00:00,"We have our own copy of existing maven plugins with some special code - maybe for some build speed improvements. But can we try to move that into the original maven plugins so we dont have our own copy that we cannot maintain and upgraded to newer versions due to API changes and whatnot.


It happends for both javadoc and resource plugin.


gnodet ^^^",
0,CAMEL-18981,New Feature,Major,None,"3.21.0, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0.0",James Netherton,James Netherton,0,1,2023-01-27 07:21:07+00:00,2023-02-09 07:11:55+00:00,"WebSockets with camel-undertow has a nice feature where you can set the option fireWebSocketChannelEvents, and you will get an exchange produced whenever a peer connects or disconnects on the WS server. Useful if you want to do some custom handling for these scenarios.


It'd be nice if vertx-websocket had a similar feature.",
0,CAMEL-18980,Bug,Minor,3.20.1,"3.18.6, 3.20.2, 3.21.0, 4.0-M2, 4.0.0","
None
",Resolved,Fixed,"3.18.6, 3.20.2, 3.21.0, 4.0-M2, 4.0.0",Federico Mariani,hisao furuichi,0,3,2023-01-27 07:19:10+00:00,2023-03-27 13:32:48+00:00,"Although camel-snmp supports SNMP v1, v2, and v3 trap, v1 trap does not work as expected.


By checking the test code for camel-snmp, v2 trap is only tested.
https://github.com/apache/camel/blob/camel-3.x/components/camel-snmp/src/test/java/org/apache/camel/component/snmp/TrapTest.java


Based on the TrapTest.java, I implemented a TrapTestSnmpv1.java. Please use the test code for this issue.","Federico Mariani:1675156891:2023-01-31T17:21:31.325+0000:1675156891:2023-01-31T17:21:31.325+0000:Hello, [https://github.com/apache/camel/pull/9276] fixes and add the V1 test, [~hfuruichi] do you think this is enough? in case, should I backport it to camel-3.x branch too?
hfuruichi:1675196246:2023-02-01T04:17:26.698+0000:1675196246:2023-02-01T04:17:26.698+0000:Hello [~Federico Mariani] , thank you so much for the quick response.

I tried the fix on my laptop, but the test failed with the following messages.
{code:java}
[ERROR] Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 11.032 s <<< FAILURE! - in org.apache.camel.component.snmp.Snmpv1TrapTest
[ERROR] org.apache.camel.component.snmp.Snmpv1TrapTest.testSendReceiveTraps  Time elapsed: 11.028 s  <<< FAILURE!
java.lang.AssertionError: mock://result Received message count. Expected: <1> but was: <0>
    at org.apache.camel.component.mock.MockEndpoint.fail(MockEndpoint.java:1860)
    at org.apache.camel.component.mock.MockEndpoint.assertEquals(MockEndpoint.java:1817)
    at org.apache.camel.component.mock.MockEndpoint.doAssertIsSatisfied(MockEndpoint.java:449)
    at org.apache.camel.component.mock.MockEndpoint.assertIsSatisfied(MockEndpoint.java:427)
    at org.apache.camel.component.mock.MockEndpoint.assertIsSatisfied(MockEndpoint.java:417) {code}
Is this work on your environment?

About the backport, yes please backport it to camel-3.x branch too.
Federico Mariani:1675212933:2023-02-01T08:55:33.378+0000:1675212933:2023-02-01T08:55:33.378+0000:I had this issue too, in order to overcome this I've added [https://github.com/apache/camel/pull/9276/files#diff-ab8dac15f4541b82865994814a811bf193ab93178e18c159b6a642d97bd14c88R43] the PDUv1 toString is different compared to the PDU one, probably this is why the test was failing.
hfuruichi:1675367541:2023-02-03T03:52:21.766+0000:1675367541:2023-02-03T03:52:21.766+0000:Hmm.. I double checked the extra line you [mentioned|https://github.com/apache/camel/pull/9276/files#diff-ab8dac15f4541b82865994814a811bf193ab93178e18c159b6a642d97bd14c88R43], but still no luck yet.
{code:java}
[hfuruich@hfuruich camel-snmp]$ oo17
openjdk version ""17.0.2"" 2022-01-18
OpenJDK Runtime Environment (build 17.0.2+8-86)
OpenJDK 64-Bit Server VM (build 17.0.2+8-86, mixed mode, sharing)
[hfuruich@hfuruich camel-snmp]$ cat ./src/test/java/org/apache/camel/component/snmp/Snmpv1TrapTest.java | grep ""trap.setEnterprise""
        trap.setEnterprise(oid);
[hfuruich@hfuruich camel-snmp]$ mvn test -Dtest=org.apache.camel.component.snmp.Snmpv1TrapTest
[INFO] Scanning for projects...
~~skip~~
[INFO] -------------------------------------------------------
[INFO]  T E S T S
[INFO] -------------------------------------------------------
[INFO] Running org.apache.camel.component.snmp.Snmpv1TrapTest
[ERROR] Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 11.7 s <<< FAILURE! - in org.apache.camel.component.snmp.Snmpv1TrapTest
[ERROR] org.apache.camel.component.snmp.Snmpv1TrapTest.testSendReceiveTraps  Time elapsed: 11.364 s  <<< FAILURE!
java.lang.AssertionError: mock://result Received message count. Expected: <1> but was: <0>
    at org.apache.camel.component.mock.MockEndpoint.fail(MockEndpoint.java:1860)
    at org.apache.camel.component.mock.MockEndpoint.assertEquals(MockEndpoint.java:1817)
    at org.apache.camel.component.mock.MockEndpoint.doAssertIsSatisfied(MockEndpoint.java:449)
    at org.apache.camel.component.mock.MockEndpoint.assertIsSatisfied(MockEndpoint.java:427)
    at org.apache.camel.component.mock.MockEndpoint.assertIsSatisfied(MockEndpoint.java:417)
    at org.apache.camel.component.snmp.AbstractTrapTest.testSendReceiveTraps(AbstractTrapTest.java:59)
    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
    at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    at java.base/java.lang.reflect.Method.invoke(Method.java:568)
    at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:727)
 ~~skip~~
{code}
Probably I don't understand correctly about your last comment. So due to the difference of toString methods, we need to modify the test code again to pass? Or the current test code works on your end now?
hfuruichi:1675612221:2023-02-05T23:50:21.158+0000:1675612221:2023-02-05T23:50:21.158+0000:Hello. My bad. there is some difference in SnmpTrapProducer.java. It works fine now :)
{code:java}
[INFO] -------------------------------------------------------
[INFO]  T E S T S
[INFO] -------------------------------------------------------
[INFO] Running org.apache.camel.component.snmp.Snmpv1TrapTest
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.679 s - in org.apache.camel.component.snmp.Snmpv1TrapTest
[INFO] 
[INFO] Results:
[INFO] 
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0
[INFO] 
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 01:26 min
[INFO] Finished at: 2023-02-06T08:47:08+09:00
[INFO] ------------------------------------------------------------------------
 {code}
Federico Mariani:1675648276:2023-02-06T09:51:16.310+0000:1675648276:2023-02-06T09:51:16.310+0000:Great, I've backported the fix to camel-3.x and camel-3.20.x branch, the next release will contain it.
davsclaus:1675652001:2023-02-06T10:53:21.338+0000:1675652001:2023-02-06T10:53:21.338+0000:Remember to update the fix-versions in JIRA"
0,CAMEL-18979,Improvement,Minor,None,"3.21.0, 4.0-M1, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M1, 4.0.0",Andrea Cosentino,ALEXANDRE DAVI ZANELATTO,0,1,2023-01-26 18:21:05+00:00,2023-01-30 08:59:48+00:00,"We need to use the delimiter and prefix query param to add into the ListObjectsRequest,  currently these parameters are used only in the Consumer.{}",
0,CAMEL-18978,Task,Major,4.0.0,"4.0-M1, 4.0.0","
None
",Resolved,Fixed,"4.0-M1, 4.0.0",Federico Mariani,Federico Mariani,0,2,2023-01-25 17:54:14+00:00,2023-01-30 08:59:48+00:00,"Atmosphere builds an in-memory map for each consumer but, if the path is not specified, the logic in Atmosphere is not enough, and messages are redirected to the first entry of the map.","Federico Mariani:1674640558:2023-01-25T17:55:58.035+0000:1674640558:2023-01-25T17:55:58.035+0000:https://github.com/apache/camel/pull/9210
nfilotto:1674799019:2023-01-27T13:56:59.846+0000:1674799019:2023-01-27T13:56:59.846+0000:The description and title should be rewritten as it is not what has been done at the end"
0,CAMEL-18977,Task,Minor,3.20.1,"3.21.0, 4.0-M1, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M1, 4.0.0",Nicolas Filotto,Nicolas Filotto,0,1,2023-01-25 10:10:56+00:00,2023-01-30 08:59:48+00:00,"With the current code base, it is hard to change the behavior of the jOOR language in order to move most of the logic at build time and/or at static initialization time, without having to use ugly hacks like reflection. The goal of this task is to make the code more flexible to avoid using hacks.","nfilotto:1674639806:2023-01-25T17:43:26.445+0000:1674729861:2023-01-26T18:44:21.507+0000:The corresponding PRs:
 * [https://github.com/apache/camel/pull/9208] for Camel 4
 * [https://github.com/apache/camel/pull/9216] for Camel 3"
0,CAMEL-18976,New Feature,Major,"3.20.1, 4.0.0, Future",,"
None
",Closed,Information Provided,None,Unassigned,Hitesh C,0,3,2023-01-24 16:19:54+00:00,2023-02-18 04:19:25+00:00,"Presently Copy Object operation works well when the same set of credentials have access to both source and destination buckets.


So when i am performing copy object from an S3 bucket to another S3 bucket with different set of credentials, I have to do a getObject and PutObject operation separately.


 


An functionality accepting a pair of client (s3, minio, cloud-storage), etc and the respective storage bucket as source and destination could help in simplifying the process even further.","acosentino:1674551132:2023-01-24T17:05:32.888+0000:1674551132:2023-01-24T17:05:32.888+0000:I don't think it makes sense a second client or a second set of credentials in parameters or headers or wherever. This will only pollute the endpoint options. You have the ability to do the operation through two different operations. I don't think it worths to introduce more complexities just for one single operation corner case.
davsclaus:1674725457:2023-01-26T17:30:57.910+0000:1674725457:2023-01-26T17:30:57.910+0000:You configure 2 different s3 components with their own set of credentials, and you can name them differently

from s3-mysource
  to s3-mytarget

And setup a s3-mysource component with X credentials
And setup a s3-mytarget component with Y credentials.

Then they are separated. This can be done with any of the camel components and is normal practice with Camel, for example for many years with JMS component for different JMS brokers (AMQ, WebSphere, OracleQA, Tibco, etc.)"
0,CAMEL-18975,Task,Major,None,"4.0-M1, 4.0.0","
None
",Resolved,Fixed,"4.0-M1, 4.0.0",Otavio Rodolfo Piske,Otavio Rodolfo Piske,0,1,2023-01-24 16:16:09+00:00,2023-01-30 08:59:48+00:00,"The plugin seems to be reporting errors for files that are seemingly correctly formatted:


 




[ERROR] Failed to execute goal net.revelc.code:impsort-maven-plugin:1.8.0:sort (sort-imports) on project camel-test-infra-core: Error reading file /home/opiske/code/java/camel/test-infra/camel-test-infra-core/src/test/java/org/apache/camel/test/infra/core/DefaultCamelContextExtension.java: file: /home/opiske/code/java/camel/test-infra/camel-test-infra-core/src/test/java/org/apache/camel/test/infra/core/DefaultCamelContextExtension.java; reason: the Java file contained parse errors -> [Help 1]","orpiske:1674780823:2023-01-27T08:53:43.494+0000:1674780823:2023-01-27T08:53:43.494+0000:The problem is related to pattern matching. The plugins cannot handle it.
orpiske:1674781511:2023-01-27T09:05:11.178+0000:1674781511:2023-01-27T09:05:11.178+0000:Confirmed: [https://github.com/revelc/impsort-maven-plugin/issues/67.] It's related to the missing maven.compiler.release property.
orpiske:1674786015:2023-01-27T10:20:15.229+0000:1674786015:2023-01-27T10:20:15.229+0000:Added maven.compiler.release to the pom file to fix the issue."
0,CAMEL-18974,Dependency upgrade,Major,4.0.0,4.0.0,"
None
",Closed,Won't Fix,4.0.0,Federico Mariani,Federico Mariani,0,1,2023-01-24 14:20:42+00:00,2023-01-31 15:09:41+00:00,One test is failing with pulsar version 2.11.0 due to https://github.com/apache/pulsar/issues/19320,"Federico Mariani:1675148981:2023-01-31T15:09:41.625+0000:1675148981:2023-01-31T15:09:41.625+0000:No need to downgrade pulsar, 2.11 is restored with [https://github.com/apache/camel/commit/aa377059572d528e421c84b031a21830416a81a1] as discussed on [https://github.com/apache/pulsar/issues/19320]"
0,CAMEL-18973,Bug,Major,3.20.1,,"
None
",Resolved,Information Provided,None,Claus Ibsen,Alex Landini,0,2,2023-01-24 11:10:40+00:00,2023-01-30 09:50:20+00:00,"Hi,


I'm trying to update apache camel version from version 3.18.4 to version 3.20.1.
I have an integration with a rest api exposed through https with mtls authentication.
I created a SSLContextParameters object with the keystores configuration .


With apache camel 3.18.4 everything is working fine starting from 3.20.1 stopped working,
if I removed the mtls from the server everything works fine, I'm getting the following error from the server:
Caused by: javax.net.ssl.SSLException: readHandshakeRecord


 


I created a test case with wiremock to simulate the external API, you can check the following repository with a full example:
https://github.com/landal79/camel-mtls-test


 


Thanks","davsclaus:1674868563:2023-01-28T09:16:03.081+0000:1674868563:2023-01-28T09:16:03.081+0000:It also works with 3.19.0
davsclaus:1674870169:2023-01-28T09:42:49.402+0000:1674870169:2023-01-28T09:42:49.402+0000:Okay so its how certifictes are loaded in camel - as in 3.20 we now load using a standard way in Camel, that loads from classpath by default. And you want to load from file system, so it should be like

{code}
  ssl:
    server:
      trust-self-signed: true
      certificate:
        path: ""file:src/test/resources/keystore.p12""
        password: ""changeit""
        type: ""PKCS12""
    client:
      certificate:
        path: ""file:src/test/resources/keystore-mtls.p12""
        password: ""changeit""
        type: ""PKCS12""
{code}

eg with file: as prefix

This was also documented in the 3.19 -> 3.20 upgrade guide
https://camel.apache.org/manual/camel-3x-upgrade-guide-3_20.html#_camel_api


davsclaus:1674870198:2023-01-28T09:43:18.464+0000:1674870198:2023-01-28T09:43:18.464+0000:Thanks for the sample project, to demonstrate your issue
landal79:1675043420:2023-01-30T09:50:20.182+0000:1675043420:2023-01-30T09:50:20.182+0000:[~davsclaus] Thanks to you for the quick answer."
0,CAMEL-18972,Test,Minor,"3.18.0, 3.20.1, 4.0.0",,"
None
",Resolved,Cannot Reproduce,None,Unassigned,Hitesh C,0,2,2023-01-24 08:27:40+00:00,2023-07-26 06:01:35+00:00,"Hi,


I am working on some customisation of camel-minio component. The integration tests written for it are failing due to some issue with connectivity with testcontainers on m1 Max mac book pro .


log snippet:


```


ErrorResponse(code = XMinioServerNotInitialized, message = Server not initialized, please try again., bucketName = mycamel, objectName = null, resource = /mycamel, requestId = 173D2C3AD8A1384E, hostId = e7662b13-45a2-4748-866b-0ee7a07cf096)
request=

{method=GET, url=http://localhost:59988/mycamel?location=, headers=Host: localhost:59988
Accept-Encoding: identity
User-Agent: MinIO (Mac OS X; aarch64) minio-java/8.5.1
Content-MD5: 1B2M2Y8AsgTpgAmY7PhCfg==
x-amz-content-sha256: e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855
x-amz-date: 20230124T065427Z
Authorization: ??
}

response=

{code=503, headers=Accept-Ranges: bytes
Content-Length: 306
Content-Security-Policy: block-all-mixed-content
Content-Type: application/xml
Retry-After: 120
Server: MinIO
Strict-Transport-Security: max-age=31536000; includeSubDomains
Vary: Origin
Vary: Accept-Encoding
X-Amz-Request-Id: 173D2C3AD8A1384E
X-Content-Type-Options: nosniff
X-Xss-Protection: 1; mode=block
Date: Tue, 24 Jan 2023 06:54:27 GMT
}


        at io.minio.S3Base$1.onResponse(S3Base.java:690)
        at okhttp3.internal.connection.RealCall$AsyncCall.run(RealCall.kt:519)
        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
        at java.base/java.lang.Thread.run(Thread.java:833)


[INFO] 
[INFO] Results:
[INFO] 
[ERROR] Errors: 
[ERROR]   MinioComponentIT>CamelTestSupport.setUp:377->CamelTestSupport.doSetUp:539->CamelTestSupport.startCamelContext:763 ? FailedToStartRoute
[ERROR]   MinioComponentIT>CamelTestSupport.setUp:377->CamelTestSupport.doSetUp:539->CamelTestSupport.startCamelContext:763 ? FailedToStartRoute
[ERROR]   MinioConsumerIT>CamelTestSupport.setUp:377->CamelTestSupport.doSetUp:539->CamelTestSupport.startCamelContext:763 ? FailedToStartRoute


```


 


The same test cases run alright on x86 linux machines.


 


I have tried a lot of solutions provided by forums including the following dependency


 
<dependency>
<groupId>net.java.dev.jna</groupId>
<artifactId>jna</artifactId>
<version></version>
<scope>test</scope>
</dependency>
 
 but none of them  resolved the issue.","davsclaus:1690322495:2023-07-26T06:01:35.313+0000:1690322495:2023-07-26T06:01:35.313+0000:[INFO] --- failsafe:3.1.2:integration-test (integration-test) @ camel-minio ---
[INFO] Using auto detected provider org.apache.maven.surefire.junitplatform.JUnitPlatformProvider
[INFO]
[INFO] -------------------------------------------------------
[INFO]  T E S T S
[INFO] -------------------------------------------------------
[INFO] Running org.apache.camel.component.minio.integration.MinioObjectRangeOperationIT
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 14.28 s -- in org.apache.camel.component.minio.integration.MinioObjectRangeOperationIT
[INFO] Running org.apache.camel.component.minio.integration.MinioConsumerIT
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 2.394 s -- in org.apache.camel.component.minio.integration.MinioConsumerIT
[INFO] Running org.apache.camel.component.minio.integration.MinioListObjectsOperationIT
[INFO] Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 31.60 s -- in org.apache.camel.component.minio.integration.MinioListObjectsOperationIT
[INFO] Running org.apache.camel.component.minio.integration.MinioComponentIT
[INFO] Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 5.563 s -- in org.apache.camel.component.minio.integration.MinioComponentIT
[INFO] Running org.apache.camel.component.minio.integration.MinioDeleteBucketOperationIT
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.348 s -- in org.apache.camel.component.minio.integration.MinioDeleteBucketOperationIT
[INFO] Running org.apache.camel.component.minio.integration.MinioCopyObjectOperationIT
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.024 s -- in org.apache.camel.component.minio.integration.MinioCopyObjectOperationIT
[INFO] Running org.apache.camel.component.minio.integration.MinioPresignedUrlIT
[INFO] Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 61.03 s -- in org.apache.camel.component.minio.integration.MinioPresignedUrlIT
[INFO]
[INFO] Results:
[INFO]
[INFO] Tests run: 10, Failures: 0, Errors: 0, Skipped: 0"
0,CAMEL-18971,Task,Major,None,"4.0-M2, 4.0.0","
None
",Resolved,Fixed,"4.0-M2, 4.0.0",Andrea Cosentino,Andrea Cosentino,0,1,2023-01-24 06:51:47+00:00,2023-02-10 10:25:38+00:00,Like we have in Camel.,
0,CAMEL-18970,Task,Major,None,None,"
None
",Resolved,Fixed,"4.0-M1, 4.0.0",Andrea Cosentino,Andrea Cosentino,0,2,2023-01-24 06:30:09+00:00,2023-02-10 10:25:20+00:00,"This component is on 2.7 from too much time and there doesn't seem to be a release on the horizon. It's full of out-of-date dependencies and not really maintained even on our side, so I think it's better removing it on 4.x and deprecate on 3.x",davsclaus:1674818907:2023-01-27T19:28:27.377+0000:1674818907:2023-01-27T19:28:27.377+0000:We need to deprecate it in camel-3.x
0,CAMEL-18969,Improvement,Major,None,4.4.0,"
None
",Resolved,Fixed,4.4.0,Vaishnavi R,Andrea Tarocchi,0,3,2023-01-23 15:56:49+00:00,2024-01-10 07:50:15+00:00,"To be flexible and future proof about supporting all the mongodb client options, to add the possibility of configuring camel-mongodb component passing directly the whole connection string/uri see https://www.mongodb.com/docs/drivers/java/sync/current/fundamentals/connection/connect/#connection-uri","var:1686617161:2023-06-13T08:46:01.410+0000:1686617161:2023-06-13T08:46:01.410+0000:I can work on this
orpiske:1689659972:2023-07-18T13:59:32.389+0000:1689659972:2023-07-18T13:59:32.389+0000:Is this complete?
orpiske:1704844215:2024-01-10T07:50:15.788+0000:1704844215:2024-01-10T07:50:15.788+0000:Resolved with the linked PR.

Thanks [~var]"
0,CAMEL-18968,Bug,Major,3.20.1,"3.18.5, 3.20.2, 3.21.0, 4.0-M1, 4.0.0","
None
",Resolved,Fixed,"3.18.5, 3.20.2, 3.21.0, 4.0-M1, 4.0.0",Jiri Ondrusek,Jiri Ondrusek,0,1,2023-01-23 12:28:18+00:00,2023-01-30 08:59:45+00:00,"During investigation of https://github.com/apache/camel-quarkus/issues/4389 I found that aws2-sqs producer is not able to send messages to the queueu which was created as delayed.


 


Queue url should be initialized during the endpoint initialization phase.  If queue does not exist in that time, the url stays empty for the whole life of the endpoint. Therefore majority of actions would fail.",
0,CAMEL-18967,Improvement,Major,None,"3.18.6, 3.20.2, 3.21.0, 4.0-M1, 4.0.0","
None
",Resolved,Fixed,"3.18.6, 3.20.2, 3.21.0, 4.0-M1, 4.0.0",James Netherton,James Netherton,0,1,2023-01-23 12:15:36+00:00,2023-01-30 08:59:45+00:00,"The way that camel-platform-http-vertx tries to determine whether a request can / should have a body is a little bit flawed.


There is a HttpMethod enum which controls which HTTP method is allowed a body:


https://github.com/apache/camel/blob/main/components/camel-platform-http/src/main/java/org/apache/camel/component/platform/http/spi/Method.java#L29-L38


This is then checked in the platform-http consumer:


https://github.com/apache/camel/blob/main/components/camel-platform-http-vertx/src/main/java/org/apache/camel/component/platform/http/vertx/VertxPlatformHttpConsumer.java#L280


The problem is that it's not in line with how Vert.x web works. It already has its own logic for this. If the request Content-Type is application/x-www-form-urlencoded, then only POST, PUT, PATCH or DELETE is allowed a body. Otherwise  no restriction is applied.


So I think we should drop checking with 'canHaveBody' and just let Vert.x do its own validation.",
0,CAMEL-18966,New Feature,Major,3.x,None,"
None
",Resolved,Fixed,"3.21.0, 4.0-M1, 4.0.0",Unassigned,Karsten,0,2,2023-01-23 12:15:25+00:00,2023-01-30 08:59:45+00:00,Add support for Camunda Zeebe process orchestration. Based on the operations supported by the java client and grpc API,davsclaus:1674947565:2023-01-29T07:12:45.217+0000:1674951321:2023-01-29T08:15:21.959+0000:We need to add SB -starter for this also (camel v4 *DONE* camel v3 *DONE*)
0,CAMEL-18965,Bug,Minor,3.11.1,"3.18.8, 3.20.6, 4.0-RC1","
None
",Resolved,Fixed,"3.18.8, 3.20.6, 4.0-RC1",Freeman Yue Fang,Manuel Shenavai,0,4,2023-01-23 09:36:42+00:00,2023-06-07 21:27:58+00:00,"Since following change, the onCompletionHandler is not called anymore in error case (soap fault)


https://issues.apache.org/jira/browse/CAMEL-16796
https://github.com/apache/camel/commit/45e64cce8ad2e1d22a5f55be13a6dfcaa504f58f


Reproducer: https://github.com/mash-sap/CAMEL-16532/tree/Camel-18965","acosentino:1674441548:2023-01-23T10:39:08.039+0000:1674441548:2023-01-23T10:39:08.039+0000:Did you try with 3.18.x and 3.20.x?
mash-sap:1674443149:2023-01-23T11:05:49.293+0000:1674448201:2023-01-23T12:30:01.737+0000:Hi [~acosentino],

I can update the reproducer only to 3.17 due to missing dependency to camel-cxf-starter 3.18 and above.

3.17 has the same problem and the code-change mentioned above is also part of 3.20. So I think it's also a problem in 3.20.

CXFConsumer in 3.20 (no close of Camel UOW): [https://github.com/apache/camel/blob/camel-3.20.x/components/camel-cxf/camel-cxf-soap/src/main/java/org/apache/camel/component/cxf/jaxws/CxfConsumer.java#L87]

Best regards,
Manuel
davsclaus:1674725604:2023-01-26T17:33:24.524+0000:1674725604:2023-01-26T17:33:24.524+0000:See the upgrade guides on CXF from 3.18 onwards
https://camel.apache.org/manual/camel-3x-upgrade-guide-3_18.html
mash-sap:1675382771:2023-02-03T08:06:11.886+0000:1675382771:2023-02-03T08:06:11.886+0000:Hi [~ffang] , is there any update on this issue?

Thanks in advance &
Best regards,
Manuel
davsclaus:1679712394:2023-03-25T10:46:34.698+0000:1679712394:2023-03-25T10:46:34.698+0000:Is the onCompletion called if the SOAP request is valid (200 OK) instead of 500 fault
davsclaus:1679733218:2023-03-25T16:33:38.987+0000:1679733218:2023-03-25T16:33:38.987+0000:Okay camel-cxf is a bit old code, and at first glance it looks like its wrong in the consumer class, where it creates UoW but does not call done after processing - there is only some code doing this in case of exception thrown.
davsclaus:1679733803:2023-03-25T16:43:23.871+0000:1679733803:2023-03-25T16:43:23.871+0000:There is an UnitOfWorkCloserInterceptor that is supposed to done the UoW. But its not triggered when there is this soap fault. 

There are 2 closers below. 1st is for one-way. And a SOAP is request/response, so its not done. The 2nd below is not called when there is a SOAP fault error inside CXF.

        ret.getEndpoint().getInInterceptors().add(new UnitOfWorkCloserInterceptor(""post-invoke"", true));
        ret.getEndpoint().getOutInterceptors().add(new UnitOfWorkCloserInterceptor());


ffang:1686144478:2023-06-07T21:27:58.045+0000:1686144478:2023-06-07T21:27:58.045+0000:Thanks [~davsclaus] for the analysis. You are absolutely correct!"
0,CAMEL-18964,Bug,Minor,"3.18.1, 3.20.1",,"
None
",Resolved,Information Provided,None,Unassigned,Christian Schubert-Huff,0,2,2023-01-22 13:46:52+00:00,2023-03-01 19:40:30+00:00,"We implemented an IBM-MQ to ActiveMQ bridge in camel-main, using camel-activemq and camel-jms for IBM-MQ, very similar to the documented EIP.


This requires the definition of a custom connection factory, which is then set as connection factory of the JMS component:



camel.beans.mqConnectionFactory = #class:com.ibm.mq.jms.MQConnectionFactory
camel.beans.mqConnectionFactory.HOSTNAME= mqhost

camel.component.jms.connection-factory = #bean:mqConnectionFactory




Next, we configured the ActiveMQ component without defining an explicit connection factory, like this:



camel.component.activemq.broker-url = activemqhost
camel.component.activemq.username = jay
camel.component.activemq.password = unit




We expected this to just work. Instead, the ActiveMQ component began using the mqConnectionFactory bean as its own connection factory, and the application started throwing errors.


This occurs regardless of the value of camel.component.activemq.allow-auto-wired-connection-factory (which defaults to true).


This can be reproduced with the following unit test (which uses ActiveMQConnectionFactory so it doesn't depend on proprietary JARs):




@Test
public void testBindJmsConnectionFactory() {
    Main main = new Main();
    main.configure().addRoutesBuilder(new MyRouteBuilder());

    // defining a connection factory for the JMS component
    main.addProperty(""camel.beans.jmscf"", ""#class:org.apache.activemq.ActiveMQConnectionFactory"");
    main.addProperty(""camel.beans.jmscf.brokerURL"", ""jmshost"");
    main.addProperty(""camel.component.jms.connection-factory"", ""#bean:jmscf"");

    main.addProperty(""camel.component.activemq.broker-url"", ""activemqhost"");
    main.addProperty(""camel.component.activemq.username"", ""jay"");
    main.addProperty(""camel.component.activemq.password"", ""unit"");
    main.addProperty(""camel.component.activemq.allow-auto-wired-connection-factory"", ""false"");

    main.start();

    CamelContext camelContext = main.getCamelContext();
    assertNotNull(camelContext);

    ActiveMQConnectionFactory connectionFactory = camelContext.getRegistry().lookupByNameAndType(""jmscf"", ActiveMQConnectionFactory.class);
    assertNotNull(connectionFactory);
    
    JmsComponent jmsComponent = camelContext.getComponent(""jms"", JmsComponent.class);
    assertNotNull(jmsComponent);
    assertSame(connectionFactory, jmsComponent.getConnectionFactory());

    ActiveMQComponent activeMqComponent = camelContext.getComponent(""activemq"", ActiveMQComponent.class);
    assertNotNull(activeMqComponent);
    assertEquals(""activemqhost"", activeMqComponent.getBrokerURL());
    assertEquals(""jay"", activeMqComponent.getUsername());
    assertEquals(""unit"", activeMqComponent.getPassword());
    assertNotSame(connectionFactory, activeMqComponent.getConnectionFactory());

    main.stop();
}




There is a workaround, which is to define an explicit connection factory on the ActiveMQ component:



camel.beans.amqcf = #class:org.apache.activemq.ActiveMQConnectionFactory
camel.beans.amqcf.brokerURL = activemqhost

camel.component.activemq.connection-factory = #bean:amqcf","davsclaus:1675051111:2023-01-30T11:58:31.277+0000:1675051134:2023-01-30T11:58:54.593+0000:You need to turn auto wiring off on component as well
camel.component.activemq.autowiredEnabled = false
chrissh:1677670830:2023-03-01T19:40:30.476+0000:1677670830:2023-03-01T19:40:30.476+0000:I am currently unable to test that in live code. However, I expanded the unit test above like this:
{code:java}
main.addProperty(""camel.component.activemq.autowiredEnabled"", ""false""); {code}
and also added an assertion on that, which succeeds:
{code:java}
assertFalse(activeMqComponent.isAutowiredEnabled()); {code}
However, the test still fails at the assertNotSame on the component's connection factory."
0,CAMEL-18963,Improvement,Major,3.20.1,4.0.0,"
None
",Resolved,Fixed,4.0.0,Karen Lease,Karen Lease,0,2,2023-01-20 17:27:48+00:00,2023-11-21 13:14:11+00:00,"The apicurio library used in the openapi components only supports 3.0.2 but OAS 3.1.0 was released in February 2021.
The swagger.io.v3 library already supports 3.1.0 so we could switch to using that instead as it seems to be more actively maintained.
The apicurio issue related to supporting 3.1.0 was last updated over a year ago.","davsclaus:1674819049:2023-01-27T19:30:49.670+0000:1674819049:2023-01-27T19:30:49.670+0000:yeah swagger.v3 seems more bigger and active than apicurio
klease78:1677643203:2023-03-01T12:00:03.694+0000:1677643203:2023-03-01T12:00:03.694+0000:There's now an apicurio 2.0.0.RC1 which includes the openapi 3.1.0 support. I'll try it out."
0,CAMEL-18962,Improvement,Minor,None,,"
None
",Open,Unresolved,None,Unassigned,dennis lucero,0,2,2023-01-20 08:47:35+00:00,2023-07-26 05:57:16+00:00,"When setting up an AS2Cosumer (server) security is important. Thus in mind AS2 should use encryption and signing to verify the incoming data before processing it (or supplying the message for further processing). That assures that the originator of the data is a trusted party.


Camel AS2 consumer accepts encrypted and signed data and at least decryption is working.


Problem


The problem is that the consumer also accepts unencrypted data. So even if I only want to receive encrpyted data from a trusted party, some third party disguised as the trused party, could send a malicious unencrypted payload  and the server would just accept and process it.


For example sending plain data with the content type ""application/edifact"" is always accepted.


Possible solution


The consumer should be configurable what content type is allowed. Also the already existing producer-parameter ""as2MessageStructure"" may be used for that purpose.",davsclaus:1679787066:2023-03-26T07:31:06.798+0000:1679787066:2023-03-26T07:31:06.798+0000:Thanks for reporting you are welcome to work on this and send PRs
0,CAMEL-18961,Dependency upgrade,Major,None,None,"
None
",Resolved,Fixed,"4.0-M1, 4.0.0",Unassigned,Claus Ibsen,0,1,2023-01-20 08:21:01+00:00,2023-01-30 08:59:45+00:00,"August 18, 2021 - Jakarta Mail implementation moves to Eclipse Angus
https://eclipse-ee4j.github.io/angus-mail/",
0,CAMEL-18960,Test,Minor,None,"3.18.5, 3.20.2, 4.0-M1, 4.0.0","
None
",Resolved,Fixed,"3.18.5, 3.20.2, 4.0-M1, 4.0.0",Freeman Yue Fang,Freeman Yue Fang,0,1,2023-01-19 21:52:06+00:00,2023-01-30 08:59:47+00:00,"currently this is disabled by




//@Disabled(""Camel 3.0: investigate why this fail"")




need to fix this up",
0,CAMEL-18959,Bug,Minor,3.20.1,"4.0-M1, 4.0.0","
None
",Resolved,Fixed,"4.0-M1, 4.0.0",Jeremy Ross,Jeremy Ross,0,1,2023-01-19 14:45:57+00:00,2023-01-30 08:59:46+00:00,No Desc,
0,CAMEL-18958,Dependency upgrade,Minor,None,None,"
None
",Resolved,Fixed,4.0.0,Unassigned,Claus Ibsen,0,1,2023-01-19 12:24:55+00:00,2023-05-15 11:55:39+00:00,No Desc,davsclaus:1684122939:2023-05-15T11:55:39.609+0000:1684122939:2023-05-15T11:55:39.609+0000:We have upgraded to 6.6.x
0,CAMEL-18957,Improvement,Major,3.x,4.0.0,"
None
",Resolved,Fixed,4.0.0,Otavio Rodolfo Piske,Otavio Rodolfo Piske,0,3,2023-01-19 10:53:18+00:00,2023-07-19 14:48:31+00:00,"Most of our tests in 3.x extend the `CamelTestSupport` class. This class is showing sign of age, it's getting complex and hard to maintain and debug. Additionally, with JUnit 5, we have more flexible mechanisms that we can use to run tests. This could allow us to explore interesting testing approaches (such as the live testing that was introduced in Quarkus - just an example).","orpiske:1685149494:2023-05-27T09:04:54.160+0000:1685149494:2023-05-27T09:04:54.160+0000:This is pretty much complete. The only remaining thing is start converting more tests (some of the big ones are done).
davsclaus:1689560346:2023-07-17T10:19:06.327+0000:1689560346:2023-07-17T10:19:06.327+0000:Is there more work on this or what parts of the tests has not been converted yet
orpiske:1689644702:2023-07-18T09:45:02.244+0000:1689644702:2023-07-18T09:45:02.244+0000:It was missing the conversion documentation. I have converted some components as part of this change (to help ensure we had all the features and all that). But, now, I will create a ticket for converting the remaining ones so we can track it over time ... it's a big task. Then, I think we can close this.
orpiske:1689659135:2023-07-18T13:45:35.316+0000:1689659135:2023-07-18T13:45:35.316+0000:Completed. Now the test code needs to be converted."
0,CAMEL-18956,Bug,Major,None,None,"
None
",Resolved,Fixed,"4.0-M1, 4.0.0",Andrea Cosentino,Andrea Cosentino,0,1,2023-01-19 09:55:39+00:00,2023-01-30 08:59:44+00:00,"It's not part of Jakarta move, but I guess we should use the normal dependency and not the bundle.",
0,CAMEL-18955,Test,Major,4.0.0,"4.0-M1, 4.0.0","
None
",Resolved,Fixed,"4.0-M1, 4.0.0",Federico Mariani,Federico Mariani,0,1,2023-01-19 09:26:06+00:00,2023-01-30 08:59:46+00:00,Check test results from https://ci-builds.apache.org/job/Camel/job/Camel-Spring-Boot%20Daily%20JDK17/job/main and fix them,"Federico Mariani:1674195177:2023-01-20T14:12:57.021+0000:1674195177:2023-01-20T14:12:57.021+0000:[https://github.com/apache/camel-spring-boot/commit/32df65d138ed88992f15538330dbcf5eb619c8c7] [https://github.com/apache/camel-spring-boot/commit/7817c373930df8fc660cfa33fc408a7715404bf5] [https://github.com/apache/camel-spring-boot/commit/7d4eee5d503562df325293493dae472bf424d23e] [https://github.com/apache/camel-spring-boot/commit/b440c6c68092f806acbea42960297c23ddbbbb8f] 
Federico Mariani:1674195195:2023-01-20T14:13:15.936+0000:1674195195:2023-01-20T14:13:15.936+0000:Build is green https://ci-builds.apache.org/job/Camel/job/Camel-Spring-Boot%20Daily%20JDK17/job/main/1005/"
0,CAMEL-18954,Bug,Minor,3.20.1,"3.20.2, 3.21.0, 4.0-M2, 4.0.0","
None
",Resolved,Fixed,"3.20.2, 3.21.0, 4.0-M2, 4.0.0",Claus Ibsen,Andreas Klug,0,2,2023-01-19 07:14:47+00:00,2023-01-30 12:42:54+00:00,"Hello everyone,


Unfortunately when I’m testing a route containing a micrometer endpoint on Camel 3.20.1 using Spring Boot, then I’m getting a




java.lang.NullPointerException: null
        at org.apache.camel.component.micrometer.eventnotifier.MicrometerExchangeEventNotifierNamingStrategy.getTags(MicrometerExchangeEventNotifierNamingStrategy.java:53)
        at org.apache.camel.component.micrometer.eventnotifier.MicrometerExchangeEventNotifier.handleDoneEvent(MicrometerExchangeEventNotifier.java:105)
       at org.apache.camel.component.micrometer.eventnotifier.MicrometerExchangeEventNotifier.notify(MicrometerExchangeEventNotifier.java:75)
        […]




 


The exception only occurs in case I’m using:




producer.send(ExchangeBuilder.anExchange(context).withBody(""hello"").build());



It’s working fine in case of




producer.sendBody(“hello”);



For both statements, in 3.18.3 it’s working fine – in any case, meaning in 3.18.3 and 3.20.1, the ExchangeBuilder.anExchange(context).withBody(""hello"").build().getEndpointFrom() is null, however, only in 3.20.1 it looks like that getEndpointFrom() indirectly causes the NPE in line 53.


Pls. find a repo case attached.repro.zip","davsclaus:1675051327:2023-01-30T12:02:07.826+0000:1675051327:2023-01-30T12:02:07.826+0000:Okay so how do I repdroduce this with your attached .zip file?

mvn test = pass
mvn spring-boot:run    runs
davsclaus:1675051442:2023-01-30T12:04:02.244+0000:1675051442:2023-01-30T12:04:02.244+0000:Ah okay so the test only does a WARN log and does not fail - I can see it now
davsclaus:1675053774:2023-01-30T12:42:54.064+0000:1675053774:2023-01-30T12:42:54.064+0000:Instead of using ExchangeBuilder then favour using FluentProducerTemplate instead"
0,CAMEL-18953,Bug,Minor,4.0.0,"4.0-M1, 4.0.0","
None
",Resolved,Fixed,"4.0-M1, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-01-18 21:25:57+00:00,2023-01-30 08:59:44+00:00,Jetty returns 500 instead of 504 which was expected by some unit tests,
0,CAMEL-18952,Improvement,Major,None,"3.20.2, 3.21.0, 4.0-M1, 4.0.0","
None
",Resolved,Fixed,"3.20.2, 3.21.0, 4.0-M1, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-01-18 19:08:59+00:00,2023-01-30 08:59:44+00:00,"If you have camel-servlet and camel-platform-http, then servlet may be chosen such as when using SB as servlet is registered to bean registry.",
0,CAMEL-18951,Improvement,Major,None,"4.0-M1, 4.0.0","
None
",Resolved,Fixed,"4.0-M1, 4.0.0",Andrea Cosentino,Andrea Cosentino,0,2,2023-01-18 14:27:57+00:00,2023-09-07 08:29:46+00:00,"We could use some of the maven plugin out there:
https://github.com/CycloneDX/cyclonedx-maven-plugin


To me this one is really complete.


For the beginning I will use a profile without adding the generated SBOM to the assembly (I don't know how big will it be), but I do believe it would be really helpful and I would like to add it as standard information with each release","coheigea:1694044612:2023-09-07T07:56:52.359+0000:1694044612:2023-09-07T07:56:52.359+0000:[~acosentino] Is this generated SBOM available somewhere in Maven Central? For example I added it for Santuario recently [https://repo1.maven.org/maven2/org/apache/santuario/xmlsec/4.0.0-M1/]

 
acosentino:1694044782:2023-09-07T07:59:42.193+0000:1694044782:2023-09-07T07:59:42.193+0000:At this stage, we are still not releasing it, but I'm planning to add it to the release profile.

For the moment you have the current SBOM snapshot here: https://github.com/apache/camel/tree/main/camel-sbom

We are auto-generating it once a week on Sunday.

The idea, now, is to add the SBOM to the release as other projects are starting to do. I already done that in camel-kamelets for example: https://github.com/apache/camel-kamelets/pull/1631
coheigea:1694044887:2023-09-07T08:01:27.180+0000:1694044887:2023-09-07T08:01:27.180+0000:Alright thanks!"
0,CAMEL-18950,Improvement,Minor,3.19.0,,"
None
",Open,Unresolved,None,Unassigned,Sami Peltola,0,1,2023-01-18 12:57:21+00:00,2023-01-18 12:57:21+00:00,"Related to issue CAMEL-16986


When using the @Schema annotation for OpenAPI documentation, still some of the properties of the annotation are ignored, mainly ""maxLength"", ""minLength"" and ""defaultValue"". These values missing from the  generated JSON file.


Related Open API definition: https://github.com/OAI/OpenAPI-Specification/blob/3.0.2/versions/3.0.2.md#schema-object
 


Example:
 




    @Schema(required = true, description = ""Message description"", example = ""Example message"", defaultValue = ""Default message"", maxLength = 20, minLength = 1)
    private String message;




 


Currently generated JSON:




  ""components"" : {
    ""schemas"" : {
      ""InputModel"" : {
        ""required"" : [ ""message"" ],
        ""type"" : ""object"",
        ""properties"" : {
          ""message"" : {
            ""description"" : ""Message description"",
            ""type"" : ""string"",
            ""example"" : ""Example message""
          },",
0,CAMEL-18949,Task,Major,None,"4.0-M1, 4.0.0","
None
",Resolved,Fixed,"4.0-M1, 4.0.0",Andrea Cosentino,Claus Ibsen,0,2,2023-01-18 12:42:01+00:00,2023-01-30 08:59:48+00:00,"camel-examples
camel-spring-boot-examples","acosentino:1674016990:2023-01-18T12:43:10.270+0000:1674016990:2023-01-18T12:43:10.270+0000:Done for camel-examples.
acosentino:1674020187:2023-01-18T13:36:27.471+0000:1674020187:2023-01-18T13:36:27.471+0000:Done for Spring-boot-examples"
0,CAMEL-18948,New Feature,Major,None,4.1.0,"
None
",Resolved,Fixed,4.1.0,Unassigned,Claus Ibsen,0,2,2023-01-18 12:17:16+00:00,2023-10-05 14:40:41+00:00,Users with legacy spring <beans> xml files may want to try run them on camel jbang. And maybe we can have export tools that can help migrate that to plain camel xml routes.,
0,CAMEL-18947,Dependency upgrade,Major,None,"3.18.6, 3.20.2, 3.21.0","
None
",Resolved,Fixed,"3.18.6, 3.20.2, 3.21.0",Unassigned,Claus Ibsen,0,1,2023-01-18 11:10:04+00:00,2023-01-30 14:56:33+00:00,No Desc,
0,CAMEL-18946,Dependency upgrade,Major,None,"4.0-M1, 4.0.0","
None
",Resolved,Fixed,"4.0-M1, 4.0.0",Unassigned,Claus Ibsen,0,1,2023-01-18 11:08:04+00:00,2023-02-14 08:08:13+00:00,Is expected to be released tomorrrow,
0,CAMEL-18945,Dependency upgrade,Major,4.0.0,None,"
None
",Resolved,Fixed,"4.0-M1, 4.0.0",Federico Mariani,Federico Mariani,0,1,2023-01-18 11:05:34+00:00,2023-01-30 08:59:47+00:00,"Upgrade rest assured to 5.3.0 in order to align with groovy version.


Some test in camel-spring-boot were failing because of this.",Federico Mariani:1674456953:2023-01-23T14:55:53.555+0000:1674456953:2023-01-23T14:55:53.555+0000:https://github.com/apache/camel/commit/3547ff8c6affb9af6944e0bd9cc519e03f22d9c2
0,CAMEL-18944,Bug,Major,3.20.1,"3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M3, 4.0.0",Claus Ibsen,Marat Gubaidullin,0,2,2023-01-18 02:39:48+00:00,2023-03-22 07:56:01+00:00,"The following YAML fails when run with Spring Boot




- rest:
    id: rest-dc6e
    post:
      - id: post-248c
        consumes: application/json
        produces: application/json
        to: direct:demo
- route:
    id: demo
    from:
      uri: direct:demo
      id: from-e15c
      steps:
        - log:
            message: ${body}
            id: log-a55d




command to call service




curl -X POST -H ""Content-Type: application/json"" --data '{""id"":""666"",""address"":""666 Sin Street, Holy City""}' http://0.0.0.0:8080




REST Configuration component does not change anything","davsclaus:1674019998:2023-01-18T13:33:18.243+0000:1674019998:2023-01-18T13:33:18.243+0000:We also seem to have 2 endpoints logged with / or no-slash

2023-01-18 14:32:23.277  INFO 57255 --- [           main] che.camel.main.http.VertxHttpServer : HTTP endpoints summary
2023-01-18 14:32:23.277  INFO 57255 --- [           main] che.camel.main.http.VertxHttpServer :     http://0.0.0.0:8080 (POST)
2023-01-18 14:32:23.278  INFO 57255 --- [           main] che.camel.main.http.VertxHttpServer :     http://0.0.0.0:8080/ (POST)
davsclaus:1674024105:2023-01-18T14:41:45.093+0000:1674024105:2023-01-18T14:41:45.093+0000:btw its a bit unusual to use root path as the REST path, can you try with

post:
      - id: post-248c
        consumes: application/json
        produces: application/json
        to: direct:demo
        path: foo

And then invoke 8080/foo


marat.gubaidullin@gmail.com:1674024588:2023-01-18T14:49:48.571+0000:1674024588:2023-01-18T14:49:48.571+0000:with the path
{code:java}
{""timestamp"":""2023-01-18T14:49:16.681+00:00"",""status"":404,""error"":""Not Found"",""path"":""/foo""}
{code}

davsclaus:1674024935:2023-01-18T14:55:35.270+0000:1674024935:2023-01-18T14:55:35.270+0000:Yeah it looks like camel-servlet overrides platform-http and therefore are not setup correctly on SB
davsclaus:1674025226:2023-01-18T15:00:26.926+0000:1674025226:2023-01-18T15:00:26.926+0000:We use servlet so we have that mapping pain where we need some kind of /* mapping in SB to make this working
marat.gubaidullin@gmail.com:1674025966:2023-01-18T15:12:46.117+0000:1674025966:2023-01-18T15:12:46.117+0000:When I add
{code:java}
- restConfiguration:
    component: servlet
{code}

thrown

{code:java}
Caused by: java.lang.IllegalArgumentException: Component servlet is not a RestConsumerFactory
        at org.apache.camel.component.rest.RestEndpoint.createConsumer(RestEndpoint.java:482)
        at org.apache.camel.impl.engine.DefaultRoute.gatherRootServices(DefaultRoute.java:636)
        at org.apache.camel.impl.engine.DefaultRoute.gatherServices(DefaultRoute.java:620)
        at org.apache.camel.impl.engine.DefaultRoute.initializeServices(DefaultRoute.java:205)
        at org.apache.camel.impl.engine.RouteService.doSetup(RouteService.java:151)
        at org.apache.camel.impl.engine.RouteService.setUp(RouteService.java:130)
{code}

davsclaus:1674031965:2023-01-18T16:52:45.924+0000:1674031965:2023-01-18T16:52:45.924+0000:Ah yeah so it uses servlet in SB and its mapped to camel/* by default, so you need to use

http://0.0.0.0:8080/camel

You can change the mapping in application.properties

camel.servlet.mapping.context-path=/*

A problem with using /* is that then this will capture spring boot actuator for health check and whatnot, so ideally you need a starting context-path and not to use root.

marat.gubaidullin@gmail.com:1674032765:2023-01-18T17:06:05.139+0000:1674032765:2023-01-18T17:06:05.139+0000:1. If I understand correctly: 

1.1. the default http-platform for spring-boot is servlet, and `context-path` is `camel`

1.2. we can change context-path using `camel.servlet.mapping.context-path=/*`

2. Can we use 'restConfiguration` with spring-boot ?

 
davsclaus:1674033282:2023-01-18T17:14:42.326+0000:1674033282:2023-01-18T17:14:42.326+0000:1.1 yes
1.2 yes
2 yes

I run with
{code}
- rest-configuration:
    component: ""platform-http""
- rest:
    id: rest-dc6e
    post:
      - id: post-248c
        consumes: application/json
        produces: application/json
        to: direct:demo
#        path: foo
- route:
    id: demo
    from:
      uri: direct:demo
      id: from-e15c
      steps:
        - log:
            message: ${body}
            id: log-a55d
{code}


davsclaus:1674033394:2023-01-18T17:16:34.743+0000:1674033394:2023-01-18T17:16:34.743+0000:We need to let camel-rest prefer using platform-http over servlet due to camel-servlet-starter is activated by spring boot, and SB will then use that instead of platform-http. However the reason you cannot hit the endpoint is due to / vs /camel/* in the servlet mapping.

So we can also make camel jbang export and change the servlet mapping but then it clashes with spring boot acutuator for health-check. And to make both work together we need some ""magic"" pass through in camel servlet to SB for urls that are intended for SB and not Camel.
marat.gubaidullin@gmail.com:1674034452:2023-01-18T17:34:12.046+0000:1674034452:2023-01-18T17:34:12.046+0000:we can set default contex-path, ex. `camel' explicitly for spring-boot and quarkus in application.properties and referred it in Rest DSL description message to inform users through UI

However we need to find a way to set it in camel-jbang as well to have similar UX

 
davsclaus:1674041231:2023-01-18T19:27:11.174+0000:1674041231:2023-01-18T19:27:11.174+0000:The same example works in Quarkus right, and you can also have health-check working still if you invoke /q/health

The problem is that SB uses servlet and not vertx http server directly like quarkus that can better handle url mapping so /q/health and / (root) works.

But it may be a better UX to make rest-dsl via platform-http require to set a base path, such as /api or /myapp or something
davsclaus:1679195347:2023-03-19T11:09:07.748+0000:1679195347:2023-03-19T11:09:07.748+0000:platform-http in spring-boot may uses request mapping (something) to map from SB http server to Camel instead of using a http servlet (CamelServlet). Then this could lead to making this work out of the box."
0,CAMEL-18943,Dependency upgrade,Minor,None,None,"
None
",Resolved,Fixed,"4.0-M3, 4.0.0",Unassigned,Claus Ibsen,0,1,2023-01-17 18:18:30+00:00,2023-04-21 17:31:23+00:00,No Desc,"davsclaus:1673950731:2023-01-17T18:18:51.104+0000:1673950731:2023-01-17T18:18:51.104+0000:Saxon HE 11.4 issue in chat room
https://camel.zulipchat.com/#narrow/stream/257298-camel/topic/xslt-saxon.20issue.20in.203.2E20.2Ex.3F/near/321851081"
0,CAMEL-18912,Improvement,Major,"3.19.0, 3.20.0, 3.20.1","3.20.2, 3.21.0, 4.0-M1, 4.0.0","
None
",Resolved,Fixed,"3.20.2, 3.21.0, 4.0-M1, 4.0.0",Simon Rasmussen,Simon Rasmussen,0,3,2023-01-13 10:12:00+00:00,2023-01-30 08:59:46+00:00,"Cased by CAMEL-18466 where a new health check is introduced for the SQS component.


The component creates it own client, but does so incorrectly as it fails to detect if a client is injected.


Also, the client is created for every invocation of the health check which is not very efficient, a better solution would be to pass in the SqsClient to the health check itself.","acosentino:1673576162:2023-01-13T10:16:02.452+0000:1673576183:2023-01-13T10:16:23.531+0000:So you're using a client from the registry and it is autowired?
davsclaus:1673576411:2023-01-13T10:20:11.823+0000:1673576411:2023-01-13T10:20:11.823+0000:Can you send a PR with a proposed improvement
smox:1673576429:2023-01-13T10:20:29.106+0000:1673576429:2023-01-13T10:20:29.106+0000:Yes, so a better solution would be to:


{code:java}
SqsClient client = configuration.getAmazonSQSClient() != null ? configuration.getAmazonSQSClient()
					: Sqs2ClientFactory.getSqsClient(configuration).getSQSClient();

 {code}
or even better - pass in the client in the constructor by calling getClient() from the consumer.

Also, the listQueue could just call:
{code:java}
client.listQueues(ListQueuesRequest.builder().maxResults(1).build()); {code}
this helps in situations when there are MANY queues - the health check really only needs to know that the request was successfull.
smox:1673576514:2023-01-13T10:21:54.428+0000:1673576514:2023-01-13T10:21:54.428+0000:Sure, I can try to make a PR
acosentino:1673576742:2023-01-13T10:25:42.783+0000:1673576742:2023-01-13T10:25:42.783+0000:I think this would be a problem in all the components related to AWS. We thought about client from configuration, client built from parameters and if not we create the client with default credentials provider. Silly me, didn't think about the autowired ones. Sorry.
smox:1673579441:2023-01-13T11:10:41.263+0000:1673579441:2023-01-13T11:10:41.263+0000:PR: [https://github.com/apache/camel/pull/9086,] this targets main branch - but should also be backported.
smox:1673590748:2023-01-13T14:19:08.226+0000:1673590748:2023-01-13T14:19:08.226+0000:I will contribute fixes for the other aws components as well as most of them are affected by same issue. The changes will be send as separate commits to same PR, so please await merging it.
davsclaus:1673766134:2023-01-15T15:02:14.771+0000:1673766134:2023-01-15T15:02:14.771+0000:Thanks for reporting and the PRs. Keep contributing and make Camel better, thanks ;)"
0,CAMEL-18911,Dependency upgrade,Major,None,4.0.0,"
None
",Resolved,Fixed,4.0.0,Unassigned,Claus Ibsen,0,1,2023-01-13 09:30:10+00:00,2023-05-15 11:56:02+00:00,We need optaplanner 9.0 to support JakartaEE and SB3/Q3,
0,CAMEL-18910,Task,Minor,None,None,"
None
",Resolved,Duplicate,None,Unassigned,Claus Ibsen,0,1,2023-01-12 18:42:29+00:00,2023-07-26 05:55:43+00:00,However they are working on adding Jakarta EE support so hopefully a new release is on the way,
0,CAMEL-18909,New Feature,Minor,None,"3.20.2, 3.21.0, 4.0-M1, 4.0.0","
None
",Resolved,Fixed,"3.20.2, 3.21.0, 4.0-M1, 4.0.0",Marat Gubaidullin,Marat Gubaidullin,4,2,2023-01-12 18:37:02+00:00,2023-01-30 08:59:45+00:00,No Desc,
0,CAMEL-18908,Sub-task,Major,None,None,"
None
",Resolved,Fixed,"4.0-M1, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-01-12 17:47:12+00:00,2023-01-30 08:59:45+00:00,No Desc,"davsclaus:1673516913:2023-01-12T17:48:33.042+0000:1673516913:2023-01-12T17:48:33.042+0000:They are talking about moving it to attic
https://lists.apache.org/list.html?dev@jclouds.apache.org

Geoff Macartney - Thursday, 12 January 2023 18:28:28 CET
Hi JB

It appears that we don't have the collective bandwidth to add new active
contributors to the project, so, sadly, moving jclouds to the attic does
seem to be the right thing to do. It will be up to each downstream project
to figure out what it wants to do in consequence.

Belated Happy New Year to all.

Regards
Geoff
davsclaus:1673516928:2023-01-12T17:48:48.871+0000:1673516928:2023-01-12T17:48:48.871+0000:And deprecate it in v3"
0,CAMEL-18907,Task,Major,None,None,"
None
",Resolved,Fixed,"4.0-M1, 4.0.0",Unassigned,Claus Ibsen,0,4,2023-01-12 17:38:55+00:00,2023-01-30 08:59:47+00:00,"Reported this to datasonnet at
https://github.com/datasonnet/datasonnet-mapper/issues/112


Until there is a Jakarta compatible release, then we would need to disable/remove camel-datasonnet.","javaduke:1673796474:2023-01-15T23:27:54.217+0000:1673796474:2023-01-15T23:27:54.217+0000:I'm trying to find a way to maintain backwards-compatibility. Is `jakarta.xml...` package a replacement for the `javax.xml...` packages or they both are in the classpath?
javaduke:1674114910:2023-01-19T15:55:10.256+0000:1674114949:2023-01-19T15:55:49.492+0000:The Jakarta-compatible version was released: {{{}2.5-jakarta4{}}}. Can you please try it and let me know if there are any issues?

 
acosentino:1674121463:2023-01-19T17:44:23.935+0000:1674121463:2023-01-19T17:44:23.935+0000:The component has been removed from the codebase, I think we first need to upgrade to 2.5 and then try the Jakarta one, if everything works we could add it back.
javaduke:1674128732:2023-01-19T19:45:32.423+0000:1674128732:2023-01-19T19:45:32.423+0000:There's also been a change in the package names, which requires changes in the org.apache.camel.language.datasonnet.CML class. I can make these changes, but I'm not sure which branch I should send the PR to (since datasonnet component is removed from the main branch). Is it camel-3.19.x?
acosentino:1674435408:2023-01-23T08:56:48.107+0000:1674435408:2023-01-23T08:56:48.107+0000:You should revert the commit removing the component and start to align from there I think.
javaduke:1674639688:2023-01-25T17:41:28.456+0000:1674639688:2023-01-25T17:41:28.456+0000:I created PR [https://github.com/apache/camel/pull/9209] - can you please review?"
0,CAMEL-18906,Task,Major,None,"4.0-M1, 4.0.0","
None
",Resolved,Fixed,"4.0-M1, 4.0.0",Unassigned,Claus Ibsen,0,1,2023-01-12 15:12:49+00:00,2023-01-30 08:59:46+00:00,This causes conflict as we need Jetty 11 that is JEE10 compatible.,davsclaus:1673507734:2023-01-12T15:15:34.566+0000:1673507734:2023-01-12T15:15:34.566+0000:Ah sorry it may be another component - suspecting camel-soljr
0,CAMEL-18905,Sub-task,Major,None,None,"
None
",Resolved,Fixed,None,Claus Ibsen,Claus Ibsen,0,1,2023-01-12 14:48:18+00:00,2023-01-12 14:53:01+00:00,There has not been a new release in 3.5 years and its 0.9.x still.,davsclaus:1673506206:2023-01-12T14:50:06.689+0000:1673506206:2023-01-12T14:50:06.689+0000:And deprecate camel-gora in v3
0,CAMEL-18904,New Feature,Major,None,"3.20.4, 3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.20.4, 3.21.0, 4.0-M3, 4.0.0",Louisa Frison,Claus Ibsen,0,3,2023-01-12 14:26:45+00:00,2023-05-22 13:42:32+00:00,"You sometimes need an empty object that you can then use to manipulate your camel routes. And this may require the body is not null, but an empty list / map / string / json.


So let's add some functions to simple to do that so it can be used everywhere and in low-code situations too.","louisafrison:1677329690:2023-02-25T20:54:50.904+0000:1677329690:2023-02-25T20:54:50.904+0000:I would like to try this : ) Is anybody already working on it ? 
davsclaus:1679040471:2023-03-17T16:07:51.395+0000:1679040471:2023-03-17T16:07:51.395+0000:Louisa, did you start working on this?
louisafrison:1680447188:2023-04-02T22:53:08.741+0000:1680447188:2023-04-02T22:53:08.741+0000:Hi, 

yes, I just opened a PullRequest: [CAMEL-18904: Add functions to simple language to create empty map/li… by louisa-fr · Pull Request #9770 · apache/camel (github.com)|https://github.com/apache/camel/pull/9770]
davsclaus:1680650707:2023-04-05T07:25:07.210+0000:1680650707:2023-04-05T07:25:07.210+0000:An empty json can often be a java.util.Map object.

otherwise we can consider

empty(jsonString)

which is just a ""{ }""



davsclaus:1680650728:2023-04-05T07:25:28.209+0000:1680650728:2023-04-05T07:25:28.209+0000:Louisa, you are welcome to add jsonString 
davsclaus:1681459739:2023-04-14T16:08:59.816+0000:1681459739:2023-04-14T16:08:59.816+0000:Reopening as we have ask to backport this to 3.x"
0,CAMEL-18903,Dependency upgrade,Major,None,"4.0-M1, 4.0.0","
None
",Resolved,Fixed,"4.0-M1, 4.0.0",Karen Lease,Karen Lease,0,1,2023-01-12 12:10:30+00:00,2023-01-30 08:59:46+00:00,Use swagger-core-jakarta aftifact to remove javax.xml.bind dependency in swagger-core.,
0,CAMEL-18902,Task,Major,None,None,"
None
",Open,Unresolved,None,Unassigned,Claus Ibsen,0,1,2023-01-12 11:34:08+00:00,2023-07-17 10:25:24+00:00,"During Camel v3 we had both JUnit 4.x and 5.x supported and had to have separate test modules.


In Camel v4 we only support JUnit 5, so we can rename the modules back, eg


camel-test-junit5 => camel-test


This needs to be documented in the upgrade guide.",
0,CAMEL-18901,Sub-task,Major,None,None,"
None
",Resolved,Fixed,None,Claus Ibsen,Claus Ibsen,0,1,2023-01-12 11:23:31+00:00,2023-01-12 13:39:24+00:00,No Desc,
0,CAMEL-18900,Sub-task,Major,None,None,"
None
",Resolved,Fixed,None,Claus Ibsen,Claus Ibsen,0,1,2023-01-12 11:23:21+00:00,2023-01-12 12:39:05+00:00,No Desc,
0,CAMEL-18899,Sub-task,Major,None,None,"
None
",Resolved,Fixed,None,Claus Ibsen,Claus Ibsen,0,1,2023-01-12 11:23:09+00:00,2023-01-12 13:59:52+00:00,No Desc,
0,CAMEL-18898,Sub-task,Major,None,None,"
None
",Resolved,Fixed,None,Claus Ibsen,Claus Ibsen,0,1,2023-01-12 11:22:58+00:00,2023-01-12 14:15:04+00:00,No Desc,
0,CAMEL-18897,Sub-task,Major,None,None,"
None
",Resolved,Fixed,None,Claus Ibsen,Claus Ibsen,0,1,2023-01-12 11:22:45+00:00,2023-01-12 14:07:31+00:00,No Desc,
0,CAMEL-18896,Sub-task,Major,None,None,"
None
",Resolved,Fixed,None,Andrea Cosentino,Claus Ibsen,0,1,2023-01-12 11:22:35+00:00,2023-01-12 14:42:13+00:00,No Desc,
0,CAMEL-18895,Sub-task,Major,None,None,"
None
",Resolved,Fixed,None,Claus Ibsen,Claus Ibsen,0,1,2023-01-12 11:22:25+00:00,2023-01-12 14:37:38+00:00,No Desc,
0,CAMEL-18894,Sub-task,Major,None,None,"
None
",Resolved,Fixed,"4.0-M1, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-01-12 11:13:17+00:00,2023-01-30 08:59:48+00:00,No Desc,
0,CAMEL-18893,Task,Major,None,None,"
None
",Resolved,Fixed,"4.0-M1, 4.0.0",Andrea Cosentino,Andrea Cosentino,0,1,2023-01-12 10:56:59+00:00,2023-02-10 10:26:37+00:00,"There are a bunch of example using stuff like camel-activemq, camel-websocket etc. We need to remove them and restart from scratch.",
0,CAMEL-18892,Test,Minor,4.0.0,"4.0-M1, 4.0.0","
None
",Resolved,Fixed,"4.0-M1, 4.0.0",Federico Mariani,Federico Mariani,0,1,2023-01-12 10:34:51+00:00,2023-01-30 08:59:47+00:00,No Desc,
0,CAMEL-18891,Sub-task,Major,None,None,"
None
",Resolved,Fixed,"4.0-M1, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-01-12 10:12:56+00:00,2023-01-30 08:59:48+00:00,No Desc,
0,CAMEL-18890,Task,Major,None,None,"
None
",Resolved,Fixed,"3.21.0, 4.0-M1, 4.0.0",Andrea Cosentino,Andrea Cosentino,0,3,2023-01-12 09:58:17+00:00,2023-06-21 11:41:49+00:00,No Desc,"nfilotto:1687241295:2023-06-20T14:08:15.030+0000:1687241295:2023-06-20T14:08:15.030+0000:Do we remove it in 3.21 too?
nfilotto:1687241863:2023-06-20T14:17:43.982+0000:1687241863:2023-06-20T14:17:43.982+0000:I'm asking that because it depends on a very old version of Kafka (2.x)
davsclaus:1687242350:2023-06-20T14:25:50.665+0000:1687242350:2023-06-20T14:25:50.665+0000:Yeah its okay to remove in 3.21, its been deprecated 
nfilotto:1687245030:2023-06-20T15:10:30.640+0000:1687245030:2023-06-20T15:10:30.640+0000:Ok thx Claus, let's convert it as a task instead of a sub task
nfilotto:1687246342:2023-06-20T15:32:22.575+0000:1687246342:2023-06-20T15:32:22.575+0000:The fix for 3.21 is included into https://github.com/apache/camel/pull/10454
davsclaus:1687301809:2023-06-21T06:56:49.718+0000:1687301809:2023-06-21T06:56:49.718+0000:Remember to update this page
https://github.com/apache/camel/blob/main/docs/user-manual/modules/ROOT/pages/camel-3x-upgrade-guide-3_21.adoc"
0,CAMEL-18889,Sub-task,Major,None,None,"
None
",Resolved,Fixed,"4.0-M1, 4.0.0",Andrea Cosentino,Andrea Cosentino,0,1,2023-01-12 09:57:39+00:00,2023-01-30 08:59:48+00:00,No Desc,
0,CAMEL-18888,Dependency upgrade,Minor,None,None,"
None
",Resolved,Not A Problem,"4.0-M1, 4.0.0",Unassigned,Claus Ibsen,0,2,2023-01-12 09:18:03+00:00,2023-01-30 08:59:44+00:00,git grep swaggerCodegenMavenPluginVersion,"mwebb:1673538821:2023-01-12T23:53:41.649+0000:1673538821:2023-01-12T23:53:41.649+0000:Is there any more context for this ticket?  I see the command [~davsclaus] placed in the description.  Is all that's expected is to update the version references and ensure proper operation and testing ?
davsclaus:1673560846:2023-01-13T06:00:46.395+0000:1673560846:2023-01-13T06:00:46.395+0000:Yes
davsclaus:1673573345:2023-01-13T09:29:05.966+0000:1673573345:2023-01-13T09:29:05.966+0000:Oh this may already have been done as it was the old swagger plugin that was outdated and its been removed in 4.0 now."
0,CAMEL-18887,Dependency upgrade,Minor,None,"4.0-M1, 4.0.0","
None
",Resolved,Fixed,"4.0-M1, 4.0.0",Ramu,Claus Ibsen,0,1,2023-01-12 08:45:27+00:00,2023-01-30 08:59:48+00:00,No Desc,"davsclaus:1673583567:2023-01-13T12:19:27.302+0000:1673583681:2023-01-13T12:21:21.971+0000:Okay so this requires more than just the version change, dsl/camel-kotlin-dsl needs changes to adapt to Kotlin and/or jakarta ee / java17"
0,CAMEL-18886,Dependency upgrade,Major,None,,"
None
",Resolved,Invalid,None,Unassigned,Rhuan Rocha,0,2,2023-01-11 20:44:55+00:00,2023-01-12 06:08:18+00:00,"Hello,


I'm trying to build the camel project using maven and the org.apache.camel:camel-test-spring-junit5:jar:4.0.0-SNAPSHOT is not available to https://repository.apache.org/snapshots/.","davsclaus:1673474898:2023-01-12T06:08:18.693+0000:1673474898:2023-01-12T06:08:18.693+0000:Camel 4 is just started in development, use camel-3.x branch"
0,CAMEL-18885,Task,Minor,None,,"
None
",Resolved,Abandoned,None,Unassigned,Claus Ibsen,0,2,2023-01-11 15:21:46+00:00,2023-11-22 20:05:57+00:00,No Desc,"davsclaus:1673430726:2023-01-11T17:52:06.635+0000:1673430726:2023-01-11T17:52:06.635+0000:It seems that apache johnzon needs to do a jakarta release before this is possible
acosentino:1673488633:2023-01-12T09:57:13.961+0000:1673488633:2023-01-12T09:57:13.961+0000:They are moving: https://github.com/apache/johnzon/commits/master
davsclaus:1689560818:2023-07-17T10:26:58.833+0000:1689560818:2023-07-17T10:26:58.833+0000:This requires johnzon 2.x that are still work in progress"
0,CAMEL-18884,Task,Major,None,"4.0-M1, 4.0.0","
None
",Resolved,Fixed,"4.0-M1, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-01-11 15:20:40+00:00,2023-01-30 08:59:46+00:00,"activemq
johnzon
stomp
websocket


are disabled as they are not migrated yet, but the endpoint/component DSL will regen source. We need to make it skip that for these",davsclaus:1673432503:2023-01-11T18:21:43.852+0000:1673432503:2023-01-11T18:21:43.852+0000:I added TODO: camel4 in PrepareCatalogMojo which we can adjust when we have these working
0,CAMEL-18883,Task,Major,None,None,"
None
",Resolved,Fixed,"4.0-M1, 4.0.0",Unassigned,Claus Ibsen,0,1,2023-01-11 15:14:30+00:00,2023-01-30 08:59:45+00:00,"There is 


camel-rabbitmq
camel-vertx-kafka


and potentially others as well",
0,CAMEL-18882,Task,Major,None,"4.0-M1, 4.0.0","
None
",Resolved,Fixed,"4.0-M1, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-01-11 14:48:56+00:00,2023-01-30 08:59:46+00:00,No Desc,
0,CAMEL-18881,Task,Major,None,None,"
None
",Resolved,Fixed,"4.0-M1, 4.0.0",Claus Ibsen,Claus Ibsen,0,2,2023-01-11 14:16:01+00:00,2023-01-30 08:59:46+00:00,"It is deprecated in v3 and should be removed, we have camel-openapi-java instead.","davsclaus:1673418523:2023-01-11T14:28:43.523+0000:1673418523:2023-01-11T14:28:43.523+0000:camel-jetty
camel-netty-http
camel-servlet
camel-undertow

use camel-openapi-java instead



camel-rest = remove mention of camel-swagger-java
davsclaus:1673485199:2023-01-12T08:59:59.042+0000:1673485199:2023-01-12T08:59:59.042+0000:camel-rest-swagger should either be removed or upgraded to swagger v3
davsclaus:1673485774:2023-01-12T09:09:34.129+0000:1673485774:2023-01-12T09:09:34.129+0000:Okay so camel-openapi-java has swagger v3 model classes support via CAMEL-15503 but that brings in dependency on javax.xml JAXB (there is no jakarta release of swagger v3)
davsclaus:1673487913:2023-01-12T09:45:13.544+0000:1673487913:2023-01-12T09:45:13.544+0000:remove camel-restdsl-swagger-plugin
klease78:1673495399:2023-01-12T11:49:59.504+0000:1673495399:2023-01-12T11:49:59.504+0000:{quote}Okay so camel-openapi-java has swagger v3 model classes support via CAMEL-15503 but that brings in dependency on javax.xml JAXB (there is no jakarta release of swagger v3)
{quote}
We need to use swagger-core-jakarta artifacts which fix this. I can prepare a PR.
davsclaus:1673497479:2023-01-12T12:24:39.424+0000:1673497479:2023-01-12T12:24:39.424+0000:Thanks Karen"
0,CAMEL-18880,Dependency upgrade,Major,None,"3.21.0, 4.0-M1, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M1, 4.0.0",Grzegorz Grzybek,Claus Ibsen,0,3,2023-01-11 13:35:27+00:00,2023-02-27 09:31:44+00:00,"We use 1.8.2 and there is a 1.9.2. It has some changed internals so the code should be changed a bit.


It may be easier to do this on camel-3.x branch as main is for v4 and its more unstable at the moment","ggrzybek:1673418102:2023-01-11T14:21:42.847+0000:1673418102:2023-01-11T14:21:42.847+0000:Sure - I should be able to do it this week.
davsclaus:1673419021:2023-01-11T14:37:01.068+0000:1673419021:2023-01-11T14:37:01.068+0000:Its not critical but would be good to keep up with latest maven.
ggrzybek:1673569988:2023-01-13T08:33:08.031+0000:1673571346:2023-01-13T08:55:46.860+0000:PR for main branch (4.0): https://github.com/apache/camel/pull/9075
PR for camel-3.x branch: https://github.com/apache/camel/pull/9078
cstamas:1673570689:2023-01-13T08:44:49.545+0000:1673570689:2023-01-13T08:44:49.545+0000:Howdy, vote for 1.9.4 is ongoing, 1.9.2 suffers from bug MRESOLVER-313 (Permission on cached files are ""user only"", not group readable). That's the only one bug I assume may affect you.
ggrzybek:1673571463:2023-01-13T08:57:43.159+0000:1673571818:2023-01-13T09:03:38.944+0000:[~cstamas] thanks for info - I already checked with 1.9.4 and there will be one little change needed:
1.9.2:
{code:java}
registry.bind(GAVNameMapperProvider.NAME, NameMapper.class, new GAVNameMapperProvider().get());
{code}

1.9.4:
{code:java}
registry.bind(NameMappers.GAV_NAME, NameMapper.class, NameMappers.gavNameMapper());
{code}
ggrzybek:1673571492:2023-01-13T08:58:12.362+0000:1673571492:2023-01-13T08:58:12.362+0000:I'll resolve this one when Maven Resolver 1.9.4 is released.
davsclaus:1673572536:2023-01-13T09:15:36.468+0000:1673572536:2023-01-13T09:15:36.468+0000:Okay if 1.9.4 is on VOTE already then we can wait until its released
ggrzybek:1673844282:2023-01-16T12:44:42.934+0000:1673844282:2023-01-16T12:44:42.934+0000:PR to upgrade to 1.9.4 for camel 4: https://github.com/apache/camel/pull/9117
PR to upgrade to 1.9.4 for camel 3: https://github.com/apache/camel/pull/9119"
0,CAMEL-18879,Task,Minor,None,None,"
None
",Resolved,Fixed,"4.0-M1, 4.0.0",Andrea Cosentino,Andrea Cosentino,0,1,2023-01-11 08:43:51+00:00,2023-01-30 08:59:45+00:00,I think we should remove it for Camel 4.,
0,CAMEL-18878,Bug,Major,3.20.1,"3.20.2, 3.21.0, 4.0-M1, 4.0.0","
None
",Resolved,Fixed,"3.20.2, 3.21.0, 4.0-M1, 4.0.0",Jiri Ondrusek,Jiri Ondrusek,0,1,2023-01-11 07:45:08+00:00,2023-07-31 13:28:05+00:00,"Simi9lar to  https://issues.apache.org/jira/browse/CAMEL-16527


If autowireEnabled=false is set into the component, the DefaultEndpoint in method ""doInit"" ignores the fact, that autowiring might be disabled on component/",
0,CAMEL-18877,Improvement,Minor,None,"3.21.0, 4.0-M1, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M1, 4.0.0",Andrea Cosentino,Claus Ibsen,0,2,2023-01-11 05:57:23+00:00,2023-01-30 08:59:46+00:00,"The key is Object type which is too generic, and its better to use a String type.",acosentino:1673415342:2023-01-11T13:35:42.311+0000:1673415342:2023-01-11T13:35:42.311+0000:This will require the removal of keyType parameter
0,CAMEL-18876,Task,Minor,3.20.1,"4.0-RC2, 4.0.0","
None
",Resolved,Fixed,"4.0-RC2, 4.0.0",Claus Ibsen,Marat Gubaidullin,0,1,2023-01-11 01:06:27+00:00,2023-07-17 10:27:33+00:00,"ErrorHandlerDefinition id YAML DSL
 


 


However properties in catalogue
 
 


It would be great to sync YAML DSL and Catalog",
0,CAMEL-18875,Improvement,Minor,None,"3.21.0, 4.0-M1, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M1, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-01-10 19:27:40+00:00,2023-01-30 08:59:47+00:00,Reported in user forum,
0,CAMEL-18874,Improvement,Major,3.19.0,"3.21.0, 4.0-RC1, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-RC1, 4.0.0",Claus Ibsen,Moshe Elisha,0,2,2023-01-10 14:46:12+00:00,2023-05-24 05:31:37+00:00,"Several places use the 


org.apache.camel.spi.ExceptionHandler#handleException(java.lang.String, java.lang.Throwable)


 


instead of 


 


org.apache.camel.spi.ExceptionHandler#handleException(java.lang.String, org.apache.camel.Exchange, java.lang.Throwable)


 


even when the exchange is available in scope.


One example for that is org.apache.camel.component.file.GenericFileConsumer#processExchange


 


The exchange is sometimes needed for additional information. For example, if a download of a file from an SFTP server fails, the exchange will hold the file details for logging purposes.","davsclaus:1673350700:2023-01-10T19:38:20.994+0000:1673350700:2023-01-10T19:38:20.994+0000:You are welcome to work on a PR 
elishamoshe:1673357983:2023-01-10T21:39:43.938+0000:1673357983:2023-01-10T21:39:43.938+0000:Cool. Thanks, [~davsclaus]  !
elishamoshe:1673416883:2023-01-11T14:01:23.159+0000:1673416949:2023-01-11T14:02:29.234+0000:[~davsclaus] what do you recommend regarding backward compatibility?

I see that at least in the Camel project, only SalesforceConsumer#handleException is overriding (but I'm not sure why).

If I can assume no one else in the world is overriding (or ignore them), I can do something like the below.

Even with the below approach, backward compatibility might break as we will now invoke ""handleException(message, exchange, t)"" instead of ""handleException(message, t)"".

 

{{protected void handleException(Throwable t) {}}
{{    handleException(null, null, t);}}
{{}}}

{{protected void handleException(String message, Throwable t) {}}
{{    handleException(message, null, t);}}
{{}}}

{{protected void handleException(String message, Exchange exchange, Throwable t) {}}
{{    Throwable newt = (t == null) ? new IllegalArgumentException(""Handling [null] exception"") : t;}}

         {{{}// This ""if"" is to maximize backward compatibility otherw{}}}{{{}ise calling {}}}{{handleException(message, exchange, newt) would have been much nicer.}}

{{    if (message == null && exchange == null) { }}
{{        getExceptionHandler().handleException(newt);}}
{{    } else if (exchange == null) {}}
{{        getExceptionHandler().handleException(message, newt);}}
{{    } else {}}
{{        getExceptionHandler().handleException(message, exchange, newt);}}
{{    }}}
{{}}}
davsclaus:1684877497:2023-05-24T05:31:37.462+0000:1684877497:2023-05-24T05:31:37.462+0000:Thanks we do pass in exchange many places, but as you said a few places in the file component was missing."
0,CAMEL-18873,Improvement,Major,None,"3.21.0, 4.0-M1, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M1, 4.0.0",Andrea Cosentino,Andrea Cosentino,0,1,2023-01-10 13:46:59+00:00,2023-01-30 08:59:46+00:00,"Instead of specifying a fixed path, we could in this way read from classpath, http etc.",
0,CAMEL-18872,Bug,Minor,3.20.1,"3.20.2, 3.21.0, 4.0-M1, 4.0.0","
None
",Resolved,Fixed,"3.20.2, 3.21.0, 4.0-M1, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2023-01-10 08:13:17+00:00,2023-01-30 08:59:44+00:00,A model change in 3.20.1 mistakenly removed examples from rest-dsl for param. Adding this back.,
0,CAMEL-18871,Bug,Major,3.14.7,"3.14.8, 3.18.5, 3.20.2, 3.21.0, 4.0-M1, 4.0.0","
None
",Resolved,Fixed,"3.14.8, 3.18.5, 3.20.2, 3.21.0, 4.0-M1, 4.0.0",Unassigned,Vincenzo Galluccio,0,2,2023-01-09 15:35:04+00:00,2023-01-30 08:59:45+00:00,"When the Camel Application sends a LOT of requests to a TCP/IP Server (which is not available/down) using Netty component, after a bit, it hangs because the Producer Pool is exhausted (when producerPoolMaxTotal is not -1).


 




from(""direct:start"")
.to(""netty://tcp://localhost:18667?connectTimeout=500&decoders=#myDecoders&encoders=#myEncoders&producerPoolMaxTotal=10&producerPoolMinEvictableIdle=-1&requestTimeout=250&sync=true"");




 


 


In previous version 3.14.1 the behavior was to fail when Pool was exhausted (GenericObjectPool.WHEN_EXHAUSTED_FAIL), however since version 3.14.2 and the migration to `org.apache.commons:commons-pool2` (https://issues.apache.org/jira/browse/CAMEL-17461) the default has become to block.


 


The proposal is to adjust `https://github.com/apache/camel/blob/camel-3.14.7/components/camel-netty/src/main/java/org/apache/camel/component/netty/NettyProducer.java ` , method `doStart()` to add optionally set the BlockWhenExhausted flag (BaseGenericObjectPool.setBlockWhenExhausted) and the borrowMaxWaitMillis parameters.


 




""Camel Thread #74 - NettyClientTCPWorker"" #1166 prio=5 os_prio=0 tid=0x00007fd661a1d800 nid=0x18599 waiting on condition [0x00007fd5ffb12000]
   java.lang.Thread.State: WAITING (parking)
        at sun.misc.Unsafe.park(Native Method)
        - parking to wait for  <0x00000005ce0e8338> (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)
        at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)
        at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2039)
        at org.apache.commons.pool2.impl.LinkedBlockingDeque.takeFirst(LinkedBlockingDeque.java:1323)
        at org.apache.commons.pool2.impl.GenericObjectPool.borrowObject(GenericObjectPool.java:306)
        at org.apache.commons.pool2.impl.GenericObjectPool.borrowObject(GenericObjectPool.java:223)
        at org.apache.camel.component.netty.NettyProducer.processWithBody(NettyProducer.java:259)
        at org.apache.camel.component.netty.NettyProducer.process(NettyProducer.java:228)
        at org.apache.camel.processor.SendProcessor.process(SendProcessor.java:172)
        at org.apache.camel.impl.engine.CamelInternalProcessor.process(CamelInternalProcessor.java:398)","vincenzo.galluccio:1673249892:2023-01-09T15:38:12.020+0000:1673249892:2023-01-09T15:38:12.020+0000:Hello [~davsclaus] , I see you were the assignee for https://issues.apache.org/jira/browse/CAMEL-17461 which introduced the new Pool type.
What do you think about this issue and my proposal to add those 2 extra params when configuring the Producer Pool ?
davsclaus:1673250793:2023-01-09T15:53:13.562+0000:1673250793:2023-01-09T15:53:13.562+0000:Yes you are welcome to send a PR or patch file
vincenzo.galluccio:1673433524:2023-01-11T18:38:44.789+0000:1673433524:2023-01-11T18:38:44.789+0000:Hello [~davsclaus] . I have created the following PR: [https://github.com/apache/camel/pull/9047]

PS: The PR to add the two new options/params to [https://github.com/apache/camel-spring-boot/tree/main/components-starter/camel-netty-starter] will follow..
davsclaus:1673476058:2023-01-12T06:27:38.957+0000:1673476058:2023-01-12T06:27:38.957+0000:Are you able to work on a special PR for 3.14.x as the other cannot cleanly be backported
vincenzo.galluccio:1673481623:2023-01-12T08:00:23.199+0000:1673481623:2023-01-12T08:00:23.199+0000:Yes, I can make a new PR to target branch 3.14.x
davsclaus:1673490181:2023-01-12T10:23:01.652+0000:1673490181:2023-01-12T10:23:01.652+0000:Thanks for the PRs
vincenzo.galluccio:1673490373:2023-01-12T10:26:13.201+0000:1673490373:2023-01-12T10:26:13.201+0000:Thank you. I'll work on the camel-netty-starter soon
vincenzo.galluccio:1673591979:2023-01-13T14:39:39.699+0000:1673591979:2023-01-13T14:39:39.699+0000:Hey Claus, here the PR for the starter: https://github.com/apache/camel-spring-boot/pull/697
vincenzo.galluccio:1674611039:2023-01-25T09:43:59.353+0000:1674611039:2023-01-25T09:43:59.353+0000:Hey [~davsclaus] , any idea when 3.14.8 will be released ?"
0,CAMEL-18870,Task,Major,3.21.0,3.21.0,"

osgi

",Resolved,Fixed,3.21.0,Unassigned,Francois Papon,0,3,2023-01-09 14:59:26+00:00,2023-03-13 17:49:22+00:00,"The build of OSGi manifest is broken when building camel-karaf main branch:


 




on project camel-core-osgi: Internal error in maven-bundle-plugin: Calc manifest failed, state=
...
Unclosed group near index 12
[ERROR] \$(?:replace




 


The problem seems related to this commit (remove slash):


https://github.com/apache/camel/commit/82b8cf1f28252bb7fc26bfd37df6219f3fd46b37


Replacing this:




<camel.osgi.export.pkg>$${replace;{local-packages};;;;}</camel.osgi.export.pkg>



by this from previous version:




<camel.osgi.export.pkg>$${replace;{local-packages};;;\;}</camel.osgi.export.pkg>



seems to fix the problem.


May be gnodet can give more insights about this change before revert
or fixing it.","fpapon:1678248476:2023-03-08T12:07:56.317+0000:1678248476:2023-03-08T12:07:56.317+0000:[~davsclaus] hi!

Any news about this issue?
davsclaus:1678445430:2023-03-10T18:50:30.338+0000:1678445430:2023-03-10T18:50:30.338+0000:You are welcome to send a PR with that escape fix for the 3.x branch
fpapon:1678608440:2023-03-12T16:07:20.028+0000:1678608440:2023-03-12T16:07:20.028+0000:I was thinking to wait for [~gnodet] explanation before fixing because it seems to be related to Maven 4.

[~davsclaus] is maven 4 compatibility mandatory for Camel?
gnodet:1678621500:2023-03-12T19:45:00.710+0000:1678621500:2023-03-12T19:45:00.710+0000:[~fpapon] I can't think of any good reason why I would have explicitly removed the `\`, so I think this is a refactoring error somehow.
fpapon:1678622121:2023-03-12T19:55:21.532+0000:1678622121:2023-03-12T19:55:21.532+0000:[~gnodet] ok thanks, I will create a PR to fix.
fpapon:1678696451:2023-03-13T16:34:11.635+0000:1678696451:2023-03-13T16:34:11.635+0000:[~davsclaus] PR pushed: https://github.com/apache/camel/pull/9523"
0,CAMEL-18869,Task,Minor,None,4.0.0,"
None
",Resolved,Fixed,4.0.0,Federico Mariani,Claus Ibsen,0,2,2023-01-09 14:42:39+00:00,2023-07-17 12:13:18+00:00,No Desc,"fmariani:1689567181:2023-07-17T12:13:01.533+0000:1689567181:2023-07-17T12:13:01.533+0000:Done as part of [https://github.com/apache/camel/commit/5fb94660801020bbf328e288ec14c5ee44ead611], in particular [https://github.com/apache/camel/commit/5fb94660801020bbf328e288ec14c5ee44ead611#diff-94f9ff399eb9b7a97841307e0163c766a0b75c27e1d1072a6bac297ebf7ef121R43]."
0,CAMEL-18868,Bug,Minor,3.20.1,"3.20.2, 3.21.0, 4.0-M1, 4.0.0","
None
",Resolved,Fixed,"3.20.2, 3.21.0, 4.0-M1, 4.0.0",Jiri Ondrusek,Jiri Ondrusek,0,1,2023-01-09 14:25:00+00:00,2023-01-30 08:59:47+00:00,"If component uses default credential provider (`useDefaultCredentialsProvider`), operation `createDownloadLink` fails with:


Caused by: java.lang.NullPointerException: Access key ID cannot be blank.
	at software.amazon.awssdk.utils.Validate.notNull(Validate.java:119)
	at software.amazon.awssdk.auth.credentials.AwsBasicCredentials.<init>(AwsBasicCredentials.java:66)
	at software.amazon.awssdk.auth.credentials.AwsBasicCredentials.<init>(AwsBasicCredentials.java:58)
	at software.amazon.awssdk.auth.credentials.AwsBasicCredentials.create(AwsBasicCredentials.java:78)
	at org.apache.camel.component.aws2.s3.AWS2S3Producer.createDownloadLink(AWS2S3Producer.java:590)
	at org.apache.camel.component.aws2.s3.AWS2S3Producer.process(AWS2S3Producer.java:122)",
0,CAMEL-18867,New Feature,Minor,None,,"
None
",Open,Unresolved,None,Unassigned,Claus Ibsen,0,2,2023-01-08 12:14:52+00:00,2023-07-17 10:28:42+00:00,"We have --watch that will keep watching and output in full screen mode.


We can have a --listen that will not do a full screen, but only output new changes like kuberntetes cli can do, such as when you see pod activity.


This requires to detect ""what is changed"" and then only output changes, such as if you do camel get event, camel get health, camel get event etc.","msharma:1682964167:2023-05-02T02:02:47.406+0000:1682964167:2023-05-02T02:02:47.406+0000:Can I help with this?
davsclaus:1682972048:2023-05-02T04:14:08.116+0000:1682972048:2023-05-02T04:14:08.116+0000:Yes sure anyone is welcome to help. The code are in dsl/camel-jbang"
0,CAMEL-18866,Task,Major,None,3.21.0,"
None
",Resolved,Fixed,3.21.0,Claus Ibsen,Claus Ibsen,0,1,2023-01-06 12:59:29+00:00,2023-01-10 19:45:05+00:00,No Desc,
0,CAMEL-18865,Bug,Minor,3.20.0,"3.20.2, 3.21.0, 4.0-M1, 4.0.0","
None
",Resolved,Fixed,"3.20.2, 3.21.0, 4.0-M1, 4.0.0",Claus Ibsen,Christian Schubert-Huff,0,2,2023-01-06 09:42:13+00:00,2023-01-30 08:59:45+00:00,"We are having trouble configuring camel-jms with IBM-MQ as runtime implementation, using camel-main.


Doing so requires the declaration of a connection factory, which, in our case, is com.ibm.mq.jms.MQConnectionFactory. Unfortunately, this class implements both javax.jms.ConnectionFactory and java.util.Map<java.lang.String,java.lang.Object>. Also, the setters of that class have side effects, that are non-trivial to reproduce.


What was really troubling us was that, contrary to intuition, defining a bean like this:




camel.beans.mqConnectionFactory = #class:com.ibm.mq.jms.MQConnectionFactory
camel.beans.mqConnectionFactory.hostName = mqhost




does not actually invoke the setHostName method on the factory. Instead, value ""mqhost"" is put under key ""hostName"" into the map.


Reproduction can be achieved with a quick custom class, like this:




package org.apache.camel.main;

import java.util.HashMap;

public class MyFooFactory extends HashMap<String, Object> {
    private String hostName;

    public String getHostName() {
        return hostName;
    }

    public void setHostName(String hostName) {
        this.hostName = hostName;
    }
}




and a unit test, which checks for the hostName:




    @Test
    public void testBindBeansDottedHybridMap() {
        Main main = new Main();
        main.configure().addRoutesBuilder(new MyRouteBuilder());

        // defining a factory bean
        main.addProperty(""camel.beans.myfactory"", ""#class:org.apache.camel.main.MyFooFactory"");
        main.addProperty(""camel.beans.myfactory.hostName"", ""localhost"");
        main.start();

        CamelContext camelContext = main.getCamelContext();
        assertNotNull(camelContext);

        Object bean = camelContext.getRegistry().lookupByName(""myfactory"");
        assertNotNull(bean);
        assertInstanceOf(MyFooFactory.class, bean);

        MyFooFactory factory = (MyFooFactory) bean;
        assertEquals(""localhost"", factory.getHostName());

        main.stop();
    }




For a custom bean that is under our own control, I would consider implementing java.util.Map and having additional custom getters and setters with side-effects to be invalid, but the IBM-MQ JMS client is out of our control - and required for our use case.


If the dotted annotation is used, it may be preferable to check for a suitable setter first, and only if that is missing, to check if the bean implements java.util.Map.","davsclaus:1672969608:2023-01-06T09:46:48.227+0000:1672969608:2023-01-06T09:46:48.227+0000:Sorry but Map/List will be used as a collection and not something else. 
We will not add workarounds for all really weird corner cases.
chrissh:1672970899:2023-01-06T10:08:19.786+0000:1672970899:2023-01-06T10:08:19.786+0000:I understand that. Yet, it took us hours of debugging and deep-diving into the implementations of camel-main and the ibm-mq client to figure out what was happening. Documenting it here may save other users some time in the future.
davsclaus:1672972033:2023-01-06T10:27:13.512+0000:1672972033:2023-01-06T10:27:13.512+0000:https://camel.apache.org/community/contributing/
chrissh:1672972780:2023-01-06T10:39:40.840+0000:1672972780:2023-01-06T10:39:40.840+0000:As additional information, of course we are not implemtenting something new, but migrating from an XML blueprint that ran in camel2/karaf, where that same connection factory was declared like this:
{code:xml}
<bean id=""mqConnectionFactory"" class=""com.ibm.mq.jms.MQConnectionFactory"">
  <property name=""hostName"" value=""${mqHostname}"" />
  <!-- more properties, here -->
</bean>
{code}
which suggested that we could use the hostName property in camel-main as well. I cannot tell at the moment whether or not the version of MQConnectionFactory that was used to do so, did implement Map as well.
davsclaus:1672973791:2023-01-06T10:56:31.874+0000:1672973791:2023-01-06T10:56:31.874+0000:The old <bean> in blueprint is all reflection based and not optimized. camel-main is that and avoids reflection when possible.

However looking at this again I can see the point about [xxx] vs .xxx that can make it possible to favour map first/last - because then the end user have declared the style of choice.
However its really bad that IBM make their CF extend a Map class - that is just crazy


davsclaus:1672977247:2023-01-06T11:54:07.521+0000:1672977247:2023-01-06T11:54:07.521+0000:Okay so DOT vs [] style is now taking into account.
chrissh:1673251564:2023-01-09T16:06:04.445+0000:1673251564:2023-01-09T16:06:04.445+0000:Thanks for reconsidering the issue and the quick fix!"
0,CAMEL-18864,Task,Minor,None,None,"
None
",Resolved,Fixed,"3.21.0, 4.0-M1, 4.0.0",Nicolas Filotto,Nicolas Filotto,0,2,2023-01-05 17:34:20+00:00,2023-01-30 08:59:48+00:00,"I think we can remove the .class also in camel core for java-joor dsl as it is not really needed anymore. I think (I am getting older so it is maybe no longer there) there is an option in camel-main to configure a ""compile directory"" so removing would also need to remove that.


source: https://github.com/apache/camel-quarkus/pull/4359#issuecomment-1372498183","davsclaus:1672973304:2023-01-06T10:48:24.607+0000:1672973304:2023-01-06T10:48:24.607+0000:Nicolas you are welcome to work on this
nfilotto:1672976341:2023-01-06T11:39:01.181+0000:1672976341:2023-01-06T11:39:01.181+0000:Yes, no problem, I need to finish another task first then I will work on this
nfilotto:1673172014:2023-01-08T18:00:14.227+0000:1673310205:2023-01-10T08:23:25.062+0000:The corresponding PRs https://github.com/apache/camel/pull/9016 and https://github.com/apache/camel/pull/9026"
0,CAMEL-18863,Improvement,Minor,None,"3.21.0, 4.0-M1, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M1, 4.0.0",Kengo Seki,Kengo Seki,0,1,2023-01-05 02:12:00+00:00,2023-01-30 08:59:48+00:00,"Currently, Pulsar producer can't send a message larger than maxMessageSize (default: 5MB).
It would be useful to support chunking for overcoming this limitation in some cases.",
0,CAMEL-18832,Improvement,Minor,None,"3.21.0, 4.0-M1, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M1, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2022-12-20 20:46:26+00:00,2023-01-30 08:59:48+00:00,We have such information with quarkus and we should have that with SB as well. We may add some verbose=true option or something to enable this.,
0,CAMEL-18831,Task,Minor,None,3.21.0,"
None
",Resolved,Fixed,3.21.0,Claus Ibsen,Claus Ibsen,0,1,2022-12-20 07:59:26+00:00,2022-12-20 10:15:16+00:00,"XStream is not maintained very much and due to serialization then CVEs is reported more often on this and not quickly resolved.


And then next major 1.5 release is not worked on and 1.4.x getting old.
Users can use Jackson instead",
0,CAMEL-18830,Dependency upgrade,Major,3.20.0,"3.21.0, 4.0-M1, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M1, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2022-12-20 06:33:26+00:00,2023-01-30 08:59:44+00:00,"https://github.com/ehcache/ehcache3/issues/2881


    <dependency>
      <groupId>org.glassfish.jaxb</groupId>
      <artifactId>jaxb-runtime</artifactId>
      <version>[2.2,3)</version>
      <scope>runtime</scope>
    </dependency>",
0,CAMEL-18829,Task,Major,None,"3.21.0, 4.0-M1, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M1, 4.0.0",Tomohisa Igarashi,Tomohisa Igarashi,0,1,2022-12-19 22:07:52+00:00,2023-01-30 08:59:44+00:00,"JSON schema requires `additionalProperties: false` to be specified to prohibit additional properties those are not explicitly defined in `properties`
https://json-schema.org/understanding-json-schema/reference/object.html#additional-properties
And it doesn't propagate to the children, i.e. `additionalProperties: false` needs to be specified on each object definition.


Since camel-yaml-dsl/generate-yaml-schema mojo doesn't add this property at this moment, the generated schema doesn't really restrict properties. We want to add an option 'additionalProperties"" on generate-yaml-schema mojo, and if it's false, add `additionalProperties: false` on each objects in generated schema so that it declares explicit restriction. The option should be `true` by default so that it doesn't add anything in order to preserve current behavior.


An example of having `additionalProperties` to be `false`
https://github.com/igarashitm/example-generate-yaml-schema/blob/main/pom.xml#L71


And generated YAML schema from it
https://github.com/igarashitm/example-generate-yaml-schema/commit/85441fdcc6c641a2ef02aea7149a66a0429b3c92#diff-b1d8ab8b59f212acab62fab8cab033f98736c4bd9e92cc34fcf9b53457dbc1d0",
0,CAMEL-18828,Improvement,Minor,None,"3.21.0, 4.0-M1, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M1, 4.0.0",Kengo Seki,Kengo Seki,0,2,2022-12-19 07:58:56+00:00,2023-03-29 23:15:31+00:00,"Currently, camel-kudu doesn't support these operations, so let's add them.",davsclaus:1671415837:2022-12-19T10:10:37.021+0000:1671415837:2022-12-19T10:10:37.021+0000:Thanks for contribution
0,CAMEL-18827,Test,Minor,None,"3.21.0, 4.0-M1, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M1, 4.0.0",Kengo Seki,Kengo Seki,0,2,2022-12-19 01:23:58+00:00,2023-03-29 23:15:31+00:00,"Some Kudu's unit tests are skipped for JDK 17, as follows:




$ java -version
openjdk version ""17.0.5"" 2022-10-18 LTS
OpenJDK Runtime Environment Corretto-17.0.5.8.1 (build 17.0.5+8-LTS)
OpenJDK 64-Bit Server VM Corretto-17.0.5.8.1 (build 17.0.5+8-LTS, mixed mode, sharing)
$ cd components/camel-kudu
$ ../../mvnw clean test

...

[INFO] --- maven-surefire-plugin:3.0.0-M5:test (default-test) @ camel-kudu ---
[INFO]
[INFO] -------------------------------------------------------
[INFO]  T E S T S
[INFO] -------------------------------------------------------
[INFO] Running org.apache.camel.component.kudu.KuduComponentConfigurationTest
[INFO] Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.521 s - in org.apache.camel.component.kudu.KuduComponentConfigurationTest
[INFO] Running org.apache.camel.component.kudu.KuduProducerTest
[WARNING] Tests run: 3, Failures: 0, Errors: 0, Skipped: 3, Time elapsed: 0.045 s - in org.apache.camel.component.kudu.KuduProducerTest
[INFO] Running org.apache.camel.component.kudu.KuduScanTest
[WARNING] Tests run: 2, Failures: 0, Errors: 0, Skipped: 2, Time elapsed: 0.011 s - in org.apache.camel.component.kudu.KuduScanTest
[INFO]
[INFO] Results:
[INFO]
[WARNING] Tests run: 7, Failures: 0, Errors: 0, Skipped: 5
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  6.550 s
[INFO] Finished at: 2022-12-18T09:39:28+09:00
[INFO] ------------------------------------------------------------------------




Its cause is reported in camel-kudu-test.log as follows. We have to add the ""--add-opens"" option for JDK 17+, just like CAMEL-16962.




$ cat target/camel-kudu-test.log

...

2022-12-18 09:39:28,041 [main           ] DEBUG IntegrationKuduConfiguration   - Kudu harness is not runnable because: Unable to make private static java.net.InetAddress$NameService java.net.InetAddress.createNameService() accessible: module java.base does not ""opens java.net"" to unnamed module @1572270e
java.lang.reflect.InaccessibleObjectException: Unable to make private static java.net.InetAddress$NameService java.net.InetAddress.createNameService() accessible: module java.base does not ""opens java.net"" to unnamed module @1572270e",davsclaus:1671411932:2022-12-19T09:05:32.080+0000:1671411932:2022-12-19T09:05:32.080+0000:Thanks for reporting and the PR
0,CAMEL-18826,Test,Minor,None,"3.21.0, 4.0-M1, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M1, 4.0.0",Kengo Seki,Kengo Seki,0,1,2022-12-19 00:47:16+00:00,2023-03-29 23:15:32+00:00,"Currently, Kudu's unit tests are not completely executed on CI. For example, the following test seems to be successful at first glance.
https://github.com/apache/camel/actions/runs/3612434723/jobs/6087540407#step:7:27


But we can see five tests out of seven were skipped in components-camel-kudu.log, which is downloadable as a part of test-logs, as follows:




[INFO] -------------------------------------------------------
[INFO]  T E S T S
[INFO] -------------------------------------------------------
[INFO] Running org.apache.camel.component.kudu.KuduComponentConfigurationTest
[INFO] Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.789 s - in org.apache.camel.component.kudu.KuduComponentConfigurationTest
[INFO] Running org.apache.camel.component.kudu.KuduProducerTest

...

[WARNING] Tests run: 3, Failures: 0, Errors: 0, Skipped: 3, Time elapsed: 2.133 s - in org.apache.camel.component.kudu.KuduProducerTest
[INFO] Running org.apache.camel.component.kudu.KuduScanTest
[WARNING] Tests run: 2, Failures: 0, Errors: 0, Skipped: 2, Time elapsed: 1.032 s - in org.apache.camel.component.kudu.KuduScanTest
[INFO] 
[INFO] Results:
[INFO] 
[WARNING] Tests run: 7, Failures: 0, Errors: 0, Skipped: 5




Its root cause is recorded in camel-kudu-test.log, which is also a part of test-logs. Starting MiniKuduCluster failed due to the lack of libtinfo, so we have to install it first to execute all tests.




2022-12-04 09:18:30,428 [ stderr printer] INFO  MiniKuduCluster                - /tmp/kudu-binary-jar16011888995816483654/kudu-binary-1.15.0-linux-x86_64/bin/kudu: error while loading shared libraries: libtinfo.so.5: cannot open shared object file: No such file or directory

...

2022-12-04 09:18:30,569 [main           ] INFO  MiniKuduCluster                - Caught exception while closing minicluster stdin
java.io.IOException: Stream closed",
0,CAMEL-18825,Task,Major,None,"3.21.0, 4.0-M1, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M1, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2022-12-18 14:33:12+00:00,2023-01-30 08:59:46+00:00,"We have a number of XML parser we use for tooling and elsewhere that is reported at
https://github.com/apache/camel/security/code-scanning


Lets see if we can make them more secured out of the box when possible.",
0,CAMEL-18824,Dependency upgrade,Major,None,"4.0-M2, 4.0.0","
None
",Resolved,Fixed,"4.0-M2, 4.0.0",Unassigned,Claus Ibsen,0,1,2022-12-18 13:24:43+00:00,2023-02-14 08:10:01+00:00,"We have a mix of different guava versions (mostly due to osgi import|export) restrictions.


We can see if we can harmonize to use more same version and also upgrade to newer.
We need > 24.1.1 due to CVEs in older versions


pom.xml:        <google-guava-version>20.0</google-guava-version>
pom.xml:        <google-cloud-guava-version-prefix>30.1</google-cloud-guava-version-prefix>
pom.xml:        <google-cloud-guava-version>${google-cloud-guava-version-prefix}-jre</google-cloud-guava-version>
pom.xml:        <grpc-guava-version>31.1-jre</grpc-guava-version>
pom.xml:        <guava-eventbus-version>28.2-jre</guava-eventbus-version>
pom.xml:        <hadoop3-guava-version>29.0-jre</hadoop3-guava-version>
pom.xml:        <influx-guava-version>20.0</influx-guava-version>
pom.xml:        <!-- jclouds must use this guava version -->
pom.xml:        <jclouds-google-guava-version>27.1-jre</jclouds-google-guava-version>
pom.xml:        <jclouds-google-guava-version-range>[27.0,28.0)</jclouds-google-guava-version-range>
pom.xml:        <jetcd-guava-version>31.1-jre</jetcd-guava-version>
pom.xml:        <jira-guava-version>30.1.1-jre</jira-guava-version>
pom.xml:        <leveldb-guava-version>21.0</leveldb-guava-version>
pom.xml:        <milo-guava-version>31.1-jre</milo-guava-version>
pom.xml:        <swagger-java-guava-version>27.1-jre</swagger-java-guava-version>
pom.xml:        <xchange-guava-version>31.1-jre</xchange-guava-version>",
0,CAMEL-18823,New Feature,Major,None,"3.21.0, 4.0-M1, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M1, 4.0.0",Claus Ibsen,Aurélien Pupier,0,3,2022-12-16 09:46:12+00:00,2023-09-21 07:10:06+00:00,"Camel K 1.11 is deprecating kamel local with the idea to move features in camel cli
A functionality used by VS Code Camel K was to download dependencies in a specific folder using something like: kamel local build --integration-directory ""<myDir>"" MyRoute.java


Currently camel cli allows to gather list of depednencies but not to download them https://camel.apache.org/manual/camel-jbang.html#_gathering_list_of_dependencies


it would be convenient to have an option to download the dependencies in a specific folder.","tadayosi:1671401159:2022-12-19T06:05:59.642+0000:1671401159:2022-12-19T06:05:59.642+0000:[~apupier] By the way, there is a new {{camel dependencies}} command in Camel 3.20.0 release, which has similar features:
{code}
$ camel dependencies -h
Usage: camel dependencies [-h] [--fresh] [--gradle-wrapper] [--logging]
                          [--maven-wrapper] [--quiet]
                          [--build-tool=<buildTool>]
                          [--camel-spring-boot-version=<camelSpringBootVersion>]
                           [--dep=<dependencies>] [-dir=<exportDir>]
                          [--gav=<gav>] [--java-version=<javaVersion>]
                          [--kamelets-version=<kameletsVersion>]
                          [--local-kamelet-dir=<localKameletDir>]
                          [--logging-level=<loggingLevel>]
                          [--main-classname=<mainClassname>]
                          [--output=<output>] [--profile=<profile>]
                          [--quarkus-artifact-id=<quarkusArtifactId>]
                          [--quarkus-group-id=<quarkusGroupId>]
                          [--quarkus-version=<quarkusVersion>]
                          [--runtime=<runtime>]
                          [--spring-boot-version=<springBootVersion>]
Displays all Camel dependencies required to run
      --build-tool=<buildTool>
                            Build tool to use (maven or gradle)
      --camel-spring-boot-version=<camelSpringBootVersion>
                            Camel version to use with Spring Boot
      --dep, --deps=<dependencies>
                            Add additional dependencies (Use commas to separate
                              multiple dependencies).
      -dir, --directory=<exportDir>
                            Directory where the project will be exported
      --fresh               Make sure we use fresh (i.e. non-cached) resources
      --gav=<gav>           The Maven group:artifact:version
      --gradle-wrapper      Include Gradle Wrapper files in exported project
  -h, --help                Display the help and sub-commands
      --java-version=<javaVersion>
                            Java version (11 or 17)
      --kamelets-version=<kameletsVersion>
                            Apache Camel Kamelets version
      --local-kamelet-dir=<localKameletDir>
                            Local directory for loading Kamelets (takes
                              precedence)
      --logging             Can be used to turn on logging (logs to file in
                              <user home>/.camel directory)
      --logging-level=<loggingLevel>
                            Logging level
      --main-classname=<mainClassname>
                            The class name of the Camel Main application class
      --maven-wrapper       Include Maven Wrapper files in exported project
      --output=<output>     Output format (gav or maven)
      --profile=<profile>   Profile to use, which refers to loading properties
                              file with the given profile name. By default
                              application.properties is loaded.
      --quarkus-artifact-id=<quarkusArtifactId>
                            Quarkus Platform Maven artifactId
      --quarkus-group-id=<quarkusGroupId>
                            Quarkus Platform Maven groupId
      --quarkus-version=<quarkusVersion>
                            Quarkus Platform version
      --quiet               Will be quiet, only print when error occurs
      --runtime=<runtime>   Runtime (spring-boot, quarkus, or camel-main)
      --spring-boot-version=<springBootVersion>
                            Spring Boot version
{code}
davsclaus:1671406009:2022-12-19T07:26:49.690+0000:1671406009:2022-12-19T07:26:49.690+0000:The dependencies command is renamed to dependency

And you now have 
camel dependency copy

that copies to lib folder. You can configure which folder to use."
0,CAMEL-18822,Test,Minor,3.20.0,3.x,"
None
",Resolved,Abandoned,3.x,Unassigned,Claus Ibsen,0,1,2022-12-16 05:50:10+00:00,2023-05-26 09:40:46+00:00,No Desc,
0,CAMEL-18821,Bug,Minor,None,4.x,"
None
",Open,Unresolved,4.x,Unassigned,Christian Kalkhoff,0,2,2022-12-15 16:07:36+00:00,2023-08-09 09:04:07+00:00,"When an aggregator runs in the same thread as the transacted route (Using org.apache.camel.util.concurrent.SynchronousExecutorService for executorService), the thread hangs after completion (error or not) at camel-base-engine-3.19.0-sources.jar!/org/apache/camel/impl/engine/DefaultAsyncProcessorAwaitManager.java:107


 




latch.await(); 



 


If I run latch.countDown() in a debugger, the thread continues just fine.


For the success case I found the workaround to set jtaTransactionErrorHandler()for the route containing the aggregator. Still in case of an exception thrown from the code processing the aggregated messages, the thread hangs.


See https://camel.zulipchat.com/#narrow/stream/257298-camel/topic/Deadlock.20in.20transacted.20route.2E.20is.20this.20a.20bug.3F for the discussion on this.","rhuanrocha:1676062962:2023-02-11T05:02:42.727+0000:1676062962:2023-02-11T05:02:42.727+0000:Hi, 

Do you have a reproducer of this issue?"
0,CAMEL-18820,Bug,Minor,3.19.0,,"
None
",Resolved,Not A Bug,None,Unassigned,Marco Bergsma,0,2,2022-12-15 14:56:54+00:00,2022-12-15 17:25:04+00:00,"Creating routes like this produces an infinite loop.




from(timer(""test"").repeatCount(1))
        .routeId(""test"")
        .to(direct(""testing""));

from(direct(""testing""))
        .routeId(""test-2"")
        .log(""Hey I am testing"")
        .to(direct(""testing"")); 



Is this something that don't want to allow or do we rely on users creating some stop condition?","davsclaus:1671096263:2022-12-15T17:24:23.918+0000:1671096304:2022-12-15T17:25:04.267+0000:Its like in java if you call your own method recursively, and yes end users can write camel routes using choice / when that would route elsewhere etc."
0,CAMEL-18819,Dependency upgrade,Major,3.20.0,3.20.0,"
None
",Resolved,Fixed,3.20.0,Jiri Ondrusek,Jiri Ondrusek,0,2,2022-12-15 10:58:22+00:00,2022-12-15 13:56:29+00:00,"Dependency `audience-annotations` has version 0.13.0.
Zookeper brings version 0.5.0. It should be excluded.","davsclaus:1671075950:2022-12-15T11:45:50.579+0000:1671075950:2022-12-15T11:45:50.579+0000:Jiri can you send PR today as we want to build the release tomorrow
jondruse:1671078822:2022-12-15T12:33:42.809+0000:1671078822:2022-12-15T12:33:42.809+0000:Sure, pr: https://github.com/apache/camel/pull/8908
davsclaus:1671083789:2022-12-15T13:56:29.473+0000:1671083789:2022-12-15T13:56:29.473+0000:Excluded from hbase-test-infra also as it comes there too
https://github.com/apache/camel/commit/b8460586fa75b6ed4b5812aa25e17f636ebf7ed9"
0,CAMEL-18818,Dependency upgrade,Major,3.19.0,,"
None
",Resolved,Invalid,None,Unassigned,Clemens Blamauer,0,3,2022-12-15 09:18:47+00:00,2022-12-15 10:30:06+00:00,"Dear Camel team,


Is there already a plan/roadmap to upgrade camel-spring-boot to Spring Boot 3.x?


We are planning to upgrade our microservices to Spring Boot 3 in the course of next year. As many of them are using Camel, we'd like to consider this in our roadmap.


Would you please share any plans/high-level roadmap for moving to Spring Boot 3, if such exist?


Thank you.


Kind regards,
Clemens","acosentino:1671067720:2022-12-15T09:28:40.323+0000:1671067865:2022-12-15T09:31:05.572+0000:Spring Boot 3.x support will come with Camel 4.x. Probably in 2023 with some milestone, before a fully supported Camel 4 release. So it's not in the short-term.
davsclaus:1671068457:2022-12-15T09:40:57.636+0000:1671068457:2022-12-15T09:40:57.636+0000:Roadmap to be posted later this month
davsclaus:1671068503:2022-12-15T09:41:43.434+0000:1671068503:2022-12-15T09:41:43.434+0000:And talks about Camel v4 is on the developer mailing list
davsclaus:1671070703:2022-12-15T10:18:23.804+0000:1671070703:2022-12-15T10:18:23.804+0000:Comments to blog post is welcome at
https://github.com/apache/camel-website/pull/943
clemens.blamauer@gmail.com:1671071406:2022-12-15T10:30:06.587+0000:1671071406:2022-12-15T10:30:06.587+0000:Thank you, this information is very helpful."
0,CAMEL-18817,Improvement,Minor,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Kengo Seki,Kengo Seki,0,2,2022-12-15 02:49:05+00:00,2023-03-29 23:15:31+00:00,"Currently, HBase producer doesn't support some operations such as append and increment. I'd like to add them to camel-hbase.",davsclaus:1671054353:2022-12-15T05:45:53.816+0000:1671054353:2022-12-15T05:45:53.816+0000:Thanks for the PR
0,CAMEL-18816,Bug,Minor,3.18.4,3.18.5,"
None
",Resolved,Fixed,3.18.5,Unassigned,Krzysztof Mackowiak,0,2,2022-12-14 15:38:10+00:00,2022-12-15 17:26:21+00:00,"Unfortunately it looks that when traffic to camel-ahc component starts to early it crashes with an exception:




org.apache.camel.FailedToCreateProducerException: Failed to create Producer for endpoint: ahc://http://localhost:59729/foo.
Reason: java.lang.IllegalArgumentException: AsyncHttpClient must be specified on: ahc://http://localhost:59729/foo
   at org.apache.camel.support.cache.DefaultProducerCache.acquireProducer(DefaultProducerCache.java:164)
   at org.apache.camel.processor.RecipientListProcessor.doCreateProcessorExchangePairs(RecipientListProcessor.java:270)
   at org.apache.camel.processor.RecipientListProcessor.createProcessorExchangePairs(RecipientListProcessor.java:246)
   at org.apache.camel.processor.MulticastProcessor.process(MulticastProcessor.java:295)
   at org.apache.camel.processor.RecipientList.process(RecipientList.java:175)
   at org.apache.camel.processor.Pipeline$PipelineTask.run(Pipeline.java:106)
   at org.apache.camel.impl.engine.DefaultReactiveExecutor$Worker.schedule(DefaultReactiveExecutor.java:189)
   at org.apache.camel.impl.engine.DefaultReactiveExecutor.scheduleMain(DefaultReactiveExecutor.java:61)
   at org.apache.camel.processor.Pipeline.process(Pipeline.java:182)
   at org.apache.camel.impl.engine.CamelInternalProcessor.process(CamelInternalProcessor.java:399)
   at org.apache.camel.component.timer.TimerConsumer.sendTimerExchange(TimerConsumer.java:210)
   at org.apache.camel.component.timer.TimerConsumer$2.run(TimerConsumer.java:118)
   at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
   at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
   at java.base/java.lang.Thread.run(Thread.java:829)
Caused by: java.lang.IllegalArgumentException: AsyncHttpClient must be specified on: ahc://http://localhost:59729/foo
   at org.apache.camel.util.ObjectHelper.notNull(ObjectHelper.java:176)
   at org.apache.camel.component.ahc.AhcEndpoint.createProducer(AhcEndpoint.java:94)
   at org.apache.camel.support.DefaultEndpoint.createAsyncProducer(DefaultEndpoint.java:200)
   at org.apache.camel.support.cache.ServicePool$SinglePool.acquire(ServicePool.java:237)
   at org.apache.camel.support.cache.ServicePool$SinglePool.acquire(ServicePool.java:216)
   at org.apache.camel.support.cache.ServicePool.acquire(ServicePool.java:112)
   at org.apache.camel.support.cache.ProducerServicePool.acquire(ProducerServicePool.java:28)
   at org.apache.camel.support.cache.DefaultProducerCache.acquireProducer(DefaultProducerCache.java:149)
   ... 14 common frames omitted




It causes that all traffic to camel-ahc endpoint is failing. It happens in my application for routes that take messages from JMS queue and sent it to HTTP (using camel-ahc component).


Here is a test that reproduces a problem:




public class AhcRecipientListTest extends BaseAhcTest {

    @Test
    public void testRecipientListCalledBeforeComponentStarted() throws Exception {
        getMockEndpoint(""mock:result"").expectedBodiesReceived(""Hello"");

        assertMockEndpointsSatisfied();
    }

    @Override
    protected RouteBuilder createRouteBuilder() throws Exception {
        return new RouteBuilder() {
            @Override
            public void configure() throws Exception {
                from(""timer://foo?delay=-1&?repeatCount=1"")
                    .recipientList(constant(getAhcEndpointUri()))
                    .to(""mock:result"");

                from(getTestServerEndpointUri())
                    .transform(constant(""Hello""));
            }
        };
    }
} 



I've prepared a patch with another 2 tests and a possible bugfix. The bugfix is based on a solution from HttpEnpoint/HttpProducer.


The bug was discovered in version 3.18.4, but it looks that it was present for a long time.","davsclaus:1671006028:2022-12-14T16:20:28.502+0000:1671006045:2022-12-14T16:20:45.806+0000:camel-ahc is deprecated and removed in newer Camel versions, but we can patch the 3.18.x
davsclaus:1671006072:2022-12-14T16:21:12.203+0000:1671006072:2022-12-14T16:21:12.203+0000:I wonder if you can send the patch as github PR against the 3.18.x branch
kmackowiak:1671074264:2022-12-15T11:17:44.869+0000:1671074264:2022-12-15T11:17:44.869+0000:Of course. I've send it as a PR [https://github.com/apache/camel/pull/8907]
davsclaus:1671096381:2022-12-15T17:26:21.324+0000:1671096381:2022-12-15T17:26:21.324+0000:Thanks for the patch"
0,CAMEL-18815,Improvement,Major,None,"3.20.2, 3.21.0, 4.0-M1, 4.0.0","
None
",Resolved,Fixed,"3.20.2, 3.21.0, 4.0-M1, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2022-12-14 15:25:38+00:00,2023-02-02 15:08:23+00:00,"Related to
https://github.com/apache/camel-kamelets/issues/1205#issuecomment-1351568973


We can make the base package scan code also detect custom configuration / routes etc for downloaded JARs which can benefit when using jbang",
0,CAMEL-18814,Improvement,Major,None,None,"
None
",Open,Unresolved,None,Unassigned,Claus Ibsen,0,1,2022-12-14 14:54:52+00:00,2023-07-17 10:33:41+00:00,"// camel-k: language=js
import { faker } from ""./js/node_modules/@faker-js/faker/dist/esm/index.mjs"";

const greet = (exchange, message, headers, body) => {
  return { hello: faker.name.fullName() };
};

const greetByName = (exchange, message, headers, body) => {
  return { hello: headers.name };
};

const call = (e, callback) => {
  const result = callback(
    e,
    e.getMessage(),
    e.getMessage().getHeaders(),
    e.getMessage().getBody()
  );
  e.getOut().setBody(result);
};

from(""direct:greet"").process((e)=>call(e, greet)).marshal().json();

from(""direct:greetByName"").process((e)=>call(e,greetByName)).marshal().json();




I would like `process` to fire the call to a js function with all the params (Exchange, Message, Headers, Body) and accept the result as is
instead of having manually to do it, like in the call function
Is there a way to include this call function as part of the process DSL or even better add a new js process version?",davsclaus:1688938519:2023-07-10T05:35:19.319+0000:1688938519:2023-07-10T05:35:19.319+0000:camel run https://gist.github.com/hguerrero/7757de49e4eb3f8c96e3e3756ddf02f9
0,CAMEL-18813,Improvement,Major,None,None,"
None
",Resolved,Fixed,3.20.0,Thomas Diesler,Thomas Diesler,0,1,2022-12-14 11:03:03+00:00,2022-12-14 14:28:54+00:00,No Desc,"tdiesler:1670990260:2022-12-14T11:57:40.994+0000:1670990260:2022-12-14T11:57:40.994+0000:PR: https://github.com/apache/camel/pull/8901
tdiesler:1670999334:2022-12-14T14:28:54.995+0000:1670999334:2022-12-14T14:28:54.995+0000:Done"
0,CAMEL-18812,Improvement,Minor,3.18.4,"3.18.5, 3.20.0","
None
",Resolved,Fixed,"3.18.5, 3.20.0",Unassigned,Nikola Glidzic,0,2,2022-12-14 10:21:15+00:00,2022-12-14 14:30:58+00:00,"How to reproduce


Make rest dsl route:




rest() 
    .post(""{{endpoint.uri}}"")     // <- loaded nice from configuration
    .id(""{{endpoint.id}}"")        // <- NOT loaded from configuration
    .type(Claim.class)
    .consumes(""application/json"")
    .bindingMode(RestBindingMode.json)
    .to(""direct:some_channel"")




Placeholder for endpoint.uri is loaded nice from the configuration, but endpoint.id is not loaded at all.


Acceptance criteria
Placeholder for .id() should work nicely, same as placeholder for uri.


Hint for solution
Most probably fix should be done in RouteDefinitionHelper.java in method:




forceAssignIds(CamelContext context, List<RouteDefinition> routes)","davsclaus:1670985057:2022-12-14T10:30:57.486+0000:1670985057:2022-12-14T10:30:57.486+0000:You are welcome to send a PR today if you have time
nikolagikor:1670985255:2022-12-14T10:34:15.249+0000:1670985255:2022-12-14T10:34:15.249+0000:Nice, that was my plan! Hopefully today or tomorrow
nikolagikor:1670993536:2022-12-14T12:52:16.499+0000:1670993536:2022-12-14T12:52:16.499+0000:PR https://github.com/apache/camel/pull/8902 created for version 3.18.5

After your review [~davsclaus] of this PR, I guess I should create same changes for main branch?
davsclaus:1670999100:2022-12-14T14:25:00.887+0000:1670999100:2022-12-14T14:25:00.887+0000:Thanks for reporting and the PR
nikolagikor:1670999458:2022-12-14T14:30:58.298+0000:1670999458:2022-12-14T14:30:58.298+0000:You 're welcome! 
I am glad I could participate and contribute."
0,CAMEL-18811,Bug,Minor,"3.14.7, 3.18.4","3.14.8, 3.18.5, 3.20.0","
None
",Resolved,Fixed,"3.14.8, 3.18.5, 3.20.0",Claus Ibsen,Christian Schubert-Huff,0,3,2022-12-13 17:00:13+00:00,2023-01-03 18:20:15+00:00,"We updated to camel 3.18.4 and this broke camel-ldap, running against ActiveDirectory.


Filter string is ""(CN=USERID)"". In 3.18.4, this gets escaped to ""\28CN=USERID\29"" (changed by CAMEL-18696), which does not return a result, but instead throws this exception:




javax.naming.directory.InvalidSearchFilterException: invalid attribute description; remaining name 'OU=Std,OU=User,OU=ORG,DC=ad,DC=example,DC=com'
        at java.naming/com.sun.jndi.ldap.Filter.encodeSimpleFilter(Unknown Source)
        at java.naming/com.sun.jndi.ldap.Filter.encodeFilter(Unknown Source)
        at java.naming/com.sun.jndi.ldap.Filter.encodeFilterString(Unknown Source)
        at java.naming/com.sun.jndi.ldap.LdapClient.search(Unknown Source)
        at java.naming/com.sun.jndi.ldap.LdapCtx.doSearch(Unknown Source)
        at java.naming/com.sun.jndi.ldap.LdapCtx.searchAux(Unknown Source)
        at java.naming/com.sun.jndi.ldap.LdapCtx.c_search(Unknown Source)
        at java.naming/com.sun.jndi.toolkit.ctx.ComponentDirContext.p_search(Unknown Source)
        at java.naming/com.sun.jndi.toolkit.ctx.PartialCompositeDirContext.search(Unknown Source)
        at java.naming/com.sun.jndi.toolkit.ctx.PartialCompositeDirContext.search(Unknown Source)
        at java.naming/javax.naming.directory.InitialDirContext.search(Unknown Source)
        at org.apache.camel.component.ldap.LdapProducer.simpleSearch(LdapProducer.java:129)
        at org.apache.camel.component.ldap.LdapProducer.process(LdapProducer.java:83)




The same filter string used to work fine in 3.18.1","davsclaus:1670926415:2022-12-13T18:13:35.741+0000:1670926415:2022-12-13T18:13:35.741+0000:Try with camel-spring-ldap.
Otherwise try to see if you can alter the code or try something and test on your end. 
chrissh:1670937816:2022-12-13T21:23:36.512+0000:1670937816:2022-12-13T21:23:36.512+0000:We updated to 3.18.4 with the intention to fix [CVE-2022-45046|https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-45046], which is a blocker to our release. I have not looked into camel-spring-ldap, yet, and may not be able to do so before January.
davsclaus:1670998605:2022-12-14T14:16:45.469+0000:1670998605:2022-12-14T14:16:45.469+0000:The CVE turned out to be a false alarm, so you can keep using the old version. We are in process of retracting the CVE
chrissh:1672732420:2023-01-03T15:53:40.747+0000:1672732420:2023-01-03T15:53:40.747+0000:On a sidenote, the CVE retraction process seems somewhat slow and unreliable to me. We migrated to 3.20.0, and yet, that version of camel-ldap was again flagged as vulnerable to the CVE, with a criticality that - once again - broke our build.
acosentino:1672732761:2023-01-03T15:59:21.963+0000:1672732761:2023-01-03T15:59:21.963+0000:We cannot control the process of retraction. It needs to be propagated from Mitre to subsystem I guess, but we don't have visibility on that.
davsclaus:1672741035:2023-01-03T18:17:15.618+0000:1672741215:2023-01-03T18:20:15.644+0000:3.20.0 is not affected at all - whether or not the CVE is retracted, as it was not released before the CVE was public.

However it may be that this CVE database says 3.19.0 is affected and the 3rd item does not have an upper bound, meaning that it may think that 3.20, 3.21, 3.22 etc are all affected.
https://nvd.nist.gov/vuln/detail/CVE-2022-45046#match-8689567"
0,CAMEL-18810,Dependency upgrade,Minor,None,None,"
None
",Resolved,Fixed,3.20.0,Unassigned,Claus Ibsen,0,1,2022-12-12 15:43:35+00:00,2022-12-19 12:39:27+00:00,No Desc,
0,CAMEL-18809,Bug,Minor,3.18.4,"3.18.5, 3.20.0","
None
",Resolved,Fixed,"3.18.5, 3.20.0",Babak Vahdat,Babak Vahdat,0,1,2022-12-12 13:38:54+00:00,2022-12-14 07:44:01+00:00,No Desc,
0,CAMEL-18808,Improvement,Major,3.18.4,"3.18.5, 3.20.0","
None
",Resolved,Fixed,"3.18.5, 3.20.0",Unassigned,Jussi Wallin,0,2,2022-12-12 07:56:42+00:00,2022-12-12 16:59:16+00:00,"In some cases when trying to upload large files to Azure Blob Storage it may be necessary to transfer it directly from a file. FileInputStream doesn't support mark which means that the BlobProducer isn't able to determine the size of the file. The AzureBlockBlobClient, that is used internally, doesn't allow blobs of size greater than 0 to be uploaded if the size is defined to be 0.


One way of getting around this limitation is to add the ability to use the CamelAzureStorageBlobBlobSize -header to override the logic for determining the size within the upload operation.",davsclaus:1670835556:2022-12-12T16:59:16.998+0000:1670835556:2022-12-12T16:59:16.998+0000:Thanks for reporting and the PR
0,CAMEL-18807,Bug,Major,3.18.4,"3.18.5, 3.20.0","
None
",Resolved,Fixed,"3.18.5, 3.20.0",Claus Ibsen,Claus Ibsen,0,1,2022-12-09 13:48:17+00:00,2022-12-09 14:01:58+00:00,https://github.com/apache/camel-karavan/issues/553,
0,CAMEL-18806,New Feature,Major,None,Future,"
None
",Open,Unresolved,Future,Unassigned,Claus Ibsen,0,3,2022-12-08 15:19:44+00:00,2022-12-08 15:19:44+00:00,"With Camel being able to run routes in an easier way from scripts and other DSLs in a low-code / camel-k fashion, then there is also a demand for being able to restrict what these routes can do with Camel itself.


Camel is very powerful and tradtionally in the hands of Java developers they are able to control these powers.


What we need to find out is some kind of ""light RBAC"" for Camel routes that these kind of users are running. And also at the same time we should allow pre-build kamelets / routes that have been ""pre-approved"" to not be restricted. For example some shared/common JAR with routes that may do more advanced stuff or handling errors etc.


There are many places in CamelContext that are in use while loading a route. So we need to find out a good way for this. 



components
data formats
languages
invoking bean
DSLs that can be used
property placeholder / functions (eg ENV function)
simple language (may restrict advanced features ala OGNL and whatnot)",
0,CAMEL-18805,Bug,Major,"3.18.4, 3.19.0",3.20.0,"
None
",Resolved,Fixed,3.20.0,Zineb Bendhiba,Zineb Bendhiba,0,2,2022-12-07 15:54:34+00:00,2022-12-12 13:01:04+00:00,The telegram API has been updated and we must use deleteWebhook instead of setWebhook https://core.telegram.org/bots/api#deletewebhook,"davsclaus:1670409266:2022-12-07T18:34:26.241+0000:1670409266:2022-12-07T18:34:26.241+0000:Backported to 3.18.x
zbendhiba:1670460312:2022-12-08T08:45:12.032+0000:1670460312:2022-12-08T08:45:12.032+0000:Many thanks [~davsclaus]  for backporting to 3.18.x

 
davsclaus:1670805147:2022-12-12T08:32:27.477+0000:1670805147:2022-12-12T08:32:27.477+0000:The backport for 3.18.x was not easily possible as the code has changed too much since, so we need to find out if we can backport in another way, and if not then skip it for 3.18.x"
0,CAMEL-18804,Task,Minor,"3.14.5, 3.18.2","3.18.5, 3.20.0","
None
",Resolved,Fixed,"3.18.5, 3.20.0",Unassigned,Maarten Donderwinkel,0,2,2022-12-07 14:02:24+00:00,2022-12-07 18:34:43+00:00,"According to the documentation for the camel-sftp component it's possible to set a server_host_key with the value ed25519. However that algorithm is not available with Jsch.


As a result the documentation is confusing as it's proposing options that are not available.


When trying the parameter it will ignore ed25519 as jschProposal.


 


Please change at least the documentation to list: ssh-dss,ssh-rsa,ecdsa-sha2-nistp256,ecdsa-sha2-nistp384,ecdsa-sha2-nistp521


Perhaps look into using the fork of jsch or other means to allow for ED25519 as algorithm.",davsclaus:1670409283:2022-12-07T18:34:43.338+0000:1670409283:2022-12-07T18:34:43.338+0000:Thanks docs updated
0,CAMEL-18803,Improvement,Major,None,None,"
None
",Resolved,Fixed,3.20.0,Thomas Diesler,Thomas Diesler,0,1,2022-12-07 13:14:23+00:00,2022-12-09 14:41:55+00:00,No Desc,"tdiesler:1670391662:2022-12-07T13:41:02.991+0000:1670391662:2022-12-07T13:41:02.991+0000:CrossRef: https://github.com/hyperledger/aries-agent-test-harness/issues/611
tdiesler:1670391864:2022-12-07T13:44:24.168+0000:1670391864:2022-12-07T13:44:24.168+0000:PR: https://github.com/apache/camel/pull/8859"
0,CAMEL-18802,Improvement,Major,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Claus Ibsen,Andrea Cosentino,0,2,2022-12-07 12:58:00+00:00,2022-12-12 13:00:38+00:00,"Suppose you have something like:




  template:
    from:
      uri: ""google-storage://{{bucketNameOrArn}}""
      parameters:
        autoCreateBucket: ""{{autoCreateBucket}}""
        serviceAccountKey: ""base64:{{serviceAccountKey}}""
        deleteAfterRead: ""{{deleteAfterRead}}""




and you want to have serviceAccountKey as optional parameter. If you prefix the parameter with '?', like




  template:
    from:
      uri: ""google-storage://{{bucketNameOrArn}}""
      parameters:
        autoCreateBucket: ""{{autoCreateBucket}}""
        serviceAccountKey: ""base64:{{?serviceAccountKey}}""
        deleteAfterRead: ""{{deleteAfterRead}}""




We'll try to encode the value anyway, even if not specified.","davsclaus:1670449767:2022-12-08T05:49:27.154+0000:1670449767:2022-12-08T05:49:27.154+0000:Can you try with

{code}
serviceAccountKey: ""{{base64:?serviceAccountKey}}""
{code}
davsclaus:1670452441:2022-12-08T06:34:01.520+0000:1670452441:2022-12-08T06:34:01.520+0000:So this is special due to the need for base64 function and an optional key.

Because what comes after base64 is what to encode, but you want to lookup another property with a given key.
So its like we need to check if serviceAccountKey is a property key and use that instead of its literal value.

And we need to improve PropertiesFunction API to allow it to be executed after the remainder has been resolved first.
davsclaus:1670459172:2022-12-08T08:26:12.813+0000:1670460972:2022-12-08T08:56:12.640+0000:This now works:

{code}
serviceAccountKey: ""{{base64:?serviceAccountKey}}""
{code}

And if you want to decode a specific value (old behavior) then do:

{code}
serviceAccountKey: ""{{base64:decode:Q2FtZWw==}}""
{code}

acosentino:1670818959:2022-12-12T12:22:39.297+0000:1670818959:2022-12-12T12:22:39.297+0000:In Kamelets through camel-jbang it doesn't seem to work.


{code:java}
org.apache.camel.FailedToStartRouteException: Failed to start route google-storage-source-1 because of null
	at org.apache.camel.impl.engine.RouteService.warmUp(RouteService.java:123)
	at org.apache.camel.impl.engine.InternalRouteStartupManager.doWarmUpRoutes(InternalRouteStartupManager.java:306)
	at org.apache.camel.impl.engine.InternalRouteStartupManager.safelyStartRouteServices(InternalRouteStartupManager.java:189)
	at org.apache.camel.impl.engine.InternalRouteStartupManager.doStartOrResumeRoutes(InternalRouteStartupManager.java:147)
	at org.apache.camel.impl.engine.AbstractCamelContext.doStartCamel(AbstractCamelContext.java:3425)
	at org.apache.camel.impl.engine.AbstractCamelContext.doStartContext(AbstractCamelContext.java:3094)
	at org.apache.camel.impl.engine.AbstractCamelContext.doStart(AbstractCamelContext.java:3049)
	at org.apache.camel.support.service.BaseService.start(BaseService.java:119)
	at org.apache.camel.impl.engine.AbstractCamelContext.start(AbstractCamelContext.java:2698)
	at org.apache.camel.impl.DefaultCamelContext.start(DefaultCamelContext.java:262)
	at org.apache.camel.main.KameletMain.doStart(KameletMain.java:274)
	at org.apache.camel.support.service.BaseService.start(BaseService.java:119)
	at org.apache.camel.dsl.jbang.core.commands.Run.run(Run.java:560)
	at org.apache.camel.dsl.jbang.core.commands.Run.call(Run.java:208)
	at org.apache.camel.dsl.jbang.core.commands.Run.call(Run.java:75)
	at picocli.CommandLine.executeUserObject(CommandLine.java:2041)
	at picocli.CommandLine.access$1500(CommandLine.java:148)
	at picocli.CommandLine$RunLast.executeUserObjectOfLastSubcommandWithSameParent(CommandLine.java:2461)
	at picocli.CommandLine$RunLast.handle(CommandLine.java:2453)
	at picocli.CommandLine$RunLast.handle(CommandLine.java:2415)
	at picocli.CommandLine$AbstractParseResultHandler.execute(CommandLine.java:2273)
	at picocli.CommandLine$RunLast.execute(CommandLine.java:2417)
	at picocli.CommandLine.execute(CommandLine.java:2170)
	at org.apache.camel.dsl.jbang.core.commands.CamelJBangMain.run(CamelJBangMain.java:129)
	at main.CamelJBang.main(CamelJBang.java:36)
Caused by: org.apache.camel.RuntimeCamelException: java.io.FileNotFoundException: Cannot find resource: ?serviceAccountKey for URI: ?serviceAccountKey
	at org.apache.camel.RuntimeCamelException.wrapRuntimeException(RuntimeCamelException.java:66)
	at org.apache.camel.support.service.BaseService.doFail(BaseService.java:413)
	at org.apache.camel.support.service.BaseService.fail(BaseService.java:342)
	at org.apache.camel.support.service.BaseService.start(BaseService.java:132)
	at org.apache.camel.support.service.ServiceHelper.startService(ServiceHelper.java:113)
	at org.apache.camel.impl.engine.RouteService.doWarmUp(RouteService.java:184)
	at org.apache.camel.impl.engine.RouteService.warmUp(RouteService.java:121)
	... 24 more
Caused by: java.io.FileNotFoundException: Cannot find resource: ?serviceAccountKey for URI: ?serviceAccountKey
	at org.apache.camel.support.ResourceHelper.resolveMandatoryResourceAsInputStream(ResourceHelper.java:115)
	at org.apache.camel.component.google.storage.GoogleCloudStorageConnectionFactory.create(GoogleCloudStorageConnectionFactory.java:39)
	at org.apache.camel.component.google.storage.GoogleCloudStorageEndpoint.doStart(GoogleCloudStorageEndpoint.java:75)
	at org.apache.camel.support.service.BaseService.start(BaseService.java:119)
	... 27 more
{code}


davsclaus:1670819268:2022-12-12T12:27:48.482+0000:1670819268:2022-12-12T12:27:48.482+0000:Okay do you have a sample code somewhere to try ?
acosentino:1670819442:2022-12-12T12:30:42.661+0000:1670819442:2022-12-12T12:30:42.661+0000:This is a slightly modify google-storage-source kamelet, where the service account key is optional


{code:java}
# ---------------------------------------------------------------------------
# Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.
# The ASF licenses this file to You under the Apache License, Version 2.0
# (the ""License""); you may not use this file except in compliance with
# the License.  You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an ""AS IS"" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
# ---------------------------------------------------------------------------
apiVersion: camel.apache.org/v1alpha1
kind: Kamelet
metadata:
  name: google-storage-source
  annotations:
    camel.apache.org/kamelet.support.level: ""Stable""
    camel.apache.org/catalog.version: ""main-SNAPSHOT""
    camel.apache.org/kamelet.icon: ""data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBoZWlnaHQ9IjgwMCIgd2lkdGg9IjEyMDAiIHZpZXdCb3g9Ii0xOS4yMDAxNSAtMjguNDgzIDE2Ni40MDEzIDE3MC44OTgiPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAgLTcuMDM0KSI+PGxpbmVhckdyYWRpZW50IHkyPSIxMjAuNzg5IiB4Mj0iNjQiIHkxPSI3LjAzNCIgeDE9IjY0IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgaWQ9ImEiPjxzdG9wIG9mZnNldD0iMCIgc3RvcC1jb2xvcj0iIzQzODdmZCIvPjxzdG9wIG9mZnNldD0iMSIgc3RvcC1jb2xvcj0iIzQ2ODNlYSIvPjwvbGluZWFyR3JhZGllbnQ+PHBhdGggZD0iTTI3Ljc5IDExNS4yMTdMMS41NCA2OS43NDlhMTEuNDk5IDExLjQ5OSAwIDAxMC0xMS40OTlsMjYuMjUtNDUuNDY3YTExLjUgMTEuNSAwIDAxOS45Ni01Ljc1aDUyLjVhMTEuNSAxMS41IDAgMDE5Ljk1OSA1Ljc1bDI2LjI1IDQ1LjQ2N2ExMS40OTkgMTEuNDk5IDAgMDEwIDExLjVsLTI2LjI1IDQ1LjQ2NmExMS41IDExLjUgMCAwMS05Ljk1OSA1Ljc1aC01Mi41YTExLjQ5OSAxMS40OTkgMCAwMS05Ljk2LTUuNzV6IiBmaWxsPSJ1cmwoI2EpIi8+PC9nPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAgLTcuMDM0KSI+PGRlZnM+PHBhdGggZD0iTTI3Ljc5MSAxMTUuMjE3TDEuNTQxIDY5Ljc0OWExMS40OTkgMTEuNDk5IDAgMDEwLTExLjQ5OWwyNi4yNS00NS40NjdhMTEuNDk5IDExLjQ5OSAwIDAxOS45NTktNS43NWg1Mi41YTExLjUgMTEuNSAwIDAxOS45NiA1Ljc1bDI2LjI1IDQ1LjQ2N2ExMS40OTkgMTEuNDk5IDAgMDEwIDExLjVsLTI2LjI1IDQ1LjQ2NmExMS40OTkgMTEuNDk5IDAgMDEtOS45NiA1Ljc1aC01Mi41YTExLjQ5OSAxMS40OTkgMCAwMS05Ljk1OS01Ljc1eiIgaWQ9ImIiLz48L2RlZnM+PGNsaXBQYXRoIGlkPSJjIj48dXNlIGhlaWdodD0iMTAwJSIgd2lkdGg9IjEwMCUiIHhsaW5rOmhyZWY9IiNiIiBvdmVyZmxvdz0idmlzaWJsZSIvPjwvY2xpcFBhdGg+PHBhdGggY2xpcC1wYXRoPSJ1cmwoI2MpIiBvcGFjaXR5PSIuMDciIGQ9Ik00OS4zMTMgNTMuODc1bC03LjAxIDYuOTkgNS45NTcgNS45NTgtNS44OTggMTAuNDc2IDQ0LjYzNSA0NC42MzYgMTAuODE2LjAwMkwxMTguOTM2IDg0IDg1LjQ4OSA1MC41NXoiLz48L2c+PHBhdGggZD0iTTg0LjcgNDMuMjM2SDQzLjI2NGMtLjY2NyAwLTEuMjEyLjU0Ni0xLjIxMiAxLjIxNHY4LjU2NmMwIC42NjYuNTQ2IDEuMjEyIDEuMjEyIDEuMjEySDg0LjdjLjY2NyAwIDEuMjEzLS41NDYgMS4yMTMtMS4yMTJ2LTguNTY4YzAtLjY2Ni0uNTQ1LTEuMjEzLTEuMjEyLTEuMjEzbS02LjQxNiA3Ljk3NmEyLjQ4NCAyLjQ4NCAwIDAxLTIuNDc3LTIuNDggMi40NzUgMi40NzUgMCAwMTIuNDc3LTIuNDc3YzEuMzcgMCAyLjQ4IDEuMTAzIDIuNDggMi40NzdhMi40OCAyLjQ4IDAgMDEtMi40OCAyLjQ4bTYuNDE1IDguNDkxbC00MS40MzYuMDAyYy0uNjY3IDAtMS4yMTIuNTQ2LTEuMjEyIDEuMjE0djguNTY1YzAgLjY2Ni41NDYgMS4yMTMgMS4yMTIgMS4yMTNIODQuN2MuNjY3IDAgMS4yMTMtLjU0NyAxLjIxMy0xLjIxM3YtOC41NjdjMC0uNjY2LS41NDUtMS4yMTQtMS4yMTItMS4yMTRtLTYuNDE2IDcuOTc2YTIuNDgzIDIuNDgzIDAgMDEtMi40NzctMi40OCAyLjQ3NSAyLjQ3NSAwIDAxMi40NzctMi40NzcgMi40OCAyLjQ4IDAgMTEwIDQuOTU2IiBmaWxsPSIjZmZmIi8+PC9zdmc+""
    camel.apache.org/provider: ""Apache Software Foundation""
    camel.apache.org/kamelet.group: ""Google Storage""
  labels:
    camel.apache.org/kamelet.type: ""source""
spec:
  definition:
    title: ""Google Storage Source""
    description: |-
      Consume objects from Google Cloud Storage.

      You must encode the `serviceAccountKey` property before you pass it as a parameter.
    required:
      - bucketNameOrArn
    type: object
    properties:
      bucketNameOrArn:
        title: Bucket Name Or ARN
        description: The Google Cloud Storage bucket name or Bucket Amazon Resource Name (ARN).
        type: string
      serviceAccountKey:
        title: Service Account Key
        description: The service account key to use as credentials for Google Cloud Storage access. You must encode this value in base64.
        type: binary
        x-descriptors:
        - urn:camel:group:credentials
      deleteAfterRead:
        title: Auto-delete Objects
        description: Specifies to delete objects after consuming them.
        type: boolean
        x-descriptors:
        - 'urn:alm:descriptor:com.tectonic.ui:checkbox'
        default: true
      autoCreateBucket:
        title: Autocreate Bucket
        description: Specifies to automatically create the Google Cloud Storage bucket.
        type: boolean
        x-descriptors:
        - 'urn:alm:descriptor:com.tectonic.ui:checkbox'
        default: false
  dependencies:
    - ""camel:kamelet""
    - ""camel:google-storage""
    - ""camel:jackson""
  template:
    from:
      uri: ""google-storage://{{bucketNameOrArn}}""
      parameters:
        autoCreateBucket: ""{{autoCreateBucket}}""
        serviceAccountKey: ""{{base64:?serviceAccountKey}}""
        deleteAfterRead: ""{{deleteAfterRead}}""
      steps:
      - to: kamelet:sink
{code}

and this is a yaml route to use:


{code:java}
## ---------------------------------------------------------------------------
## Licensed to the Apache Software Foundation (ASF) under one or more
## contributor license agreements.  See the NOTICE file distributed with
## this work for additional information regarding copyright ownership.
## The ASF licenses this file to You under the Apache License, Version 2.0
## (the ""License""); you may not use this file except in compliance with
## the License.  You may obtain a copy of the License at
##
##      http://www.apache.org/licenses/LICENSE-2.0
##
## Unless required by applicable law or agreed to in writing, software
## distributed under the License is distributed on an ""AS IS"" BASIS,
## WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
## See the License for the specific language governing permissions and
## limitations under the License.
## ---------------------------------------------------------------------------

- route:
    from:
      uri: ""kamelet:google-storage-source""
      parameters:
        projectId: ""test-gs-123""
        bucketNameOrArn: ""bucket-12345""
      steps:
      - to: 
          uri: ""kamelet:log-sink""
          parameters:
            showStreams: ""true""
            showHeaders: ""true""
{code}

Values are not important, it should fail because it cannot authenticate to the service, but it fails before.
davsclaus:1670820823:2022-12-12T12:53:43.901+0000:1670820823:2022-12-12T12:53:43.901+0000:Ah its due to base64 component is not automatic loaded (detected), so if you run with

--deps=camel:base64

Then it works. But we should make camel-jbang automatic include base64 if property placeholder is using it
davsclaus:1670820846:2022-12-12T12:54:06.868+0000:1670820846:2022-12-12T12:54:06.868+0000:Also you can add camel-bas64 to the dependencies in the kamelet, then it should work better
davsclaus:1670821201:2022-12-12T13:00:01.743+0000:1670821201:2022-12-12T13:00:01.743+0000:camel-jbang now atuomatic download base64 if needed. However the correct solution is to add camel-base64 as dependencies to the kamelet.
acosentino:1670821238:2022-12-12T13:00:38.523+0000:1670821238:2022-12-12T13:00:38.523+0000:My bad. Thanks for this."
0,CAMEL-18801,Bug,Major,None,,"
None
",Resolved,Invalid,None,Unassigned,Zia,0,2,2022-12-07 06:36:16+00:00,2022-12-07 06:40:48+00:00,"I am running camel salesforce kafka source connector which uses camel-salesforce version 3.14.1 to subscribe to salesforce topic events.


i am getting this error in prod and which is restricting it getting events from salesforce further. kindly help so that we can resolve this issue quickly


 


 WARN Error subscribing to /topic/Order: HttpConnectionOverHTTP@5f67dcd3::DecryptedEndPoint@4547d7f5{l=/X.X.X.X:60904,r=orgTec.my.salesforce.com/X.X.X.X:443,OPEN,fill=,flush=,to=1597/20000}. Caused by: [org.apache.camel.component.salesforce.api.SalesforceException - Error subscribing to /topic/Order: HttpConnectionOverHTTP@5f67dcd3::DecryptedEndPoint@4547d7f5\{l=/X.X.X.X:60904,r=orgTech.my.salesforce.com/X.X.X.X:443,OPEN,fill=-,flush=-,to=1597/20000}] (org.apache.camel.component.salesforce.SalesforceConsumer)
org.apache.camel.component.salesforce.api.SalesforceException: Error subscribing to /topic/Order: HttpConnectionOverHTTP@5f67dcd3::DecryptedEndPoint@4547d7f5{l=/X.X.X.X:60904,r=orgTech.my.salesforce.com/X.X.X.X:443,OPEN,fill=,flush=,to=1597/20000}","davsclaus:1670366448:2022-12-07T06:40:48.286+0000:1670366448:2022-12-07T06:40:48.286+0000:Please ask such questions on the user mailing list or zulip chat room
https://camel.apache.org/community/support/
"
0,CAMEL-18800,Improvement,Major,3.19.0,"3.18.5, 3.20.0","
None
",Resolved,Fixed,"3.18.5, 3.20.0",Unassigned,Christoph Deppisch,0,2,2022-12-06 20:01:57+00:00,2022-12-07 11:54:27+00:00,Camel JBang run command supports KameletBinding custom resources. We should also support running a Camel K integration custom resource.,davsclaus:1670385267:2022-12-07T11:54:27.461+0000:1670385267:2022-12-07T11:54:27.461+0000:Thanks for the PR
0,CAMEL-18799,Improvement,Minor,3.19.0,,"
None
",Open,Unresolved,None,Unassigned,Andrea Tarocchi,0,2,2022-12-06 14:42:44+00:00,2022-12-16 15:48:15+00:00,Implement an Azure Storage Blob changefeed consumer,"davsclaus:1670385329:2022-12-07T11:55:29.906+0000:1670385376:2022-12-07T11:56:16.509+0000:You can try using a split eip in a kamelet, though when its a source it may indeed be trickier
valdar:1671176449:2022-12-16T15:40:49.679+0000:1671176895:2022-12-16T15:48:15.542+0000:Has been possible to achieve what was needed in a kamelet see https://github.com/apache/camel-kamelets/pull/1217
might be useful to incorporate part of that behavior in a consumer?"
0,CAMEL-18798,New Feature,Major,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Claus Ibsen,Claus Ibsen,0,1,2022-12-06 08:36:51+00:00,2022-12-07 12:59:19+00:00,"So you can do


from(""xxx"").routeId(""new-order"").prefixId(""xxx"")
   .to(""aaa"")
   .to(""bbb"").id(""order"")


from(""xxx2"").routeId(""new-order"").prefixId(""zzz"")
   .to(""aaa"")
   .to(""bbb"").id(""order"")
   .to(""ccc"")


Then every node in the routes are prefixed with ""xxx"" or ""zzz"". This allows to avoid problems with ID duplicates, and also group together IDs as the use the same prefix.


The prefix is applied for



route id
explicit set id
auto generated ids



This means every ID from the route is prefixed.",
0,CAMEL-18797,Improvement,Minor,"3.14.6, 3.18.4, 3.19.0","3.14.7, 3.18.5, 3.20.0","
None
",Resolved,Fixed,"3.14.7, 3.18.5, 3.20.0",Claus Ibsen,John Taylor,0,2,2022-12-05 21:16:16+00:00,2022-12-09 06:12:56+00:00,"I have a similar problem to the problem described in CAMEL-18399 but instead of the result of getParameterMetadata returning null it is throwing an exception from the driver. The driver is com.microsoft.sqlserver/mssql-jdbc/11.2.1.jre11 although all version are affected as far as I can tell. It looks like a bug in their parser where it fails to parse for valid queries when there are parameters. Where it affects me the most is when sql-92 join syntax includes a parameter, like




select 'x' from TABLEA A 
   JOIN TABLEB B on A.F1 = B.F1 and B.F2 = :#parm1 
WHERE A.F1 = :#parm2




Including the parametersCount option doesn't help in this case as it doesn't bypass the getParameterMetadata. My proposal is to only call getParameterMetadata  if the parametersCount isn't set because it is only being used to populate the expected variable anyway.",davsclaus:1670537576:2022-12-09T06:12:56.265+0000:1670537576:2022-12-09T06:12:56.265+0000:Thanks for reporting and providing a patch
0,CAMEL-18796,Bug,Major,"3.18.0, 3.19.0","3.18.5, 3.20.0","
None
",Resolved,Fixed,"3.18.5, 3.20.0",Otavio Rodolfo Piske,Luca Burgazzoli,0,3,2022-12-05 21:10:04+00:00,2022-12-13 08:04:48+00:00,"I'm running in a strange behavior of the camle-kafka component in case of a glitch/temporary authentication issue. Assuming we have the following code:




//usr/bin/env jbang ""$0"" ""$@"" ; exit $?
//
//DEPS io.quarkus.platform:quarkus-camel-bom:2.14.2.Final@pom
//DEPS org.apache.camel.quarkus:camel-quarkus-kafka
//DEPS org.apache.camel.quarkus:camel-quarkus-log
//DEPS org.apache.camel.quarkus:camel-quarkus-direct
//
//JAVAC_OPTIONS -parameters
//JAVA_OPTIONS -Djava.util.logging.manager=org.jboss.logmanager.LogManager
//

import org.apache.camel.ExtendedCamelContext;
import org.apache.camel.builder.endpoint.EndpointRouteBuilder;

public class ck extends EndpointRouteBuilder {

    @Override
    public void configure() throws Exception {
        getCamelContext().adapt(ExtendedCamelContext.class)
            .setErrorHandlerFactory(
                deadLetterChannel(""direct:dlq"")
            );

        var kafka = kafka(""demo"")
            .brokers(""{{test.kafka.broker}}"")
            .autoOffsetReset(""earliest"")
            .securityProtocol(""SASL_SSL"")  
            .saslMechanism(""PLAIN"")
            .saslJaasConfig(""org.apache.kafka.common.security.plain.PlainLoginModule required username='{{test.kafka.username}}' password='{{test.kafka.password}}';"");      

        from(""direct:dlq"")
            .to(""log:dlq?showAll=true&multiline=true"");

        from(kafka)
            .to(""log:kafka?showAll=true&multiline=true"");
    }
}




What this route is doing is:
1. set-up a global error handler (send to a DLQ)
2. poll data from a kafka topic


If for some reason there is a glitch in the authentication machinery, then the KafkaConsumer thread is terminated and no more poll/reconnection attempt are made.




2022-12-05 21:52:48,728 DEBUG [org.apa.cam.com.kaf.con.sup.KafkaRecordProcessorFacade] (Camel (camel-1) thread #1 - KafkaConsumer[demo]) Last poll on thread demo-Thread 0 resulted on 0 records to process
2022-12-05 21:52:53,729 DEBUG [org.apa.cam.com.kaf.con.sup.KafkaRecordProcessorFacade] (Camel (camel-1) thread #1 - KafkaConsumer[demo]) Last poll on thread demo-Thread 0 resulted on 0 records to process
2022-12-05 21:52:58,730 DEBUG [org.apa.cam.com.kaf.con.sup.KafkaRecordProcessorFacade] (Camel (camel-1) thread #1 - KafkaConsumer[demo]) Last poll on thread demo-Thread 0 resulted on 0 records to process
2022-12-05 21:53:03,731 DEBUG [org.apa.cam.com.kaf.con.sup.KafkaRecordProcessorFacade] (Camel (camel-1) thread #1 - KafkaConsumer[demo]) Last poll on thread demo-Thread 0 resulted on 0 records to process
2022-12-05 21:53:08,732 DEBUG [org.apa.cam.com.kaf.con.sup.KafkaRecordProcessorFacade] (Camel (camel-1) thread #1 - KafkaConsumer[demo]) Last poll on thread demo-Thread 0 resulted on 0 records to process
2022-12-05 21:53:09,598 INFO  [org.apa.kaf.com.net.Selector] (Camel (camel-1) thread #1 - KafkaConsumer[demo]) [Consumer clientId=consumer-9fc21222-980b-4dd7-8e2b-0a228a4f3fe5-1, groupId=9fc21222-980b-4dd7-8e2b-0a228a4f3fe5] Failed re-authentication with broker-0-lb-cos-ce---l--votu-g----ig.bf2.kafka.rhcloud.com/34.247.249.77 (channelId=2147483647) (Authentication failed: credentials for user could not be verified)
2022-12-05 21:53:09,602 ERROR [org.apa.kaf.cli.NetworkClient] (Camel (camel-1) thread #1 - KafkaConsumer[demo]) [Consumer clientId=consumer-9fc21222-980b-4dd7-8e2b-0a228a4f3fe5-1, groupId=9fc21222-980b-4dd7-8e2b-0a228a4f3fe5] Connection to node 2147483647 (broker-0-lb-cos-ce---l--votu-g----ig.bf2.kafka.rhcloud.com/34.247.249.77:443) failed authentication due to: Authentication failed: credentials for user could not be verified
2022-12-05 21:53:09,605 WARN  [org.apa.cam.com.kaf.KafkaFetchRecords] (Camel (camel-1) thread #1 - KafkaConsumer[demo]) Exception org.apache.kafka.common.errors.SaslAuthenticationException caught by thread demo-Thread 0 while polling topic demo from kafka: Authentication failed: credentials for user could not be verified: org.apache.kafka.common.errors.SaslAuthenticationException: Authentication failed: credentials for user could not be verified

2022-12-05 21:53:09,609 WARN  [org.apa.cam.com.kaf.con.err.BridgeErrorStrategy] (Camel (camel-1) thread #1 - KafkaConsumer[demo]) Deferring processing to the exception handler based on polling exception strategy
2022-12-05 21:53:09,624 DEBUG [org.apa.cam.pro.err.DeadLetterChannel] (Camel (camel-1) thread #1 - KafkaConsumer[demo]) Failed delivery for (MessageId: 386B9AF6D607152-0000000000000000 on ExchangeId: 386B9AF6D607152-0000000000000000). On delivery attempt: 0 caught: org.apache.kafka.common.errors.SaslAuthenticationException: Authentication failed: credentials for user could not be verified
2022-12-05 21:53:09,628 DEBUG [org.apa.cam.pro.SendProcessor] (Camel (camel-1) thread #1 - KafkaConsumer[demo]) >>>> direct://dlq Exchange[386B9AF6D607152-0000000000000000]
2022-12-05 21:53:09,628 DEBUG [org.apa.cam.pro.SendProcessor] (Camel (camel-1) thread #1 - KafkaConsumer[demo]) >>>> log://dlq?multiline=true&showAll=true Exchange[386B9AF6D607152-0000000000000000]
2022-12-05 21:53:09,629 INFO  [dlq] (Camel (camel-1) thread #1 - KafkaConsumer[demo]) Exchange[
  Id: 386B9AF6D607152-0000000000000000
  ExchangePattern: InOnly
  Properties: {CamelErrorHandlerBridge=true, CamelExceptionCaught=org.apache.kafka.common.errors.SaslAuthenticationException: Authentication failed: credentials for user could not be verified, CamelFailureRouteId=route2, CamelFatalFallbackErrorHandler=[route2], CamelToEndpoint=log://dlq?multiline=true&showAll=true}
  Headers: {}
  BodyType: null
  Body: [Body is null]
  CaughtExceptionType: org.apache.kafka.common.errors.SaslAuthenticationException  CaughtExceptionMessage: Authentication failed: credentials for user could not be verified  StackTrace: org.apache.kafka.common.errors.SaslAuthenticationException: Authentication failed: credentials for user could not be verified

]
2022-12-05 21:53:09,635 INFO  [org.apa.cam.com.kaf.con.err.SeekUtil] (Camel (camel-1) thread #1 - KafkaConsumer[demo]) Consumer seeking to next offset 1 to continue polling next message from topic demo on partition 0
2022-12-05 21:53:09,636 DEBUG [org.apa.cam.com.kaf.KafkaFetchRecords] (Camel (camel-1) thread #1 - KafkaConsumer[demo]) Closing consumer demo-Thread 0
2022-12-05 21:53:09,636 DEBUG [org.apa.cam.com.kaf.con.sup.PartitionAssignmentListener] (Camel (camel-1) thread #1 - KafkaConsumer[demo]) onPartitionsRevoked: demo-Thread 0 from demo
2022-12-05 21:53:09,643 INFO  [org.apa.cam.com.kaf.KafkaFetchRecords] (Camel (camel-1) thread #1 - KafkaConsumer[demo]) Terminating KafkaConsumer thread demo-Thread 0 receiving from topic demo




However according to the documentation, if the pollOnError is set to ERROR_HANDLER as in this case (it is the default), the strategy should use Camel’s error handler to process the exception, and afterwards continue to poll next message but this does not seems to be the case.


This seems to be somehow related to:



https://issues.apache.org/jira/browse/CAMEL-17424
https://github.com/apache/camel/commit/55df049a96fd8f52265ef7e7a0cc9ca5a28ab6b3","lb:1670245886:2022-12-05T21:11:26.593+0000:1670245898:2022-12-05T21:11:38.551+0000:/cc [~orpiske]
orpiske:1670246104:2022-12-05T21:15:04.611+0000:1670246104:2022-12-05T21:15:04.611+0000:Thanks Luca, I will take a look
lb:1670248732:2022-12-05T21:58:52.238+0000:1670248732:2022-12-05T21:58:52.238+0000:I observed that another strange behavior happens if the pollOnError option is set to RECONNECT, as in such case, only a single reconnect attempt is performed then the consumer is essentially idle and no more reconnect attempt are made:

{code:java}
//usr/bin/env jbang ""$0"" ""$@"" ; exit $?
//
//DEPS io.quarkus.platform:quarkus-camel-bom:2.14.2.Final@pom
//DEPS org.apache.camel.quarkus:camel-quarkus-kafka
//DEPS org.apache.camel.quarkus:camel-quarkus-log
//DEPS org.apache.camel.quarkus:camel-quarkus-direct
//DEPS org.apache.camel.quarkus:camel-quarkus-microprofile-health
//
//JAVAC_OPTIONS -parameters
//JAVA_OPTIONS -Djava.util.logging.manager=org.jboss.logmanager.LogManager
//

import org.apache.camel.ExtendedCamelContext;
import org.apache.camel.builder.endpoint.EndpointRouteBuilder;

public class ck extends EndpointRouteBuilder {
    @Override
    public void configure() throws Exception {
        var kafka = kafka(""demo"")
            .brokers(""{{test.kafka.broker}}"")
            .autoOffsetReset(""earliest"")
            .securityProtocol(""SASL_SSL"")  
            .pollOnError(""RECONNECT"")
            .saslMechanism(""PLAIN"")
            .saslJaasConfig(""org.apache.kafka.common.security.plain.PlainLoginModule required username='{{test.kafka.username}}' password='{{test.kafka.password}}';"");      

        from(kafka)
            .to(""log:kafka?showAll=true&multiline=true"");
    }
}
{code}

As result is

{code}
2022-12-05 22:50:44,012 INFO  [org.apa.kaf.com.net.Selector] (Camel (camel-1) thread #1 - KafkaConsumer[demo]) [Consumer clientId=consumer-e5368aa3-6d4f-4081-bd1e-bf58dca40a06-1, groupId=e5368aa3-6d4f-4081-bd1e-bf58dca40a06] Failed re-authentication with broker-0-lb-cos-ce---l--votu-g----ig.bf2.kafka.rhcloud.com/34.247.249.77 (channelId=2147483647) (Authentication failed: credentials for user could not be verified)
2022-12-05 22:50:44,014 ERROR [org.apa.kaf.cli.NetworkClient] (Camel (camel-1) thread #1 - KafkaConsumer[demo]) [Consumer clientId=consumer-e5368aa3-6d4f-4081-bd1e-bf58dca40a06-1, groupId=e5368aa3-6d4f-4081-bd1e-bf58dca40a06] Connection to node 2147483647 (broker-0-lb-cos-ce---l--votu-g----ig.bf2.kafka.rhcloud.com/34.247.249.77:443) failed authentication due to: Authentication failed: credentials for user could not be verified
2022-12-05 22:50:44,017 WARN  [org.apa.kaf.cli.con.int.ConsumerCoordinator] (Camel (camel-1) thread #1 - KafkaConsumer[demo]) [Consumer clientId=consumer-e5368aa3-6d4f-4081-bd1e-bf58dca40a06-1, groupId=e5368aa3-6d4f-4081-bd1e-bf58dca40a06] Asynchronous auto-commit of offsets {demo-0=OffsetAndMetadata{offset=0, leaderEpoch=null, metadata=''}} failed: Authentication failed: credentials for user could not be verified
2022-12-05 22:50:44,016 ERROR [org.apa.kaf.cli.con.int.ConsumerCoordinator] (kafka-coordinator-heartbeat-thread | e5368aa3-6d4f-4081-bd1e-bf58dca40a06) [Consumer clientId=consumer-e5368aa3-6d4f-4081-bd1e-bf58dca40a06-1, groupId=e5368aa3-6d4f-4081-bd1e-bf58dca40a06] An authentication error occurred in the heartbeat thread: org.apache.kafka.common.errors.SaslAuthenticationException: Authentication failed: credentials for user could not be verified

2022-12-05 22:50:44,262 WARN  [org.apa.cam.com.kaf.KafkaFetchRecords] (Camel (camel-1) thread #1 - KafkaConsumer[demo]) Exception org.apache.kafka.common.errors.SaslAuthenticationException caught by thread demo-Thread 0 while polling topic demo from kafka: Authentication failed: credentials for user could not be verified: org.apache.kafka.common.errors.SaslAuthenticationException: Authentication failed: credentials for user could not be verified

2022-12-05 22:50:44,262 WARN  [org.apa.cam.com.kaf.con.err.ReconnectErrorStrategy] (Camel (camel-1) thread #1 - KafkaConsumer[demo]) Requesting the consumer to re-connect on the next run based on polling exception strategy
2022-12-05 22:50:44,263 DEBUG [org.apa.cam.com.kaf.KafkaFetchRecords] (Camel (camel-1) thread #1 - KafkaConsumer[demo]) Closing consumer demo-Thread 0
2022-12-05 22:50:44,263 DEBUG [org.apa.cam.com.kaf.con.sup.PartitionAssignmentListener] (Camel (camel-1) thread #1 - KafkaConsumer[demo]) onPartitionsRevoked: demo-Thread 0 from demo
2022-12-05 22:50:45,953 INFO  [org.apa.kaf.com.net.Selector] (Camel (camel-1) thread #1 - KafkaConsumer[demo]) [Consumer clientId=consumer-e5368aa3-6d4f-4081-bd1e-bf58dca40a06-1, groupId=e5368aa3-6d4f-4081-bd1e-bf58dca40a06] Failed authentication with broker-0-lb-cos-ce---l--votu-g----ig.bf2.kafka.rhcloud.com/34.247.249.77 (channelId=2147483647) (Authentication failed: credentials for user could not be verified)
2022-12-05 22:50:45,954 ERROR [org.apa.kaf.cli.NetworkClient] (Camel (camel-1) thread #1 - KafkaConsumer[demo]) [Consumer clientId=consumer-e5368aa3-6d4f-4081-bd1e-bf58dca40a06-1, groupId=e5368aa3-6d4f-4081-bd1e-bf58dca40a06] Connection to node 2147483647 (broker-0-lb-cos-ce---l--votu-g----ig.bf2.kafka.rhcloud.com/34.247.249.77:443) failed authentication due to: Authentication failed: credentials for user could not be verified
2022-12-05 22:50:45,955 ERROR [org.apa.kaf.cli.con.KafkaConsumer] (Camel (camel-1) thread #1 - KafkaConsumer[demo]) [Consumer clientId=consumer-e5368aa3-6d4f-4081-bd1e-bf58dca40a06-1, groupId=e5368aa3-6d4f-4081-bd1e-bf58dca40a06] Failed to close coordinator: org.apache.kafka.common.errors.SaslAuthenticationException: Authentication failed: credentials for user could not be verified
{code}

And no more entries in the log
davsclaus:1670841114:2022-12-12T18:31:54.914+0000:1670841114:2022-12-12T18:31:54.914+0000:Is there more work to this?
orpiske:1670842572:2022-12-12T18:56:12.929+0000:1670842572:2022-12-12T18:56:12.929+0000:I was waiting for a feedback from Luca, but I think we can close this and reopen if there's any problem."
0,CAMEL-18795,Bug,Major,"3.18.4, 3.19.0","3.18.5, 3.20.0","
None
",Resolved,Fixed,"3.18.5, 3.20.0",Otavio Rodolfo Piske,Otavio Rodolfo Piske,0,1,2022-12-05 13:50:55+00:00,2022-12-07 09:17:37+00:00,"Quoting a user report on the chat:


""I have faced with the issue that org.apache.kafka.clients.consumer.Consumer is never closed during an app shutdown, I use camel 3.18.3. 
It looks that it might happened after these changes. I don't have this issue on camel 3.18.0
Maybe it's expected that consumer should be closed here, but it looks that default pollExceptionStrategies don't return false from canContinue during an app shutdown. ""


 


This is caused as unintended side-effect of CAMEL-17947.","orpiske:1670219499:2022-12-05T13:51:39.986+0000:1670219499:2022-12-05T13:51:39.986+0000:Probably the easiest / safest way is reverting the fix for 17947 as it seemed to affect only the tests.
orpiske:1670375811:2022-12-07T09:16:51.445+0000:1670375811:2022-12-07T09:16:51.445+0000:Backported with https://github.com/apache/camel/pull/8850"
0,CAMEL-18794,New Feature,Minor,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Claus Ibsen,Claus Ibsen,0,1,2022-12-04 13:23:39+00:00,2022-12-04 13:24:44+00:00,So you can run directly Java route from CLI,
0,CAMEL-18793,New Feature,Major,None,"4.0-RC1, 4.0.0","
None
",Resolved,Fixed,"4.0-RC1, 4.0.0",Unassigned,Claus Ibsen,0,1,2022-12-04 10:48:18+00:00,2023-06-18 08:32:18+00:00,"When working with json data (or xml) then it may be nice to easily log this in pretty print mode, with ${body}


Maybe if we have a function in simple for this ala:


${prettyBody}",
0,CAMEL-18792,Test,Minor,None,None,"
None
",Resolved,Fixed,3.20.0,Kengo Seki,Kengo Seki,0,1,2022-12-03 05:15:15+00:00,2023-03-29 23:15:31+00:00,"It's a follow-up issue for CAMEL-18776.
The original issue should have been found by running integration tests, but as of now, we have to set up an HDFS cluster for running them. It's bothering a bit.
If we leverage MiniDFSCluster for this purpose, we don't need a real cluster any longer so we can easily find a similar problem.",
0,CAMEL-18791,Bug,Minor,3.18.3,,"
None
",Resolved,Not A Bug,None,Unassigned,Alexander Domke,0,2,2022-12-02 13:18:23+00:00,2023-12-20 15:56:19+00:00,"The MDC logging in connection with the JMS component does not work properly. Although MDC logging is switched on in the CamelContext and MDC logging has been configured, the log file is not filled. During further tests I found out that logging only works if the first JMS message is sent from the same CamelContext.  Unfortunately, it is out of the question for us to change the JMS component to synchronous operation.  I hope my hint helps you to fix the component.


blueprint.xml




<?xml version=""1.0"" encoding=""UTF-8""?>
<blueprint xmlns=""http://www.osgi.org/xmlns/blueprint/v1.0.0""
           xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance""
           xsi:schemaLocation=""http://www.osgi.org/xmlns/blueprint/v1.0.0 https://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd
                               http://camel.apache.org/schema/blueprint http://camel.apache.org/schema/blueprint/camel-blueprint-3.18.2.xsd"">    <reference id=""artemisCF"" interface=""javax.jms.ConnectionFactory"" filter=""(osgi.jndi.service.name=artemis)"" />    <bean id=""jmsTxManager"" class=""org.springframework.jms.connection.JmsTransactionManager"">
        <property name=""connectionFactory"" ref=""artemisCF"" />
    </bean>    <bean id=""PROPAGATION_REQUIRED"" class=""org.apache.camel.spring.spi.SpringTransactionPolicy"">
        <property name=""transactionManager"" ref=""jmsTxManager"" />
    </bean>    <bean id=""jms"" class=""org.apache.camel.component.jms.JmsComponent"">
        <property name=""connectionFactory"" ref=""artemisCF"" />
        <property name=""transactionManager"" ref=""jmsTxManager"" />
        <property name=""transacted"" value=""false"" />
    </bean>
        <camelContext id=""testCamelContext"" useMDCLogging=""true"" autoStartup=""true"" xmlns=""http://camel.apache.org/schema/blueprint"">        <!-- mdc logging works only if the send route in the same camel context! -->
        <route id=""send-to-queue"">
            <from uri=""timer:TestTimer?repeatCount=1"" />
            <setBody>
                <constant>my message</constant>
            </setBody>
            <to uri=""jms:queue:myqueue?connectionFactory=artemisCF"" />
        </route>
        
        <route id=""read-from-queue"">
            <from uri=""jms:queue:myqueue?concurrentConsumers=3"" />            <transacted />            <to uri=""mock:end"" />
        </route>
    
</blueprint>","davsclaus:1703058979:2023-12-20T15:56:19.107+0000:1703058979:2023-12-20T15:56:19.107+0000:MDC is thread bound. If you receive JMS from another JVM or app, it has its own MDC stuff"
0,CAMEL-18790,Improvement,Minor,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Claus Ibsen,Claus Ibsen,0,1,2022-12-02 09:04:34+00:00,2022-12-02 09:20:41+00:00,The MEP is not very useful in the logging as most often you want to see the message body (and maybe custom headers). So lets turn this off and reduce the output.,
0,CAMEL-18789,Improvement,Major,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Claus Ibsen,Claus Ibsen,0,1,2022-12-02 08:38:21+00:00,2022-12-04 09:11:26+00:00,"We have stream caching enabled by default, and when you then send data to the log component it will not log the data, however the user would expect to see data, so lets allow stream caches. 


Add an option to turn this off if needed.",
0,CAMEL-18788,Improvement,Minor,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Claus Ibsen,Claus Ibsen,0,1,2022-12-01 20:49:55+00:00,2022-12-02 12:54:14+00:00,"It sets wrong live reload as the file is not in current folder, but in myfolder




~/workspace/camel main *1 ?1 ❯ camel run ~/Downloads/example.yaml --dev                                                                                                                              ✘ INT 1m 28s
2022-12-01 21:48:25.994  INFO 43687 --- [           main] org.apache.camel.main.MainSupport        : Apache Camel (JBang) 3.20.0-SNAPSHOT is starting
2022-12-01 21:48:26.179  INFO 43687 --- [           main] org.apache.camel.main.MainSupport        : Using Java 11.0.13 with PID 43687. Started by davsclaus in /Users/davsclaus/workspace/camel
2022-12-01 21:48:26.194  INFO 43687 --- [           main] he.camel.cli.connector.LocalCliConnector : Camel CLI enabled (local)
2022-12-01 21:48:28.321  INFO 43687 --- [           main] e.camel.impl.engine.AbstractCamelContext : Apache Camel 3.20.0-SNAPSHOT (example) is starting
2022-12-01 21:48:28.472  INFO 43687 --- [           main] upport.FileWatcherResourceReloadStrategy : Live route reloading enabled (directory: .)",
0,CAMEL-18787,Task,Minor,3.19.0,3.20.0,"
None
",Resolved,Fixed,3.20.0,Nicolas Filotto,Nicolas Filotto,0,1,2022-12-01 17:36:29+00:00,2022-12-12 16:07:25+00:00,The new component camel-elasticsearch has been added to Camel 3.19 and needs to be added to Camel Karaf too,"nfilotto:1669888468:2022-12-01T17:54:28.774+0000:1669888468:2022-12-01T17:54:28.774+0000:The corresponding PR https://github.com/apache/camel-karaf/pull/219
nfilotto:1669943826:2022-12-02T09:17:06.490+0000:1669943826:2022-12-02T09:17:06.490+0000:The part #2 https://github.com/apache/camel-karaf/pull/221 which uses the Service Mix bundle"
0,CAMEL-18786,Task,Major,None,4.0.0,"
None
",Resolved,Fixed,4.0.0,Otavio Rodolfo Piske,Otavio Rodolfo Piske,0,3,2022-12-01 17:00:06+00:00,2023-07-17 10:35:09+00:00,"The community has complained for a long time that our documentation is hard to follow, outdated and disorganized. 


This task is to document the effort to clean it up.","githubbot:1669885626:2022-12-01T17:07:06.626+0000:1669885626:2022-12-01T17:07:06.626+0000:orpiske opened a new pull request, #929:
URL: https://github.com/apache/camel-website/pull/929

   These changes allow the Camel Core project to create a new page to
   reorganize, categorize and separate the project documentation according
   to the audience.
   
   The behavior of a few of the static pages is changed to accommodate
   that.



githubbot:1669885763:2022-12-01T17:09:23.139+0000:1669885763:2022-12-01T17:09:23.139+0000:orpiske commented on PR #929:
URL: https://github.com/apache/camel-website/pull/929#issuecomment-1334086914

   This depends on apache/camel#8821.



githubbot:1669888286:2022-12-01T17:51:26.281+0000:1669888286:2022-12-01T17:51:26.281+0000:orpiske commented on PR #929:
URL: https://github.com/apache/camel-website/pull/929#issuecomment-1334135458

   The preview and more details are available on the linked PR. 



githubbot:1669954144:2022-12-02T12:09:04.742+0000:1669954144:2022-12-02T12:09:04.742+0000:orpiske commented on PR #929:
URL: https://github.com/apache/camel-website/pull/929#issuecomment-1335145420

   @zregvart @djencks hey guys, any idea what might be the problem here? The build is failing with:
   
   ```
   ➤ YN0000: [build:minify  ] [09:56:21] Error in plugin ""gulp-htmlmin""
   ```
   
   I didn't get those errors locally, so I am not sure what might be the problem. 
   
   If you have any pointers, that would be helpful. Thanks!!!



githubbot:1669954431:2022-12-02T12:13:51.530+0000:1669954431:2022-12-02T12:13:51.530+0000:zregvart commented on PR #929:
URL: https://github.com/apache/camel-website/pull/929#issuecomment-1335150365

   There is a typo on this line:
   
   https://github.com/apache/camel/blob/ea35b3ee5c554bb56f7434267661b4ede723df01/docs/main/modules/ROOT/attachments/contents-table.html#L60
   
   `<bcomponents...` is not a valid HTML tag.
   
   If you want to run all the checks locally run with `CAMEL_ENV=production` [environment variable](https://github.com/apache/camel-website#camel_env-environment-variable).
   
   In general I don't think it is a good idea to have HTML outside of the website repository, things are prone to breaking that way. The layouts that generate the HTML need to be in the website directory.



githubbot:1669954924:2022-12-02T12:22:04.959+0000:1669954924:2022-12-02T12:22:04.959+0000:orpiske commented on PR #929:
URL: https://github.com/apache/camel-website/pull/929#issuecomment-1335157872

   > There is a typo on this line:
   > 
   > https://github.com/apache/camel/blob/ea35b3ee5c554bb56f7434267661b4ede723df01/docs/main/modules/ROOT/attachments/contents-table.html#L60
   > 
   > `<bcomponents...` is not a valid HTML tag.
   > 
   > If you want to run all the checks locally run with `CAMEL_ENV=production` [environment variable](https://github.com/apache/camel-website#camel_env-environment-variable).
   
   Awesome! Thanks for pointing the error and sharing the info about the checks. I'll make sure to include that into my workflow.
   
   > 
   > In general I don't think it is a good idea to have HTML outside of the website repository, things are prone to breaking that way. The layouts that generate the HTML need to be in the website directory.
   
   I agree that it would be better to avoid HTML. Unfortunately I couldn't get it to look precisely the way I wanted. 
   
   In the future I will refactor this to move that page to the website. So we avoid these anti-patterns and don't create problems for the future.
   
   



githubbot:1669955917:2022-12-02T12:38:37.034+0000:1669955917:2022-12-02T12:38:37.034+0000:zregvart commented on PR #929:
URL: https://github.com/apache/camel-website/pull/929#issuecomment-1335172468

   @orpiske one more thing, the inline styles you have in `contents-table.html` the will not work on the production site, we explicitly disable inline CSS and JavaScript via [CSP](https://github.com/apache/camel-website/blob/034de87cf0f5ad866951f5d03af5e85d6c13d49a/static/.htaccess#L1384). To test the website in a production-like environment build with `CAMEL_ENV=production` and [run Apache HTTPD locally](https://github.com/apache/camel-website/blob/main/support/README.md#running-apache-http).



githubbot:1669956155:2022-12-02T12:42:35.581+0000:1669956155:2022-12-02T12:42:35.581+0000:orpiske commented on PR #929:
URL: https://github.com/apache/camel-website/pull/929#issuecomment-1335175926

   > @orpiske one more thing, the inline styles you have in `contents-table.html` the will not work on the production site, we explicitly disable inline CSS and JavaScript via [CSP](https://github.com/apache/camel-website/blob/034de87cf0f5ad866951f5d03af5e85d6c13d49a/static/.htaccess#L1384). To test the website in a production-like environment build with `CAMEL_ENV=production` and [run Apache HTTPD locally](https://github.com/apache/camel-website/blob/main/support/README.md#running-apache-http).
   
   Thanks. It's looking like I might need to move those to the website repo and reference them there somehow. I'll investigate this more closely. Thanks for pointing this.



githubbot:1670234815:2022-12-05T18:06:55.657+0000:1670234815:2022-12-05T18:06:55.657+0000:github-actions[bot] commented on PR #929:
URL: https://github.com/apache/camel-website/pull/929#issuecomment-1337875148

   🚀 Preview is available at https://pr-929--camel.netlify.app



githubbot:1670235303:2022-12-05T18:15:03.116+0000:1670235303:2022-12-05T18:15:03.116+0000:orpiske merged PR #929:
URL: https://github.com/apache/camel-website/pull/929



davsclaus:1689561309:2023-07-17T10:35:09.866+0000:1689561309:2023-07-17T10:35:09.866+0000:Lets create new tickets for new website/doc stuff"
0,CAMEL-18785,New Feature,Minor,None,None,"
None
",Resolved,Abandoned,None,Unassigned,Chirag Sanghavi,0,1,2022-12-01 16:46:43+00:00,2023-11-22 20:06:29+00:00,"There needs to be a component created for Alibaba Messaging Service.
https://www.alibabacloud.com/help/en/message-service",
0,CAMEL-18784,Improvement,Minor,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Claus Ibsen,Claus Ibsen,0,1,2022-12-01 13:43:01+00:00,2022-12-05 06:49:57+00:00,"If you use csimple instead of simple then you get


Caused by: org.apache.camel.language.csimple.CSimpleException: Cannot find compiled csimple language for expression: Hello Camel from yaml
	at org.apache.camel.language.csimple.CSimpleLanguage.createExpression(CSimpleLanguage.java:185)
	at org.apache.camel.language.csimple.CSimpleLanguage.createExpression(CSimpleLanguage.java:160)
	at org.apache.camel.reifier.language.TypedExpressionReifier.createExpression(TypedExpressionReifier.java:59)
	at org.apache.camel.reifier.language.ExpressionReifier.createExpression(ExpressionReifier.java:175)
	at org.apache.camel.reifier.AbstractReifier.createExpression(AbstractReifier.java:115)
	at org.apache.camel.reifier.SetBodyReifier.createProcessor(SetBodyReifier.java:34)
	at org.apache.camel.reifier.ProcessorReifier.makeProcessor(ProcessorReifier.java:857)
	at org.apache.camel.reifier.ProcessorReifier.addRoutes(ProcessorReifier.java:598)
	at org.apache.camel.reifier.RouteReifier.doCreateRoute(RouteReifier.java:211)",
0,CAMEL-18783,Improvement,Minor,3.18.3,3.20.0,"
None
",Resolved,Fixed,3.20.0,Freeman Yue Fang,Lukas Lowinger,0,4,2022-12-01 12:51:22+00:00,2022-12-22 08:19:22+00:00,"Having one `cxf:bean:soapClientEndpoint` (with Singleton scope) and following two routes




        from(""direct:simpleUriBean"")
                .to(""cxf:bean:soapClientEndpoint?dataFormat=PAYLOAD"");

        from(""direct:operandsAdd"")
                .to(""cxf:bean:soapClientEndpoint?dataFormat=POJO"");




Leads to situation, that invoking route via `direct:simpleUriBean` will use `dataFormat=POJO` instead of PAYLOAD (which reader of that code could expect). Could we somehow detect those misuses of URI options ?


Eg. printing WARNING: You are using URI option dataFormat which wasn't taken into account because you are using shared bean with Singleton scope.","ppalaga:1669901356:2022-12-01T21:29:16.523+0000:1669901356:2022-12-01T21:29:16.523+0000:I guess this problem is not CXF specific - it may also exist for bean and perhaps other kinds of components.

For CXF specifically, [~ffang] explained to us that the current behavior, that only one of the two settings (PAYLOAD vs. POJO) gets effective for the given named bean is expected because the bean (in Singleton or Application scope) gets initialized only once. The explanation sounds plausible and I do not think it makes sense to change the behavior in any way. But still, the question is whether we could perhaps warn users that they do not get what they may expect? Or we should even make it illegal and throw an exception?
ffang:1669902308:2022-12-01T21:45:08.950+0000:1669902308:2022-12-01T21:45:08.950+0000:Hi [~ppalaga],

I totally agree with you that this problem isn't CXF or even Camel specific.

This is about how bean's life cycle(the scope concept) is managed in IOC containers(pretty much similar in CDI or Spring), if a bean is supposed to be stateful, then it shouldn't be a singleton, and I believe this is an important reason why we can specify scope of bean in IOC container. And about to warn users, I'm not sure how that could be done in Camel since it's mainly an IOC behaviour(or even a java language object behaviour). Not sure if Spring or CDI has such mechanism like a stateful singleton bean can't be referred more than once.

Freeman
ppalaga:1669943327:2022-12-02T09:08:47.239+0000:1669943327:2022-12-02T09:08:47.239+0000:Not sure for Spring and CDI in general, but Arc (the CDI impl of Quarkus) IIRC offers an API to query for a given bean what is it's scope:

{code}
Arc.container().instance(beanName).getBean().getScope()
{code}

Detecting the inconsistent situation could then go as follows:

1. Collect the URI params for all endpoint refs starting with {{cxf:bean:soapClientEndpoint}}
2. If the individual URI params (dataFormat=PAYLOAD vs. dataFormat=POJO) differ, then look up the bean's scope
3. If the scope is not SessionScoped, then throw an exception

Does it sound doable?
ffang:1669981834:2022-12-02T19:50:34.699+0000:1669991655:2022-12-02T22:34:15.559+0000:I'm hesitant to introduce IOC container specific API, and I believe we don't need really to know the scope of the bean, what we really care is that if the bean with the same name is the same instance, and if so, if the bean instance state has changed. So I'm gonna go this way, based on the fact that Camel CxfComponent creates CxfEndpoint per each URI, if bean prefix is detected here, if will use
{code}
CamelContextHelper.mandatoryLookup(getCamelContext(), beanId, CxfEndpoint.class);
{code}
to lookup the CxfEndpoint instance with the beanId, and here the underlying(if used) IOC container will kick in and return the CxfEndpoint instance per different scope of IOC. So we can maintain a CxfEndpoint bean map in CxfComponent, the map entry could be like 
{code}
beanId---->{beanInstance, isBeanStateChanged}.
{code}
 And during camel route creation procedure, whenever we detect the same beanId refer the same beanInstance &  isBeanStateChanged(we can consider all cxf:bean:beanId with options change the bean state), we can either log a warn message or even throw an exception.

ppalaga:1669993525:2022-12-02T23:05:25.647+0000:1669993525:2022-12-02T23:05:25.647+0000:Thanks [~ffang], generally your proposal sounds very elegant.

bq. we can consider all cxf:bean:beanId with options change the bean state

With *any* options? - i.e. also if {{cxf:bean:soapClientEndpoint?dataFormat=PAYLOAD}} is used in two routes with exactly the same options?
ffang:1669995017:2022-12-02T23:30:17.176+0000:1669995017:2022-12-02T23:30:17.176+0000:Hi [~ppalaga],

Good point, we need to add an ""equals"" method to CxfEndpoint to determine if two CxfEndpoint instances equal or not to tell if the state really changed.

Freeman
ffang:1670490734:2022-12-08T17:12:14.323+0000:1670490734:2022-12-08T17:12:14.323+0000:Addressed by this commit
https://github.com/apache/camel/commit/701f09b8a15eb1c7c92881be86dc02ad640de86c
and the test scenario is in CSB
https://github.com/apache/camel-spring-boot/commit/8e81bdd187b6b40b659d763671755c95815e1a68
ppalaga:1670559349:2022-12-09T12:15:49.277+0000:1670559349:2022-12-09T12:15:49.277+0000:Thanks [~ffang]! 

[~llowinge] any chance to check whether the solution works well on Camel Quarkus?
llowinge:1671169604:2022-12-16T13:46:44.883+0000:1671169604:2022-12-16T13:46:44.883+0000:[~ppalaga] I wanted to try it, overriding version with 

{code}
        <dependency>
            <groupId>org.apache.camel</groupId>
            <artifactId>camel-cxf-soap</artifactId>
            <version>3.20.0</version>
        </dependency>
{code}, but that artifact cannot be found - even i see https://github.com/apache/camel/releases/tag/camel-3.20.0, but i will probably have to wait a bit for the artifacts to be released.
davsclaus:1671169715:2022-12-16T13:48:35.997+0000:1671169715:2022-12-16T13:48:35.997+0000:Yes the release build has just started, takes a week. Keep eye on announcement on website when its released
llowinge:1671668362:2022-12-22T08:19:22.542+0000:1671668362:2022-12-22T08:19:22.542+0000:[~ppalaga] It was automatically verified by upgrade to 3.20.0 in CQ repository - eg. we have to apply those changes https://github.com/apache/camel-quarkus/commit/b115a4b25013098af1024f201fa13e18eb441fb8 as we alter (which shouldn't be allowed) CXFEndpoint in ApplicationScope."
0,CAMEL-18752,Improvement,Minor,None,"3.21.0, 4.0-M1, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M1, 4.0.0",Claus Ibsen,Claus Ibsen,0,1,2022-11-24 12:16:50+00:00,2023-01-30 08:59:46+00:00,"Even when we have description in camel-micrometer, then I do not see them in prometheus exporter (via camel-quarkus).


A sample output is here, where the HELP only have human description for JVM metrics (not from Camel)




# HELP CamelExchangesTotal_total
# TYPE CamelExchangesTotal_total counter
CamelExchangesTotal_total{camelContext=""ChaosMonkey"",routeId=""route2"",serviceName=""MicrometerRoutePolicyService"",} 19.0
CamelExchangesTotal_total{camelContext=""ChaosMonkey"",routeId=""route1"",serviceName=""MicrometerRoutePolicyService"",} 15.0
# HELP process_start_time_seconds Start time of the process since unix epoch.
# TYPE process_start_time_seconds gauge
process_start_time_seconds 1.66928575989E9
# HELP CamelRoutesRunning_routes
# TYPE CamelRoutesRunning_routes gauge
CamelRoutesRunning_routes{camelContext=""ChaosMonkey"",eventType=""RouteEvent"",serviceName=""MicrometerEventNotifierService"",} 2.0
# HELP jvm_buffer_count_buffers An estimate of the number of buffers in the pool
# TYPE jvm_buffer_count_buffers gauge
jvm_buffer_count_buffers{id=""mapped"",} 0.0
jvm_buffer_count_buffers{id=""direct"",} 18.0
# HELP jvm_info_total JVM version info
# TYPE jvm_info_total counter
jvm_info_total{runtime=""OpenJDK Runtime Environment"",vendor=""Azul Systems, Inc."",version=""11.0.13+8-LTS"",} 1.0
# HELP process_uptime_seconds The uptime of the Java virtual machine
# TYPE process_uptime_seconds gauge
process_uptime_seconds 75.098
# HELP system_load_average_1m The sum of the number of runnable entities queued to available processors and the number of runnable entities running on the available processors averaged over a period of time
# TYPE system_load_average_1m gauge
system_load_average_1m 2.45947265625
# HELP process_files_open_files The open file descriptor count
# TYPE process_files_open_files gauge
process_files_open_files 384.0
# HELP jvm_threads_daemon_threads The current number of live daemon threads
# TYPE jvm_threads_daemon_threads gauge
jvm_threads_daemon_threads 18.0
# HELP CamelExchangesSucceeded_total
# TYPE CamelExchangesSucceeded_total counter
CamelExchangesSucceeded_total{camelContext=""ChaosMonkey"",routeId=""route2"",serviceName=""MicrometerRoutePolicyService"",} 19.0
CamelExchangesSucceeded_total{camelContext=""ChaosMonkey"",routeId=""route1"",serviceName=""MicrometerRoutePolicyService"",} 15.0
# HELP jvm_threads_peak_threads The peak live thread count since the Java virtual machine started or peak was reset
# TYPE jvm_threads_peak_threads gauge
jvm_threads_peak_threads 94.0




I am not sure if we need to do something more special in camel-micrometer. But it would be good to dive into the prometheus exporter from quarkus to track in the code how this works, so we can find out how.",davsclaus:1671427556:2022-12-19T13:25:56.409+0000:1671427556:2022-12-19T13:25:56.409+0000:We have some stats already in 3.19 and more in 3.20 and a bit more in 3.21
0,CAMEL-18751,Task,Minor,3.19.0,3.20.0,"
None
",Resolved,Fixed,3.20.0,Alex Dettinger,Alex Dettinger,0,1,2022-11-24 10:27:59+00:00,2022-11-24 17:38:36+00:00,No Desc,
0,CAMEL-18750,Bug,Major,3.19.0,3.20.0,"
None
",Resolved,Fixed,3.20.0,Claus Ibsen,Claus Ibsen,0,1,2022-11-24 06:51:23+00:00,2022-11-24 07:08:32+00:00,"SB manages a set of dependencies and bring in


jakarta.json:jakarta.json-api:jar:1.1.6


But ES requires v2 of this library, so we must force it to use that version","davsclaus:1669244542:2022-11-24T07:02:22.685+0000:1669244542:2022-11-24T07:02:22.685+0000:This is not possible due to SB 2.7.x is managing and overriding this json-api to be v1.

Camel end users that use camel-elasticsearch-starter must then put v2 as dependency in their own pom.xml to override this.
We cannot do this automatic from Camel Spring Boot.

davsclaus:1669244907:2022-11-24T07:08:27.311+0000:1669244907:2022-11-24T07:08:27.311+0000:I have added a note in the docs about this. Spring Boot v3 is upgraded to ES 8.x so this should work better there out of the box.
https://github.com/apache/camel/commit/01f559487d520ff6694db8d6fc7ef3e81d1b8fdd
"
0,CAMEL-18749,Improvement,Major,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Kengo Seki,Kengo Seki,0,2,2022-11-24 05:22:47+00:00,2023-03-29 23:15:32+00:00,"camel-hdfs currently supports gzip and bzip2 compression, but HDFS supports some other codecs. I'd like to add snappy support as a first step.",davsclaus:1669243231:2022-11-24T06:40:31.938+0000:1669243231:2022-11-24T06:40:31.938+0000:Thanks for the PR
0,CAMEL-18748,Improvement,Major,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Claus Ibsen,Marat Gubaidullin,0,3,2022-11-23 21:11:15+00:00,2022-12-13 11:37:17+00:00,"Different properties for the ErrorHandler model in catalog and camelYamlDsl.json


https://github.com/apache/camel/blob/main/catalog/camel-catalog/src/generated/resources/org/apache/camel/catalog/models/errorHandler.json


and 


https://github.com/apache/camel/blob/30029a9f3f02befd111e57a301025d94fe565c73/dsl/camel-yaml-dsl/camel-yaml-dsl/src/generated/resources/schema/camelYamlDsl.json#L760","klease78:1670322361:2022-12-06T18:26:01.032+0000:1670322361:2022-12-06T18:26:01.032+0000:If we want to enforce that only one kind of error handler can be specified, we can do it like this in the schema camelYamlDsl:
{code:java}
""oneOf"": [
         {""required"": [""deadLetterChannel""]},
         {""required"": [""defaultErrorHandler""]},
         {""required"": [""noErrorHandler""]},
         {""required"": [""jtaTransactionErrorHandler""]},
         {""required"": [""springTransactionErrorHandler""]}
         ]{code}
But while trying to validate a yaml file with this, I found that this kind of errorHandler (org.apache.camel.model.ErrorHandlerDefinition) is only referenced from org.apache.camel.model.RouteConfigurationDefinition which itself is not referenced in the schema because the ""route-configuration"" key is not present in the list of top-level properties listed in the schema.
I'm not sure if that's intentional or not.
davsclaus:1670811810:2022-12-12T10:23:30.950+0000:1670811810:2022-12-12T10:23:30.950+0000:This is because error handler has always been special and is specially in Spring/Blueprint XML DSL and Java DSL has its own way as well. And now YAML DSL has that too.

CAMEL-18216 is a ticket to use the same error handler from model across all DSLs, but its tricky to do this and keep backwards compatible.
davsclaus:1670849758:2022-12-12T20:55:58.581+0000:1670849758:2022-12-12T20:55:58.581+0000:The route configuration has been added for 3.20, and also did some fixes in the custom de-serializer as it was a bit wrong

A little example here
https://github.com/apache/camel-kamelets-examples/tree/main/jbang/error-handler"
0,CAMEL-18747,Improvement,Minor,3.20.0,4.0.0,"
None
",Resolved,Invalid,4.0.0,Otavio Rodolfo Piske,Otavio Rodolfo Piske,0,2,2022-11-23 13:52:32+00:00,2023-08-07 09:01:15+00:00,We are currently using 2.10.x and we should investigate upgrading Hadoop images to 3.x as the code should be compatible with that version.,"davsclaus:1689561487:2023-07-17T10:38:07.416+0000:1689561487:2023-07-17T10:38:07.416+0000:We only have camel-hdfs in v4 - is there anything more to do in this ticket?
orpiske:1689570350:2023-07-17T13:05:50.336+0000:1689570350:2023-07-17T13:05:50.336+0000:I think this is invalid. I was looking at test-infra and our HDFS infra is not based on container images anymore.
orpiske:1689570374:2023-07-17T13:06:14.738+0000:1689570374:2023-07-17T13:06:14.738+0000:HDFS infra is not based on containers anymore, therefore marking as invalid."
0,CAMEL-18746,Task,Major,3.18.3,"3.18.4, 3.20.0","
None
",Resolved,Fixed,"3.18.4, 3.20.0",Thomas Cunningham,Thomas Cunningham,0,2,2022-11-23 12:14:56+00:00,2022-11-24 06:41:23+00:00,"camel-spring-boot-3.18.x branch contains a debezium-db2-starter and a debezium-oracle-starter : 


https://github.com/apache/camel-spring-boot/tree/camel-spring-boot-3.18.x/components-starter/camel-debezium-db2-starter


https://github.com/apache/camel-spring-boot/tree/camel-spring-boot-3.18.x/components-starter/camel-debezium-oracle-starter


It looks like these have not been added as modules to components-starter: 


https://github.com/apache/camel-spring-boot/blob/main/components-starter/pom.xml


Should they be?","tcunning:1669176966:2022-11-23T12:16:06.101+0000:1669176966:2022-11-23T12:16:06.101+0000:Same issue on main branch (sorry I logged this under 3.18.3, saw it there first).
acosentino:1669177439:2022-11-23T12:23:59.287+0000:1669177439:2022-11-23T12:23:59.287+0000:Yes, they should be there. "
0,CAMEL-18745,New Feature,Minor,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Claus Ibsen,Claus Ibsen,0,1,2022-11-23 09:02:30+00:00,2022-11-24 14:19:01+00:00,We could add a function to access the original message body. However this requires end users to enable this feature (useOriginalMessage=true).,
0,CAMEL-18744,Improvement,Minor,None,4.0.0,"
None
",Resolved,Invalid,4.0.0,Otavio Rodolfo Piske,Otavio Rodolfo Piske,0,1,2022-11-23 07:33:00+00:00,2023-11-14 12:43:06+00:00,Currently we test PR changes only for core and components. We should also try to test changes for DSL components.,orpiske:1699936986:2023-11-14T12:43:06.610+0000:1699936986:2023-11-14T12:43:06.610+0000:This became invalid after the github actions changes we implemented during Camel 4 development.
0,CAMEL-18743,New Feature,Minor,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Andrea Cosentino,Claus Ibsen,0,2,2022-11-22 09:46:58+00:00,2022-12-06 12:44:20+00:00,"Finding a good name is hard, maybe


camel get count=total,error
1,0


camel get count=total,error
2,1


So this gets a count of total messages processed, failed messages


The idea is a way to quickly tell from tooling that Camel processed messaged and that there was no errors. And we need to ensure that it does not say 0 due to nothing has been processed at all, so we need to have output of total + error.",acosentino:1669081828:2022-11-22T09:50:28.774+0000:1669081828:2022-11-22T09:50:28.774+0000:This would be super helpful here for example: https://github.com/apache/camel-kamelets/tree/main/it-tests
0,CAMEL-18742,Task,Minor,None,3.21.0,"
None
",Resolved,Fixed,3.21.0,Zheng Feng,Zheng Feng,0,1,2022-11-22 02:04:27+00:00,2023-03-30 13:44:50+00:00,"We introduce a new property transactionStrategy in CAMEL-18450 and I think the transactionManager should be deprecated and removed in the future release since it should only be used in the DefaultTransactionStragtegy which depends on spring-tx.


Also camel-quarkus-jpa extension could be benefited from it. see https://github.com/apache/camel-quarkus/issues/4279",
0,CAMEL-18741,Test,Trivial,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Unassigned,Peter Palaga,0,2,2022-11-21 18:32:32+00:00,2022-11-21 20:05:16+00:00,"Steps to reproduce: run the js-dsl test in Camel Quarkus with GraalVM 22.3




2022-11-16T13:44:56.0069333Z Caused by: java.lang.AbstractMethodError: Receiver class com.oracle.truffle.polyglot.PolyglotEngineDispatch does not define or inherit an implementation of the resolved method 'abstract org.graalvm.polyglot.Context createContext(java.lang.Object, java.io.OutputStream, java.io.OutputStream, java.io.InputStream, boolean, org.graalvm.polyglot.HostAccess, org.graalvm.polyglot.PolyglotAccess, boolean, boolean, boolean, boolean, boolean, boolean, java.util.function.Predicate, java.util.Map, java.util.Map, java.lang.String[], org.graalvm.polyglot.io.FileSystem, java.lang.Object, boolean, org.graalvm.polyglot.io.ProcessHandler, org.graalvm.polyglot.EnvironmentAccess, java.util.Map, java.time.ZoneId, java.lang.Object, java.lang.String, java.lang.ClassLoader, boolean, boolean)' of abstract class org.graalvm.polyglot.impl.AbstractPolyglotImpl$AbstractEngineDispatch.
2022-11-16T13:44:56.0071305Z    at org.graalvm.polyglot.Context$Builder.build(Context.java:1861)
2022-11-16T13:44:56.0072044Z    at org.apache.camel.dsl.js.JavaScriptRoutesBuilderLoader.doLoadEndpointRouteBuilder(JavaScriptRoutesBuilderLoader.java:53)
2022-11-16T13:44:56.0072891Z    at org.apache.camel.builder.endpoint.EndpointRouteBuilder$2.configure(EndpointRouteBuilder.java:79)
2022-11-16T13:44:56.0073551Z    at org.apache.camel.builder.RouteBuilder.checkInitialized(RouteBuilder.java:677)
2022-11-16T13:44:56.0074171Z    at org.apache.camel.builder.RouteBuilder.configureRoutes(RouteBuilder.java:619)
2022-11-16T13:44:56.0074809Z    at org.apache.camel.builder.RouteBuilder.addRoutesToCamelContext(RouteBuilder.java:555)
2022-11-16T13:44:56.0075506Z    at org.apache.camel.impl.engine.AbstractCamelContext.addRoutes(AbstractCamelContext.java:1202)
2022-11-16T13:44:56.0076207Z    at org.apache.camel.main.RoutesConfigurer.addDiscoveredRoutes(RoutesConfigurer.java:237)
2022-11-16T13:44:56.0076869Z    at org.apache.camel.main.RoutesConfigurer.configureRoutes(RoutesConfigurer.java:212)
2022-11-16T13:44:56.0077491Z    at org.apache.camel.quarkus.main.CamelMain.configureRoutes(CamelMain.java:70)
2022-11-16T13:44:56.0078155Z    at org.apache.camel.main.BaseMainSupport.postProcessCamelContext(BaseMainSupport.java:703)
2022-11-16T13:44:56.0078802Z    at org.apache.camel.quarkus.main.CamelMain.initCamelContext(CamelMain.java:116)
2022-11-16T13:44:56.0079541Z    at org.apache.camel.quarkus.main.CamelMain.doInit(CamelMain.java:86)
2022-11-16T13:44:56.0080213Z    at org.apache.camel.support.service.BaseService.init(BaseService.java:83)
2022-11-16T13:44:56.0080819Z    at org.apache.camel.quarkus.main.CamelMain.startEngine(CamelMain.java:137)
2022-11-16T13:44:56.0081415Z    at org.apache.camel.quarkus.main.CamelMainRuntime.start(CamelMainRuntime.java:49)
2022-11-16T13:44:56.0082084Z    at org.apache.camel.quarkus.core.CamelBootstrapRecorder.start(CamelBootstrapRecorder.java:45)
2022-11-16T13:44:56.0082748Z    at io.quarkus.deployment.steps.CamelBootstrapProcessor$boot173480958.deploy_0(Unknown Source)
2022-11-16T13:44:56.0083355Z    at io.quarkus.deployment.steps.CamelBootstrapProcessor$boot173480958.deploy(Unknown Source)","davsclaus:1669028876:2022-11-21T19:07:56.446+0000:1669028876:2022-11-21T19:07:56.446+0000:I think you should create a ticket in camel-quarkus instead of here
davsclaus:1669029967:2022-11-21T19:26:07.020+0000:1669029967:2022-11-21T19:26:07.020+0000:camel uses graalvm 22.2.0 at the moment, so its maybe a matter of upgrading to newer version
davsclaus:1669030090:2022-11-21T19:28:10.738+0000:1669030090:2022-11-21T19:28:10.738+0000:Upgraded to the same version as camel-quarkus so assuming this fixes your issue
https://github.com/apache/camel/commit/24e4fd120fcebceb09c634ed5932d2f876cd4dab
ppalaga:1669031835:2022-11-21T19:57:15.885+0000:1669031835:2022-11-21T19:57:15.885+0000:Thanks [~davsclaus], yes, upgrading is essential. I just wonder whether there is no test in Camel that would show the same issue with the new version?
ppalaga:1669032316:2022-11-21T20:05:16.074+0000:1669032316:2022-11-21T20:05:16.074+0000:Ah, you are right, it is not Camel's fault. The problem is that Quarkus 2.14.1 upgraded from GraalVM 22.2 to 22.3 and at the same time, they do not manage org.graalvm.js:js. It is only managed in Camel Quarkus, so it got out of sync from the rest of GraalVM artifacts managed in Quarkus. Sorry for the noise!"
0,CAMEL-18740,New Feature,Minor,None,Future,"
None
",Open,Unresolved,Future,Unassigned,Bruno Meseguer,0,1,2022-11-21 16:02:29+00:00,2022-11-21 19:16:12+00:00,"In pursuit of better useability of Camel and future UI tooling, it would be ideal for implementing in Camel an automatic encapsulation of in/out data when invoking endpoints.


The following scenario is a typical processing flow in the enterprise:
1) receive client request
2) call system A
3) call system B
4) call system C
5) compose response (A'+ B'+ C')
6) reply to client


Camel is today 100% capable of letting the developer implement such workflow. If the developer wants to compose a response (step 5), then the sequence of calls above (A/B/C) require to manually keep responses in exchange properties. It requires from the developer to be well familiar with Camel to code the right actions. New users would find it very challenging at first to find the right approach.


Additionally, the current Camel mechanics of handling properties/headers/body do not provide a good enough level of support for UI tooling. A GUI user would still require a good understanding of Camel to accomplish such workflow.


This ticket proposes to provide Camel the ability to automatically handle external calls in such a way that response data is inmediately available for developers to easility compose the response data.


An example Exchange structure that Camel could self-populate is the following:


(config/inputs could be defined at design time, in code or GUI)
(outputs would be resolved at runtime)


Exchange
 - Consumer (1)
    - configuration
    - message (received) or (output)
        - headers
        - body
 - Producer (2)
    - configuration
    - message (sent) or (input)
        - headers
        - body
    - message (response) or (output)
        - headers
        - body
 - Producer (3)
    - configuration
    - message (sent) or (input)
        - headers
        - body
    - message (response) or (output)
        - headers
        - body
 - Producer (4)
    - configuration
    - message (sent) or (input)
        - headers
        - body
    - message (response) or (output)
        - headers
        - body
 - Mapping (5)
    - configuration
    - message (input)
        - headers
        - body
    - message (output)
        - headers
        - body
 - Response to client (automatic)


In the structure above, Camel has automatically created multiple objects inside the Exchange, where each endpoint interaction has been encapsulated. At design time, the Camel route could provide all the metadata (config/inputs) necessary to allow a GUI to easy present to the user information that can be used to configure other inputs.",
0,CAMEL-18739,Bug,Minor,3.19.0,3.20.0,"
None
",Resolved,Fixed,3.20.0,Claus Ibsen,Alexander Lex,0,2,2022-11-21 12:52:31+00:00,2022-12-14 18:00:55+00:00,"We are facing an issue where we end up with stale files in the temp directory (on Windows: C:\Users\...\AppData\Local\Temp). This stops our application from running.


 


Problem description:


When using ""Split Definition"" with ""ZipAggregationStrategy"", we try to aggregate multiple parts in one zip archive. Our Code does exactly that and works fine, but it misses the step to delete the temporaly created archive (created automactly) in the temp directory after completion.


 


We would expect that the completion of the route does the deletion.


 


Having a look in into the code, we saw that the ""ZipAggregationStrategy"" does have a ""DeleteZipFileOnCompletion"", which does exactly that. The ""OnCompletion"" is also added to the exchange. However,  the deletion is never executed, due to a copy of the subexchange to the original exchange (losing the previously added onComplete)


 


Attached you can find code to reproduce the issue.","davsclaus:1669006561:2022-11-21T12:56:01.343+0000:1669006561:2022-11-21T12:56:01.343+0000:Can you attach the reproducer as tar or zip (not 7z)
AlexanderLex:1669007336:2022-11-21T13:08:56.671+0000:1669007336:2022-11-21T13:08:56.671+0000:Maybe it helps to add:

 

// must copy results at this point
if (subExchange != null) {
    if (stoppedOnException) {
        // if we stopped due an exception then only propagate the exception
        original.setException(subExchange.getException());
    } else {
        // copy the current result to original so it will contain this result of this eip
        ExchangeHelper.copyResults(original, subExchange);
        *subExchange.adapt(ExtendedExchange.class).handoverCompletions(original);*
    }
}

 

to

MulticastProcessor.java

 
AlexanderLex:1669709791:2022-11-29T16:16:31.237+0000:1669709791:2022-11-29T16:16:31.237+0000:Added a PR:

 

https://github.com/apache/camel/pull/8795
davsclaus:1671011739:2022-12-14T17:55:39.521+0000:1671011739:2022-12-14T17:55:39.521+0000:Did the same fix for camel-tarfile
davsclaus:1671012055:2022-12-14T18:00:55.014+0000:1671012055:2022-12-14T18:00:55.014+0000:Thanks for reporting and the PR and unit test"
0,CAMEL-18738,Dependency upgrade,Minor,None,None,"
None
",Resolved,Fixed,"4.0-M1, 4.0.0",Unassigned,Claus Ibsen,0,1,2022-11-21 12:01:22+00:00,2023-01-30 08:59:44+00:00,This requires java 17 and therefore target for camel v4,
0,CAMEL-18737,Bug,Major,3.19.0,"3.18.5, 3.20.0","
None
",Resolved,Fixed,"3.18.5, 3.20.0",Luigi De Masi,Luigi De Masi,0,1,2022-11-21 11:16:28+00:00,2022-12-02 14:44:22+00:00,"When trying to instantiate a bean using the constructor like this:




spec:
  template:
    beans:
      - name: myBean
        type: '#class:com.mycompany.MyBean({{propA}}, {{propb}})'




property substitution does not happen.",
0,CAMEL-18736,Bug,Minor,3.18.3,"3.18.4, 3.20.0","
None
",Resolved,Fixed,"3.18.4, 3.20.0",Unassigned,Dave Riseley,0,2,2022-11-21 10:07:30+00:00,2022-11-21 19:15:58+00:00,"We have a project that depends on both camel-cxf-spring-rest.jar and camel-cxf-spring-soap.jar. These both ship with identically named schema/cxfEndpoint.xsd resources:


https://github.com/apache/camel/blob/main/components/camel-cxf/camel-cxf-spring-rest/src/main/resources/schema/cxfEndpoint.xsd


https://github.com/apache/camel/blob/main/components/camel-cxf/camel-cxf-spring-soap/src/main/resources/schema/cxfEndpoint.xsd


which are referenced in spring.schema files:


https://github.com/apache/camel/blob/main/components/camel-cxf/camel-cxf-spring-rest/src/main/resources/META-INF/spring.schemas


https://github.com/apache/camel/blob/main/components/camel-cxf/camel-cxf-spring-soap/src/main/resources/META-INF/spring.schemas


 


However as the classpath resource schema/cxfEndpoint.xsd is duplicated in both modules we get issues when both dependencies are added to the application such as:


Caused by: org.xml.sax.SAXParseException: TargetNamespace.1: Expecting namespace 'http://camel.apache.org/schema/cxf/jaxws', but the target namespace of the schema document is 'http://camel.apache.org/schema/cxf/jaxrs'.
    at java.xml/com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.createSAXParseException(ErrorHandlerWrapper.java:204)


i.e. the jaxws spring.schemas file has loaded the jaxrs schema.


Could the xsd's be renamed to be unique (eg schema/cxfJaxwsEndpoint.xsd  and schema/cxfJaxrsEndpoint.xsd ) and the respective spring.schema files updated to avoid this classpath conflict?


This issue is blocking our upgrade from 3.16.x to 3.18.x","davsclaus:1668997524:2022-11-21T10:25:24.275+0000:1668997524:2022-11-21T10:25:24.275+0000:How do you run Camel
daveroa:1668997675:2022-11-21T10:27:55.566+0000:1668997675:2022-11-21T10:27:55.566+0000:It's run inside a spring boot application - hosting both soap and rest services
davsclaus:1668997753:2022-11-21T10:29:13.921+0000:1668997753:2022-11-21T10:29:13.921+0000:Thanks for reporting, can you maybe send a PR with the renames for us to review. 
daveroa:1668997819:2022-11-21T10:30:19.821+0000:1668997819:2022-11-21T10:30:19.821+0000:Will do
daveroa:1669023088:2022-11-21T17:31:28.692+0000:1669023088:2022-11-21T17:31:28.692+0000:I have raised the following PR for this: https://github.com/apache/camel/pull/8753
davsclaus:1669029358:2022-11-21T19:15:58.483+0000:1669029358:2022-11-21T19:15:58.483+0000:Thanks for reporting and the PR"
0,CAMEL-18735,Improvement,Minor,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Claus Ibsen,Claus Ibsen,0,1,2022-11-21 09:47:20+00:00,2022-11-21 11:56:59+00:00,"Because auto assigned route ids may be harder for monitoring tooling to filter out


https://github.com/apache/camel/commit/5ab1e7783431ceebab3b7f143650a51837745d55#diff-6af6b3af5046914db32bc1e0f49ae935a728e42531a688a8e6ecb20a01077ab3R734",
0,CAMEL-18734,Task,Minor,None,None,"
None
",Resolved,Fixed,3.20.0,Claus Ibsen,Claus Ibsen,0,1,2022-11-20 14:49:55+00:00,2022-11-21 10:35:08+00:00,camel-micrometer is the recommended approach,
0,CAMEL-18733,Bug,Major,None,3.20.0,"
None
",Resolved,Not A Bug,3.20.0,Claus Ibsen,Claus Ibsen,0,1,2022-11-20 10:26:30+00:00,2022-11-24 10:38:11+00:00,"When you have 2+ routes, then the metrics for exchanges total etc not per route, but override each other.","davsclaus:1669193855:2022-11-23T16:57:35.982+0000:1669193855:2022-11-23T16:57:35.982+0000:Ah okay so the names are unique via tags. However there is a little bit odd api to use.
And in jbang we have a chicken-egg situation where micrometer are in use in the route, but you want to also enable it for route policy."
0,CAMEL-18732,Improvement,Minor,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Claus Ibsen,Claus Ibsen,0,1,2022-11-20 10:18:36+00:00,2022-11-21 10:32:28+00:00,"The route policy metrics do not include description of the metrics, which tooling can use to show to humans.


Also the route description is optional and should only be in tags if present.",
0,CAMEL-18731,Improvement,Major,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Nicolas Filotto,Claus Ibsen,0,2,2022-11-19 16:43:15+00:00,2022-11-26 09:25:22+00:00,"Some of the languages have


    @XmlAttribute(name = ""resultType"")
    private String resultTypeName;
    @XmlTransient
    private Class<?> resultType;
    @XmlAttribute
    @Metadata(label = ""advanced"")
    private String headerName;
    @Metadata(label = ""advanced"")
    private String propertyName;


We need to have this for more languages (all but not)



header
exchange property



So we could maybe have a class that extends ExpressionDefinition and then have the above options which other languages can extend to make it reuable and consistent.


This then also requires to update



reifier
builder","davsclaus:1668847521:2022-11-19T16:45:21.991+0000:1668847521:2022-11-19T16:45:21.991+0000:[~essobedo] I wonder if you can help with this? You recently did the great work on the language fluent builder. We have some inconsistency in languages. By allowing more of them to easily get their input from a header/property, and as well to set the output class type. 
davsclaus:1668847566:2022-11-19T16:46:06.321+0000:1668847566:2022-11-19T16:46:06.321+0000:See this PR for inspiration
https://github.com/apache/camel/commit/ca3e54436e8b4bd4242e577b2b05de589a7e56ba
nfilotto:1668995674:2022-11-21T09:54:34.444+0000:1668995674:2022-11-21T09:54:34.444+0000:Ok no problem, I will have a look to this ticket asap
nfilotto:1669350023:2022-11-25T12:20:23.756+0000:1669350023:2022-11-25T12:20:23.756+0000:The corresponding PR https://github.com/apache/camel/pull/8778"
0,CAMEL-18730,Bug,Major,"3.18.3, 3.19.0",None,"
None
",Resolved,Fixed,"3.14.7, 3.18.4, 3.20.0",Nicolas Filotto,Nicolas Filotto,0,1,2022-11-19 11:43:36+00:00,2022-11-21 10:10:54+00:00,"After generating the route coverage of the tests, if we launch the maven command mvn camel-report:route-coverage, the plugin fails with the next error:



[ERROR] Failed to execute goal org.apache.camel:camel-report-maven-plugin:3.20.0-SNAPSHOT:route-coverage (default-cli) on project camel-example-main: Execution default-cli of goal org.apache.camel:camel-report-maven-plugin:3.20.0-SNAPSHOT:route-coverage failed: A required class was missing while executing org.apache.camel:camel-report-maven-plugin:3.20.0-SNAPSHOT:route-coverage: edu/emory/mathcs/backport/java/util/Collections
[ERROR] -----------------------------------------------------
[ERROR] realm =    plugin>org.apache.camel:camel-report-maven-plugin:3.20.0-SNAPSHOT
[ERROR] strategy = org.codehaus.plexus.classworlds.strategy.SelfFirstStrategy
[ERROR] urls[0] = file:/Users/foo/.m2/repository/org/apache/camel/camel-report-maven-plugin/3.20.0-SNAPSHOT/camel-report-maven-plugin-3.20.0-SNAPSHOT.jar
[ERROR] urls[1] = file:/Users/foo/.m2/repository/org/apache/httpcomponents/httpclient/4.5.13/httpclient-4.5.13.jar
[ERROR] urls[2] = file:/Users/foo/.m2/repository/commons-logging/commons-logging/1.2/commons-logging-1.2.jar
[ERROR] urls[3] = file:/Users/foo/.m2/repository/org/apache/httpcomponents/httpcore/4.4.15/httpcore-4.4.15.jar
[ERROR] urls[4] = file:/Users/foo/.m2/repository/commons-codec/commons-codec/1.15/commons-codec-1.15.jar
[ERROR] urls[5] = file:/Users/foo/.m2/repository/org/codehaus/mojo/exec-maven-plugin/1.6.0/exec-maven-plugin-1.6.0.jar
[ERROR] urls[6] = file:/Users/foo/.m2/repository/org/codehaus/plexus/plexus-utils/3.3.0/plexus-utils-3.3.0.jar
[ERROR] urls[7] = file:/Users/foo/.m2/repository/org/apache/commons/commons-exec/1.3/commons-exec-1.3.jar
[ERROR] urls[8] = file:/Users/foo/.m2/repository/org/apache/maven/plugin-tools/maven-plugin-annotations/3.6.4/maven-plugin-annotations-3.6.4.jar
[ERROR] urls[9] = file:/Users/foo/.m2/repository/org/apache/camel/camel-core/3.20.0-SNAPSHOT/camel-core-3.20.0-SNAPSHOT.jar
[ERROR] urls[10] = file:/Users/foo/.m2/repository/org/apache/camel/camel-core-engine/3.20.0-SNAPSHOT/camel-core-engine-3.20.0-SNAPSHOT.jar
[ERROR] urls[11] = file:/Users/foo/.m2/repository/org/apache/camel/camel-api/3.20.0-SNAPSHOT/camel-api-3.20.0-SNAPSHOT.jar
[ERROR] urls[12] = file:/Users/foo/.m2/repository/org/apache/camel/camel-base-engine/3.20.0-SNAPSHOT/camel-base-engine-3.20.0-SNAPSHOT.jar
[ERROR] urls[13] = file:/Users/foo/.m2/repository/org/apache/camel/camel-base/3.20.0-SNAPSHOT/camel-base-3.20.0-SNAPSHOT.jar
[ERROR] urls[14] = file:/Users/foo/.m2/repository/org/apache/camel/camel-core-reifier/3.20.0-SNAPSHOT/camel-core-reifier-3.20.0-SNAPSHOT.jar
[ERROR] urls[15] = file:/Users/foo/.m2/repository/org/apache/camel/camel-core-processor/3.20.0-SNAPSHOT/camel-core-processor-3.20.0-SNAPSHOT.jar
[ERROR] urls[16] = file:/Users/foo/.m2/repository/org/apache/camel/camel-management-api/3.20.0-SNAPSHOT/camel-management-api-3.20.0-SNAPSHOT.jar
[ERROR] urls[17] = file:/Users/foo/.m2/repository/org/apache/camel/camel-support/3.20.0-SNAPSHOT/camel-support-3.20.0-SNAPSHOT.jar
[ERROR] urls[18] = file:/Users/foo/.m2/repository/org/apache/camel/camel-util/3.20.0-SNAPSHOT/camel-util-3.20.0-SNAPSHOT.jar
[ERROR] urls[19] = file:/Users/foo/.m2/repository/org/apache/camel/camel-core-languages/3.20.0-SNAPSHOT/camel-core-languages-3.20.0-SNAPSHOT.jar
[ERROR] urls[20] = file:/Users/foo/.m2/repository/org/apache/camel/camel-core-model/3.20.0-SNAPSHOT/camel-core-model-3.20.0-SNAPSHOT.jar
[ERROR] urls[21] = file:/Users/foo/.m2/repository/org/apache/camel/camel-bean/3.20.0-SNAPSHOT/camel-bean-3.20.0-SNAPSHOT.jar
[ERROR] urls[22] = file:/Users/foo/.m2/repository/org/apache/camel/camel-browse/3.20.0-SNAPSHOT/camel-browse-3.20.0-SNAPSHOT.jar
[ERROR] urls[23] = file:/Users/foo/.m2/repository/org/apache/camel/camel-cluster/3.20.0-SNAPSHOT/camel-cluster-3.20.0-SNAPSHOT.jar
[ERROR] urls[24] = file:/Users/foo/.m2/repository/org/apache/camel/camel-controlbus/3.20.0-SNAPSHOT/camel-controlbus-3.20.0-SNAPSHOT.jar
[ERROR] urls[25] = file:/Users/foo/.m2/repository/org/apache/camel/camel-dataformat/3.20.0-SNAPSHOT/camel-dataformat-3.20.0-SNAPSHOT.jar
[ERROR] urls[26] = file:/Users/foo/.m2/repository/org/apache/camel/camel-dataset/3.20.0-SNAPSHOT/camel-dataset-3.20.0-SNAPSHOT.jar
[ERROR] urls[27] = file:/Users/foo/.m2/repository/org/apache/camel/camel-direct/3.20.0-SNAPSHOT/camel-direct-3.20.0-SNAPSHOT.jar
[ERROR] urls[28] = file:/Users/foo/.m2/repository/org/apache/camel/camel-directvm/3.20.0-SNAPSHOT/camel-directvm-3.20.0-SNAPSHOT.jar
[ERROR] urls[29] = file:/Users/foo/.m2/repository/org/apache/camel/camel-file/3.20.0-SNAPSHOT/camel-file-3.20.0-SNAPSHOT.jar
[ERROR] urls[30] = file:/Users/foo/.m2/repository/org/apache/camel/camel-health/3.20.0-SNAPSHOT/camel-health-3.20.0-SNAPSHOT.jar
[ERROR] urls[31] = file:/Users/foo/.m2/repository/org/apache/camel/camel-language/3.20.0-SNAPSHOT/camel-language-3.20.0-SNAPSHOT.jar
[ERROR] urls[32] = file:/Users/foo/.m2/repository/org/apache/camel/camel-log/3.20.0-SNAPSHOT/camel-log-3.20.0-SNAPSHOT.jar
[ERROR] urls[33] = file:/Users/foo/.m2/repository/org/apache/camel/camel-mock/3.20.0-SNAPSHOT/camel-mock-3.20.0-SNAPSHOT.jar
[ERROR] urls[34] = file:/Users/foo/.m2/repository/org/apache/camel/camel-ref/3.20.0-SNAPSHOT/camel-ref-3.20.0-SNAPSHOT.jar
[ERROR] urls[35] = file:/Users/foo/.m2/repository/org/apache/camel/camel-rest/3.20.0-SNAPSHOT/camel-rest-3.20.0-SNAPSHOT.jar
[ERROR] urls[36] = file:/Users/foo/.m2/repository/org/apache/camel/camel-saga/3.20.0-SNAPSHOT/camel-saga-3.20.0-SNAPSHOT.jar
[ERROR] urls[37] = file:/Users/foo/.m2/repository/org/apache/camel/camel-scheduler/3.20.0-SNAPSHOT/camel-scheduler-3.20.0-SNAPSHOT.jar
[ERROR] urls[38] = file:/Users/foo/.m2/repository/org/apache/camel/camel-seda/3.20.0-SNAPSHOT/camel-seda-3.20.0-SNAPSHOT.jar
[ERROR] urls[39] = file:/Users/foo/.m2/repository/org/apache/camel/camel-stub/3.20.0-SNAPSHOT/camel-stub-3.20.0-SNAPSHOT.jar
[ERROR] urls[40] = file:/Users/foo/.m2/repository/org/apache/camel/camel-timer/3.20.0-SNAPSHOT/camel-timer-3.20.0-SNAPSHOT.jar
[ERROR] urls[41] = file:/Users/foo/.m2/repository/org/apache/camel/camel-validator/3.20.0-SNAPSHOT/camel-validator-3.20.0-SNAPSHOT.jar
[ERROR] urls[42] = file:/Users/foo/.m2/repository/org/apache/camel/camel-vm/3.20.0-SNAPSHOT/camel-vm-3.20.0-SNAPSHOT.jar
[ERROR] urls[43] = file:/Users/foo/.m2/repository/org/apache/camel/camel-xpath/3.20.0-SNAPSHOT/camel-xpath-3.20.0-SNAPSHOT.jar
[ERROR] urls[44] = file:/Users/foo/.m2/repository/org/apache/camel/camel-xslt/3.20.0-SNAPSHOT/camel-xslt-3.20.0-SNAPSHOT.jar
[ERROR] urls[45] = file:/Users/foo/.m2/repository/org/apache/camel/camel-xml-jaxb/3.20.0-SNAPSHOT/camel-xml-jaxb-3.20.0-SNAPSHOT.jar
[ERROR] urls[46] = file:/Users/foo/.m2/repository/jakarta/xml/bind/jakarta.xml.bind-api/2.3.3/jakarta.xml.bind-api-2.3.3.jar
[ERROR] urls[47] = file:/Users/foo/.m2/repository/jakarta/activation/jakarta.activation-api/1.2.2/jakarta.activation-api-1.2.2.jar
[ERROR] urls[48] = file:/Users/foo/.m2/repository/com/sun/xml/bind/jaxb-core/2.3.0/jaxb-core-2.3.0.jar
[ERROR] urls[49] = file:/Users/foo/.m2/repository/com/sun/xml/bind/jaxb-impl/2.3.3/jaxb-impl-2.3.3.jar
[ERROR] urls[50] = file:/Users/foo/.m2/repository/com/sun/activation/jakarta.activation/1.2.2/jakarta.activation-1.2.2.jar
[ERROR] urls[51] = file:/Users/foo/.m2/repository/org/apache/camel/camel-xml-jaxp/3.20.0-SNAPSHOT/camel-xml-jaxp-3.20.0-SNAPSHOT.jar
[ERROR] urls[52] = file:/Users/foo/.m2/repository/org/apache/camel/camel-xml-io-util/3.20.0-SNAPSHOT/camel-xml-io-util-3.20.0-SNAPSHOT.jar
[ERROR] urls[53] = file:/Users/foo/.m2/repository/org/apache/camel/camel-catalog/3.20.0-SNAPSHOT/camel-catalog-3.20.0-SNAPSHOT.jar
[ERROR] urls[54] = file:/Users/foo/.m2/repository/org/apache/camel/camel-core-catalog/3.20.0-SNAPSHOT/camel-core-catalog-3.20.0-SNAPSHOT.jar
[ERROR] urls[55] = file:/Users/foo/.m2/repository/org/apache/camel/camel-util-json/3.20.0-SNAPSHOT/camel-util-json-3.20.0-SNAPSHOT.jar
[ERROR] urls[56] = file:/Users/foo/.m2/repository/org/apache/camel/camel-tooling-model/3.20.0-SNAPSHOT/camel-tooling-model-3.20.0-SNAPSHOT.jar
[ERROR] urls[57] = file:/Users/foo/.m2/repository/org/apache/camel/camel-catalog-lucene/3.20.0-SNAPSHOT/camel-catalog-lucene-3.20.0-SNAPSHOT.jar
[ERROR] urls[58] = file:/Users/foo/.m2/repository/org/apache/lucene/lucene-core/8.11.1/lucene-core-8.11.1.jar
[ERROR] urls[59] = file:/Users/foo/.m2/repository/org/apache/lucene/lucene-suggest/8.11.1/lucene-suggest-8.11.1.jar
[ERROR] urls[60] = file:/Users/foo/.m2/repository/org/apache/lucene/lucene-analyzers-common/8.11.1/lucene-analyzers-common-8.11.1.jar
[ERROR] urls[61] = file:/Users/foo/.m2/repository/org/apache/camel/camel-catalog-maven/3.20.0-SNAPSHOT/camel-catalog-maven-3.20.0-SNAPSHOT.jar
[ERROR] urls[62] = file:/Users/foo/.m2/repository/org/codehaus/groovy/groovy/3.0.12/groovy-3.0.12.jar
[ERROR] urls[63] = file:/Users/foo/.m2/repository/org/apache/ivy/ivy/2.5.1/ivy-2.5.1.jar
[ERROR] urls[64] = file:/Users/foo/.m2/repository/org/apache/camel/camel-allcomponents/3.20.0-SNAPSHOT/camel-allcomponents-3.20.0-SNAPSHOT.pom
[ERROR] urls[65] = file:/Users/foo/.m2/repository/org/apache/camel/camel-route-parser/3.20.0-SNAPSHOT/camel-route-parser-3.20.0-SNAPSHOT.jar
[ERROR] urls[66] = file:/Users/foo/.m2/repository/org/apache/camel/camel-tooling-util/3.20.0-SNAPSHOT/camel-tooling-util-3.20.0-SNAPSHOT.jar
[ERROR] urls[67] = file:/Users/foo/.m2/repository/org/jboss/forge/roaster/roaster-api/2.26.0.Final/roaster-api-2.26.0.Final.jar
[ERROR] urls[68] = file:/Users/foo/.m2/repository/org/jboss/forge/roaster/roaster-jdt/2.26.0.Final/roaster-jdt-2.26.0.Final.jar
[ERROR] Number of foreign imports: 1
[ERROR] import: Entry[import  from realm ClassRealm[maven.api, parent: null]]
[ERROR] 
[ERROR] -----------------------------------------------------
[ERROR] : edu.emory.mathcs.backport.java.util.Collections
[ERROR] -> [Help 1]
[ERROR]","nfilotto:1668829704:2022-11-19T11:48:24.727+0000:1668829704:2022-11-19T11:48:24.727+0000:The corresponding PR https://github.com/apache/camel/pull/8731
nfilotto:1668995604:2022-11-21T09:53:24.541+0000:1668995604:2022-11-21T09:53:24.541+0000:The version 3.14.7 doesn't exist yet, if someone could add it to the JIRA project and add it to the list of the fix versions of this ticket, it would be great. Thx in advance
nfilotto:1668996654:2022-11-21T10:10:54.473+0000:1668996654:2022-11-21T10:10:54.473+0000:Thx [~davsclaus]"
0,CAMEL-18729,Test,Major,None,"3.18.4, 3.20.0","
None
",Resolved,Fixed,"3.18.4, 3.20.0",Freeman Yue Fang,Freeman Yue Fang,1,2,2022-11-18 19:22:32+00:00,2022-11-28 08:32:13+00:00,"1. migrate those tests from camel-cxf-soap which use spring xml configuration to java bean configuration(which is the first citizen/ best practice in spring boot)
2. use undertow based servlet transport instead of the embedded http-jetty transport
3. add more cusmtomerized Undertow Handlers tests","davsclaus:1669239188:2022-11-24T05:33:08.489+0000:1669239188:2022-11-24T05:33:08.489+0000:Hi [~ffang]

The 3.19.0 is a non-LTS release, so please do not push commits to this, only do this on LTS branches.
ffang:1669269618:2022-11-24T14:00:18.099+0000:1669269618:2022-11-24T14:00:18.099+0000:Hi [~davsclaus],

Thanks for the reminder, reverted on 3.19.x branches.
Sorry about it.

Freeman"
0,CAMEL-18728,Bug,Minor,3.19.0,3.20.0,"
None
",Resolved,Fixed,3.20.0,Unassigned,Ludovic Boutros,0,1,2022-11-18 16:45:43+00:00,2022-11-19 18:31:07+00:00,"Currently we cannot use the new Elasticsearch component in the Endpoint DSL because there is a component name clash.


We need to update the old deprecated component class name in order to let the build process generate the correct catalog descriptor and the needed classes and function in the dsl code.",
0,CAMEL-18727,Improvement,Minor,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Claus Ibsen,Claus Ibsen,0,1,2022-11-18 15:17:45+00:00,2022-11-21 10:32:15+00:00,"camel get micrometer
  PID   NAME         TYPE     NAME                                VALUE  MEAN  MAX  TOTAL
 65332  ChaosMonkey  counter  CamelExchangesExternalRedeliveries
 65332  ChaosMonkey  counter  CamelExchangesFailed
 65332  ChaosMonkey  counter  CamelExchangesFailuresHandled
 65332  ChaosMonkey  counter  CamelExchangesSucceeded                 1
 65332  ChaosMonkey  counter  CamelExchangesTotal                     1
 65332  ChaosMonkey  counter  messages                                1
 65332  ChaosMonkey  timer    CamelRoutePolicy                        1    26   26     26


All the CamelXXX should be able to filter out via some new boolean option",
0,CAMEL-18726,Task,Major,None,None,"
None
",Closed,Invalid,None,Claudio Miranda,Claudio Miranda,0,2,2022-11-18 13:46:52+00:00,2022-11-18 14:40:47+00:00,"Migrate all camel-k-runtime quarkus extensions into camel-quarkus project.


camel-k-runtime used to host some camel components and its quarkus extensions suitable for camel-k project, however today all camel components are already in camel, only the quarkus extensions remained in camel-k-runtime project.


It seems appropriate to move all camel-k-runtime quarkus extensions into camel-quarkus project.","acosentino:1668751702:2022-11-18T14:08:22.014+0000:1668751702:2022-11-18T14:08:22.014+0000:I think this should go in Camel-Quarkus issues and camel-k issues, not in the Camel JIRA. It's not really related to Camel at all.
claudio4j:1668753619:2022-11-18T14:40:19.949+0000:1668753619:2022-11-18T14:40:19.949+0000:yes, makes sense, thanks for the heads up Andrea."
0,CAMEL-18725,New Feature,Major,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Claus Ibsen,Claus Ibsen,0,1,2022-11-17 14:41:24+00:00,2022-11-21 14:06:40+00:00,Just a reminder to see that camel top does what we have in the camel karaf route profile command that are great value to users,"davsclaus:1669010209:2022-11-21T13:56:49.427+0000:1669010209:2022-11-21T13:56:49.427+0000:https://github.com/apache/camel/blob/camel-2.25.x/platforms/commands/commands-core/src/main/java/org/apache/camel/commands/RouteProfileCommand.java
davsclaus:1669010800:2022-11-21T14:06:40.343+0000:1669010800:2022-11-21T14:06:40.343+0000:Yes you can use

camel top processor
camel top route
camel top context

To have various such data"
0,CAMEL-18724,Improvement,Trivial,3.19.0,3.20.0,"
None
",Resolved,Fixed,3.20.0,Karen Lease,Raymond,0,2,2022-11-16 08:20:04+00:00,2022-11-18 14:10:39+00:00,"In the documentation of the throttle EIP:


https://camel.apache.org/components/next/eips/throttle-eip.html


There are several Boolean options like:


**



asyncDelayed
rejectExecution
disabled{}



According to the documentation, they don't have default options, but every optional value has one:



asyncDelayed (Default=true)
rejectExecution (Default=false)
disabled (Default=false)
**



See: https://github.com/apache/camel/blob/main/core/camel-core-model/src/generated/resources/org/apache/camel/model/throttle.json


Maybe clearer to add them","skin27:1668558338:2022-11-16T08:25:38.845+0000:1668558338:2022-11-16T08:25:38.845+0000:I can create a PR myself, but don't know which file to change.

There is this page:

[https://github.com/apache/camel/blob/main/core/camel-core-engine/src/main/docs/modules/eips/pages/throttle-eip.adoc]

But that one links to: [partial$eip-options.adoc|https://github.com/apache/camel/blob/main/core/camel-core-engine/src/main/docs/modules/eips/pages/partial$eip-options.adoc]

It seems that this page gets its values from a json file, but it doesn't seem to be

[https://github.com/apache/camel/blob/main/core/camel-core-model/src/generated/resources/org/apache/camel/model/throttle.json]

As this file is generated and already contains the default.

Should the PR made for main or for example 2.20.x branch?
klease78:1668566786:2022-11-16T10:46:26.592+0000:1668566786:2022-11-16T10:46:26.592+0000:[~skin27] I think the problem is in [eip-options.adoc|https://github.com/apache/camel/blob/main/core/camel-core-engine/src/main/docs/modules/eips/partials/eip-options.adoc] which generates the html like this
{code:java}
 | value.defaultValue ? `${value.defaultValue}` : """" \
{code}
If defaultValue is false, the empty string is used.
But [endpoint options|https://github.com/apache/camel/blob/main/docs/components/modules/ROOT/partials/component-endpoint-options.adoc] uses this expression: 
{code:java}
|util.valueAsString(value.defaultValue)
{code}
In addition, I note that the options.adoc files for dataformats and languages use the expression ""util.defaultValue(value.defaultValue)"" but there is no defaultValue function defined in https://github.com/apache/camel-website/blob/main/util/jsonpath-util.js which perhaps explains why no default values appear in the website for those.

klease78:1668750646:2022-11-18T13:50:46.899+0000:1668750646:2022-11-18T13:50:46.899+0000:Changes for EIP, dataformat and languages checked in local website generation."
0,CAMEL-18723,Bug,Minor,3.14.2,,"
None
",Closed,Invalid,None,Unassigned,Kouame,0,2,2022-11-15 16:05:16+00:00,2022-11-15 16:15:20+00:00,"Hi all,


I want to know if it's possible to get the file name when error occured during local copy file in SftpOperations.


I have put an OnException but in the processor, i can't get the name of file because the message has been changed during 


GenericFileOperationFailedException","acosentino:1668499818:2022-11-15T16:10:18.678+0000:1668499818:2022-11-15T16:10:18.678+0000:Please ask on Zulip or user mailing list. Jira is for issues.
andrekouame:1668499912:2022-11-15T16:11:52.615+0000:1668500101:2022-11-15T16:15:01.179+0000:ok.

Thanks"
0,CAMEL-18722,Bug,Major,"3.18.2, 3.18.3","3.18.4, 3.20.0","
None
",Resolved,Fixed,"3.18.4, 3.20.0",Andrea Cosentino,Henrik Karlsson,0,2,2022-11-14 18:20:11+00:00,2022-11-22 07:06:24+00:00,When storing files to AWS S3 metadata like Content-Disposition isn't handled correctly by the camel-aws2-s3 component. It should be stored as 'Content-Disposition' but is stored as 'x-amz-meta-content-disposition'. Content-Type is stored as both 'Content-Type' and 'x-amz-meta-content-type'.,acosentino:1668422331:2022-11-14T18:38:51.875+0000:1668422331:2022-11-14T18:38:51.875+0000:I'll have a look. If you want to open a PR please do.
0,CAMEL-18721,New Feature,Minor,3.19.0,,"
None
",Open,Unresolved,None,Tadayoshi Sato,Tadayoshi Sato,0,2,2022-11-14 05:30:19+00:00,2023-07-17 10:38:43+00:00,"Similarly to CAMEL-18716, we can provide positional parameter completion for integration names and pids with camel top and camel stop:




$ camel top context [TAB]
$ camel stop [TAB]




But implementing this should be a bit trickier as the completion script needs to call back camel ps to get completion candidates. We can embed the completion by using Picocli's @Parameters completionCandidates attribute.","davsclaus:1678255986:2023-03-08T14:13:06.393+0000:1678255986:2023-03-08T14:13:06.393+0000:Yeah the completion is not dynamic
davsclaus:1678256502:2023-03-08T14:21:42.078+0000:1678256502:2023-03-08T14:21:42.078+0000:https://github.com/remkop/picocli/issues/506
davsclaus:1678256674:2023-03-08T14:24:34.027+0000:1678256674:2023-03-08T14:24:34.027+0000:We can possible have camel-jbang keep a special file up to date with current running camel integration names.
Then if we can get the completion script to load from the file instead of hardcoded values?

~/.camel/names

Then names is a text file with the current running names. When a camel is stopped, then we need to update the file, in camel-kamelet-main/camel-cli-connector.

davsclaus:1678256716:2023-03-08T14:25:16.415+0000:1678256716:2023-03-08T14:25:16.415+0000:[~tadayosi] not sure if you have ideas for custom completion script in bash/zsh where we read the names "
0,CAMEL-18720,Bug,Major,3.19.0,,"
None
",Resolved,Not A Bug,None,Unassigned,Tadayoshi Sato,0,2,2022-11-14 05:19:54+00:00,2022-12-04 11:46:09+00:00,"There seems to be a minor problem with selection of integrations based on their names with camel top commands. For example:




$ camel run a.java
$ camel run aa.java
$ camel run aaa.java




Then:




$ camel top context 
  PID    NAME  JAVA     CAMEL   PLATFORM  STATUS    AGE   LOAD        HEAP        NON-HEAP     GC     THREADS 
 131260  aa    11.0.17  3.19.0  Camel     Running  5m58s  0/0/0  267/656/8319 MB  62/66 MB  51ms (5)      8/9 
 131963  aaa   11.0.17  3.19.0  Camel     Running  5m52s  0/0/0  262/641/8319 MB  62/66 MB  38ms (5)      8/9 
 130555  a     11.0.17  3.19.0  Camel     Running   6m2s  0/0/0  130/645/8319 MB  62/66 MB  50ms (7)      8/9 




But:




$ camel top context a
  PID    NAME  JAVA     CAMEL   PLATFORM  STATUS    AGE   LOAD        HEAP       NON-HEAP     GC     THREADS 
 130555  a     11.0.17  3.19.0  Camel     Running  1m32s  0/0/0  95/645/8319 MB  60/64 MB  42ms (6)      8/9 
 131260  aa    11.0.17  3.19.0  Camel     Running  1m28s  0/0/0  95/656/8319 MB  60/63 MB  51ms (5)      8/9 
 131963  aaa   11.0.17  3.19.0  Camel     Running  1m22s  0/0/0  90/641/8319 MB  60/63 MB  38ms (5)      8/9 

$ camel top context aa
  PID    NAME  JAVA     CAMEL   PLATFORM  STATUS    AGE   LOAD        HEAP       NON-HEAP     GC     THREADS 
 130555  a     11.0.17  3.19.0  Camel     Running  1m35s  0/0/0  97/645/8319 MB  60/64 MB  42ms (6)      8/9 
 131260  aa    11.0.17  3.19.0  Camel     Running  1m31s  0/0/0  97/656/8319 MB  60/63 MB  51ms (5)      8/9 
 131963  aaa   11.0.17  3.19.0  Camel     Running  1m25s  0/0/0  92/641/8319 MB  60/63 MB  38ms (5)      8/9 

$  camel top context aaa
  PID    NAME  JAVA     CAMEL   PLATFORM  STATUS    AGE   LOAD        HEAP       NON-HEAP     GC     THREADS 
 131260  aa    11.0.17  3.19.0  Camel     Running  1m34s  0/0/0  97/656/8319 MB  60/63 MB  51ms (5)      8/9 
 131963  aaa   11.0.17  3.19.0  Camel     Running  1m28s  0/0/0  94/641/8319 MB  60/63 MB  38ms (5)      8/9 

$  camel top context aaaa
  PID    NAME  JAVA     CAMEL   PLATFORM  STATUS   AGE   LOAD        HEAP        NON-HEAP     GC     THREADS 
 131963  aaa   11.0.17  3.19.0  Camel     Running  2m6s  0/0/0  120/641/8319 MB  60/64 MB  38ms (5)      8/9 

$  camel top context aaaaa




PID based selection works fine.","davsclaus:1670125558:2022-12-04T11:45:58.532+0000:1670125558:2022-12-04T11:45:58.532+0000:This is because the name is using wildcard, so it becomes `a*` and that is by design so you do not have to type the full name."
0,CAMEL-18719,Bug,Minor,3.20.0,3.20.0,"
None
",Resolved,Fixed,3.20.0,Unassigned,Mrinal,0,2,2022-11-14 02:40:37+00:00,2022-11-22 08:28:12+00:00,"jbang --debug --verbose -Dcamel.jbang.version=3.20.0-SNAPSHOT ../CamelJBang.java  export --deps=org.apache.camel.quarkus:camel-quarkus-core:2.13.0 



The above command created an exported project with pom.xml with two camel-quarkus dependency.




    <dependencies>
        <dependency>
            <groupId>org.apache.camel.quarkus</groupId>
            <artifactId>camel-quarkus-core</artifactId>
        </dependency>
        <dependency>
            <groupId>org.apache.camel.quarkus</groupId>
            <artifactId>camel-quarkus-platform-http</artifactId>
        </dependency>
        <dependency>
            <groupId>org.apache.camel.quarkus</groupId>
            <artifactId>camel-quarkus-microprofile-health</artifactId>
        </dependency>
        <dependency>
            <groupId>org.apache.camel.quarkus</groupId>
            <artifactId>camel-quarkus-core</artifactId>
            <version>2.13.0</version>
        </dependency>
        <dependency>
            <groupId>org.apache.camel.quarkus</groupId>
            <artifactId>camel-quarkus-direct</artifactId>
        </dependency>
        <dependency>
            <groupId>org.apache.camel.quarkus</groupId>
            <artifactId>camel-quarkus-rest</artifactId>
        </dependency>
        <dependency>
            <groupId>org.apache.camel.quarkus</groupId>
            <artifactId>camel-quarkus-yaml-dsl</artifactId>
        </dependency>
        <dependency>
            <groupId></groupId>
            <artifactId>null</artifactId>
        </dependency>
        <dependency>
            <groupId>io.quarkus</groupId>
            <artifactId>quarkus-junit5</artifactId>
            <scope>test</scope>
        </dependency>
    </dependencies>","msharma:1668364970:2022-11-14T02:42:50.429+0000:1668364970:2022-11-14T02:42:50.429+0000:I am working on it.
davsclaus:1669076892:2022-11-22T08:28:12.466+0000:1669076892:2022-11-22T08:28:12.466+0000:Thanks for the PR"
0,CAMEL-18718,New Feature,Major,None,None,"
None
",Resolved,Fixed,3.20.0,Claus Ibsen,Claus Ibsen,0,2,2022-11-12 08:52:23+00:00,2022-11-20 16:45:48+00:00,"Lets see if we can use graalvm-sdk or graalvm-js that can compile and execute javascript code (with npm modules imported)


A dirty prototype




public static void main(String[] args) throws IOException {

        String src = ""import {faker} from '../js/node_modules/@faker-js/faker/dist/esm/index.mjs';"" +
                     ""const randomName = faker.name.fullName();"" +
                     ""console.log(randomName);"";
    
        Context cx = Context.newBuilder(""js"")
                    .allowIO(true)
                    .build();
    
        cx.eval(Source.newBuilder(""js"", src, ""test.mjs"").build());
    }




If we can then make this as a language in Camel then end users can more easily use this together with Camel.","msharma:1668933948:2022-11-20T16:45:48.979+0000:1668933948:2022-11-20T16:45:48.979+0000:I know this work is already completed but thought of documenting a good open-source solution that can be used in the future to evaluate JS if needed. It supports NodeJs also.

https://github.com/caoccao/Javet"
0,CAMEL-18717,Bug,Major,"3.18.3, 3.19.0","3.18.4, 3.20.0","
None
",Resolved,Fixed,"3.18.4, 3.20.0",Otavio Rodolfo Piske,Otavio Rodolfo Piske,0,1,2022-11-12 08:02:33+00:00,2022-11-24 10:26:12+00:00,"Quoting the report from an user on the users mailing list:


 


Hi All,


I'm upgrading Camel from 3.16 to 3.17 and found a problem that OffsetRepository didn't get update after manual commit.
It is a Spring boot project and MemoryStateRepository as follows.


        @Bean
        public MemoryStateRepository offsetRepo() {
                MemoryStateRepository stateRepository = new MemoryStateRepository();
                stateRepository.setState(topic + ""/0"", """");
                return stateRepository;
        }


Here is the method I use when commit:


        private void commitOffsetToKafka(Exchange exchange) {
                KafkaManualCommit manual = exchange.getIn().getHeader(KafkaConstants.MANUAL_COMMIT, KafkaManualCommit.class);
                manual.commit();
        }


Here is my Kafka endpoint


kafka:integration_test _topic?brokers=127.0.0.1:41478&autoCommitEnable=false&allowManualCommit=true&seekTo=beginning&maxPollRecords=2&groupId=ANE&autoOffsetReset=earliest&offsetRepository=#offsetRepo&kafkaManualCommitFactory=#class:org.apache.camel.component.kafka.consumer.DefaultKafkaManualCommitFactory


It is working fine in 3.16. When DefaultkafkaManualSyncCommit.commit() is invoked. The offsetRepository.setState() get invoked so the offset increased.
However, in 3.17, DefaultkafkaManualSyncCommit.commit() doesn't have a reference to offsetRepository so the offset in offsetRepository won't get increased.


Is this a bug or there is a different way to get the offset after committing. Could you please suggest what I should do to test if the offset get increased after manual commit?


 


This happened even after upgrading to Camel 3.18.3 as requested on the thread.


 


This needs to be investigated further.",orpiske:1669256751:2022-11-24T10:25:51.505+0000:1669256751:2022-11-24T10:25:51.505+0000:Backported to 3.18 with https://github.com/apache/camel/pull/8757.
0,CAMEL-18716,New Feature,Major,3.19.0,3.20.0,"
None
",Resolved,Fixed,3.20.0,Tadayoshi Sato,Tadayoshi Sato,1,1,2022-11-12 05:32:31+00:00,2022-11-17 00:32:10+00:00,"Shell completion is provided with CAMEL-18673, but file path completion for positional parameters such as:




$ camel run [TAB]
$ camel pipe [TAB]




doesn't work, because it seems Picocli disables the default fallback Bash completion.


To support such file path completion, it seems we need an enhancement to Picocli:
https://github.com/remkop/picocli/issues/1871
Discussing with the author of Picocli I found a way to implement it within Camel JBang.",
0,CAMEL-18715,Improvement,Minor,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Claus Ibsen,Claus Ibsen,0,1,2022-11-11 15:42:13+00:00,2022-12-04 11:07:57+00:00,"Today the dir is for local file system. But it may be nice to point to a github url, where you can have custom kamelets, and then load from there.",
0,CAMEL-18714,Improvement,Minor,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Claus Ibsen,Claus Ibsen,0,1,2022-11-11 15:28:37+00:00,2022-11-11 15:38:18+00:00,"With shell tab completion then its annoying when a command has an alias, eg during completion




~/workspace ❯ camel get
blocked           endpoint          events            int               micrometer        route             service           vault
circuit-breaker   endpoints         health            integration       processor         route-controller  services          vaults
context           event             inflight          integrations      processors        routes            source




eg endppoint vs endpoints etc",
0,CAMEL-18713,Bug,Minor,"3.14.4, 3.14.6, 3.18.2","3.14.7, 3.18.5, 3.20.0","
None
",Resolved,Fixed,"3.14.7, 3.18.5, 3.20.0",Claus Ibsen,Petr Holubec,0,1,2022-11-11 11:41:55+00:00,2022-12-04 12:18:25+00:00,"Description


I have a route constructed approximately like this:




processDefinition
  .process { ex -> // setup repeating }
  .loopDoWhile(RepeatingPredicate())
  .process { ex -> // prepare iteration }
  .process { ex -> // do work }
  .process { ex -> // finish iteration }
  .end()
  .process { ex -> // clean up repeating }




The route does some setup and then starts iterating - let's say 10 iterations when ""the work"" takes 10 seconds to complete.


Then, in the middle of processing (let's say during 5th iteration), I request Camel engine to shutdown with infinite timeout:




context.shutdownStrategy.timeout = Long.MAX_VALUE
context.stop()



But the Camel engine will shutdown immediately because it is not able to correctly detect current inflight requests.


Additional Info


More specifically, the ShutdownTask class tries to get inflight requests:



InflightRepository returns 1 which is correct number
but iterating over services returns negative number at the end
-> so the condition size > 0 is false which means no inflight requests



When going deeper, the LoopProcessor classes are the ones which return negative numbers of inflight requests.
Looks like the taskCount is not initialized because expression is null which means it's value is 0 but decremented several times
which will cause negative numbers to return.",
0,CAMEL-18712,Improvement,Minor,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Claus Ibsen,Claus Ibsen,0,1,2022-11-11 08:32:17+00:00,2022-11-11 12:31:23+00:00,"We can try to detect if modeline was in use or not, and only include the JAR if exported. As modeline requires a little overhead when included in runtime.",
0,CAMEL-18711,Bug,Minor,"3.14.6, 3.18.3, 3.19.0","3.18.4, 3.20.0","
None
",Resolved,Fixed,"3.18.4, 3.20.0",Claus Ibsen,Iliya Grushevskiy,0,2,2022-11-10 22:36:33+00:00,2022-11-11 10:19:49+00:00,"References to schema definitions are not generating correctly when classes defined in RestDefiniton type and outType have @Schema(name = ""..."") annotation. Older camel-swagger-java component doesn't have this issue.


Generated references contains full class name of defined class while schemas contains short names from annotations.


Also generated x-className extension of such classes doesn't contain class name but contain short name from annotation. 


see: https://issues.apache.org/jira/browse/CAMEL-15503","davsclaus:1668132336:2022-11-11T10:05:36.885+0000:1668132336:2022-11-11T10:05:36.885+0000:Thanks for reporting and the PR
iliya.gr:1668133189:2022-11-11T10:19:49.803+0000:1668133189:2022-11-11T10:19:49.803+0000:Can You please add this fix to 3.14?"
0,CAMEL-18710,Improvement,Major,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Claus Ibsen,Claus Ibsen,0,1,2022-11-10 13:05:25+00:00,2022-11-10 16:24:18+00:00,"We always include camel-kamelets and the -util JAR today. We should only include these if really in use.


This is related to export and dependencies command.",
0,CAMEL-18709,Improvement,Minor,3.14.2,,"

help-wanted

",Open,Unresolved,None,Unassigned,Michael Jensen Garde,0,1,2022-11-10 09:24:40+00:00,2023-11-14 13:21:30+00:00,"Hi


I have noticed some discrepancies between the HL7 component and the MLLP component in how the HL7 Sending Application message header (MSH-3) is extracted from an HL7 message and saved in their respective Camel exchange headers.


In short


The MSH-3 header may contain 3 components separated by ""hats"" (^)




namespace id^universal id^universal id type




Here is a couple of examples of how the two Camel components interpret these headers:


(1)


HL7 message MSH-3:



UNIVERSAL_ID



Camel exchange headers:




CamelHL7SendingApplication -> UNIVERSAL_ID
CamelMllpSendingApplication -> UNIVERSAL_ID



(2)


HL7 message MSH-3:




^UNIVERSAL_ID



Camel exchange headers:




CamelHL7SendingApplication -> null
CamelMllpSendingApplication -> ^UNIVERSAL_ID



(3)


HL7 message MSH-3:




^UNIVERSAL_ID^TYPE



Camel exchange headers:




CamelHL7SendingApplication -> null
CamelMllpSendingApplication -> ^UNIVERSAL_ID^TYPE



So...


I'm not entirely sure what expected behaviour should be. We expected to use the CamelHL7SendingApplication exchange header for validating the sending application Universal Id but as of now we can't really trust it. Similarly CamelMllpSendingApplication isn't useful for validating the Universal Id, otherwise we need to do a manual split of the exchange header and the we would rather just have a Terser do it for us instead. So right now, we just do this instead:




private static String getSendingSystemUniversalId(Message hl7Message) throws HL7Exception {
    Terser terser = new Terser(hl7Message);
    return terser.get(""MSH-3-2"");
} 



 


Link to the MSH-3 standard:


https://hl7-definition.caristix.com/v2/HL7v2.8/Fields/MSH.3",
0,CAMEL-18708,New Feature,Major,None,None,"
None
",Resolved,Abandoned,None,Unassigned,Claus Ibsen,0,2,2022-11-09 23:00:02+00:00,2023-11-22 20:06:48+00:00,"I wonder if we could have a sample dashboard for Grafana that end users with Camel on Kubernetes can use to setup a clustered dashboard to see Camel details.


End users can then use that as a starting point and customize if needed. This can help users to use Camel on kubernetes with more success, as they can better get Camel integratied with monitoring tools.","davsclaus:1668006118:2022-11-09T23:01:58.041+0000:1668006118:2022-11-09T23:01:58.041+0000:There are various users that has posted blogs and sample projects such as
https://github.com/anton-goncharov/camel-opentelemetry-grafana-demo

And for Kafka CKC with Strimizi
https://github.com/anton-goncharov/camel-opentelemetry-grafana-demo"
0,CAMEL-18707,Dependency upgrade,Major,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Karen Lease,Claus Ibsen,0,2,2022-11-09 17:24:40+00:00,2022-11-23 13:37:20+00:00,https://quarkus.io/blog/quarkus-2-14-0-final-released/#jandex-3,"klease78:1669012894:2022-11-21T14:41:34.623+0000:1669012894:2022-11-21T14:41:34.623+0000:Updated dependency version, maven coordinates and use of modified APIs.

Removed unused jandex dependency in camel-spring-boot/tooling/camel-spring-boot-generator-maven-plugin
davsclaus:1669096422:2022-11-22T13:53:42.696+0000:1669096422:2022-11-22T13:53:42.696+0000:This upgrade changed the yaml-dsl maven generator. We need to make sure the generator creates the same yaml DSL as before.
davsclaus:1669153359:2022-11-23T05:42:39.633+0000:1669153359:2022-11-23T05:42:39.633+0000:This caused camel-yaml-dsl to be generating the DSL differently which broke it.
davsclaus:1669153958:2022-11-23T05:52:38.562+0000:1669153958:2022-11-23T05:52:38.562+0000:Reverted until we find a fix for the yaml-dsl generation - the .json spec files that it generates and its source code must not change
klease78:1669160243:2022-11-23T07:37:23.381+0000:1669160243:2022-11-23T07:37:23.381+0000:Sorry about that. I'll look into it shortly.
davsclaus:1669162568:2022-11-23T08:16:08.688+0000:1669162568:2022-11-23T08:16:08.688+0000:No problem I was surprised too that this could affect the yaml dsl. "
0,CAMEL-18706,Improvement,Major,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Claus Ibsen,Claus Ibsen,1,1,2022-11-09 14:50:14+00:00,2022-11-10 09:33:38+00:00,"If you export and use 3.20.0-SNAPSHOT then we need ASF snapshot repo for end users to use it out of the box, otherwise they need to build everything local to have their m2/repository populated with JARs",
0,CAMEL-18705,Improvement,Major,None,3.x,"
None
",Resolved,Duplicate,3.x,Unassigned,Claus Ibsen,0,2,2022-11-09 14:33:58+00:00,2022-11-09 14:37:01+00:00,"camel-ahc-ws allowed to do that, but we need such feature in camel-vertx-websocket.


Currently it can only act in consumer where it is the websocket server. What we need is to connect to existing remote WS and receive events from it.","davsclaus:1667975758:2022-11-09T14:35:58.979+0000:1667975758:2022-11-09T14:35:58.979+0000:   <route id=""ws"">
        <from uri=""vertx-websocket://someserver.com:443/wss/v2/2/demo/""/>
        <log message=""${body}""/>
    </route>

davsclaus:1667975821:2022-11-09T14:37:01.195+0000:1667975821:2022-11-09T14:37:01.195+0000:See ticket CAMEL-17895 "
0,CAMEL-18704,Bug,Minor,3.18.0,3.20.0,"
None
",Resolved,Fixed,3.20.0,Karen Lease,Claus Ibsen,0,1,2022-11-09 14:22:01+00:00,2022-11-16 10:48:26+00:00,"The camel-activemq component does not have a headers in the JAR and in the website docs. This is because it extends camel-jms, that has the headers.


https://camel.apache.org/components/3.18.x/activemq-component.html#_endpoint_options


https://camel.apache.org/components/3.18.x/jms-component.html#_message_headers


There are other components that extend like ftp <- file, and jsch <- file etc.","davsclaus:1667975127:2022-11-09T14:25:27.696+0000:1667975127:2022-11-09T14:25:27.696+0000:The maven plugin that generates the json files have logic for this for. the endpoint options, so maybe something can be done similar for headers"
0,CAMEL-18703,Bug,Major,3.20.0,3.20.0,"
None
",Resolved,Cannot Reproduce,3.20.0,Claus Ibsen,Claus Ibsen,0,1,2022-11-09 14:20:09+00:00,2022-11-10 06:22:42+00:00,It seems the header table is no longer shown,
0,CAMEL-18672,Task,Trivial,3.18.3,None,"

dataset

",Resolved,Fixed,"3.18.4, 3.20.0",Claus Ibsen,Aneta Cadova,0,2,2022-10-31 12:12:02+00:00,2022-11-07 12:53:21+00:00,"Both the Test and Mock links in the Dataset introduction point to the Mock component page. 


 


https://camel.apache.org/components/3.18.x/dataset-component.html","davsclaus:1667220389:2022-10-31T20:46:29.316+0000:1667220389:2022-10-31T20:46:29.316+0000:Thanks I updated the links
acadova:1667355159:2022-11-02T10:12:39.190+0000:1667355159:2022-11-02T10:12:39.190+0000:Thanks [~davsclaus]. I just found the same issue in the Dataset-test component, can you please fix it too? https://camel.apache.org/components/3.18.x/dataset-test-component.html
davsclaus:1667611149:2022-11-05T09:19:09.945+0000:1667611149:2022-11-05T09:19:09.945+0000:yes that is fixed too"
0,CAMEL-18671,Task,Trivial,3.18.3,None,"

dataset

",Resolved,Fixed,"3.18.4, 3.20.0",Claus Ibsen,Aneta Cadova,0,2,2022-10-31 10:45:42+00:00,2022-11-07 12:53:16+00:00,"In the dataSetIndex parameter description, the description of strict, lenient and off values contains some probably unintentional “=”. Generally, the description seems unclear, I propose putting enum values at the beginning, and adding a description for the given enum values at the same line in the list.


https://camel.apache.org/components/3.18.x/dataset-component.html#_endpoint_query_option_dataSetIndex","davsclaus:1667219874:2022-10-31T20:37:54.169+0000:1667219874:2022-10-31T20:37:54.169+0000:Its a bit harder to do rich HTML documentation as the description is ascii text based.

The docs is polished a bit"
0,CAMEL-18670,Task,Trivial,3.18.3,None,"

dataset

",Resolved,Fixed,"3.18.4, 3.20.0",Claus Ibsen,Aneta Cadova,0,2,2022-10-31 10:39:30+00:00,2022-11-07 12:53:10+00:00,"In the description of assertPeriod and sleepForEmptyTest query parameters is mentioned the expectedMessageCount(int) parameter, but I only found “expectedCount” parameter in the list of query parameters. Please specify the correct name of the parameter.


https://camel.apache.org/components/3.18.x/dataset-component.html#_endpoint_query_option_assertPeriod",davsclaus:1667220086:2022-10-31T20:41:26.413+0000:1667220086:2022-10-31T20:41:26.413+0000:Thanks I updated the docs
0,CAMEL-18669,Improvement,Minor,None,"3.18.4, 3.20.0","
None
",Resolved,Fixed,"3.18.4, 3.20.0",Claus Ibsen,Claus Ibsen,0,1,2022-10-31 09:47:27+00:00,2022-11-06 08:27:42+00:00,"If you use CB and have configured resilienc4j in the route, then we should automatic add camel-resilienc4j.


Caused by: java.lang.IllegalStateException: Cannot find camel-resilience4j or camel-microprofile-fault-tolerance on the classpath.
	at org.apache.camel.reifier.CircuitBreakerReifier.createProcessor(CircuitBreakerReifier.java:32)
	at org.apache.camel.reifier.ProcessorReifier.makeProcessor(ProcessorReifier.java:857)
	at org.apache.camel.reifier.ProcessorReifier.addRoutes(ProcessorReifier.java:598",
0,CAMEL-18668,Dependency upgrade,Major,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,James Netherton,James Netherton,0,1,2022-10-31 08:53:02+00:00,2022-11-21 14:56:36+00:00,"Quarkus has upgraded to SmallRye Fault Tolerance 5.6.0. Seems there are some breaking changes in the CircuitBreaker constructor.


You can no longer directly instantiate SystemStopwatch. You must instead use SystemStopwatch.INSTANCE.


Also there's an additional Timer parameter that must be provided. Which should probably an instance of ThreadTimer. ThreadTimer requires its own executor service.",
0,CAMEL-18667,Improvement,Minor,None,Future,"
None
",Open,Unresolved,Future,Unassigned,Sergei Portnov,0,2,2022-10-30 18:09:38+00:00,2023-08-09 09:04:19+00:00,Current Telegram models are outdated. Need to update this to match the current API documentation.,"prtnv:1667129752:2022-10-30T19:35:52.382+0000:1667129752:2022-10-30T19:35:52.382+0000:I'm working on it
davsclaus:1670805173:2022-12-12T08:32:53.125+0000:1670805173:2022-12-12T08:32:53.125+0000:Are you still working on this?
prtnv:1670904930:2022-12-13T12:15:30.056+0000:1670904930:2022-12-13T12:15:30.056+0000:Sorry, I was sick. I'm still working on this"
0,CAMEL-18666,Improvement,Minor,None,,"
None
",Resolved,Won't Fix,None,Unassigned,Luca Burgazzoli,0,1,2022-10-28 15:26:32+00:00,2023-07-26 05:49:10+00:00,"As today, the camel-rest-openapi supports to configure the name of the http component to use but it does not allow to configure it. A workaround to configure it is to use the rest configuration but that's complicated things.


To make things easy it should be possible to directly bind an http component instance to the amel-rest-openapi.",
0,CAMEL-18665,Improvement,Minor,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Claus Ibsen,Luca Burgazzoli,0,1,2022-10-28 15:03:48+00:00,2022-11-01 07:26:38+00:00,the JsseParameters should use camel's resource loader mechanism to load resources instead of its own one (see JsseParameters.resolveResource),
0,CAMEL-18664,Task,Minor,3.19.0,3.20.0,"
None
",Resolved,Fixed,3.20.0,Unassigned,Karen Lease,0,1,2022-10-28 14:57:13+00:00,2022-11-10 07:57:14+00:00,"The camel-karaf-examples which use a features.xml file can't be installed in the Karaf containter:



camel-example-mybatis
camel-example-artemis-amqp-blueprint
camel-example-sql-blueprint
camel-example-transformer-blueprint
camel-example-kamelet-chucknorris



The placeholders  such as camel.version aren't replaced during the installation.",
0,CAMEL-18663,Improvement,Minor,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Luca Burgazzoli,Luca Burgazzoli,0,1,2022-10-28 14:45:32+00:00,2022-11-05 10:00:51+00:00,"As today, the VertxHttpComponent exposes a number of configuration options but lacks the options to set WebClientOptions.",
0,CAMEL-18662,New Feature,Major,None,3.x,"
None
",Resolved,Duplicate,3.x,Unassigned,Claus Ibsen,0,2,2022-10-28 12:23:26+00:00,2023-03-06 13:50:01+00:00,"when using camel run it runs local in camel-main (standalone) but sometimes you need to run in Spring Boot or Quarkus with their extra services to setup things such as JTA transaction or whatnot.


Today you would need to export and then leave jbang.


So we could make a export to temp folder in the shadown and run it foreground as if it was running like camel standalone.


And when you exit then cleanup the temporary directory.",davsclaus:1678081794:2023-03-06T13:49:54.117+0000:1678081794:2023-03-06T13:49:54.117+0000:CAMEL-19041
0,CAMEL-18661,Bug,Minor,3.19.0,3.20.0,"
None
",Resolved,Fixed,3.20.0,Unassigned,Liudmila,1,4,2022-10-27 21:06:04+00:00,2022-12-27 19:56:34+00:00,"I have the following application:


 




@Component
public class SourceRoute extends EndpointRouteBuilder {
    private static final String cs = ""..."";
    @Override
    public void configure() {

       from(timer(""tick"").period(1000).repeatCount(1))
                .log(""Timer triggered"")
                .setBody(simple(""hello""))
                .to(azureServicebus(""testme"").
                        serviceBusType(""topic"").
                        connectionString(cs));
    }
} 



 


And I run it with OpenTelemtery Java agent.


Camel creates ""tick"" and ""testme"" spans.
ServiceBus SDK is instrumented too and it creates it's own spans.


Actual behavior:


Spans created by ServiceBus SDK are unrelated to Camel spans. I.e. ServiceBus spans and Camel spans are in different traces (check out the attached screenshot).


Expected behavior:


Camel ""testme"" span is a parent of ServiceBus spans:



tick
	
testme
		
ServiceBus.message
ServiceBus.send







Investigation


If I look into the OTel instrumentation code (and debug my application). I can see that OTel span starts here


https://github.com/apache/camel/blob/1175c2666821457dcb6cf0921f4076508459341a/components/camel-opentelemetry/src/main/java/org/apache/camel/opentelemetry/OpenTelemetryTracer.java#L92


and then is 'activated' here 


https://github.com/apache/camel/blob/main/components/camel-tracing/src/main/java/org/apache/camel/tracing/Tracer.java#L248


But the activation code only puts trace_id and span_id on MDC.


The proposal for Camel is to make OpenTelemtery span active (using Span.makeCurrent()).
This is the only way underlying traces can be correlated to Camel spans.




try (Scope s = span.makeCurrent()) {
   // wrap processing, but always clean up the scope to avoid leaks
} 



OTel instrumentation will take care of propagating this context anywhere else.","davsclaus:1666904553:2022-10-28T05:02:33.631+0000:1666904553:2022-10-28T05:02:33.631+0000:Thanks for reporting, if you can then you are welcome to send your suggested fix as a PR against main branch
Molkova:1668178682:2022-11-11T22:58:02.582+0000:1668178682:2022-11-11T22:58:02.582+0000:[~davsclaus] I prototyped some changes here [https://github.com/apache/camel/pull/8713,] but it's not as trivial as I expected (for async calls), and I would appreciate any guidance on the approach I've done in the PR or alternatives. Thanks!
davsclaus:1671150675:2022-12-16T08:31:15.771+0000:1671150675:2022-12-16T08:31:15.771+0000:Thanks for reporting and the excellent work on fixing/improving this
bvahdat:1671154056:2022-12-16T09:27:36.060+0000:1671154056:2022-12-16T09:27:36.060+0000:Should we look into backporting this for the upcoming {{3.18.5}} LTS release?
davsclaus:1671154560:2022-12-16T09:36:00.165+0000:1671154560:2022-12-16T09:36:00.165+0000:No its a bit too invasive in the core (not isolated to opentelemetry only)
bvahdat:1671164540:2022-12-16T12:22:20.286+0000:1671164540:2022-12-16T12:22:20.286+0000:Please review: https://github.com/apache/camel/pull/8911
bvahdat:1671450391:2022-12-19T19:46:31.532+0000:1671450391:2022-12-19T19:46:31.532+0000:Hi [~Molkova] 

As per conversation [here|https://github.com/apache/camel/pull/8911#issuecomment-1355233167] just to let you know that the flaky test has popped up on Jenkins build as well:

https://ci-builds.apache.org/job/Camel/job/Camel%20JDK11%20Build%20(S390x)/job/main/409/testReport/junit/org.apache.camel.opentelemetry/CurrentSpanTest/testContextDoesNotLeak/
 
{code}
org.apache.camel.CamelExecutionException: Exception occurred during execution on the exchange: Exchange[1E6AD74DFFAFE6E-000000000000000A]
	at org.apache.camel.CamelExecutionException.wrapCamelExecutionException(CamelExecutionException.java:45)
	at org.apache.camel.support.AbstractExchange.setException(AbstractExchange.java:597)
	at org.apache.camel.support.DefaultExchange.setException(DefaultExchange.java:27)
	at org.apache.camel.processor.MulticastProcessor$MulticastTask.aggregate(MulticastProcessor.java:445)
	at org.apache.camel.processor.MulticastProcessor$MulticastReactiveTask.lambda$run$0(MulticastProcessor.java:570)
	at org.apache.camel.AsyncCallback.run(AsyncCallback.java:44)
	at org.apache.camel.impl.engine.DefaultReactiveExecutor$Worker.schedule(DefaultReactiveExecutor.java:181)
	at org.apache.camel.impl.engine.DefaultReactiveExecutor.schedule(DefaultReactiveExecutor.java:54)
	at org.apache.camel.processor.MulticastProcessor.lambda$schedule$1(MulticastProcessor.java:336)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
	at java.base/java.lang.Thread.run(Thread.java:829)
Caused by: org.opentest4j.AssertionFailedError: expected: <false> but was: <true>
	at org.junit.jupiter.api.AssertionFailureBuilder.build(AssertionFailureBuilder.java:151)
	at org.junit.jupiter.api.AssertionFailureBuilder.buildAndThrow(AssertionFailureBuilder.java:132)
	at org.junit.jupiter.api.AssertFalse.failNotFalse(AssertFalse.java:63)
	at org.junit.jupiter.api.AssertFalse.assertFalse(AssertFalse.java:36)
	at org.junit.jupiter.api.AssertFalse.assertFalse(AssertFalse.java:31)
	at org.junit.jupiter.api.Assertions.assertFalse(Assertions.java:228)
	at org.apache.camel.opentelemetry.CurrentSpanTest$1.lambda$configure$0(CurrentSpanTest.java:221)
	at org.apache.camel.AggregationStrategy.aggregate(AggregationStrategy.java:86)
	at org.apache.camel.processor.MulticastProcessor.doAggregateInternal(MulticastProcessor.java:882)
	at org.apache.camel.processor.MulticastProcessor.doAggregateSync(MulticastProcessor.java:863)
	at org.apache.camel.processor.MulticastProcessor.doAggregate(MulticastProcessor.java:848)
	at org.apache.camel.processor.MulticastProcessor$MulticastTask.aggregate(MulticastProcessor.java:439)
	... 10 more
{code}"
0,CAMEL-18660,Task,Minor,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Nicolas Filotto,Nicolas Filotto,0,1,2022-10-27 17:05:01+00:00,2022-12-12 17:21:53+00:00,"The test Kinesis2ConsumerHealthCustomClientTest systematically fails on Jenkins. After a deeper investigation, it is actually due to an API rate limit exceeded


The corresponding stack trace:



Error starting infrastructure: Could not get list of releases from https://api.github.com/repos/etspaceman/kinesis-mock/releases/tags/0.2.5: {""message"":""API rate limit exceeded for 67.195.81.161. (But here's the good news: Authenticated requests get a higher rate limit. Check out the documentation for more details.)"",""documentation_url"":""https://docs.github.com/rest/overview/resources-in-the-rest-api#rate-limiting""}
 Traceback (most recent call last):
  File ""/opt/code/localstack/localstack/services/infra.py"", line 420, in start_infra
    thread = do_start_infra(asynchronous, apis, is_in_docker)
  File ""/opt/code/localstack/localstack/services/infra.py"", line 516, in do_start_infra
    prepare_installation()
  File ""/opt/code/localstack/localstack/utils/bootstrap.py"", line 77, in wrapped
    return f(*args, **kwargs)
  File ""/opt/code/localstack/localstack/services/infra.py"", line 470, in prepare_installation
    install.install_components(apis)
  File ""/opt/code/localstack/localstack/services/install.py"", line 411, in install_components
    parallelize(install_component, names)
  File ""/opt/code/localstack/localstack/utils/threads.py"", line 135, in parallelize
    return pool.map(func, arr)
  File ""/usr/local/lib/python3.10/multiprocessing/pool.py"", line 367, in map
    return self._map_async(func, iterable, mapstar, chunksize).get()
  File ""/usr/local/lib/python3.10/multiprocessing/pool.py"", line 774, in get
    raise self._value
  File ""/usr/local/lib/python3.10/multiprocessing/pool.py"", line 125, in worker
    result = (True, func(*args, **kwds))
  File ""/usr/local/lib/python3.10/multiprocessing/pool.py"", line 48, in mapstar
    return list(map(*args))
  File ""/opt/code/localstack/localstack/services/install.py"", line 407, in install_component
    installer()
  File ""/opt/code/localstack/localstack/packages/api.py"", line 182, in install
    self.get_installer(version).install(target)
  File ""/opt/code/localstack/localstack/packages/api.py"", line 83, in install
    raise e
  File ""/opt/code/localstack/localstack/packages/api.py"", line 74, in install
    if not self.is_installed():
  File ""/opt/code/localstack/localstack/packages/api.py"", line 93, in is_installed
    return self.get_installed_dir() is not None
  File ""/opt/code/localstack/localstack/packages/api.py"", line 103, in get_installed_dir
    if directory and os.path.exists(self._get_install_marker_path(directory)):
  File ""/opt/code/localstack/localstack/packages/core.py"", line 172, in _get_install_marker_path
    url = self._get_download_url()
  File ""/opt/code/localstack/localstack/packages/core.py"", line 208, in _get_download_url
    raise PackageException(
localstack.packages.api.PackageException: Could not get list of releases from https://api.github.com/repos/etspaceman/kinesis-mock/releases/tags/0.2.5: {""message"":""API rate limit exceeded for 67.195.81.161. (But here's the good news: Authenticated requests get a higher rate limit. Check out the documentation for more details.)"",""documentation_url"":""https://docs.github.com/rest/overview/resources-in-the-rest-api#rate-limiting""}




It appears that it is a known issue and it is due to the fact that the docker image localstack 1.2.0 doesn't contain kinesis-mock thus anytime it uses the localstack image, it tries to automatically install it by downloading it from GitHub which causes the rate limit issue.","nfilotto:1666862320:2022-10-27T17:18:40.779+0000:1666862320:2022-10-27T17:18:40.779+0000:Temporary workaround https://github.com/apache/camel/pull/8642 until the docker image is fixed
nfilotto:1667983459:2022-11-09T16:44:19.478+0000:1667983459:2022-11-09T16:44:19.478+0000:FYI, the bug has been fixed into localstack (https://github.com/localstack/localstack/pull/7033), now we need to wait for a new release with the fix.
nfilotto:1670832243:2022-12-12T16:04:03.230+0000:1670832243:2022-12-12T16:04:03.230+0000:The corresponding PR https://github.com/apache/camel/pull/8884"
0,CAMEL-18659,Improvement,Minor,"3.12.0, 3.13.0","3.21.0, 4.0-M1, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M1, 4.0.0",Claus Ibsen,M,0,2,2022-10-27 12:27:25+00:00,2023-01-30 08:59:44+00:00,"Hi,


I marked field with @Schema annotation like below:


@Schema(example = ""1234"", nullable = true)
private Long id;


I got output:




""id"" : {
            ""format"" : ""int64"",
            ""type"" : ""integer"",
            ""example"" : 1234
          } 



when my expectation is:




""id"" : {
            ""format"" : ""int64"",
            ""type"" : ""integer"",
            ""nullable"" : true,  
            ""example"" : 1234
         } 



Or maybe I'm doing something wrong .


Open-api 3.0.2.",davsclaus:1666848655:2022-10-27T13:30:55.477+0000:1666848655:2022-10-27T13:30:55.477+0000:Nullable is not support at the moment - you are welcome to dive into the code to see if you can add this. And also help with an unit test or sample project to help demonstrate this.
0,CAMEL-18658,Improvement,Major,None,3.20.0,"
None
",Resolved,Cannot Reproduce,3.20.0,Claus Ibsen,Claus Ibsen,0,1,2022-10-27 11:41:09+00:00,2022-10-27 13:17:57+00:00,"This example
https://github.com/apache/camel-kamelets-examples/tree/main/jbang/camelk-bean


If you edit the inlined source code the route is reloaded but bean is not updated.","davsclaus:1666847877:2022-10-27T13:17:57.427+0000:1666847877:2022-10-27T13:17:57.427+0000:It works but it was when using ${bean:foo} then simple caches the bean, so either set scope=request or use bean eip to call that lookup."
0,CAMEL-18657,Bug,Major,"3.18.2, 3.19.0","3.18.4, 3.20.0","
None
",Resolved,Fixed,"3.18.4, 3.20.0",Claus Ibsen,Claus Ibsen,0,1,2022-10-26 18:49:17+00:00,2022-10-27 08:49:17+00:00,"Reported on chat
https://camel.zulipchat.com/#narrow/stream/257298-camel/topic/mixing.20to.20and.20toD",
0,CAMEL-18656,Bug,Major,"3.18.3, 3.19.0","3.18.4, 3.20.0","
None
",Resolved,Fixed,"3.18.4, 3.20.0",Otavio Rodolfo Piske,Gilvan Filho,0,3,2022-10-26 15:34:24+00:00,2022-10-28 14:26:20+00:00,"Merge operations always is done at master branch.


Once default branch name can be whatever user needs and master is being replaced by main in many repo this could led to problems. That way camel-git needs to allow user especify a targetBranch and, if this are no set, get default branch from user configs.","orpiske:1666770814:2022-10-26T15:53:34.201+0000:1666770814:2022-10-26T15:53:34.201+0000:I discussed about this issue with [~gilvansfilho] and he proposed to write the fix. I am assigning this to me so I can track and backport this.
gilvansfilho:1666845492:2022-10-27T12:38:12.069+0000:1666845492:2022-10-27T12:38:12.069+0000:That [PR|https://github.com/apache/camel/pull/8639] address this.
davsclaus:1666846397:2022-10-27T12:53:17.978+0000:1666846397:2022-10-27T12:53:17.978+0000:Thanks, so we need to backport this to 3.18.x branch. You are welcome to send a PR for that
gilvansfilho:1666854877:2022-10-27T15:14:37.422+0000:1666854877:2022-10-27T15:14:37.422+0000:Ok. I will do that.
gilvansfilho:1666856736:2022-10-27T15:45:36.626+0000:1666856736:2022-10-27T15:45:36.626+0000:Done.
Backport PR [here|https://github.com/apache/camel/pull/8641]"
0,CAMEL-18655,New Feature,Major,None,None,"
None
",Resolved,Fixed,3.20.0,Unassigned,Christofer Dutz,0,1,2022-10-26 14:08:23+00:00,2022-11-22 06:13:02+00:00,No Desc,
0,CAMEL-18654,Improvement,Minor,None,,"
None
",Open,Unresolved,None,Unassigned,Luca Burgazzoli,0,1,2022-10-26 13:48:00+00:00,2022-10-26 13:48:00+00:00,"In order to test the azure components against i.e. azurite, it would be nice if the azure components would provide a way to to override the service endpoint used by the clients at the component and endpoint level.",
0,CAMEL-18653,Improvement,Major,"3.18.3, 3.19.0, 3.20.0",3.20.0,"
None
",Resolved,Fixed,3.20.0,Otavio Rodolfo Piske,Otavio Rodolfo Piske,0,1,2022-10-26 12:43:51+00:00,2022-11-04 15:06:34+00:00,"The resume API currently has very limited support for handling scenarios when the resume media becomes unavailable. If Camel itself goes down, data could be lost.


We should implement more robust mechanisms to handle such scenarios.",orpiske:1667545594:2022-11-04T15:06:34.893+0000:1667545594:2022-11-04T15:06:34.893+0000:Fixed with the implementation of `camel-wal`.
0,CAMEL-18652,Improvement,Major,None,3.20.0,"
None
",Resolved,Not A Problem,3.20.0,Unassigned,Claus Ibsen,0,1,2022-10-26 10:48:26+00:00,2022-10-26 11:49:28+00:00,We should add Gauge and LongTaskTimer,davsclaus:1666756168:2022-10-26T11:49:28.701+0000:1666756168:2022-10-26T11:49:28.701+0000:Its more hard to support gauge as this requires to setup a gauge such as an object that has a size that is then in use.
0,CAMEL-18651,New Feature,Minor,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Claus Ibsen,Claus Ibsen,0,1,2022-10-25 12:38:54+00:00,2022-10-31 08:52:16+00:00,"So you can observe data from the CLI as well


camel get metrics


or some kind of command for that. And if we can have it work in --watch mode too.
Its like the camel get events command.",
0,CAMEL-18650,Improvement,Major,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Claus Ibsen,Claus Ibsen,0,1,2022-10-25 12:23:52+00:00,2022-10-26 13:53:52+00:00,"Like we did for camel-microprofile-metrics, we should do the same for camel-micrometer",
0,CAMEL-18649,Improvement,Major,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Otavio Rodolfo Piske,Otavio Rodolfo Piske,0,1,2022-10-25 11:49:17+00:00,2022-10-26 12:35:13+00:00,"Due to the way it works, with recurrent polling along with recursion, the resume process for directory entries performs badly (O(n2)).",orpiske:1666758913:2022-10-26T12:35:13.037+0000:1666758913:2022-10-26T12:35:13.037+0000:Fixed with the linked PR.
0,CAMEL-18648,Bug,Major,3.20.0,3.20.0,"
None
",Resolved,Fixed,3.20.0,Jiri Ondrusek,Jiri Ondrusek,0,1,2022-10-25 07:41:21+00:00,2022-12-08 15:32:03+00:00,"Some recent changes to the class `GoogleBigQueryConfiguration` causes `ArrayIndexOutOfBoundsException` for endpoint urls containing 3 parts (i.e. `google-bigquery://test-project:google_bigquery_test_dataset:google_bigquery_table_for_partitioning?connectionFactory=#connectionFactory`)


Simple test covering this should be added.",
0,CAMEL-18647,New Feature,Minor,3.19.0,3.20.0,"
None
",Resolved,Fixed,3.20.0,Claus Ibsen,Raymond,0,1,2022-10-25 06:46:37+00:00,2022-10-25 13:02:08+00:00,"In the current Java DSL you can set the delay EIP as follows:


 




routeTemplate(""delay"")
.templateParameter(""in"")
.templateParameter(""delayTimeout"",""5000"")
.templateParameter(""out"")
.from(""{{in}}"")
   .delay().constant(""{delayTimeout}}"").syncDelayed().callerRunsWhenRejected(false)
   .to(""{{out}}"");




 


I would like to make the options configurable:


 




routeTemplate(""delay"")
.templateParameter(""in"")
.templateParameter(""delayTimeout"",""5000"")
.templateParameter(""asyncDelayed"",""true"")  
.templateParameter(""callerRunsWhenRejected"",""true"")  
.templateParameter(""out"")
.from(""{{in}}"")
   .delay().constant(""{{delayTimeout}}"")
          .asyncDelayed(""{{asyncDelayed}}"")
          .callerRunsWhenRejected(""{{callerRunsWhenRejected}}"")
   .to(""{{out}}"");






 


https://camel.apache.org/components/3.18.x/eips/delay-eip.html",
0,CAMEL-18646,Improvement,Major,3.19.0,3.20.0,"
None
",Resolved,Fixed,3.20.0,Unassigned,Federico Mariani,0,3,2022-10-24 10:40:56+00:00,2022-11-07 15:12:34+00:00,"let camel users provide a custom git configuration, for example, disable SSL verification.


https://git.eclipse.org/r/plugins/gitiles/jgit/jgit/+/refs/heads/master/Documentation/config-options.md","gilvansfilho:1666948263:2022-10-28T17:11:03.876+0000:1666948263:2022-10-28T17:11:03.876+0000:I was looking on that and once JGit don't allow (or I did not find a way to) inject {{org.eclipse.jgit.lib.StoreConfig}} I think remain two options:

1 - Allow user pass a {{org.eclipse.jgit.lib.Repository}} to camel use it
2 - Allow user pass a {{.gitconfig}} file through a {{java.io.File}} or it path as {{String}} and use it in a Custom {{org.eclipse.jgit.utilSystemReader}}

First option, pass a {{Repository}}, would allow users create that as they want, giving them more flexibility but require more knowledge about JGit internals. Moreover {{localPath}} path parameter would no longer be mandatory.

With second option, pass a {{File}}, users would need to pass a File (or it path) and dont worry about JGit internals. More simples but less flexible (for user). However that way camel-git will turn more coupled with JGit once will be needed to extend one JGit internal class (SystemReader).

What's the best alternative?
Federico Mariani:1667447031:2022-11-03T11:43:51.338+0000:1667447031:2022-11-03T11:43:51.338+0000:Hello [~gilvansfilho], thanks for your reply, do you think it is possible/worth creating a temp gitconfig file and a custom SystemReader implementation, in this way it should be possible to:
 * copy system config to temp config
 * Update the SystemReader via _SystemReader.setInstance(...)_
 * In this way it should be possible to pass options on the camel route ex. git://repo?operation=init&params=http.sslVerify=true
 * so that http.sslVerify is added to the temp configuration and we do not mess with user config or ask user to provide a file

What do you think?

Part of this StackOverflow may help [https://stackoverflow.com/questions/33804097/prevent-jgit-from-reading-the-native-git-config#answer-59110721]
 
gilvansfilho:1667450799:2022-11-03T12:46:39.243+0000:1667450799:2022-11-03T12:46:39.243+0000:Hi [~Federico Mariani] 

I made some tests with that and I was able to pass a .gitconfig like file to be used as custom config through custom System Reader as exposed in Stack Overflow. That was done passing to endpoint a new query parameter (String) with path to a .gitconfig file. That way file could be on OS dirs or on resource folder. With that you could override all git configs as you want. But this is not mandatory. If user doesn`t provide that file camel-git will load that from users home folder as default behavior of JGit does.
{code:java}
from(""git://repo?gitConfigFile=/tmp/gitconfig"").to(...) //that way will load from OS dirs
from(""git://repo?gitConfigFile=gitconfig"").to(...) //that way will load from resources folder
from(""git://repo"").to(...) //that way will load from users home dir as default{code}
Said that, is still possible allows user to provide only some desired configurations through endpoint query params and override them in loaded configuration no matter if that was default or from a provided through gitConfigFile endpoint query param. But here I think we need pay attention in 2 points:
 * There are a lot of options as exposed [here|https://git.eclipse.org/r/plugins/gitiles/jgit/jgit/+/refs/heads/master/Documentation/config-options.md]. To allow the user provide all could turn things hard. Maybe defining some settings that will be exposed this way is a simpler way to do that.
 * We need to care about side effects avoiding configs made in one endpoint affect others. I will do some tests with that.

With that two things users will have great flexibility to config as they needs.

What do you think about?
Federico Mariani:1667465626:2022-11-03T16:53:46.732+0000:1667465626:2022-11-03T16:53:46.732+0000:Nice solution, in this way, if different routes use another config file, they will not mix up. is it correct? if this is the case, I like it!

[~orpiske] do you have any opinion?
gilvansfilho:1667468672:2022-11-03T17:44:32.518+0000:1667468672:2022-11-03T17:44:32.518+0000:{quote}Nice solution, in this way, if different routes use another config file, they will not mix up. is it correct?
{quote}
Correct. You could have for examples 2 config file in your resource folder and reference them as you want. Or to have 1 config file and use this one sometimes and use default (.gitconfig from user folder) other times.

 

I'm going to do some tests providing config through query params and mix them with loaded configs. That way I think things will work as below:
 # Camel-git loads config from supplied file or default
 # Loaded configs are overrided by individual query params.
orpiske:1667528990:2022-11-04T10:29:50.328+0000:1667528990:2022-11-04T10:29:50.328+0000:[~gilvansfilho] [~Federico Mariani] nice one, I like the idea."
0,CAMEL-18645,Improvement,Minor,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Unassigned,Claus Ibsen,0,1,2022-10-24 09:43:03+00:00,2022-10-24 10:03:43+00:00,"If you want to output custom meta-data then you need to filter out the standard keys. 




       ""details"": {
          ""invocation.count"": ""179"",
          ""failure.time"": ""2022-10-24T11:00:40.295336+02:00[Europe/Oslo]"",
          ""group.id"": ""5b6145fb-3bcd-4d91-be53-12c144fc9950"",
          ""bootstrap.servers"": ""value"",
          ""invocation.time"": ""2022-10-24T11:00:40.295336+02:00[Europe/Oslo]"",
          ""check.group"": ""camel"",
          ""route.id"": ""kafka-not-secured-source-1"",
          ""failure.start.time"": ""2022-10-24T10:54:41.812377+02:00[Europe/Oslo]"",
          ""topic"": ""value"",
          ""success.count"": ""0"",
          ""check.id"": ""kafka-consumer-kafka-not-secured-source-1"",
          ""check.kind"": ""READINESS"",
          ""failure.count"": ""179""
        }
      }




In the example above then custom is topic and bootstrap.servers. All the other is standard by camel-health.


We may consider having reserved keys by camel, and for custom to better separate this.",davsclaus:1666577016:2022-10-24T10:03:36.298+0000:1666577016:2022-10-24T10:03:36.298+0000:You can use isReservedKey on HealthCheckHelper to know if its a standard or not
0,CAMEL-18644,Dependency upgrade,Trivial,3.18.2,None,"
None
",Resolved,Fixed,"3.18.4, 3.20.0",Unassigned,Federico Mariani,0,2,2022-10-24 08:40:05+00:00,2022-10-24 10:29:47+00:00,No Desc,davsclaus:1666576893:2022-10-24T10:01:33.448+0000:1666576893:2022-10-24T10:01:33.448+0000:hsqldb is only used for testing
0,CAMEL-18643,Improvement,Major,None,None,"
None
",Resolved,Fixed,3.20.0,Andrea Cosentino,Andrea Cosentino,0,1,2022-10-24 07:21:10+00:00,2022-11-09 12:29:59+00:00,So we could set error code and status code in the health check details.,
0,CAMEL-18642,Bug,Major,3.18.2,"3.18.4, 3.20.0","
None
",Resolved,Information Provided,"3.18.4, 3.20.0",Claus Ibsen,Marat Gubaidullin,0,2,2022-10-24 02:53:51+00:00,2022-10-25 13:01:53+00:00,"camel-jbang export change class package to group from gav.
after that class reference in yaml is not correct anymore, ex:


The following 2 files run using camel-jbang without any issues




import org.apache.camel.BindToRegistry;
import org.apache.camel.Exchange;
import org.apache.camel.Processor;

@BindToRegistry(""CustomProcessor"")
public class CustomProcessor implements Processor {

  public void process(Exchange exchange) throws Exception {
      exchange.getIn().setBody(""Hello world"");
  }
}




and




- route:
    from:
      uri: kamelet:timer-source
      steps:
        - process:
            ref: '#CustomProcessor'
        - log:
            message: ${body}
      parameters:
        period: 2000
        message: xxx




while during export camel-jbang adds package to the class 




package org.test.demo;

import org.apache.camel.BindToRegistry;
import org.apache.camel.Exchange;
import org.apache.camel.Processor;

@BindToRegistry(""CustomProcessor"")
public class CustomProcessor implements Processor {

  public void process(Exchange exchange) throws Exception {
      exchange.getIn().setBody(""Hello world"");
  }
}




After that yaml ref is not correct anymore
We need to find a way to make export without changing source files","davsclaus:1666556684:2022-10-24T04:24:44.043+0000:1666556684:2022-10-24T04:24:44.043+0000:The ref is correct as its CustomProcessor and not based on package name, so its something else.
davsclaus:1666646418:2022-10-25T05:20:18.588+0000:1666646418:2022-10-25T05:20:18.588+0000:Depending on the runtime you export as you should use their way of annotations

For example for quarkus
https://camel.apache.org/manual/camel-jbang.html#_using_quarkus_injection

The camel-quarkus does not understand classes annotated with the Camel BindToRegistry annotation - You need to use their @Named @Singleton combo.


davsclaus:1666646577:2022-10-25T05:22:57.993+0000:1666646577:2022-10-25T05:22:57.993+0000:{code}
package com.foo.acme;

import org.apache.camel.Exchange;
import org.apache.camel.Processor;

import javax.inject.Named;
import javax.inject.Singleton;

@Singleton @Named(""CustomProcessor"")
public class CustomProcessor implements Processor {

  public void process(Exchange exchange) throws Exception {
      exchange.getIn().setBody(""Hello world"");
  }
}
{code}
davsclaus:1666646617:2022-10-25T05:23:37.183+0000:1666646617:2022-10-25T05:23:37.183+0000:Maybe we can make export automatic change this (replace import ...) and the annotation to that combo
davsclaus:1666654311:2022-10-25T07:31:51.374+0000:1666654311:2022-10-25T07:31:51.374+0000:I dont want at this point to ""change"" the source code with replacing annotations etc. 

marat.gubaidullin@gmail.com:1666674113:2022-10-25T13:01:53.202+0000:1666674113:2022-10-25T13:01:53.202+0000:Perhaps we could implement @BindToRegistry annotation in camel-quarkus?"
0,CAMEL-18641,Bug,Minor,3.19.0,None,"
None
",Resolved,Fixed,3.20.0,Claus Ibsen,Raymond,0,2,2022-10-23 18:01:18+00:00,2022-10-24 10:47:15+00:00,"Since the last release (3.19.0) Camel supports Python experimentally. That's great.
 
I like to test it out, here are some things I noticed.
 
1) In IntelliJ it doesn't seem to recognize ""python"" in the Java DSL yet (is it part of the DSL model?) For example:




 .choice()
.when(python(""myexpression"")).to(""mock:endpoint"")




or


 




.setBody().python(""myexpresson"")



 
isn't allowed. Other languages are recognized and Intellij points to 3.19.0.
 
2) Examples
 
Would be nice if some examples were added to the documentation:
 
https://camel.apache.org/components/next/languages/python-language.html
 
For me, and I think for most users, it's hard to find out how to use it.


3) Version
 
It's unclear what Python version is used. It's based on Jython. The latest version of Jython is 2.7.3. Does that mean Python 2.x is used, or can we use Python 3 syntax?


 4) Jira


The component ""camel-python"" is not selectable.
 


BTW: Another minor thing I noticed (not specifically related to Python) is that version 3.19.0 is at the moment not available as select on the documentation page. So I could only see the python documentation in 'next'.","davsclaus:1666578631:2022-10-24T10:30:31.298+0000:1666578631:2022-10-24T10:30:31.298+0000:You can use language(""python"", ""xxxx"")"
0,CAMEL-18640,Improvement,Minor,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Claus Ibsen,Claus Ibsen,0,1,2022-10-23 09:37:39+00:00,2022-10-24 08:11:43+00:00,This allows tooling to better display information as each trace line is separated,
0,CAMEL-18639,Improvement,Major,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Claus Ibsen,Claus Ibsen,0,1,2022-10-23 08:38:30+00:00,2022-10-23 09:27:37+00:00,"We should keep state when was the last time there was a failure / success.
This is good to know that the check has failed for the last 3 minutes, etc.",
0,CAMEL-18638,Improvement,Minor,3.19.0,"4.0-RC1, 4.0.0","
None
",Resolved,Fixed,"4.0-RC1, 4.0.0",Unassigned,Karen Lease,0,2,2022-10-22 21:16:12+00:00,2023-05-26 11:15:39+00:00,"Currently UriEndpoint deprecates the String label in favor of an array of Category enums, but Metadata, UriPath and UriParam annotations still have only label.
Harmonize all annotations.
In addition, reduce the number of Category values by using more general values, for example bigdata instead of hadoop, cloud for azure. Ideally there would be approx 50 which could then be used to filter the list of components on the website or in other tools.",davsclaus:1685070939:2023-05-26T11:15:39.577+0000:1685070939:2023-05-26T11:15:39.577+0000:We have reduced category and all components uses Category now
0,CAMEL-18637,New Feature,Major,None,4.2.0,"
None
",Resolved,Fixed,4.2.0,Unassigned,Steven Dürrenmatt,1,6,2022-10-22 14:37:28+00:00,2023-10-12 07:31:45+00:00,Implement OAuth 2.0 Client Credentials authentication,"akvel:1671763935:2022-12-23T10:52:15.681+0000:1671763935:2022-12-23T10:52:15.681+0000:BTW It could be done by custom HttpConfirurer for httpClient, here example with sprinb boot oauth2 integration https://github.com/Akvel/httpclient-with-spring-boot-oauth/blob/main/src/test/java/pro/akvel/test/oauth/OauthClientTest.java
tanyu:1695088141:2023-09-19T09:49:01.917+0000:1695088141:2023-09-19T09:49:01.917+0000:I can try it, can you set assignee to me？
acosentino:1695088317:2023-09-19T09:51:57.828+0000:1695088317:2023-09-19T09:51:57.828+0000:It is enough to add a comment. Assign permissions will be given to users with a bit more contributions.
akvel:1695089347:2023-09-19T10:09:07.167+0000:1695093290:2023-09-19T11:14:50.266+0000:[~tanyu] I also have example for camel 4/httpclient5/spring boot 3 oauth. I could upload it for you?
gilvansfilho:1696221370:2023-10-02T12:36:10.612+0000:1696221370:2023-10-02T12:36:10.612+0000:[~tanyu]  are you working on that?

If not I have a working work which need some polish and I what to discuss that with others. Perhaps I could submit that as draft PR...
tanyu:1696225092:2023-10-02T13:38:12.960+0000:1696225092:2023-10-02T13:38:12.960+0000:[~gilvansfilho] Hello, I'm currently working on another issue. Feel free to continue with your tasks.

gilvansfilho:1696226967:2023-10-02T14:09:27.119+0000:1696226967:2023-10-02T14:09:27.119+0000:Thanks [~tanyu] 
Mendola:1696305910:2023-10-03T12:05:10.236+0000:1696305910:2023-10-03T12:05:10.236+0000:I have developed a Kamelet for this use case. Wouldn't this be a a perfect fit for an official Kamelet handling OAuth2 authentication?

 

The reason is... one may need OAuth2 for other than camel-http, such as camel-rest, or distribution list.

 
acosentino:1696983608:2023-10-11T08:20:08.454+0000:1696983608:2023-10-11T08:20:08.454+0000:[~Mendola] why don't you open a PR on camel-kamelets repository?
Mendola:1696984841:2023-10-11T08:40:41.838+0000:1696984841:2023-10-11T08:40:41.838+0000:[~acosentino] good idea, could be an alternative to the new feature in camel-http if more control is needed"
0,CAMEL-18636,Improvement,Major,None,"3.14.8, 3.18.6, 3.20.3, 3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.14.8, 3.18.6, 3.20.3, 3.21.0, 4.0-M3, 4.0.0",Andrea Cosentino,Andrea Tarocchi,0,1,2022-10-21 20:14:23+00:00,2023-03-16 08:51:39+00:00,"All the component properties used in this check: https://github.com/apache/camel/blob/main/components/camel-azure/camel-azure-storage-datalake/src/main/java/org/apache/camel/component/azure/storage/datalake/DataLakeComponent.java#L102 are configurable only ad jave classes in the registry.


These seems counter intuitive because as a user I would like to configure them as strings... furthermore this complicate the use of this components in kamelets and camel kafka connect.",
0,CAMEL-18635,New Feature,Major,None,4.1.0,"
None
",Resolved,Fixed,4.1.0,Craig Ziesman,Craig Ziesman,0,2,2022-10-21 15:02:44+00:00,2023-08-16 18:47:12+00:00,"I have created a Maven plugin that provides the ability to generate Camel route coverage reports as HTML and as Excel-compatible .xlsx files. The plugin works in conjunction with the Camel Report Maven Plugin. The Camel Report Maven Plugin generates the XML files that are then converted to HTML and .xlsx files by this plugin. 


The initial version of code can be found here: https://github.com/cziesman/camel-route-coverage-maven-plugin


I would like to donate this to the Apache Camel project.","cziesman:1667212017:2022-10-31T18:26:57.808+0000:1667212017:2022-10-31T18:26:57.808+0000:Per Claus Ibsen, references to lombok have been removed.
davsclaus:1667219023:2022-10-31T20:23:43.825+0000:1667219023:2022-10-31T20:23:43.825+0000:Thanks for wanting to donate this.

I wonder if the plugin is merged into ASF Camel, then the current plugin has these options
https://camel.apache.org/manual/camel-report-maven-plugin.html

For generating in Excel or HTML as new features, then I wonder if there should be a new option named output where you can configure the desired output.
Then you can choose among XML, HTML, or Excel.

Thought I wonder if there are use cases where you want more than 1 kind of output, eg both XML and Excel?
cziesman:1667219645:2022-10-31T20:34:05.242+0000:1667219666:2022-10-31T20:34:26.241+0000:This plugin already generates HTML and Excel output files simultaneously.

I will take a look at how to integrate it with the existing report plugin. I am guessing it shouldn't be too difficult.
davsclaus:1689561723:2023-07-17T10:42:03.113+0000:1689561723:2023-07-17T10:42:03.113+0000:Any update on this?
cziesman:1691504268:2023-08-08T22:17:48.703+0000:1691504268:2023-08-08T22:17:48.703+0000:Yes, still working on it. Ran into an issue with incorrect reporting of some EIPs, so working to resolve that.
davsclaus:1692100266:2023-08-15T19:51:06.249+0000:1692100266:2023-08-15T19:51:06.249+0000:Thanks Craig for the donation and PR"
0,CAMEL-18634,Bug,Minor,None,3.20.0,"
None
",Resolved,Not A Bug,3.20.0,Claus Ibsen,Claus Ibsen,0,1,2022-10-21 13:49:36+00:00,2022-10-23 08:37:02+00:00,Noticed that a custom health check from jbang was listed twice in output.,"davsclaus:1666341890:2022-10-21T16:44:50.325+0000:1666341890:2022-10-21T16:44:50.325+0000:Ah this is because the custom health check is both readiness and liveness at the same time, and the check performs both, so we have both as a result.
davsclaus:1666346892:2022-10-21T18:08:12.200+0000:1666346892:2022-10-21T18:08:12.200+0000:So we may need to change how we invoke checks, so we avoid the double call
davsclaus:1666485422:2022-10-23T08:37:02.589+0000:1666485422:2022-10-23T08:37:02.589+0000:It was due to the check was both ready and liveness"
0,CAMEL-18633,Task,Minor,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Nicolas Filotto,Manuel Langer,0,2,2022-10-21 08:45:03+00:00,2022-10-24 08:48:43+00:00,"In class org.apache.camel.component.mock.MockEndPoint, there is bug in the following method:


protected void waitForCompleteLatch(long timeout) throws InterruptedException {
    // Wait for a default 10 seconds if resultWaitTime is not set
    long waitTime = timeout == 0 ? 10000L ** : timeout;


    // now let's wait for the results
    LOG.debug(""Waiting on the latch for: {} millis"", timeout);
            **    if (!latch.await(waitTime, TimeUnit.MILLISECONDS)) {
        LOG.warn(""The latch did not reach 0 within the specified time"");
        }
}


Use waitTime instead of timeout in the debug log:


LOG.debug(""Waiting on the latch for: {} millis"", timeout);","nfilotto:1666572523:2022-10-24T08:48:43.052+0000:1666572523:2022-10-24T08:48:43.052+0000:Thanks for reporting.

Fixed by https://github.com/apache/camel/commit/6dda0f98add093b87daa9fa9557bbfa936876b43"
0,CAMEL-18632,Dependency upgrade,Minor,3.14.5,3.14.6,"
None
",Resolved,Fixed,3.14.6,Claus Ibsen,Claus Ibsen,0,1,2022-10-21 07:08:54+00:00,2022-10-21 07:40:37+00:00,No Desc,
0,CAMEL-18631,Dependency upgrade,Major,None,"3.18.3, 3.20.0","
None
",Resolved,Fixed,"3.18.3, 3.20.0",Claus Ibsen,Claus Ibsen,0,1,2022-10-21 05:33:53+00:00,2022-10-21 06:10:40+00:00,No Desc,
0,CAMEL-18630,Improvement,Minor,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Claus Ibsen,Claus Ibsen,0,1,2022-10-20 13:50:09+00:00,2022-10-24 10:02:07+00:00,So you can see more detailed stats of the health checks,
0,CAMEL-18629,Dependency upgrade,Minor,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Unassigned,Claus Ibsen,0,1,2022-10-20 09:09:25+00:00,2022-11-01 11:27:41+00:00,No Desc,
0,CAMEL-18628,New Feature,Major,3.19.0,3.20.0,"
None
",Resolved,Fixed,3.20.0,Claus Ibsen,Tuomas Palenius,0,2,2022-10-20 05:48:01+00:00,2022-11-23 06:47:57+00:00,"Allowing to define autoStartup in the rest-dsl:


1) On the top-level:
 




rest(""/api"")
  .autoStartup(true)
  .get(""..."")
  .get(""..."")



 
Would allow to create chunks of apis that could be enabled/disabled from the configuration (my use-case). The workaround now is to define the endpoints as plain routes.


2) On a particular verb-level:




rest(""/api"")
  .get(""/hello"").autoStartup(false).to(...)



Would allow to enable/disable a single route by using rest-dsl.","davsclaus:1666228446:2022-10-20T09:14:06.368+0000:1666228446:2022-10-20T09:14:06.368+0000:We cannot have autoStartup as that implies the rest service can be enabled at runtime. However we have disabled on the route EIPs coming up in 3.20, so we can consider having that for rest-dsl as well

    @XmlAttribute
    @Metadata(label = ""advanced"", javaType = ""java.lang.Boolean"")
    protected String disabled;

devituomas:1666229348:2022-10-20T09:29:08.671+0000:1666229348:2022-10-20T09:29:08.671+0000:Ok. Disabled on rest-dsl would do the work as long as it has the boolean-parameter, so it can be disabled from the configuration.
davsclaus:1667273221:2022-11-01T11:27:01.769+0000:1667273221:2022-11-01T11:27:01.769+0000:If a rest endpoint is disabled should it then be included in the swagger doc? Or should it be present, but if the endpoint is invoked then it does a noop operation.
So in the /api/hello then when disabled then if invoked then Camel will just return HTTP 204.
Or should we not include it, and if you attempt to invoke it, you get a 404.

devituomas:1667344465:2022-11-02T07:14:25.011+0000:1667344465:2022-11-02T07:14:25.011+0000:I'd prefer not including disabled rest-endpoints in swagger doc, and thus returning 404 upon invoking such.

Including them, and returning 204 could potentially cause confusion, such as wondering how far the request was processed and if there were any side-effects. However, if you decide to include them, the swagger description could be prefixed with ""DISABLED - WILL RETURN 404"" which would leave no room for confusion."
0,CAMEL-18627,Bug,Trivial,"3.18.2, 3.19.0","3.18.3, 3.20.0","
None
",Resolved,Fixed,"3.18.3, 3.20.0",Otavio Rodolfo Piske,rupam,0,2,2022-10-19 16:22:49+00:00,2022-10-20 09:14:40+00:00,"In the updateTaskState() method, if the consumer is resumed and it had no previously stored offset details,  then it throws a null pointer exception when it tries to retrieve ((OffsetAndMetadata) v).offset() information


 




     private void updateTaskState() {
    switch (state) {
      case PAUSE_REQUESTED:
        LOG.info(""Pausing the consumer as a response to a pause request"");
        consumer.pause(consumer.assignment());
        state = State.PAUSED;
        break;
      case RESUME_REQUESTED:
        LOG.info(""Resuming the consumer as a response to a resume request"");
        if (consumer.committed(consumer.assignment()) != null) {
          consumer.committed(consumer.assignment()).forEach((k, v) -> {
                final TopicPartition tp = ((TopicPartition) k);
                LOG.info(""Resuming from offset {} for the topic {}  with partition {}"",
                    ((OffsetAndMetadata) v).offset(), tp.topic(), tp.partition());

                consumer.seek(tp, ((OffsetAndMetadata) v).offset());
              }
          );
        }

        consumer.resume(consumer.assignment());
        state = State.RUNNING;
        break;
      default:
        break;
    } }
 {","orpiske:1666167861:2022-10-19T16:24:21.824+0000:1666168399:2022-10-19T16:33:19.273+0000:[~geek.rupam] thanks for the report. -Can you provide the stack trace, please?-

 

Ok, stack trace not needed after the updated description. 

Are you planning to send a PR for this one as well [~geek.rupam]? Please, feel free to do so! We might still have time to squeeze it in 3.18.3 ...
geek.rupam:1666169845:2022-10-19T16:57:25.415+0000:1666169845:2022-10-19T16:57:25.415+0000:yes. I plan to send the PR  a little later today
orpiske:1666169871:2022-10-19T16:57:51.112+0000:1666169871:2022-10-19T16:57:51.112+0000:Perfect. Thank you!"
0,CAMEL-18626,Improvement,Minor,3.19.0,"3.18.3, 3.20.0","
None
",Resolved,Fixed,"3.18.3, 3.20.0",Claus Ibsen,Raymond,0,2,2022-10-19 11:44:39+00:00,2022-10-19 16:15:39+00:00,"I would like to set the ExchangePattern dynamically with a routetemplate like this:




routeTemplate(""setPattern"")
    .templateParameter(""in"")
    .templateParameter(""out"")
    .templateParameter(""exchangePattern"")
    .from(""{{in}}"")
        .setExchangePattern(""{{myExchangePattern}}"")
        .to(""{{out}}"");



This is currently not possible as template parameters expect only Strings. I tried to work around it. For example:


 




.setExchangePattern(""ExchangePattern.valueOf({{myExchangePattern}})"")

//or
.setProperty(""ExchangePattern"").simple(""${exchange.setPattern('{{ExchangePattern}}')}"")
 




But they don't work because the parameter are interpolated too late in the process. For now, I set a property and use processor to set the ExchangePattern.",davsclaus:1666155119:2022-10-19T12:51:59.013+0000:1666155119:2022-10-19T12:51:59.013+0000:Yeah we can likely expose this as a string type in java dsl
0,CAMEL-18625,New Feature,Major,None,"3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.21.0, 4.0-M3, 4.0.0",Andrea Cosentino,Ajithlal,0,2,2022-10-19 11:40:53+00:00,2023-04-06 05:59:09+00:00,"Currently there is no option to pass specific AWS SAML profile when I am connecting to AWS secret-manager from camel aws vault program.


I am expecting ,need a option to set aws saml profile name inside application.properties file.


If user is make below configuration


camel.vault.aws.defaultCredentialsProvider=false


camel.vault.aws.saml.profileCredentialName=intdev


then it should connect to aws resource.


(""intdev"" is aws saml profile name.""intdev"" is not default profile )","acosentino:1666151263:2022-10-19T11:47:43.886+0000:1666151263:2022-10-19T11:47:43.886+0000:Can you please add a bit more detail, how are you trying to use an AWS SAML Profile? Do you need to pass a ProfileCredentialsProvider to the client builder?
acosentino:1666152224:2022-10-19T12:03:44.083+0000:1666152224:2022-10-19T12:03:44.083+0000:Under the hood the function to get properties from Secrets Manager is using the Secrets Manager v2 java client, so we'll need to find a way to support eventually saml profile from the function code.
acosentino:1666152255:2022-10-19T12:04:15.878+0000:1666152367:2022-10-19T12:06:07.220+0000:It's not really clear from your description, but just adding a different property won't make it work.
lalajith1:1666153574:2022-10-19T12:26:14.437+0000:1666153993:2022-10-19T12:33:13.363+0000:I am using aws saml cli to connect aws resource.My *x_principal_arn* in credential file look like below.

x_principal_arn = arn:aws:sts::xxxxxx:[assumed-role/sso-poweruser/xxxxxx@xxxx.com|mailto:assumed-role/sso-poweruser/xxxxxx@xxxx.com]

x_security_token_expires = 2022-10-19 13:15:11+00:00

Once I login using cli, I can use the session token for specific duration. So I don't want to pass {*}aws_access_key_id{*},{*}aws_secret_access_key{*} explicitly through program. Instead If I am mentioning saml profile name in application.properties ,it will automatically connect when I am connected through aws cli and will expire once session token expire.

 
acosentino:1666154117:2022-10-19T12:35:17.001+0000:1666154206:2022-10-19T12:36:46.009+0000:I need to investigate how and if it is possible to do this in Java SDK v2.
lalajith1:1666154727:2022-10-19T12:45:27.378+0000:1666154833:2022-10-19T12:47:13.862+0000:{{FYI : aws saml profile connectivity using s3}}

 
{code:java}
var client = AmazonS3ClientBuilder.standard()
                .withCredentials(new ProfileCredentialsProvider(""intdev"")).withRegion(awsRegion)
                .build();

 from(""direct:s3connect"")
.to(""aws-s3://\{{app.aws-s3.BucketName}}?amazonS3Client=#client"")

.end();

{code}
acosentino:1666154832:2022-10-19T12:47:12.168+0000:1666154832:2022-10-19T12:47:12.168+0000:So, as I asked before you just want to have a way of specify a ProfileCredentialProvider.
lalajith1:1666155656:2022-10-19T13:00:56.643+0000:1666155677:2022-10-19T13:01:17.985+0000:Yes..it's fine ,If you are providing option to pass ProfileCredentialProvider . Is it possible  to implement  define profile in application.properties file?
acosentino:1666156292:2022-10-19T13:11:32.635+0000:1666156292:2022-10-19T13:11:32.635+0000:We need to add the option to support this and add some cases to the function. I can work on this.
acosentino:1680130790:2023-03-30T06:59:50.993+0000:1680130790:2023-03-30T06:59:50.993+0000:Let me if I can complete this next week.
acosentino:1680676583:2023-04-05T14:36:23.932+0000:1680676583:2023-04-05T14:36:23.932+0000:so now, we'll have 

""camel.vault.aws.profileCredentialsProvider""
""camel.vault.aws.profileName""

options. 

This still needs to be completed, with the Spring Boot part and with the same level of support for Secret Refresh


acosentino:1680679365:2023-04-05T15:22:45.824+0000:1680679365:2023-04-05T15:22:45.824+0000:Spring Boot part done."
0,CAMEL-18624,Bug,Major,3.18.2,"3.18.3, 3.20.0","
None
",Resolved,Fixed,"3.18.3, 3.20.0",Claus Ibsen,Claus Ibsen,0,1,2022-10-19 07:38:47+00:00,2022-10-20 09:05:06+00:00,"This route does not log the file content




- route:
    from:
      uri: file:demodir?probeContentType=true&noop=true
      steps:
        - to: log:info?showFiles=true




You can use --deps=camel:file as workaround",
0,CAMEL-18623,New Feature,Minor,3.18.2,3.x,"
None
",Closed,Not A Problem,3.x,Unassigned,Jeff,0,4,2022-10-18 21:54:18+00:00,2022-10-24 12:48:41+00:00,"Camel mail component does not appear to work with OAuth2. This seems clear from the lack of documentation or unit tests regarding OAuth2, but having spent a few hours trying different approaches it seems like the reason it doesn't work is that it isn't supported. So maybe this is a new feature request if the mail component is indeed not intended to work with OAuth2. If it is intended to work with OAuth2, and there is some evidence of this, please be so kind as to direct me to it. I would be happy to update the docs if this is the case.


Here is the component for reference:


 




from('imaps://{{app.email.exchange.host}}?' +
'mail.imap.auth.mechanisms=XOAUTH2&' +
'mail.imap.starttls.enable=true&' +
'mail.imap.auth.plain.disable=true&' +
'mail.imap.auth.ntlm.disable=true&' +
'mail.imap.auth.gssapi.disable=true&' +
'mail.imap.auth.xoauth2.disable=false&' +
'authenticator=#exchangeAuthenticator&' +
'debugMode=true&' +
'bridgeErrorHandler=true&' +
'delete=true')



 


 


And the debug output:


DEBUG: setDebug: Jakarta Mail version 1.6.7
DEBUG: getProvider() returning javax.mail.Provider[STORE,imaps,com.sun.mail.imap.IMAPSSLStore,Oracle]
DEBUG IMAPS: mail.imap.fetchsize: 16384
DEBUG IMAPS: mail.imap.ignorebodystructuresize: false
DEBUG IMAPS: mail.imap.statuscachetimeout: 1000
DEBUG IMAPS: mail.imap.appendbuffersize: -1
DEBUG IMAPS: mail.imap.minidletime: 10
DEBUG IMAPS: closeFoldersOnStoreFailure
DEBUG IMAPS: trying to connect to host ""outlook.office365.com"", port 993, isSSL true


OK The Microsoft Exchange IMAP4 service is ready. ...
A0 CAPABILITY


CAPABILITY IMAP4 IMAP4rev1 AUTH=PLAIN AUTH=XOAUTH2 SASL-IR UIDPLUS MOVE ID UNSELECT CHILDREN IDLE NAMESPACE LITERAL+
A0 OK CAPABILITY completed.


B0 OK CAPABILITY completed.
DEBUG IMAPS: AUTH: PLAIN
DEBUG IMAPS: AUTH: XOAUTH2
DEBUG IMAPS: protocolConnect login, host=outlook.office365.com, user=user@email.com, password=<non-null>
DEBUG IMAPS: AUTHENTICATE XOAUTH2 command trace suppressed
DEBUG IMAPS: AUTHENTICATE XOAUTH2 command result: B1 NO AUTHENTICATE failed.","davsclaus:1666135126:2022-10-19T07:18:46.400+0000:1666135126:2022-10-19T07:18:46.400+0000:I think some have made camel-mail work with oauth. Camel uses the javax mail JAR so what it supports then that should likely be possible to do with camel-mail too.

You should use additionalJavaMailProperties to set properties on javax mail. So try changing `mail.imap.xxx` to `additionalJavaMailProperties.xxx` instead. You can also put all of that into a properties object and refer to it via #style.

If you get this working then we love contributions and you are welcome to help update the docs
fieldbradley:1666158648:2022-10-19T13:50:48.889+0000:1666158648:2022-10-19T13:50:48.889+0000:The only documentation on the additionalJavaMailProperties I can find is this unit test which shows the mail property in the url: [https://github.com/apache/camel/blob/main/components/camel-mail/src/test/java/org/apache/camel/component/mail/AdditionalMailPropertiesTest.java]

Replacing the inline mail.xxx properties with additionalJavaMailProperties.xxx had no affect on the DEBUG output or authentication.

Moving the properties to a Properties bean and referencing that in the url with `additionalJavaMailProperties=#exchangeProperties` also had not affect on debug output or authentication.

I've also tried adding the mail properties as JVM system properties, and that also has no affect.

So there appear to be multiple issues with the component. I'm still probably using it wrong, but the lack of documentation makes using this component for modern OAuth more complicated than writing a mail client from scratch, so will I might have to go that route due to time constraints.
tmielke:1666316868:2022-10-21T09:47:48.898+0000:1666316868:2022-10-21T09:47:48.898+0000:CAMEL-14795 introduced the option to configure a custom authenticator. Would that help for this use case? You would still need to write a customized mail authenticator class that retrieves and refreshes oauth tokens from MS Exchange.
fieldbradley:1666322806:2022-10-21T11:26:46.744+0000:1666322806:2022-10-21T11:26:46.744+0000:Yes, as you see from the example posted in the issue description above I am using a custom authenticator bean named `exchangeAuthenticator`. I pass the OAuth access token as the password, as shown in the Groovy snippet below.

 
{code:java}
@Component
class ExchangeAuthenticator extends MailAuthenticator {

    @Autowired
    ExchangeTokeCache tokenCache

    @Autowired
    ExchangeConfigurationProperties configurationProperties

    @Override
    PasswordAuthentication getPasswordAuthentication() {
        def accessToken = tokenCache.getToken().accessToken
        def user = configurationProperties.username
        return new PasswordAuthentication(user, accessToken)

    }
} {code}
 

I have confirmed that I am getting a valid token from the authorization server, and that the user name is also valid according to the [exhange OAuth2 for IMAP docs|https://learn.microsoft.com/en-us/exchange/client-developer/legacy-protocols/how-to-authenticate-an-imap-pop-smtp-application-by-using-oauth]. I can also see from the debug logs (also above) that OAuth authentication is being attempted.
tmielke:1666323097:2022-10-21T11:31:37.545+0000:1666323097:2022-10-21T11:31:37.545+0000:Oh sorry [~fieldbradley], I missed that you already specify a custom authenticator class. 
fieldbradley:1666406794:2022-10-22T10:46:34.656+0000:1666407056:2022-10-22T10:50:56.847+0000:Got it working and will submit a pull request to add an example to the docs.

The main difficulty here was with the Exchange configuration and getting the additional mail properties right. In the end, the minimal component configuration that works with Exchange is below. Additional mail properties may be required for other servers, and the Exchange docs for IMAP OAuth2 lead me down some wrong paths with SASL properties, but in the end, this works along with custom MailAuthenticator that handles supplying the OAuth access token and user name.

 
{code:java}
from('imaps://{{app.email.exchange.host}}?' +
    'authenticator=#exchangeAuthenticator&' +
    'mail.imaps.auth.mechanisms=XOAUTH2')
{code}
 

 
ldemasi:1666570059:2022-10-24T08:07:39.626+0000:1666570059:2022-10-24T08:07:39.626+0000:Hi Jeff, I'm in the same situation as you, what kind of oauth flow did you use to get it working? Which scope  did you use during the access token request? 

which permission did you gave to the application in Azure AD?
fieldbradley:1666577908:2022-10-24T10:18:28.765+0000:1666577908:2022-10-24T10:18:28.765+0000:I am using the client_credentials grant flow. 

Here is a yaml snippet with the settings for fetching the token:

client-id: ${CLIENT_ID}
client-secret: ${CLIENT_SECRET}
token-uri: login.microsoftonline.com/${TENANT_ID}/oauth2/v2.0/token
scope: [https://outlook.office365.com/.default]

My DevOps engineer registered the app in Exchange, and this was the part that got us hung up, but ultimately we followed this guide and set up the app with the IMAP.AccessAsApp permission: https://learn.microsoft.com/en-us/exchange/client-developer/legacy-protocols/how-to-authenticate-an-imap-pop-smtp-application-by-using-oauth
ldemasi:1666586921:2022-10-24T12:48:41.068+0000:1666586921:2022-10-24T12:48:41.068+0000:Got it working! Thanks [~fieldbradley] "
0,CAMEL-18591,Improvement,Major,None,None,"
None
",Open,Unresolved,Future,Unassigned,Luca Burgazzoli,0,1,2022-10-06 09:50:53+00:00,2023-07-26 05:47:00+00:00,"Some components rely on header values to react to exchange completion, as example the AWS S3 component, uses the bucked name and key to delete or move buckets on completion [1].


As headers are often manipulated by users and may affect other downstream processing logic, it would be better to move such information to the exchange properties.


For backward compatibility we could add a double lookup like:




var name = exchange.getProperty(AWS2S3Constants.BUCKET_NAME, String.class);
if (name == null) {
    name = exchange.getMessage().getHeader(AWS2S3Constants.BUCKET_NAME, String.class);
}




[1] https://github.com/apache/camel/blob/2263301d9701d4ddfe306ea52aa05deffdd7b0b9/components/camel-aws/camel-aws2-s3/src/main/java/org/apache/camel/component/aws2/s3/AWS2S3Consumer.java#L314-L315",
0,CAMEL-18590,Improvement,Major,None,4.4.0,"
None
",Resolved,Fixed,4.4.0,Andrea Cosentino,Andrea Cosentino,0,1,2022-10-06 08:38:53+00:00,2023-12-19 10:41:27+00:00,"We have currently different approach for authenticating against Azure services. For example in Azure Storage Blob we have the credentialType parameter which is an enum and we have three possible values. In Azure Eventhubs we have tokenCredential in combination with other possible approaches.


We should have just one way and one set of parameters in all the Azure components, like we have in AWS and we are trying to do in GCP.",
0,CAMEL-18589,Bug,Minor,None,"3.18.3, 3.20.0","
None
",Resolved,Fixed,"3.18.3, 3.20.0",Claus Ibsen,Praveen Prabhu,0,2,2022-10-06 06:53:30+00:00,2022-10-09 09:25:39+00:00,"The readHeaders() method in DefaultHttpBinding class has a bug. The loop ""while (names.hasMoreElements()"" iterates over all the header names in a http request, and the statement ""String value = request.getHeader(name);"" ends up reading only one header of the given name. Underlying http request object created by implementations like jetty use Set<String> internally to return unique names for the request.getHeaderNames(), hence if there are multiple headers with same name (e.g. Cookie), then this ends up in creating only a single entry in the exchange headers. I think this can be fixed by calling getHeaders(name) method on the request object rather than the getHeader(name) and then enumerate over the returned values and set a list of headers of the same name.","davsclaus:1665084991:2022-10-07T03:36:31.083+0000:1665084991:2022-10-07T03:36:31.083+0000:You are welcome to send a PR
prabhupraveen:1665265395:2022-10-09T05:43:15.724+0000:1665265395:2022-10-09T05:43:15.724+0000:Attached a patch file."
0,CAMEL-18588,Bug,Minor,3.18.0,"3.18.3, 3.20.0","
None
",Resolved,Fixed,"3.18.3, 3.20.0",Otavio Rodolfo Piske,rupam,0,3,2022-10-06 03:27:57+00:00,2023-10-03 09:01:28+00:00,"In Camel-Kafka , if max poll records is set to more than 1 and breakOnFirstError is set to TRUE, then on any exception thrown on the first message in the batch will cause the KafkaConsumer to start repolling from zero offset because partitionLastOffset is -1 for the first message




  private boolean processException(
            Exchange exchange, TopicPartition partition, long partitionLastOffset,
            ExceptionHandler exceptionHandler) {

        // processing failed due to an unhandled exception, what should we do
        if (configuration.isBreakOnFirstError()) {
            // we are failing and we should break out
            if (LOG.isWarnEnabled()) {
                LOG.warn(""Error during processing {} from topic: {}"", exchange, partition.topic(), exchange.getException());
                LOG.warn(""Will seek consumer to offset {} and start polling again."", partitionLastOffset);
            }

            // force commit, so we resume on next poll where we failed
            commitManager.forceCommit(partition, partitionLastOffset);

            // continue to next partition
            return true;
        } else {
            // will handle/log the exception and then continue to next
            exceptionHandler.handleException(""Error during processing"", exchange, exchange.getException());
        }

        return false;
    }","klease78:1665389224:2022-10-10T16:07:04.767+0000:1665389224:2022-10-10T16:07:04.767+0000:[~geek.rupam] I think the changes made for CAMEL-18350 should fix this.
geek.rupam:1665397192:2022-10-10T18:19:52.308+0000:1665397192:2022-10-10T18:19:52.308+0000:CAMEL-18350 doesn't safeguard against the case when the Kafka consumer restarted after a few commits and fails at the first message in a poll 
orpiske:1665444064:2022-10-11T07:21:04.752+0000:1665444064:2022-10-11T07:21:04.752+0000:[~geek.rupam] thank you for the fix! I assigned the ticket to me - as your profile on Jira is not yet available for ticket assignment. I'll eval and, if needed, backport this to 3.18 codebase."
0,CAMEL-18587,Bug,Minor,3.18.0,"3.18.3, 3.20.0","
None
",Resolved,Fixed,"3.18.3, 3.20.0",Otavio Rodolfo Piske,rupam,0,2,2022-10-06 03:23:37+00:00,2022-10-12 16:20:40+00:00,"In KafkaFetchRecords' startPolling method , if breakOnErrorHit is true, the KafkaConsumer closes instead of pausing.


 




while (isKafkaConsumerRunnableAndNotStopped() && isConnected() && pollExceptionStrategy.canContinue()) {
ConsumerRecords<Object, Object> allRecords = consumer.poll(pollDuration);
if (consumerListener != null) {
if (!consumerListener.afterConsume(consumer)) {
continue;
}
}

ProcessingResult result = recordProcessorFacade.processPolledRecords(allRecords, lastResult);

if (result.isBreakOnErrorHit()) {
LOG.debug(""We hit an error ... setting flags to force reconnect"");
// force re-connect
setReconnect(true);
setConnected(false);
} else {
lastResult = result;
}

updateTaskState();
}","orpiske:1665527574:2022-10-12T06:32:54.371+0000:1665527574:2022-10-12T06:32:54.371+0000:[~geek.rupam] thank you for the fix! I assigned the ticket to me - as your profile on Jira is not yet available for ticket assignment. I'll eval and, if needed, backport this to 3.18 codebase.
orpiske:1665562840:2022-10-12T16:20:40.199+0000:1665562840:2022-10-12T16:20:40.199+0000:Closing as they should have been fixed now."
0,CAMEL-18586,Bug,Minor,3.18.2,"3.18.3, 3.20.0","
None
",Resolved,Cannot Reproduce,"3.18.3, 3.20.0",Unassigned,Martin Frei,0,1,2022-10-05 13:28:21+00:00,2022-10-17 08:17:58+00:00,See https://camel.zulipchat.com/#narrow/stream/257298-camel/topic/Hanging.20JVM.20through.20interceptFrom.20interceptSendToEndpoint,
0,CAMEL-18585,Bug,Minor,"3.18.2, 3.19.0","3.18.3, 3.20.0","
None
",Resolved,Not A Bug,"3.18.3, 3.20.0",Otavio Rodolfo Piske,Otavio Rodolfo Piske,0,3,2022-10-05 10:15:05+00:00,2022-10-20 13:00:07+00:00,"A user reported a strange behavior with the Validator. It appears - though not yet confirmed - that the validator is not being called in some circumstances.


A reproducer was provided: https://github.com/Croway/camel/blob/validator-with-scheduler/core/camel-core/src/test/java/org/apache/camel/component/validator/ValidatorWithSchedulerTest.java","davsclaus:1666053860:2022-10-18T08:44:20.999+0000:1666053860:2022-10-18T08:44:20.999+0000:Ah its the route contract stuff that are seldom in use. 

Instead of using a scheduler then start the test with a direct and call it, otherwise the scheduler can trigger before the test method
orpiske:1666057213:2022-10-18T09:40:13.905+0000:1666057213:2022-10-18T09:40:13.905+0000:C/c: [~Federico Mariani] 
Federico Mariani:1666057598:2022-10-18T09:46:38.540+0000:1666057598:2022-10-18T09:46:38.540+0000:Thanks [~davsclaus], [~orpiske], if _otherwise the scheduler can trigger before the test method_ is expected I'm ok with it, I think that there is a StackOverflow question about it and all the tests use ""direct"". 

My concern was, what if instead of ""scheduler"" I'm using another component like ""jms""? do I have to create another route in order to use the Validator? again, if this is expected, the issue can be closed then.
davsclaus:1666060561:2022-10-18T10:36:01.947+0000:1666060561:2022-10-18T10:36:01.947+0000:Its more about the mocks, when they are being setup in the test method, then a mock endpoint may already have received X messages prior. 

However in this case the mock tests are only that 1 message arrived etc, so its safter, but its still better to do

@Test
public void testMethodHere
1. setup mock expecations

2. use template to send message(s) to the route

3. assert mocks

This is explained in the CiA2 book in the testing chapter.
davsclaus:1666066428:2022-10-18T12:13:48.384+0000:1666066428:2022-10-18T12:13:48.384+0000:Ah okay so this is not a bug, the inputTypeWithValidate validates what the message body is from the consumer. Because the consumer is scheduler, then the message body is null/empty.
You then afterwards set the message body via setBody, which does not trigger inputTypeWithValidate.

However if you use direct and send a message body to this route then it works.

See this test
https://github.com/apache/camel/commit/f06229ac118ea4bbda20eb095963db9a02da7c57
Federico Mariani:1666081317:2022-10-18T16:21:57.874+0000:1666081317:2022-10-18T16:21:57.874+0000:[~davsclaus] thanks for your feedback. 

{code:java}
 Because the consumer is scheduler, then the message body is null/empty.
You then afterwards set the message body via setBody, which does not trigger inputTypeWithValidate.
{code}

makes sense!

[~orpiske] this issue can be closed as explained, thank you."
0,CAMEL-18584,Improvement,Minor,3.19.0,3.20.0,"
None
",Resolved,Fixed,3.20.0,Unassigned,Manuel Shenavai,0,1,2022-10-05 10:09:28+00:00,2022-10-05 11:32:06+00:00,During the enhancements of the attachment handling (https://issues.apache.org/jira/browse/CAMEL-18481) an existing constructor was extended which could result in regressions for users that invoke this constructor from a derived class,mash-sap:1664936426:2022-10-05T10:20:26.252+0000:1664936426:2022-10-05T10:20:26.252+0000:PR created: [https://github.com/apache/camel/pull/8482]
0,CAMEL-18583,Bug,Major,"3.18.2, 3.19.0","3.18.3, 3.20.0","
None
",Resolved,Fixed,"3.18.3, 3.20.0",Luigi De Masi,Luigi De Masi,0,1,2022-10-04 17:03:45+00:00,2022-10-05 12:30:09+00:00,"The bug is in the org.apache.camel.component.minio.MinioProducer.deleteObjects() method.
Minio API performs deletion lazily, deleteObjects request is performed while iterating through the result object.
https://min.io/docs/minio/linux/developers/java/API.html#removeobjects-removeobjectsargs-args



Removes multiple objects lazily. Its required to iterate the returned Iterable to perform removal.","ldemasi:1664944209:2022-10-05T12:30:09.941+0000:1664944209:2022-10-05T12:30:09.941+0000:Pull Requests:

{*}3.18-x{*}:  [https://github.com/apache/camel/pull/8484]

{*}main{*}:    https://github.com/apache/camel/pull/8483"
0,CAMEL-18582,Task,Major,None,,"
None
",Resolved,Fixed,None,Nicolas Filotto,Nicolas Filotto,0,1,2022-10-04 08:58:58+00:00,2022-10-10 10:45:32+00:00,"The build regularly fails with an error of type:


 


2022-10-04T08:27:32.6309180Z [ERROR] Could not acquire write lock for '/home/runner/.m2/repository/.locks/jakarta.activation~jakarta.activation-api~1.2.2.resolverlock' 2022-10-04T08:27:32.6313534Z [ERROR] Camel :: Management: Could not acquire write lock for '/home/runner/.m2/repository/.locks/jakarta.activation~jakarta.activation-api~1.2.2.resolverlock'


 


The goal of this task is to investigate the issue and find a way to fix it or at least find a workaround.","nfilotto:1664929965:2022-10-05T08:32:45.081+0000:1664929965:2022-10-05T08:32:45.081+0000:Since we upgraded mvnd to 0.8, the locking of the artifacts is now made by default with a file locking ([apache/maven-mvnd#508|https://github.com/apache/maven-mvnd/pull/508]) which causes regular build failures due to write lock issues, as workaround I proposed in this PR [https://github.com/apache/camel/pull/8481] to change of named lock factory for something equivalent to what we had with mvnd 0.7
nfilotto:1664930261:2022-10-05T08:37:41.002+0000:1664930261:2022-10-05T08:37:41.002+0000:Another related PR https://github.com/apache/camel/pull/8461
nfilotto:1664940006:2022-10-05T11:20:06.686+0000:1664940014:2022-10-05T11:20:14.715+0000:It appears that the problem still happens with the LocalReadWriteLockNamedLockFactory so the lock timeout is increased to 5 minutes and a thread dump is automatically generated in case of a lock issue to be able to investigate deeper if it still occurs.
nfilotto:1664943020:2022-10-05T12:10:20.745+0000:1664943020:2022-10-05T12:10:20.745+0000:With these workarounds, let's see if the problem still occurs and if so don't hesitate to reopen this ticket
nfilotto:1664948179:2022-10-05T13:36:19.191+0000:1664948179:2022-10-05T13:36:19.191+0000:The problem still occurs https://github.com/apache/camel/actions/runs/3189606199 
nfilotto:1665123206:2022-10-07T14:13:26.409+0000:1665123206:2022-10-07T14:13:26.409+0000:After a deeper analysis, it appears that the build failures are indirectly due to errors of type {{I/O exception (java.net.SocketException) caught when processing request to \{s}->https://repo.maven.apache.org:443: Connection timed out (Read failed)}} which has consequences to keep the lock on the artifacts for more than 15 minutes such that the build ends up with a lock issue since the lock timeout is only 5 minutes.

 

The PR to update the timeouts involved https://github.com/apache/camel/pull/8488
nfilotto:1665123996:2022-10-07T14:26:36.545+0000:1665124198:2022-10-07T14:29:58.249+0000:With the latest fix, we now get errors of type {{{}SocketTimeoutException: Read timed out{}}}. It is clear that for an unknown reason, the runner loses regularly the connection with maven central for some period of time and then recovers it.

 
{noformat}
[ERROR] Plugin org.codehaus.mojo:exec-maven-plugin:1.6.0 or one of its dependencies could not be resolved: Failed to read artifact descriptor for org.codehaus.mojo:exec-maven-plugin:jar:1.6.0: Could not transfer artifact org.codehaus.mojo:exec-maven-plugin:pom:1.6.0 from/to central (https://repo.maven.apache.org/maven2): transfer failed for https://repo.maven.apache.org/maven2/org/codehaus/mojo/exec-maven-plugin/1.6.0/exec-maven-plugin-1.6.0.pom: Read timed out -> [Help 1]
org.apache.maven.plugin.PluginResolutionException: Plugin org.codehaus.mojo:exec-maven-plugin:1.6.0 or one of its dependencies could not be resolved: Failed to read artifact descriptor for org.codehaus.mojo:exec-maven-plugin:jar:1.6.0
at org.apache.maven.plugin.internal.DefaultPluginDependenciesResolver.resolve(DefaultPluginDependenciesResolver.java:133)
at org.mvndaemon.mvnd.plugin.CliMavenPluginManager.lambda$getPluginDescriptor$0(CliMavenPluginManager.java:189)
at org.mvndaemon.mvnd.cache.invalidating.InvalidatingPluginDescriptorCache.lambda$get$0(InvalidatingPluginDescriptorCache.java:100)
at org.mvndaemon.mvnd.cache.impl.TimestampCacheFactory$TimestampCache.lambda$computeIfAbsent$2(TimestampCacheFactory.java:183)
at java.base/java.util.concurrent.ConcurrentHashMap.compute(ConcurrentHashMap.java:1947)
at org.mvndaemon.mvnd.cache.impl.TimestampCacheFactory$TimestampCache.computeIfAbsent(TimestampCacheFactory.java:171)
at org.mvndaemon.mvnd.cache.invalidating.InvalidatingPluginDescriptorCache.get(InvalidatingPluginDescriptorCache.java:98)
at org.mvndaemon.mvnd.plugin.CliMavenPluginManager.getPluginDescriptor(CliMavenPluginManager.java:188)
at org.mvndaemon.mvnd.plugin.CliMavenPluginManager.getMojoDescriptor(CliMavenPluginManager.java:274)
at org.apache.maven.plugin.DefaultBuildPluginManager.getMojoDescriptor(DefaultBuildPluginManager.java:244)
at org.apache.maven.lifecycle.internal.DefaultLifecycleExecutionPlanCalculator.setupMojoExecution(DefaultLifecycleExecutionPlanCalculator.java:169)
at org.apache.maven.lifecycle.internal.DefaultLifecycleExecutionPlanCalculator.setupMojoExecutions(DefaultLifecycleExecutionPlanCalculator.java:154)
at org.apache.maven.lifecycle.internal.DefaultLifecycleExecutionPlanCalculator.calculateExecutionPlan(DefaultLifecycleExecutionPlanCalculator.java:130)
at org.apache.maven.lifecycle.internal.DefaultLifecycleExecutionPlanCalculator.calculateExecutionPlan(DefaultLifecycleExecutionPlanCalculator.java:144)
at org.apache.maven.lifecycle.internal.builder.BuilderCommon.resolveBuildPlan(BuilderCommon.java:98)
at org.apache.maven.lifecycle.internal.LifecycleModuleBuilder.buildProject(LifecycleModuleBuilder.java:111)
at org.mvndaemon.mvnd.builder.SmartBuilderImpl.buildProject(SmartBuilderImpl.java:178)
at org.mvndaemon.mvnd.builder.SmartBuilderImpl$ProjectBuildTask.run(SmartBuilderImpl.java:198)
at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515)
at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
at java.base/java.lang.Thread.run(Thread.java:829)
Caused by: org.eclipse.aether.resolution.ArtifactDescriptorException: Failed to read artifact descriptor for org.codehaus.mojo:exec-maven-plugin:jar:1.6.0
at org.apache.maven.repository.internal.DefaultArtifactDescriptorReader.loadPom(DefaultArtifactDescriptorReader.java:255)
at org.apache.maven.repository.internal.DefaultArtifactDescriptorReader.readArtifactDescriptor(DefaultArtifactDescriptorReader.java:171)
at org.eclipse.aether.internal.impl.DefaultRepositorySystem.readArtifactDescriptor(DefaultRepositorySystem.java:263)
at org.apache.maven.plugin.internal.DefaultPluginDependenciesResolver.resolve(DefaultPluginDependenciesResolver.java:107)
... 22 common frames omitted
Caused by: org.eclipse.aether.resolution.ArtifactResolutionException: Could not transfer artifact org.codehaus.mojo:exec-maven-plugin:pom:1.6.0 from/to central (https://repo.maven.apache.org/maven2): transfer failed for https://repo.maven.apache.org/maven2/org/codehaus/mojo/exec-maven-plugin/1.6.0/exec-maven-plugin-1.6.0.pom
at org.eclipse.aether.internal.impl.DefaultArtifactResolver.resolve(DefaultArtifactResolver.java:431)
at org.eclipse.aether.internal.impl.DefaultArtifactResolver.resolveArtifacts(DefaultArtifactResolver.java:235)
at org.eclipse.aether.internal.impl.DefaultArtifactResolver.resolveArtifact(DefaultArtifactResolver.java:212)
at org.apache.maven.repository.internal.DefaultArtifactDescriptorReader.loadPom(DefaultArtifactDescriptorReader.java:240)
... 25 common frames omitted
Caused by: org.eclipse.aether.transfer.ArtifactTransferException: Could not transfer artifact org.codehaus.mojo:exec-maven-plugin:pom:1.6.0 from/to central (https://repo.maven.apache.org/maven2): transfer failed for https://repo.maven.apache.org/maven2/org/codehaus/mojo/exec-maven-plugin/1.6.0/exec-maven-plugin-1.6.0.pom
at org.eclipse.aether.connector.basic.ArtifactTransportListener.transferFailed(ArtifactTransportListener.java:52)
at org.eclipse.aether.connector.basic.BasicRepositoryConnector$TaskRunner.run(BasicRepositoryConnector.java:369)
at org.eclipse.aether.util.concurrency.RunnableErrorForwarder.lambda$wrap$0(RunnableErrorForwarder.java:73)
at org.eclipse.aether.connector.basic.BasicRepositoryConnector$DirectExecutor.execute(BasicRepositoryConnector.java:627)
at org.eclipse.aether.connector.basic.BasicRepositoryConnector.get(BasicRepositoryConnector.java:262)
at org.eclipse.aether.internal.impl.DefaultArtifactResolver.performDownloads(DefaultArtifactResolver.java:520)
at org.eclipse.aether.internal.impl.DefaultArtifactResolver.resolve(DefaultArtifactResolver.java:408)
... 28 common frames omitted
Caused by: org.apache.maven.wagon.TransferFailedException: transfer failed for https://repo.maven.apache.org/maven2/org/codehaus/mojo/exec-maven-plugin/1.6.0/exec-maven-plugin-1.6.0.pom
at org.apache.maven.wagon.providers.http.wagon.shared.AbstractHttpClientWagon.fillInputData(AbstractHttpClientWagon.java:1250)
at org.apache.maven.wagon.providers.http.wagon.shared.AbstractHttpClientWagon.fillInputData(AbstractHttpClientWagon.java:1140)
at org.apache.maven.wagon.StreamWagon.getInputStream(StreamWagon.java:126)
at org.apache.maven.wagon.StreamWagon.getIfNewer(StreamWagon.java:88)
at org.apache.maven.wagon.StreamWagon.get(StreamWagon.java:61)
at org.eclipse.aether.transport.wagon.WagonTransporter$GetTaskRunner.run(WagonTransporter.java:541)
at org.eclipse.aether.transport.wagon.WagonTransporter.execute(WagonTransporter.java:425)
at org.eclipse.aether.transport.wagon.WagonTransporter.get(WagonTransporter.java:400)
at org.eclipse.aether.connector.basic.BasicRepositoryConnector$GetTaskRunner.runTask(BasicRepositoryConnector.java:457)
at org.eclipse.aether.connector.basic.BasicRepositoryConnector$TaskRunner.run(BasicRepositoryConnector.java:364)
... 33 common frames omitted
Caused by: java.net.SocketTimeoutException: Read timed out
at java.base/java.net.SocketInputStream.socketRead0(Native Method)
at java.base/java.net.SocketInputStream.socketRead(SocketInputStream.java:115)
at java.base/java.net.SocketInputStream.read(SocketInputStream.java:168)
at java.base/java.net.SocketInputStream.read(SocketInputStream.java:140)
at java.base/sun.security.ssl.SSLSocketInputRecord.read(SSLSocketInputRecord.java:478)
at java.base/sun.security.ssl.SSLSocketInputRecord.readHeader(SSLSocketInputRecord.java:472)
at java.base/sun.security.ssl.SSLSocketInputRecord.bytesInCompletePacket(SSLSocketInputRecord.java:70)
at java.base/sun.security.ssl.SSLSocketImpl.readApplicationRecord(SSLSocketImpl.java:1454)
at java.base/sun.security.ssl.SSLSocketImpl$AppInputStream.read(SSLSocketImpl.java:1065)
at org.apache.maven.wagon.providers.http.httpclient.impl.io.SessionInputBufferImpl.streamRead(SessionInputBufferImpl.java:137)
at org.apache.maven.wagon.providers.http.httpclient.impl.io.SessionInputBufferImpl.fillBuffer(SessionInputBufferImpl.java:153)
at org.apache.maven.wagon.providers.http.httpclient.impl.io.SessionInputBufferImpl.readLine(SessionInputBufferImpl.java:280){noformat}
 
nfilotto:1665369686:2022-10-10T10:41:26.688+0000:1665369932:2022-10-10T10:45:32.432+0000:By default, {{SocketTimeoutException}} as a subclass of {{InterruptedIOException}} is part of the non-retryable classes which is the reason why no retries are made, so we need to redefine the non-retryable classes without {{InterruptedIOException}} to make sure that it will retry in case of {{Read timed out}}

The PR to remove SocketTimeoutException from non retryable classes [https://github.com/apache/camel/pull/8497]

 

During the last build, we can see [in the log file|https://github.com/apache/camel/actions/runs/3209749409/jobs/5261980216] that several `read timed out`s occurred but the build still passed, so it should be good now.

 
{code:java}
[camel-mapstruct] [INFO] I/O exception (java.net.SocketTimeoutException) caught when processing request to
{s}->https://repo.maven.apache.org:443: Read timed out
[camel-mapstruct] [INFO] Retrying request to {s}
->https://repo.maven.apache.org:443
[camel-mapstruct] [INFO] 
[camel-mapstruct] [INFO] — maven-enforcer-plugin:3.0.0:enforce (enforce-java-version) @ camel-mapstruct —
[camel-mapstruct] [INFO] 
[camel-mapstruct] [INFO] — maven-enforcer-plugin:3.0.0:enforce (enforce-maven) @ camel-mapstruct —
[camel-mapstruct] [INFO] 
[camel-mapstruct] [INFO] — camel-bundle-plugin:3.20.0-SNAPSHOT:cleanVersions (versions) @ camel-mapstruct —
[camel-mapstruct] [INFO] 
[camel-mapstruct] [INFO] — build-helper-maven-plugin:3.2.0:add-source (default) @ camel-mapstruct —
[camel-mapstruct] [INFO] Source directory: /home/runner/work/camel/camel/components/camel-mapstruct/src/generated/java added.
[camel-mapstruct] [INFO] 
[camel-mapstruct] [INFO] — build-helper-maven-plugin:3.2.0:add-resource (default) @ camel-mapstruct —
[camel-mapstruct] [INFO] 
[camel-mapstruct] [INFO] — maven-resources-plugin:3.2.0:resources (default-resources) @ camel-mapstruct —
[camel-mapstruct] [INFO] Using 'UTF-8' encoding to copy filtered resources.
[camel-mapstruct] [INFO] Using 'UTF-8' encoding to copy filtered properties files.
[camel-mapstruct] [INFO] skip non existing resourceDirectory /home/runner/work/camel/camel/components/camel-mapstruct/src/main/resources
[camel-mapstruct] [INFO] Copying 6 resources
[camel-mapstruct] [INFO] 
[camel-mapstruct] [INFO] — flatten-maven-plugin:1.2.5:flatten (default-cli) @ camel-mapstruct —
[camel-mapstruct] [INFO] Generating flattened POM of project org.apache.camel:camel-mapstruct:jar:3.20.0-SNAPSHOT...
[camel-mapstruct] [INFO] 
[camel-mapstruct] [INFO] — maven-compiler-plugin:3.8.1:compile (default-compile) @ camel-mapstruct —
[camel-mapstruct] [INFO] Changes detected - recompiling the module!
[camel-mapstruct] [INFO] Compiling 8 source files to /home/runner/work/camel/camel/components/camel-mapstruct/target/classes
[camel-mapstruct] [INFO] 
[camel-mapstruct] [INFO] — camel-package-maven-plugin:3.20.0-SNAPSHOT:generate (generate) @ camel-mapstruct —
[camel-mapstruct] [INFO] No previous run data found, generating files.
[camel-mapstruct] [INFO] Building index...
{code}
 "
0,CAMEL-18581,New Feature,Major,None,4.x,"
None
",Resolved,Won't Fix,4.x,Unassigned,Claus Ibsen,0,1,2022-10-04 00:59:10+00:00,2023-12-22 12:43:51+00:00,"Users that just want to run a camel integration once, eg process 1 message or process until ""being idle for N seconds"" then you cannot do this across runtimes in a very easy way.


You would need to use maxMessages configuration and set that in SB / Quarkus / Main etc. However this requires doing so in application.properties etc.


If we have a kamelet where users can ""fool"" by saying to shutdown after 1 message or timeout after 10 seconds, then users can easily configure this.",
0,CAMEL-18580,Improvement,Minor,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Nicolas Filotto,Nicolas Filotto,0,1,2022-10-03 16:48:33+00:00,2022-10-05 20:08:37+00:00,"In Camel 3.19, a new component based on the Java Api Client has been proposed. This component provides a blocking producer which could be improved by leveraging the asynchronous client to propose a non-blocking/asynchronous producer instead.",nfilotto:1664788861:2022-10-03T17:21:01.983+0000:1664788861:2022-10-03T17:21:01.983+0000:The corresponding PR https://github.com/apache/camel/pull/8459
0,CAMEL-18579,Bug,Major,"3.18.2, 3.19.0","3.18.3, 3.20.0","
None
",Resolved,Fixed,"3.18.3, 3.20.0",Unassigned,Jan Filipski,0,2,2022-10-03 13:16:10+00:00,2022-10-05 18:00:34+00:00,"CxfRsConsumer class has a direct dependency to CxfUtils (from another bundle). Osgi import to package org.apache.camel.component.cxf.util is now explicity disabled, so if CxfUtils is called, that cause ClassNotFoundException from runtime.


It's easy reproducable, probably on all versions containing camel-cxf-rest bundle (after CAMEL-9627).


After fault on rest endpoint, outFaultObserver is called and that cause runtime ClassNotFoundException on osgi environments.


Example stacktrace:



java.lang.NoClassDefFoundError: org/apache/camel/component/cxf/util/CxfUtils
        at org.apache.camel.component.cxf.jaxrs.CxfRsConsumer.lambda$createServer$0(CxfRsConsumer.java:65) ~[?:?]
        at org.apache.cxf.phase.PhaseInterceptorChain.wrapExceptionAsFault(PhaseInterceptorChain.java:373) ~[?:?]
        at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:331) ~[?:?]
        at org.apache.cxf.interceptor.security.JAASLoginInterceptor$1.run(JAASLoginInterceptor.java:159) ~[?:?]
        at org.apache.cxf.interceptor.security.JAASLoginInterceptor$1.run(JAASLoginInterceptor.java:152) ~[?:?]
        at java.security.AccessController.doPrivileged(AccessController.java:399) ~[?:?]
        at javax.security.auth.Subject.doAs(Subject.java:376) ~[?:?]
        at org.apache.cxf.interceptor.security.JAASLoginInterceptor.handleMessage(JAASLoginInterceptor.java:152) ~[?:?]
        at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:307) ~[?:?]
        at org.apache.cxf.transport.ChainInitiationObserver.onMessage(ChainInitiationObserver.java:121) ~[?:?]
        at org.apache.cxf.transport.http.AbstractHTTPDestination.invoke(AbstractHTTPDestination.java:265) ~[?:?]
        at org.apache.cxf.transport.servlet.ServletController.invokeDestination(ServletController.java:234) ~[?:?]
        at org.apache.cxf.transport.servlet.ServletController.invoke(ServletController.java:208) ~[?:?]
        at org.apache.cxf.transport.servlet.ServletController.invoke(ServletController.java:160) ~[?:?]
        at org.apache.cxf.transport.servlet.CXFNonSpringServlet.invoke(CXFNonSpringServlet.java:225) ~[?:?]
        at org.apache.cxf.transport.servlet.AbstractHTTPServlet.handleRequest(AbstractHTTPServlet.java:304) ~[?:?]
        at org.apache.cxf.transport.servlet.AbstractHTTPServlet.doPost(AbstractHTTPServlet.java:217) ~[?:?]
        at javax.servlet.http.HttpServlet.service(HttpServlet.java:517) ~[?:?]
        at org.apache.cxf.transport.servlet.AbstractHTTPServlet.service(AbstractHTTPServlet.java:279) ~[?:?]
        at org.ops4j.pax.web.service.spi.servlet.OsgiInitializedServlet.service(OsgiInitializedServlet.java:74) ~[?:?]
        at org.eclipse.jetty.servlet.ServletHolder$NotAsync.service(ServletHolder.java:1450) ~[?:?]
        at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:799) ~[?:?]
        at org.eclipse.jetty.servlet.ServletHandler$ChainEnd.doFilter(ServletHandler.java:1656) ~[?:?]
        at org.ops4j.pax.web.service.spi.servlet.OsgiFilterChain.doFilter(OsgiFilterChain.java:100) ~[?:?]
        at org.ops4j.pax.web.service.jetty.internal.PaxWebServletHandler.doHandle(PaxWebServletHandler.java:310) ~[?:?]
        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143) ~[?:?]
        at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:600) ~[?:?]
        at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:127) ~[?:?]
        at org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:235) ~[?:?]
        at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1624) ~[?:?]
        at org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:233) ~[?:?]
        at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1440) ~[?:?]
        at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:188) ~[?:?]
        at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:505) ~[?:?]
        at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1594) ~[?:?]
        at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:186) ~[?:?]
        at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1355) ~[?:?]
        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141) ~[?:?]
        at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:234) ~[?:?]
        at org.ops4j.pax.web.service.jetty.internal.PrioritizedHandlerCollection.handle(PrioritizedHandlerCollection.java:96) ~[?:?]



 


Fix - not tested yet, but removing explict import removal from pom.xml should be enough (line containing !org.apache.camel.component.cxf.util)","davsclaus:1664854617:2022-10-04T11:36:57.856+0000:1664854617:2022-10-04T11:36:57.856+0000:Can you send a PR with your suggested fix
globalbus:1664858415:2022-10-04T12:40:15.886+0000:1664858415:2022-10-04T12:40:15.886+0000:sure. 
[https://github.com/apache/camel/pull/8465]

temporal solution that works, is to add Fragment bundle with missing import.
{code:java}
Manifest-Version: 1.0
Bundle-ManifestVersion: 2
Bundle-Name: bundle-camel-fix
Bundle-SymbolicName: com.company.bundle-camel-fix.1.0.0
Bundle-Version: 1.0.0
Fragment-Host: org.apache.camel.camel-cxf-rest
Import-Package: org.apache.camel.component.cxf.util{code}
 
davsclaus:1664964034:2022-10-05T18:00:34.889+0000:1664964034:2022-10-05T18:00:34.889+0000:Fixed by PR
https://github.com/apache/camel/pull/8465"
0,CAMEL-18578,Improvement,Minor,3.19.0,3.20.0,"
None
",Resolved,Fixed,3.20.0,Federico Mariani,Federico Mariani,0,1,2022-10-03 12:19:32+00:00,2022-10-05 11:32:38+00:00,"Use JDK11 HttpClient
Fix test
Use correct printDuration for durations < 1s",Federico Mariani:1664770817:2022-10-03T12:20:17.623+0000:1664770817:2022-10-03T12:20:17.623+0000:https://github.com/apache/camel/pull/8456
0,CAMEL-18577,Dependency upgrade,Major,None,None,"
None
",Resolved,Won't Fix,None,Ramu,Andrea Cosentino,0,3,2022-10-03 12:16:09+00:00,2023-05-30 12:29:46+00:00,No Desc,"ramu11:1665095051:2022-10-07T06:24:11.778+0000:1665095115:2022-10-07T06:25:15.396+0000:solr-solrj require solr-cell jar but latest version for 'org.apache.solr » solr-cell' available  is 8.11.2

as of now updating to 8.11.2

https://mvnrepository.com/artifact/org.apache.solr/solr-cell
nfilotto:1665107415:2022-10-07T09:50:15.979+0000:1665107415:2022-10-07T09:50:15.979+0000:[~ramu11] I believe that it is because solr-cell has been renamed to solr-extraction, see upgrade notes https://solr.apache.org/guide/solr/latest/upgrade-notes/major-changes-in-solr-9.html
ramu11:1665704092:2022-10-14T07:34:52.402+0000:1665704180:2022-10-14T07:36:20.004+0000:[~nfilotto] 9.0 version uses CloudHttp2SolrClient  else have to use deprecated api [CloudLegacySolrClient |https://issues.apache.org/jira/browse/SOLR-15223]

if  CloudHttp2SolrClient is used then need to use http2clients

  SolrClientHandlerCloud.java:[44,66] error: incompatible types: HttpClient cannot be converted to Http2SolrClient

so how we proceed here



nfilotto:1665729231:2022-10-14T14:33:51.613+0000:1665729231:2022-10-14T14:33:51.613+0000:[~ramu11] Yeah I know, there are some breaking changes to take into account, it is not really a quick task.
ramu11:1665944528:2022-10-17T02:22:08.501+0000:1665944528:2022-10-17T02:22:08.501+0000:This upgrade requires slf4j 2.x  .  will do once CAMEL-18416 is done
nfilotto:1685420966:2023-05-30T12:29:26.759+0000:1685420966:2023-05-30T12:29:26.759+0000:The component has been removed by CAMEL-19290 such that this ticket doesn't really make sense"
0,CAMEL-18576,Bug,Minor,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Claus Ibsen,Marco Martins,0,3,2022-10-03 10:28:41+00:00,2022-10-13 08:56:42+00:00,"Hi, I'm using Quarkus Camel 2.12.3.Final with YAML DSL and Kamelets and I have a problem passing a JSON value through URI as a query parameter when trying to use the elasticsearch-search-source with a basic query:




{""query"":{""match_all"":{}}} 



Example on the YAML DSL:



Scenario 1


query: '{""query"":{""match_all"":{}}}'

Gives

java.lang.IllegalArgumentException: Missing {{ from the text: {""query"":{""match_all"":{}}}






Scenario 2


query: '{{myQuery}}'

Gives

java.lang.IllegalArgumentException: Missing {{ from the text: {""query"":{""match_all"":{}}}






Scenario 3


query: '#property:myQuery'

Gives

java.lang.IllegalArgumentException: Property with key myQuery not found by properties component


But using debug I've checked that the above exception occurs due to the same

java.lang.IllegalArgumentException: Missing {{ from the text: {""query"":{""match_all"":{}}}






Scenario 4
I've also tried to change the Kamelet YAML definition to use the RAW value directly


- set-body: 
  constant: ""RAW({{myQuery}})""

With the same result

java.lang.IllegalArgumentException: Missing {{ from the text: {""query"":{""match_all"":{}}}





I have a workaround if I add spaces in JSON like below it works in scenarios 1 and 2.




{ ""query"": { ""match_all"": { } } } 



My point is, why do I have to change the JSON value to adapt to the Camel parser? Also, there also might exist some other use case where the value can't be changed.


Why don't you simply have a function that does not try to resolve properties as placeholders recursively? For example:




query: '{{raw:myQuery}}'



Or with a default value




query: '{{raw:myQuery:{""query"":{""match_all"":{}}}}}'



Or at least have a way to escape curly brackets.","davsclaus:1665357439:2022-10-10T07:17:19.515+0000:1665357439:2022-10-10T07:17:19.515+0000:Can you paste your route where you use this
davsclaus:1665357589:2022-10-10T07:19:49.924+0000:1665357589:2022-10-10T07:19:49.924+0000:Ah okay, so its the property placeholder that assumes it was a {{ }} pair, where you have no end pair.
davsclaus:1665382544:2022-10-10T14:15:44.362+0000:1665382544:2022-10-10T14:15:44.362+0000:I have reproduced this. So its because of using kamelets where the query is passed in as {{ }} placeholder, and that it has json that have }} as well, and the property placeholder performs nested placeholder (eg a placeholder has also a placeholder, recursive).

So we need to ""think"" to find a better way.
MarcoMartins:1665392396:2022-10-10T16:59:56.990+0000:1665392396:2022-10-10T16:59:56.990+0000:Yeah, it is because of the placeholder recursivity feature together with the JSON having }} in its body, which, gets the Camel parser confused trying to find the beginning of a placeholder that does not exist.

Thank you for your availability.
davsclaus:1665450626:2022-10-11T09:10:26.841+0000:1665450626:2022-10-11T09:10:26.841+0000:You can turn off nested on the properties component, but we need to find a better out of the box way for kamelets
MarcoMartins:1665452966:2022-10-11T09:49:26.872+0000:1665452966:2022-10-11T09:49:26.872+0000:Can you give me an example of how I could turn off the nested on configuration option? I can't find any reference to this in [ELASTICSEARCH REST|https://camel.apache.org/components/3.18.x/elasticsearch-rest-component.html], [PropertiesComponent|https://camel.apache.org/components/3.18.x/properties-component.html] documentation nor do I see any obvious property analyzing the [ElasticsearchComponent.java|https://github.com/apache/camel/blob/main/components/camel-elasticsearch-rest/src/main/java/org/apache/camel/component/elasticsearch/ElasticsearchComponent.java] itself.
davsclaus:1665453319:2022-10-11T09:55:19.425+0000:1665453319:2022-10-11T09:55:19.425+0000:See the linked JIRA, and its a new feature in 3.20
MarcoMartins:1665469234:2022-10-11T14:20:34.840+0000:1665469234:2022-10-11T14:20:34.840+0000:Thank you, I did look into the changes, and I think I've found a discrepancy in one of the commits. On the one that added the new configuration to the documentation *camel.component.properties.nested-placeholder* mention that the default value is {*}false{*}, although, in  [PropertiesComponent.java|https://github.com/apache/camel/blob/main/core/camel-base/src/main/java/org/apache/camel/component/properties/PropertiesComponent.java] the default value is *true* 
{code:java}
private boolean nestedPlaceholder = true; {code}
which makes sense for using old library version behavior as default. 
 
nfilotto:1665482812:2022-10-11T18:06:52.666+0000:1665482977:2022-10-11T18:09:37.424+0000:[~davsclaus] I proposed in this PR [https://github.com/apache/camel/pull/8521] a fix based on an escape character (backslash) WDYT? 

 

PS: Sorry to work on your ticket, initially, I just wanted to test an idea. 
davsclaus:1665551371:2022-10-12T13:09:31.396+0000:1665551391:2022-10-12T13:09:51.738+0000:Nicolas, that look good for users that can edit their input and escape the JSon input.

But for out of the box, we should ideally have a way.
I have run a full test with nested placeholder disabled and we do not use it very much - only in some special tests for camel-jasypt.

I have also not seen real world use-cases with nested placeholders. Its only when you may go very fine grained and have a placeholder for hostname, and another for port, and then have a 3rd where you concat them together.

But lets keep this open for a while and think about if we can have a nicer solution out of the box - but even then this problem is only when you have double {{ and }} which ought to be more rare for even JSon payloads. 

[~MarcoMartins] do you see the double `{{` used more often in your ES queries ?
MarcoMartins:1665553283:2022-10-12T13:41:23.024+0000:1665553525:2022-10-12T13:45:25.336+0000:[~davsclaus] I don't see the `{{` pattern appear often on ES queries since they're JSON payloads and JSON can't have two `{{`, although, they could appear as a field value to be searched. 

This issue occurred without the \{{ since Camel was looking for }} pattern which occurs very often in JSON, and if found it would consider that it was a property placeholder and when looking for the beginning of the ""false property"" it would not find it since there was no `{{`.
nfilotto:1665553685:2022-10-12T13:48:05.304+0000:1665553685:2022-10-12T13:48:05.304+0000:[~davsclaus] Should I revert the fix that I proposed?
davsclaus:1665554112:2022-10-12T13:55:12.185+0000:1665554112:2022-10-12T13:55:12.185+0000:Nicolas, no its actually a good new functionality that end users can escape property placeholder values to make them literal values and not the begin or end markers
davsclaus:1665609574:2022-10-13T05:19:34.099+0000:1665609574:2022-10-13T05:19:34.099+0000:1
We could introduce {{myKey?nested=false}} as a way to turn off nested for a specific placeholder. 

2
We can also relax the {{ }} check on level 2+ since its the value of the placeholder that cannot always be assumed to be another placeholder

davsclaus:1665618883:2022-10-13T07:54:43.102+0000:1665618883:2022-10-13T07:54:43.102+0000:Okay so the best we can do for now is

a) allow to turn of nested placeholder globally
b) allow escaping property values
c) turn of nested on specific placeholder
"
0,CAMEL-18575,Improvement,Minor,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Otavio Rodolfo Piske,Otavio Rodolfo Piske,0,1,2022-10-03 09:38:17+00:00,2023-09-05 14:01:10+00:00,"I think Nicolas Filotto gave this idea sometime in the past, but I did not have time to pursuit it back then. 


Here's the change: there's many places in the test code where we are using temporary directories for the tests. There is code to create, cleanup and whatnot to handle this.


 


However, there is a TempDir extension that is part of JUnit 5 that we can use instead.",orpiske:1664784440:2022-10-03T16:07:20.755+0000:1664784440:2022-10-03T16:07:20.755+0000:Resolved with https://github.com/apache/camel/pull/8458
0,CAMEL-18574,New Feature,Major,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Claus Ibsen,Claus Ibsen,0,1,2022-10-03 03:25:56+00:00,2022-10-05 11:28:37+00:00,"When working with EIPs you may want to temporary disable one or more EIPs. Today you have to comment out code, or remove the EIPs.


But we should add disabled = true|false so users can set it directly on the EIP and keep the code as-is. This will also help tooling where you can then easily [x] to disable something.","davsclaus:1664903537:2022-10-05T01:12:17.873+0000:1664903537:2022-10-05T01:12:17.873+0000:Once an EIP is disabled it cannot be enabled again at runtime. This is due to optimized routing engine to avoid the overhead of checking for enabled vs disabled. And since this feature is to make it quick to disable parts of routes during development or testing.

"
0,CAMEL-18573,Dependency upgrade,Major,None,"3.18.3, 3.20.0","
None
",Resolved,Fixed,"3.18.3, 3.20.0",Thomas Cunningham,Claus Ibsen,0,1,2022-10-02 10:19:52+00:00,2022-10-05 11:33:41+00:00,No Desc,
0,CAMEL-18572,Improvement,Major,3.18.2,,"
None
",Resolved,Won't Fix,None,Unassigned,Otavio Rodolfo Piske,0,2,2022-10-01 09:41:02+00:00,2023-10-05 14:41:49+00:00,"When a new project is generated with Camel JBang, the generated file is not parsable by JBang.


Steps to reproduce:
1. Generate a new file: camel init MyFile.java
2. Try to open it with jbang edit: jbang edit --live MyFile.java


The file will be missing the dependencies and there will be many errors on the IDE.","orpiske:1664588860:2022-10-01T09:47:40.151+0000:1664588860:2022-10-01T09:47:40.151+0000:The IDE errors are gone after these steps:


1. Add the following:

 
{code:java}
///usr/bin/env jbang ""$0"" ""$@"" ; exit $?
// camel-k: language=java
//JAVA 11+
//REPOS mavencentral,apache=https://repository.apache.org/snapshots
//DEPS org.apache.camel:camel-bom:${camel.jbang.version:3.18.2}@pom
//DEPS org.apache.camel:camel-jbang-core:${camel.jbang.version:3.18.2}
//DEPS org.apache.camel.kamelets:camel-kamelets:${camel-kamelets.version:0.9.0}
//DEPS org.apache.camel.kamelets:camel-kamelets-utils:${camel-kamelets.version:0.9.0}
{code}
 

2. Save the file and restart the IDE.

 
davsclaus:1664591088:2022-10-01T10:24:48.584+0000:1664591088:2022-10-01T10:24:48.584+0000:This requires a jbang plugin installed in IDEA, and would only work for .java source files.

What is needed is the Camel IDEA plugin to have better jbang support out of the box
https://github.com/camel-tooling/camel-idea-plugin/issues/691
davsclaus:1664591165:2022-10-01T10:26:05.168+0000:1664591165:2022-10-01T10:26:05.168+0000:However we could add a boolean option to `init` command that can tell it to add those jbang DEPS. Not sure what to call such a flag.

camel init --jbang-deps=true foo.java


orpiske:1664593516:2022-10-01T11:05:16.671+0000:1664593516:2022-10-01T11:05:16.671+0000:Hm, yeah, we could also adjust the plugin so it recognizes the file somehow. Another possibility was something like this: [https://github.com/jbangdev/jbang/issues/986], which would make it possible to run Camel scripts directly from JBang. 

 

I was hoping it would be possible to use the stock JBang plugin (it is, after you add the dependencies - the only thing missing is that you cannot use the run option - which is OK initially). 

 

IMHO, at this point, maybe it would be better to just add a note about it in the documentation so we have time to decide the best approach.

 

 
davsclaus:1664596853:2022-10-01T12:00:53.112+0000:1664596853:2022-10-01T12:00:53.112+0000:Yeah doc updates is always welcome

We have jbang examples here
https://github.com/apache/camel-kamelets-examples/tree/main/jbang

davsclaus:1696488105:2023-10-05T14:41:45.226+0000:1696488105:2023-10-05T14:41:45.226+0000:The pure JBang plugin is not able to do this very well. It assume a public static void main class, and dont understand Camel to well.
The Camel IDEA plugin have improved and can important dependencies and setup so you can do code editing."
0,CAMEL-18571,Dependency upgrade,Major,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Andrea Cosentino,Andrea Cosentino,0,1,2022-09-30 08:59:51+00:00,2022-09-30 10:36:13+00:00,No Desc,
0,CAMEL-18570,Bug,Minor,3.18.2,,"

aggregation
xaresource

",Open,Unresolved,None,Unassigned,Julien Hattab,1,2,2022-09-29 13:16:21+00:00,2022-09-30 10:35:21+00:00,"Since Camel 3 version.


The aggregation processor doesn't open a XA transaction when the aggregation is completed or timed-out.


If the aggregated route destination is a XA resource camel throw the following exception :




Session's XAResource has not been enlisted in a distributed transaction 



I create 2 projects with one test.


One in camel 3.18.2 which is failing and one with camel 2.25.4 which is successful.",
0,CAMEL-18569,Improvement,Minor,3.18.2,,"
None
",Open,Unresolved,None,Unassigned,Ilham Elyazov,0,3,2022-09-29 12:07:43+00:00,2023-12-22 12:47:39+00:00,"Currently, SmppConsumer creates session with static variables. In connect and bind method, it uses  BIND_RX, NPI, and TON. This prevents usage of other binding types, NPI and TON options.","acosentino:1664424642:2022-09-29T12:10:42.568+0000:1664424642:2022-09-29T12:10:42.568+0000:You're welcome to work on a Pull request if you have time.
davsclaus:1703220459:2023-12-22T12:47:39.971+0000:1703220459:2023-12-22T12:47:39.971+0000:How would other bind types help in the consumer? BIND_RX is for receiving. 

There are only these types

receiver (BIND_RX) - receive only
transmitter (BIND_TX) - transmit only
transceiver (BIND_TRX) - receive and transmit"
0,CAMEL-18568,Improvement,Minor,3.19.0,3.20.0,"
None
",Resolved,Fixed,3.20.0,Unassigned,Manuel Shenavai,0,1,2022-09-29 11:21:59+00:00,2022-09-30 20:43:50+00:00,"Extend existing option ""handleDuplicateAttachmentNames"" to allow suffixing the attachment names",
0,CAMEL-18567,Bug,Major,3.18.2,,"
None
",Resolved,Information Provided,None,Unassigned,John Yin,0,3,2022-09-28 19:30:08+00:00,2022-09-29 12:54:01+00:00,"When using Camel 3.18.2, encountered the following exception:


org.springframework.beans.factory.parsing.BeanDefinitionParsingException: Configuration problem: Unable to locate Spring NamespaceHandler for XML schema namespace http://camel.apache.org/schema/cxf


The namespace is defined in <beans ... 


http://camel.apache.org/schema/cxf
http://camel.apache.org/schema/cxf/camel-cxf.xsd>


The following camel-cxf dependencies were included:


api ""org.apache.camel:camel-cxf-common:${camelVersion}""
api ""org.apache.camel:camel-cxf-rest:${camelVersion}""
api ""org.apache.camel:camel-cxf-soap:${camelVersion}""
api ""org.apache.camel:camel-cxf-transport:${camelVersion}""
api ""org.apache.camel:camel-cxf-spring-common:${camelVersion}""
api ""org.apache.camel:camel-cxf-spring-rest:${camelVersion}""
api ""org.apache.camel:camel-cxf-spring-soap:${camelVersion}""
api ""org.apache.camel:camel-cxf-spring-transport:${camelVersion}""
api ""org.apache.camel.springboot:camel-cxf-rest-starter:${camelVersion}""
api ""org.apache.camel.springboot:camel-cxf-soap-starter:${camelVersion}""
api ""org.apache.camel.springboot:camel-cxf-transport-starter:${camelVersion}""","davsclaus:1664403064:2022-09-29T06:11:04.558+0000:1664403064:2022-09-29T06:11:04.558+0000:Have you seen the upgrade guides, the namespaces are changed
https://camel.apache.org/manual/camel-3x-upgrade-guide-3_18.html
acosentino:1664410319:2022-09-29T08:11:59.047+0000:1664410319:2022-09-29T08:11:59.047+0000:Related to this I'm adding the CXF Schemas for 3.18.1 and 3.18.2
https://github.com/apache/camel-website/pull/908
bocamel:1664427241:2022-09-29T12:54:01.515+0000:1664427241:2022-09-29T12:54:01.515+0000:Thanks!  My bad, should have read at the doc."
0,CAMEL-18566,Bug,Minor,None,None,"
None
",Resolved,Incomplete,None,Unassigned,Ben Melzer,0,2,2022-09-28 10:52:46+00:00,2022-10-05 11:34:12+00:00,"We use Salesforce component version 3.18.x and although we use all error handler methods, a connection exception is not thrown, but instead we get following exception as a WARN:
TimeoutException: DNS timeout 15000 ms,
UnknownHostException: XXX.sandbox.my.salesforce.com,
The repeated re-connection to Salesforce leads to our component silently dying.


Is there any other way to throw connection exceptions?


Thank you for your help.","davsclaus:1664403228:2022-09-29T06:13:48.182+0000:1664403228:2022-09-29T06:13:48.182+0000:Can you ask on the mailing list or chat room first to get help.
Also your report is limited information so its harder to help you."
0,CAMEL-18565,Improvement,Minor,3.18.1,"3.18.3, 3.20.0","
None
",Resolved,Fixed,"3.18.3, 3.20.0",Claus Ibsen,Tuomas Palenius,0,2,2022-09-28 09:37:59+00:00,2022-10-17 09:20:40+00:00,"In the application.yml we define route-include-pattern e.g.
 



camel:         
  context:
    name: my-camel
  main:
    routes-include-pattern: |
      classpath:routes/route1.yaml,
      classpath:routes/route-2.yaml



 
 
When Camel fails to find any of the defined routes (e.g. route-2.yaml does not exist), the result is that Camel does not load any of them but fails silently. However the regular routes defined with the Java DSL do start. The problem is that there is no clear error message stating that there was failure to load routes.","davsclaus:1664505448:2022-09-30T10:37:28.962+0000:1664505448:2022-09-30T10:37:28.962+0000:Can you try with latest quarkus release, and also if possible with just plain camel-main without quarkus
davsclaus:1665968137:2022-10-17T08:55:37.785+0000:1665968137:2022-10-17T08:55:37.785+0000:[~jamesnetherton] wonder if there is some special quarkus loader here that can cause such behaviour?
davsclaus:1665968626:2022-10-17T09:03:46.047+0000:1665968626:2022-10-17T09:03:46.047+0000:Ah I can reproduce this in a plain main app
davsclaus:1665969203:2022-10-17T09:13:23.501+0000:1665969203:2022-10-17T09:13:23.501+0000:Okay have a pending fix

Caused by: java.io.FileNotFoundException: Resource not found: classpath:routes/route-2.yaml"
0,CAMEL-18564,Task,Major,3.18.2,3.20.0,"
None
",Resolved,Fixed,3.20.0,Luigi De Masi,Luigi De Masi,0,1,2022-09-28 07:40:01+00:00,2022-11-01 11:38:42+00:00,No Desc,
0,CAMEL-18563,Bug,Minor,3.18.2,"3.18.3, 3.20.0","
None
",Resolved,Duplicate,"3.18.3, 3.20.0",Unassigned,Jacek Szymański,0,2,2022-09-27 18:51:59+00:00,2022-10-05 11:35:44+00:00,"When a route started from a cxf:rsServer service throws an exception, an additional exception from Camel is thrown:


2022-09-27T20:37:53,371 | WARN  | qtp1368588965-512 | HttpChannel                      | 184 - org.eclipse.jetty.util - 9.4.48.v20
220622 | /cxf/abc/xxx
java.lang.NoClassDefFoundError: org/apache/camel/component/cxf/util/CxfUtils
        at org.apache.camel.component.cxf.jaxrs.CxfRsConsumer.lambda$createServer$0(CxfRsConsumer.java:65) ~[?:?]
        at org.apache.cxf.phase.PhaseInterceptorChain.wrapExceptionAsFault(PhaseInterceptorChain.java:373) ~[?:?]


[...]


{{Caused by: java.lang.ClassNotFoundException: org.apache.camel.component.cxf.util.CxfUtils not found by org.apache.camel.camel-cxf-rest [90]
        ... 46 more}}


 


CxfUtils is used by CxfRsConsumer.java on line 65, but in pom.xml the package is explicitly excluded from imports.


 


I have put a demo code on https://github.com/jacekszymanski/cxfrstest


to reproduce behavior load into camel-karaf, start and access /cxf/abc/anything with POST.


As a workaround I removed exclusion and added explicit import instead, this sort of fixed it.",davsclaus:1664276267:2022-09-27T18:57:47.111+0000:1664276267:2022-09-27T18:57:47.111+0000:You are welcome to send a PR
0,CAMEL-18562,Task,Major,None,None,"
None
",Open,Unresolved,None,Otavio Rodolfo Piske,Otavio Rodolfo Piske,0,2,2022-09-27 08:57:56+00:00,2023-07-17 10:44:58+00:00,"Multiple components have overlapping functionality and/or duplicated logic that could possibly be consolidated into abstract platforms. These abstract platforms would provide a reusable interface for components handling things as:



HTTP clients
HTTP servers
	
WebSocket servers


JMS clients
	
Messaging


Servlet containers
Socket-based I/O
Web Services frameworks



 


Concrete example:


For instance, the Telegram component:



In Camel version 3.18x, it allowed the users to provide a custom AsyncHttpClient through the `client` parameter.
In Camel version 3.19.x and newer, the `client` parameter changed to use the Java's own HTTP client (due to CAMEL-18506).



With a core platform, instead of using a concrete client, it would use an abstract HTTP platform that would provide the functionality required for the component.


Among other things, this would prevent situations such as the one we now have with Whatsapp and Telegram components, where both implement their own HTTP multi-part body handling logic on top of the Java's HTTP client.


 


Benefits:



Reduce duplicated code
Increase testability and test coverage
Increase flexiblity by allowing users to implement their own pluggable platforms if they wish
Increase flexiblity for Camel to decouple from legacy platforms and projects",
0,CAMEL-18561,Improvement,Minor,3.18.2,,"

help-wanted

",Open,Unresolved,None,Unassigned,Zineb Bendhiba,0,1,2022-09-27 08:51:55+00:00,2023-11-14 13:31:25+00:00,"In camel-quarkus, we need to add those classes for reflection. a goal would be to avoid that.


 


There's a discussion here around `@Configurer` usage : https://github.com/apache/camel-quarkus/pull/3705",
0,CAMEL-18560,Dependency upgrade,Major,None,3.19.0,"
None
",Resolved,Fixed,3.19.0,Nicolas Filotto,Nicolas Filotto,0,1,2022-09-27 08:34:01+00:00,2022-09-28 14:22:39+00:00,"Since the latest version of jetcd-all (0.5.11), new versions of jetcd have been released but as individual artifacts.","nfilotto:1664239224:2022-09-27T08:40:24.191+0000:1664239224:2022-09-27T08:40:24.191+0000:The corresponding PR https://github.com/apache/camel/pull/8436
nfilotto:1664342354:2022-09-28T13:19:14.023+0000:1664342354:2022-09-28T13:19:14.023+0000:This causes a build failure in the SB project that should be fixed by https://github.com/apache/camel/pull/8445"
0,CAMEL-18559,New Feature,Major,None,4.4.0,"
None
",Resolved,Fixed,4.4.0,Claus Ibsen,Claus Ibsen,0,1,2022-09-27 07:45:47+00:00,2023-12-26 10:39:07+00:00,"Some components are internal only (like direct/seda/log) and others are remote like kafka/jms/ftp


It would be good to have a way to mark that in the component (UriEndpoint possible) and output a detail in the component json too.
Then we can know from tooling point of view too and Camel CLI.


https://github.com/apache/camel-karavan/issues/484",
0,CAMEL-18558,Improvement,Minor,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Claus Ibsen,Claus Ibsen,0,1,2022-09-26 17:15:31+00:00,2022-10-10 05:53:27+00:00,commands to list the inflight exchanges (and where they are) and also for blocked exchanges,
0,CAMEL-18557,Improvement,Major,None,3.19.0,"
None
",Resolved,Fixed,3.19.0,Claus Ibsen,Claus Ibsen,0,1,2022-09-26 15:36:02+00:00,2022-09-26 17:08:11+00:00,"from timer:a
  to direct:b


from direct:b
  log  b
  to seda:c


from seda:c
  log c


Given 1 exchange triggered by the timer
then route a, b and c will all says total = 1


and the camel context would say total = 3 (for every route - even if it was the same exchange)","davsclaus:1664182453:2022-09-26T16:54:13.797+0000:1664182453:2022-09-26T16:54:13.797+0000:This is especially a problem when you use kamelets (as each kamelet is a route). So the TOTAL counter may be +4 but there was only 1 exchange routed.

"
0,CAMEL-18556,Improvement,Major,None,3.19.0,"
None
",Resolved,Fixed,3.19.0,Claus Ibsen,Claus Ibsen,0,1,2022-09-26 15:06:51+00:00,2022-09-26 15:16:46+00:00,"The event dev console requires to be started to be working - this happens normally, but Camel CLI resolves dev consoles in a different way where they are not started.",
0,CAMEL-18555,Improvement,Major,None,3.20.0,"
None
",Resolved,Fixed,3.20.0,Grzegorz Grzybek,Claus Ibsen,0,2,2022-09-26 10:21:21+00:00,2022-10-11 10:56:24+00:00,"ShrinkWrap is not very active maintained but is a great library for making it easier to download via Maven


However we can switch to standard Maven APIs like JBang recently did
https://github.com/jbangdev/jbang/commit/b9a339c71492509b84fecc0fac3f9fa617ecd499","ggrzybek:1664775894:2022-10-03T13:44:54.366+0000:1664775894:2022-10-03T13:44:54.366+0000:Because of MRESOLVER-157, we'd benefit from very simple DI solution that can instantiate classes and wire them using {{@Inject}} annotated constructors.
For now, instantiation is done by {{org.apache.camel.support.ObjectHelper#newInstance(java.lang.Class<T>)}} but it requires no-arg constructor.

However {{org.apache.camel.main.injection.AnnotationDependencyInjection.QuarkusBeanPostProcessorInjector}} already supports some JSR330 annotations ({{javax.inject.Inject}}, {{javax.inject.Named}}), so I'll see if we can use what we have to configure and wire {{org.eclipse.aether.RepositorySystem}}.
ggrzybek:1665380222:2022-10-10T13:37:02.186+0000:1665380222:2022-10-10T13:37:02.186+0000:PR: https://github.com/apache/camel/pull/8501"
0,CAMEL-18554,Task,Minor,3.19.0,3.20.0,"
None
",Resolved,Fixed,3.20.0,Unassigned,Karen Lease,0,2,2022-09-26 08:52:23+00:00,2022-10-10 16:00:41+00:00,"This example fails because the website hosting the jokes API, http://api.icndb.com, returns a 500 error.


There is an alternative site which functions with a small change to the json path: https://api.chucknorris.io/.","davsclaus:1664153956:2022-09-26T08:59:16.332+0000:1664153956:2022-09-26T08:59:16.332+0000:Ah nice, then we can update the chuck-norris-kamelet to use this new api
davsclaus:1664158218:2022-09-26T10:10:18.942+0000:1664158218:2022-09-26T10:10:18.942+0000:PR to fix the kamelet
https://github.com/apache/camel-kamelets/pull/1043
klease78:1664178416:2022-09-26T15:46:56.723+0000:1664178416:2022-09-26T15:46:56.723+0000:For camel-examples, it can be fixed directly in src/main/resources/kamelets/chuck-norris-source.kamelet.yaml. Maybe it uses the local file instead of looking it up via the URI kamelet:chuck-norris-source in the route?
davsclaus:1664180663:2022-09-26T16:24:23.500+0000:1664180663:2022-09-26T16:24:23.500+0000:Yes it will use local file first
klease78:1664271622:2022-09-27T17:40:22.496+0000:1664271622:2022-09-27T17:40:22.496+0000:PR to fix the local file: https://github.com/apache/camel-examples/pull/109"
0,CAMEL-18553,Task,Minor,3.19.0,3.19.0,"
None
",Resolved,Fixed,3.19.0,Karen Lease,Karen Lease,0,1,2022-09-26 08:26:24+00:00,2022-09-26 08:38:52+00:00,The example main-tiny fails because the property camel.main.eager-classloading has been removed.,klease78:1664152046:2022-09-26T08:27:26.419+0000:1664152046:2022-09-26T08:27:26.419+0000:It would be useful to mention this change in the upgrade guide for 3.19.
0,CAMEL-18552,New Feature,Major,None,4.x,"
None
",Open,Unresolved,4.x,Claus Ibsen,Claus Ibsen,0,1,2022-09-26 07:41:27+00:00,2023-12-15 16:09:26+00:00,"Lets see if we can make the swagger ui available for camel-jbang, like we can do for hawtio.


So you can do something ala:


camel run foo.java --openapi-ui


And then have /q/openapi show the ui","davsclaus:1702627766:2023-12-15T16:09:26.901+0000:1702627766:2023-12-15T16:09:26.901+0000:https://github.com/quarkusio/quarkus/blob/main/extensions/swagger-ui/deployment/src/main/java/io/quarkus/swaggerui/deployment/SwaggerUiProcessor.java
https://github.com/smallrye/smallrye-open-api/tree/main/ui/open-api-ui"
0,CAMEL-18551,New Feature,Major,None,"4.0-M3, 4.0.0","
None
",Resolved,Fixed,"4.0-M3, 4.0.0",Jeremy Ross,Jeremy Ross,0,1,2022-09-24 17:19:08+00:00,2023-04-05 09:02:40+00:00,No Desc,
0,CAMEL-18550,Test,Minor,3.19.0,,"
None
",Resolved,Fixed,None,Thomas Cunningham,Thomas Cunningham,0,1,2022-09-24 16:42:42+00:00,2023-07-17 10:45:57+00:00,"camel-ftp-starter tests are failing - looks like some sort of timing issue.     Proposing to add a number of temporary excludes while working on this :


          <excludes>
            <exclude>FileToFtpsWithCustomTrustStorePropertiesTest.java</exclude>
            <exclude>FileToFtpsImplicitSSLWithClientAuthTest.java</exclude>
            <exclude>FileToFtpsWithCustomTrustStorePropertiesTest.java</exclude>
            <exclude>FtpsTest.java</exclude>
            <exclude>SftpConsumerLocalWorkDirectoryTest.java</exclude>
            <exclude>SftpKeyExchangeProtocolsTest.java</exclude>
            <exclude>SftpSetOperationsTest.java</exclude>
            <exclude>SftpSimpleProduceThroughProxyTest.java</exclude>
            <exclude>SftpUseListFalseTest.java</exclude>
          </excludes>",
0,CAMEL-18549,Improvement,Minor,None,None,"
None
",Resolved,Fixed,"3.18.3, 3.20.0",Steve Storck,Steve Storck,0,2,2022-09-24 13:26:31+00:00,2022-11-05 14:45:10+00:00,"Adding routing filters to the dynamic router processor can lead to having multiple entries of essentially the same filter.  Filters are identified by ID, and the processor accumulates filters in a list, so no uniqueness (by ID) is maintained.  If a component starts, and then restarts any number of times, it might register the same filter each time, if it registers with the dynamic router upon startup.  The filters need to be accumulated as a map, where the key is the filter ID.  Filters will be overridden if a filter by that ID exists when a component registers its filter.  Therefore, it is the responsibility of the user of the dynamic router component to coordinate filter registration and the IDs that are used.","davsclaus:1664154069:2022-09-26T09:01:09.046+0000:1664154069:2022-09-26T09:01:09.046+0000:Can you backport to 3.18.x and 3.14.x
davsclaus:1665981847:2022-10-17T12:44:07.287+0000:1665981847:2022-10-17T12:44:07.287+0000:I backported to 3.18.x
Steve973:1667626871:2022-11-05T13:41:11.384+0000:1667626871:2022-11-05T13:41:11.384+0000:I just saw this.  Yeah, I'll backport to 3.14.x now.
davsclaus:1667629955:2022-11-05T14:32:35.475+0000:1667629955:2022-11-05T14:32:35.475+0000:Ah okay so the EIP was added in 3.15. And because of that then this should not be backported, sorry for the noise.

Steve973:1667630248:2022-11-05T14:37:28.902+0000:1667630270:2022-11-05T14:37:50.962+0000:Ok, [~davsclaus], no worries. It was a one-minute change, anyway!"
0,CAMEL-18548,Improvement,Minor,2.19.0,,"
None
",Closed,Workaround,None,Nicolas Filotto,Nicolas Filotto,0,2,2022-09-24 09:06:14+00:00,2022-09-28 09:05:02+00:00,"Since CAMEL-10646, a List is no more converted into an InpuStream by the JsonPathEngine but is directly treated as a List.


This behavior change causes regressions on routes of the following type:


from(""cxfrs://..."").setBody().jsonpath(""$.name"")


where the related rest endpoint consumes JSON payload as next:


@Path(""/customer"")
@POST
@Consumes({ ""application/json"" })
@Produces({ ""application/json"" })
Object createCustomer(String payload);


The payload received is wrapped by the consumer endpoint into MessageContentsList which is now treated directly as a List instead of being converted into an InpuStream like before which causes an error of the following type:


org.apache.camel.ExpressionEvaluationException: com.jayway.jsonpath.PathNotFoundException: Expected to find an object with property ['name'] in path $ but found 'org.apache.cxf.message.MessageContentsList'. This is not a json object according to the JsonProvider: 'com.jayway.jsonpath.spi.json.JacksonJsonProvider'.
at org.apache.camel.jsonpath.JsonPathExpression.evaluate(JsonPathExpression.java:172) ~[classes/:?]
at org.apache.camel.support.ExpressionAdapter.evaluate(ExpressionAdapter.java:45) ~[classes/:?]
at org.apache.camel.processor.SetBodyProcessor.process(SetBodyProcessor.java:45) ~[classes/:?]
at org.apache.camel.processor.errorhandler.RedeliveryErrorHandler$SimpleTask.run(RedeliveryErrorHandler.java:477) ~[classes/:?]
at org.apache.camel.impl.engine.DefaultReactiveExecutor$Worker.schedule(DefaultReactiveExecutor.java:181) ~[classes/:?]
at org.apache.camel.impl.engine.DefaultReactiveExecutor.scheduleMain(DefaultReactiveExecutor.java:59) ~[classes/:?]
at org.apache.camel.processor.Pipeline.process(Pipeline.java:175) ~[classes/:?]
at org.apache.camel.impl.engine.CamelInternalProcessor.process(CamelInternalProcessor.java:392) ~[classes/:?]","nfilotto:1663983050:2022-09-24T09:30:50.870+0000:1663983050:2022-09-24T09:30:50.870+0000:The potential fix for it https://github.com/apache/camel/pull/8430
davsclaus:1664075862:2022-09-25T11:17:42.096+0000:1664075862:2022-09-25T11:17:42.096+0000:Have you tried with setting bindingStyle=SimpleConsumer

davsclaus:1664076165:2022-09-25T11:22:45.344+0000:1664076165:2022-09-25T11:22:45.344+0000:Instead of trying to fix bad CXF in other components I am more keen on fixing CXF or at least first find out a better way. 

Camel 2.19 is 5+ years old and this has been like this since, and always as this in Camel 3. So I want first to find a better solution than trying to ""band aid"" in other components.
davsclaus:1664319426:2022-09-28T06:57:06.070+0000:1664319426:2022-09-28T06:57:06.070+0000:Did you get a chance to try the simple binding? 

Also I assume you could convert before the json path

from cxf
  convert body to input stream
  set body jsonpath

But if the simple binding works then there is a nicer solution.

But at the end of the day it would be good to get cxf as out of the box to work with this without having to turn on a special flag in jsonpath or on cxf itself.

maybe that list thingy was some old cruft for SOAP that is not as relevant for REST and if so we can maybe come up with a fix inside camel-cxf
nfilotto:1664327082:2022-09-28T09:04:42.256+0000:1664327082:2022-09-28T09:04:42.256+0000:Yes sorry for the delay, setting bindingStyle to SimpleConsumer did the job. I was just waiting for internal feedback about potential side effects before giving an answer. Let's close it for now, I will reopen it if needed."
0,CAMEL-18547,Improvement,Minor,2.19.4,,"
None
",Closed,Duplicate,None,Nicolas Filotto,Nicolas Filotto,0,1,2022-09-24 08:59:00+00:00,2022-09-24 09:44:13+00:00,"Since the addition CAMEL-10646, a List is no more converted into an InpuStream by the JsonPathEngine but directly treated as a List.


 


This behavior change causes regressions on route of type:


from(""cxfrs://..."").setBody().jsonpath(""$.name"")


where the related rest endpoint consumes json payload as next:


@Path(""/customer"")
@POST
@Consumes({ ""application/json"" })
@Produces({ ""application/json"" })
Object createCustomer(String payload);


The payload received is wrapped by the consumer endpoint into MessageContentsList which is not treated directly as a List instead of being converted into an InpuStream like before which causes an error of type:


 


org.apache.camel.ExpressionEvaluationException: com.jayway.jsonpath.PathNotFoundException: Expected to find an object with property ['name'] in path $ but found 'org.apache.cxf.message.MessageContentsList'. This is not a json object according to the JsonProvider: 'com.jayway.jsonpath.spi.json.JacksonJsonProvider'.
at org.apache.camel.jsonpath.JsonPathExpression.evaluate(JsonPathExpression.java:172) ~[classes/:?]
at org.apache.camel.support.ExpressionAdapter.evaluate(ExpressionAdapter.java:45) ~[classes/:?]
at org.apache.camel.processor.SetBodyProcessor.process(SetBodyProcessor.java:45) ~[classes/:?]
at org.apache.camel.processor.errorhandler.RedeliveryErrorHandler$SimpleTask.run(RedeliveryErrorHandler.java:477) ~[classes/:?]
at org.apache.camel.impl.engine.DefaultReactiveExecutor$Worker.schedule(DefaultReactiveExecutor.java:181) ~[classes/:?]
at org.apache.camel.impl.engine.DefaultReactiveExecutor.scheduleMain(DefaultReactiveExecutor.java:59) ~[classes/:?]
at org.apache.camel.processor.Pipeline.process(Pipeline.java:175) ~[classes/:?]
at org.apache.camel.impl.engine.CamelInternalProcessor.process(CamelInternalProcessor.java:392) ~[classes/:?]",
0,CAMEL-18546,New Feature,Major,None,,"
None
",Open,Unresolved,None,Unassigned,Claus Ibsen,0,1,2022-09-24 07:17:05+00:00,2022-09-24 07:17:05+00:00,"A few components hosts a service exclusive in Camel such as HTTP/TCP based


from cxf
from platform-http
from servlet
from netty (not in client mode)
from mina
from mllp


There may be a few others.


Its not the same as


from file
from jms
from kafka


As these are camel consumer that reacts on events from another ""service"", eg JMS broker or Kafka broker.


If we have an API/SPI to mark a consumer as being a HostedConsumer (or come up with a better name). Then we can collect service information, such as



name
protocol
ur to call the service
additional metadata
api schema (optional)



Then we can make camel-core able to detect all its consumers that are hosted, and be able to expose this so its easier for tooling etc to gather a list of services.


There is something related to this in RestRegistry in camel-core but that was for RESTful hosted service only.",
0,CAMEL-18545,Bug,Major,None,,"
None
",Resolved,Invalid,None,Grzegorz Grzybek,Alexander Domke,0,2,2022-09-23 16:19:42+00:00,2022-09-25 20:16:18+00:00,"Hello together!


I am trying to load an XML route in a Karaf OSGi runtime and add it to a camel context. Then I plan to pass an exchange to the endpoint from the loaded route. All my attempts so far have failed and I don't know what to do anymore. I have already investigated open Camel Jira issues and found nothing that points to an existing problem. 


My Test Implementation:




package testbundle;

import java.io.File;
import java.nio.file.Files;

import org.apache.camel.Exchange;
import org.apache.camel.ProducerTemplate;
import org.apache.camel.builder.RouteBuilder;
import org.apache.camel.core.osgi.OsgiCamelContextHelper;
import org.apache.camel.core.osgi.OsgiCamelContextPublisher;
import org.apache.camel.core.osgi.OsgiDefaultCamelContext;
import org.apache.camel.dsl.xml.io.XmlRoutesBuilderLoader;
import org.apache.camel.impl.DefaultCamelContext;
import org.apache.camel.spi.Resource;
import org.apache.camel.support.DefaultExchange;
import org.apache.camel.support.ResourceHelper;
import org.osgi.framework.BundleContext;
import org.osgi.service.component.annotations.Activate;
import org.osgi.service.component.annotations.Component;

@Component(
    immediate = true,
    service = TestBundle.class,
    property = {""osgi.command.scope=test"", ""osgi.command.function=loadRoutes""})
public class TestBundle {

  private BundleContext bundleContext;

  @Activate
  public void activate(BundleContext bundleContext) {
    this.bundleContext = bundleContext;
  }

  public void loadRoutes() throws Exception {
    OsgiDefaultCamelContext camelContext = null;
    try (OsgiCamelContextPublisher publisher = new OsgiCamelContextPublisher(bundleContext); ) {
      camelContext = new OsgiDefaultCamelContext(bundleContext);
      OsgiCamelContextHelper.osgiUpdate(camelContext, bundleContext);
      publisher.registerCamelContext(camelContext);

      loadRoute(""C:\\tmp\\before_create.xml"", (DefaultCamelContext) camelContext);

      camelContext.start();

      Exchange exchange = new DefaultExchange(camelContext);
      ProducerTemplate producerTemplate = exchange.getContext().createProducerTemplate();
      Exchange resultExchange = producerTemplate.send(""direct:start"", exchange);
      System.out.println(""resultExchange: "" + resultExchange);

      if (resultExchange.getException() != null) {
        throw resultExchange.getException();
      }
    } finally {
      camelContext.stop();
    }
  }

  private void loadRoute(String name, DefaultCamelContext camelContext) {
    try {
      File file = new File(name);
      byte[] content = Files.readAllBytes(file.toPath());

      Resource resource = ResourceHelper.fromBytes(file.getAbsolutePath(), content);
      RouteBuilder builder =
          (RouteBuilder) new XmlRoutesBuilderLoader().loadRoutesBuilder(resource);
      builder.setCamelContext(camelContext);
      builder.configure();

    } catch (Exception e) {
      throw new RuntimeException(e);
    }
  }
}




My Test Route:




<routes xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance""
        xmlns=""http://camel.apache.org/schema/spring""
        xsi:schemaLocation=""
            http://camel.apache.org/schema/spring
            http://camel.apache.org/schema/spring/camel-spring.xsd"">

    <route id=""xml-route"" autoStartup=""true"">
        <from uri=""direct:start""/>
        <log message=""Hello XML!""/>
    </route>
</routes>




Installed Karaf Features:




Name            | Version | Required | State   | Repository     | Description
----------------+---------+----------+---------+----------------+--------------------------------------------------
xml-specs-api   | 2.9.0   |          | Started | camel-3.18.2   |
camel           | 3.18.2  | x        | Started | camel-3.18.2   |
camel-core      | 3.18.2  |          | Started | camel-3.18.2   |
camel-blueprint | 3.18.2  | x        | Started | camel-3.18.2   |
camel-jaxb      | 3.18.2  | x        | Started | camel-3.18.2   |
aries-proxy     | 4.4.1   |          | Started | standard-4.4.1 | Aries Proxy
aries-blueprint | 4.4.1   |          | Started | standard-4.4.1 | Aries Blueprint
feature         | 4.4.1   | x        | Started | standard-4.4.1 | Features Support
shell           | 4.4.1   | x        | Started | standard-4.4.1 | Karaf Shell
deployer        | 4.4.1   | x        | Started | standard-4.4.1 | Karaf Deployer
bundle          | 4.4.1   | x        | Started | standard-4.4.1 | Provide Bundle support
config          | 4.4.1   | x        | Started | standard-4.4.1 | Provide OSGi ConfigAdmin support
diagnostic      | 4.4.1   | x        | Started | standard-4.4.1 | Provide Diagnostic support
instance        | 4.4.1   | x        | Started | standard-4.4.1 | Provide Instance support
jaas            | 4.4.1   | x        | Started | standard-4.4.1 | Provide JAAS support
log             | 4.4.1   | x        | Started | standard-4.4.1 | Provide Log support
package         | 4.4.1   | x        | Started | standard-4.4.1 | Package commands and mbeans
service         | 4.4.1   | x        | Started | standard-4.4.1 | Provide Service support
system          | 4.4.1   | x        | Started | standard-4.4.1 | Provide System support
kar             | 4.4.1   | x        | Started | standard-4.4.1 | Provide KAR (KARaf archive) support
ssh             | 4.4.1   | x        | Started | standard-4.4.1 | Provide a SSHd server on Karaf
management      | 4.4.1   | x        | Started | standard-4.4.1 | Provide a JMX MBeanServer and a set of MBeans in
eventadmin      | 4.4.1   | x        | Started | standard-4.4.1 | OSGi Event Admin service specification for event-
scr             | 4.4.1   | x        | Started | standard-4.4.1 | Declarative Service support
pax-url-wrap    | 2.6.11  |          | Started | standard-4.4.1 | Wrap URL handler
wrap            | 2.6.11  | x        | Started | standard-4.4.1 | Transition feature to pax-url-wrap




Installed Bundles:




121 | Active   |  80 | 3.18.2             | camel-xml-io
123 | Active   |  80 | 3.18.2             | camel-xml-io-dsl
125 | Active   |  80 | 3.18.2             | camel-dsl-support




Error I get after sending the exchange:




18:03:22.483 ERROR [Karaf local console user karaf] Exception caught while executing command
org.apache.camel.component.direct.DirectConsumerNotAvailableException: No consumers available on endpoint: direct://start. Exchange[]
        at org.apache.camel.component.direct.DirectProducer.process(DirectProducer.java:82) ~[?:?]
        at org.apache.camel.impl.engine.SharedCamelInternalProcessor.process(SharedCamelInternalProcessor.java:214) ~[?:?]
        at org.apache.camel.impl.engine.SharedCamelInternalProcessor$1.process(SharedCamelInternalProcessor.java:111) ~[?:?]
        at org.apache.camel.impl.engine.DefaultAsyncProcessorAwaitManager.process(DefaultAsyncProcessorAwaitManager.java:83) ~[?:?]
        at org.apache.camel.impl.engine.SharedCamelInternalProcessor.process(SharedCamelInternalProcessor.java:108) ~[?:?]
        at org.apache.camel.support.cache.DefaultProducerCache.send(DefaultProducerCache.java:199) ~[?:?]
        at org.apache.camel.impl.engine.DefaultProducerTemplate.send(DefaultProducerTemplate.java:176) ~[?:?]
        at org.apache.camel.impl.engine.DefaultProducerTemplate.send(DefaultProducerTemplate.java:148) ~[?:?]
        at org.apache.camel.impl.engine.DefaultProducerTemplate.send(DefaultProducerTemplate.java:131) ~[?:?]
        at testbundle.TestBundle.loadRoutes(TestBundle.java:47) ~[?:?]
        at jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:?]
        at jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:?]
        at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:?]
        at java.lang.reflect.Method.invoke(Method.java:566) ~[?:?]
        at org.apache.felix.gogo.runtime.Reflective.invoke(Reflective.java:143) ~[?:?]
        at org.apache.felix.gogo.runtime.CommandProxy.execute(CommandProxy.java:91) ~[?:?]
        at org.apache.karaf.shell.impl.console.osgi.CommandTracker$1.execute(CommandTracker.java:112) ~[?:?]
        at org.apache.karaf.shell.impl.console.osgi.secured.SecuredCommand.execute(SecuredCommand.java:68) ~[?:?]
        at org.apache.karaf.shell.impl.console.osgi.secured.SecuredCommand.execute(SecuredCommand.java:86) ~[?:?]
        at org.apache.felix.gogo.runtime.Closure.executeCmd(Closure.java:599) ~[?:?]
        at org.apache.felix.gogo.runtime.Closure.executeStatement(Closure.java:526) ~[?:?]
        at org.apache.felix.gogo.runtime.Closure.execute(Closure.java:415) ~[?:?]
        at org.apache.felix.gogo.runtime.Pipe.doCall(Pipe.java:416) ~[?:?]
        at org.apache.felix.gogo.runtime.Pipe.call(Pipe.java:229) ~[?:?]
        at org.apache.felix.gogo.runtime.Pipe.call(Pipe.java:59) ~[?:?]
        at java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[?:?]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) ~[?:?]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) ~[?:?]
        at java.lang.Thread.run(Thread.java:834) ~[?:?]




For the tests I used Camel version 3.18.2 and Karaf version 4.4.1. 
Maybe one of you has done this before and can point me to the right solution?","davsclaus:1663927157:2022-09-23T17:59:17.342+0000:1663927157:2022-09-23T17:59:17.342+0000:We only support camel-blueprint loading XML files with <blueprint>
delphisual:1664108178:2022-09-25T20:16:18.084+0000:1664108178:2022-09-25T20:16:18.084+0000:Hi Claus, thanks for your quick reply. Also my attempt to extend a Blueprint Camel Context at runtime with additional routes was not successful. Here is the approach:

*My Test Implementation:*
{code:java}
package testbundle;

import java.io.File;
import java.nio.file.Files;

import org.apache.camel.CamelContext;
import org.apache.camel.Exchange;
import org.apache.camel.ExtendedCamelContext;
import org.apache.camel.ProducerTemplate;
import org.apache.camel.blueprint.BlueprintCamelContext;
import org.apache.camel.spi.Resource;
import org.apache.camel.support.DefaultExchange;
import org.apache.camel.support.ResourceHelper;
import org.osgi.service.component.annotations.Component;
import org.osgi.service.component.annotations.Reference;

@Component(
    immediate = true,
    service = TestBundle.class,
    property = {""osgi.command.scope=test"", ""osgi.command.function=loadRoutes""})
public class TestBundle {

  public BlueprintCamelContext camelContext;

  @Reference(target = ""(camel.context.name=dummyCamelContext)"")
  public void bindCamelContext(CamelContext camelContext) {
    this.camelContext = (BlueprintCamelContext) camelContext;
  }

  public void unbindCamelContext() {
    camelContext = null;
  }

  public void loadRoutes() throws Exception {
    loadRoute(""C:\\tmp\\before_create.xml"", camelContext);
    camelContext.start();
    Exchange exchange = new DefaultExchange(camelContext);
    ProducerTemplate producerTemplate = exchange.getContext().createProducerTemplate();
    Exchange resultExchange = producerTemplate.send(""direct:start"", exchange);
    System.out.println(""resultExchange: "" + resultExchange);

    if (resultExchange.getException() != null) {
      throw resultExchange.getException();
    }
  }

  private void loadRoute(String name, BlueprintCamelContext camelContext) {
    ExtendedCamelContext ecc = camelContext.adapt(ExtendedCamelContext.class);
    try {
      File file = new File(name);
      byte[] content = Files.readAllBytes(file.toPath());
      Resource resource = ResourceHelper.fromBytes(file.getAbsolutePath(), content);
      ecc.getRoutesLoader().loadRoutes(resource);
      System.out.println(""ecc routes: "" + ecc.getRoutes());
      System.out.println(""camelContext routes: "" + camelContext.getRouteDefinitions());

    } catch (Exception e) {
      throw new RuntimeException(e);
    }
  }
}

{code}

*My Blueprint with camel context:*
{code:java}
<?xml version=""1.0"" encoding=""UTF-8""?>
<blueprint xmlns=""http://www.osgi.org/xmlns/blueprint/v1.0.0"" xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance"" xmlns:cm=""http://aries.apache.org/blueprint/xmlns/blueprint-cm/v1.0.0"" xmlns:ext=""http://aries.apache.org/blueprint/xmlns/blueprint-ext/v1.0.0"" xmlns:enc=""http://karaf.apache.org/xmlns/jasypt/v1.0.0"" xsi:schemaLocation=""
       http://www.osgi.org/xmlns/blueprint/v1.0.0 http://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd"">
    <camelContext xmlns=""http://camel.apache.org/schema/blueprint"" id=""dummyCamelContext"">
        <route id=""create"" autoStartup=""true"">
            <from uri=""direct:dummyStart"" />
            <to uri=""mock:dummyEnd"" />
        </route>
    </camelContext>
</blueprint>
{code}


*My Route to load:*
{code:java}
<?xml version=""1.0"" encoding=""UTF-8""?>
<blueprint xmlns=""http://www.osgi.org/xmlns/blueprint/v1.0.0"">
    <routes xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance"" xmlns=""http://camel.apache.org/schema/blueprint"" xsi:schemaLocation=""
            http://camel.apache.org/schema/blueprint
            http://camel.apache.org/schema/blueprint/camel-blueprint.xsd"">

        <route id=""xml-route"" autoStartup=""true"">
            <from uri=""direct:start"" />
            <log message=""Hello XML!"" />
        </route>
    </routes>
</blueprint>
{code}

Error executing command: No consumers available on endpoint: direct://start. Exchange[]

I am at a loss, do you have any idea what I am doing wrong?
"
0,CAMEL-18544,Bug,Minor,3.18.2,"3.14.6, 3.18.3, 3.19.0","
None
",Resolved,Fixed,"3.14.6, 3.18.3, 3.19.0",Claus Ibsen,Claus Ibsen,0,1,2022-09-23 07:17:58+00:00,2022-09-26 09:05:39+00:00,https://github.com/apache/camel/pull/8396,
0,CAMEL-18543,Dependency upgrade,Minor,None,3.19.0,"
None
",Resolved,Fixed,3.19.0,Claus Ibsen,Claus Ibsen,0,1,2022-09-23 05:40:18+00:00,2022-09-23 05:43:00+00:00,No Desc,
0,CAMEL-18542,Dependency upgrade,Major,None,3.19.0,"
None
",Resolved,Fixed,3.19.0,Claus Ibsen,Claus Ibsen,0,1,2022-09-23 05:16:09+00:00,2022-09-23 07:13:33+00:00,"We are using an older qpid version, we should upgrade.",davsclaus:1663888407:2022-09-23T07:13:27.281+0000:1663888407:2022-09-23T07:13:27.281+0000:qpid 2.x is jakarta so we will upgrade to this in camel 4
0,CAMEL-18510,Bug,Minor,3.18.2,"3.18.3, 3.19.0","
None
",Resolved,Fixed,"3.18.3, 3.19.0",Claus Ibsen,Claus Ibsen,0,1,2022-09-15 05:07:46+00:00,2022-09-15 08:47:49+00:00,No Desc,"davsclaus:1663189695:2022-09-15T05:08:15.193+0000:1663189695:2022-09-15T05:08:15.193+0000:Also it should be possible to use current dir as local kamelet dir
davsclaus:1663189725:2022-09-15T05:08:45.941+0000:1663189725:2022-09-15T05:08:45.941+0000:camel init my-sink.kamelet.yaml
camel bind timer-source my-sink mybinding.yaml --local-kamelet-dir=.
davsclaus:1663191010:2022-09-15T05:30:10.174+0000:1663202707:2022-09-15T08:45:07.284+0000:TODO: camel init kamelet should support sink vs source *DONE*
TODO: --local-kamelet-dir to support multiple dirs *DONE*
TODO: --local-kamelet-dir to support current dir or relative dirs *DONE*"
0,CAMEL-18509,Test,Major,None,"3.18.3, 3.19.0","
None
",Resolved,Fixed,"3.18.3, 3.19.0",Freeman Yue Fang,Freeman Yue Fang,0,1,2022-09-14 19:32:19+00:00,2022-09-15 19:14:56+00:00,Use SB container servlet  transport(spring-boot-starter-web) instead of the embeded undertow server,
0,CAMEL-18508,New Feature,Major,None,"3.20.3, 3.21.0, 4.0-M3, 4.0.0","
None
",Resolved,Fixed,"3.20.3, 3.21.0, 4.0-M3, 4.0.0",Federico Mariani,Claus Ibsen,1,2,2022-09-14 15:55:54+00:00,2023-03-09 13:08:24+00:00,"It would be good to allow a user config file, where you can store various default values and versions for camel-jbang, such as



3rd party maven repos
specific camel version to use
specific spring boot / quarkus version to use
etc.



The config should contain key=value pairs as .properties which maps to CLI arguments when using the camel CLI.


We can have commands ala:


camel config list
camel config get x
camel config set x=y
camel config unset x","davsclaus:1678171000:2023-03-07T14:36:40.007+0000:1678171000:2023-03-07T14:36:40.007+0000:branch with prototype
https://github.com/apache/camel/tree/jbang-user-config

You can then have a user config in ~/.camel-jbang-user.properties
where you can have default values for all command line options such as

camel-version = 3.20.1

then

camel run foo.yaml

will then use that camel version
davsclaus:1678241250:2023-03-08T10:07:30.091+0000:1678241250:2023-03-08T10:07:30.091+0000:We need to add some documentation to

docs/ ... camel-jbang.adoc file
fmariani:1678266811:2023-03-08T17:13:31.023+0000:1678266811:2023-03-08T17:13:31.023+0000:Docs added in draft PR https://github.com/apache/camel/pull/9489
davsclaus:1678324244:2023-03-09T09:10:44.425+0000:1678324577:2023-03-09T09:16:17.583+0000:Okay polished and pushed to main, 3.x, and 3.20.x *DONE*"
0,CAMEL-18507,Improvement,Major,None,None,"
None
",Resolved,Fixed,"3.18.3, 3.19.0",Claus Ibsen,Claus Ibsen,0,1,2022-09-14 13:30:00+00:00,2022-09-14 13:56:52+00:00,Reported in community on mailing list,
0,CAMEL-18506,Task,Major,None,None,"
None
",Resolved,Fixed,3.19.0,Otavio Rodolfo Piske,Otavio Rodolfo Piske,0,1,2022-09-14 13:20:26+00:00,2022-09-26 04:32:38+00:00,"The project Async HTTP Client is likely unmaintained. We should migrate the following components to a different HTTP client: 



camel-ahc (to be removed ... see CAMEL-18496)
camel-atmosphere-websocket (test scope)
camel-elytron  (test scope)
camel-telegram (runtime scope)
camel-undertow (test scope)
camel-websocket (test scope)","orpiske:1663132911:2022-09-14T13:21:51.359+0000:1663132911:2022-09-14T13:21:51.359+0000:[~davsclaus] [~acosentino] FYI, more stuff to cleanup.
orpiske:1663205516:2022-09-15T09:31:56.559+0000:1663205516:2022-09-15T09:31:56.559+0000:The easy ones (in test) are done. Telegram used in runtime all over the place, so it's a bit more complicated ... but it's a WIP.
orpiske:1663645738:2022-09-20T11:48:58.521+0000:1663645738:2022-09-20T11:48:58.521+0000:All the components using async http client were migrated to Java's HTTP client. Usage for camel-ahc is pending removal (CAMEL-18496), but it will be dealt with separately."
0,CAMEL-18505,Dependency upgrade,Major,None,3.19.0,"
None
",Resolved,Fixed,3.19.0,Jiri Ondrusek,Jiri Ondrusek,0,1,2022-09-14 08:43:54+00:00,2022-09-14 15:16:35+00:00,"Recent update of Scandium to 2.7.3 created 2 version conflicts in camel-coap.


Build of camel-quarkus extension copa fails with:




Dependency convergence error for org.eclipse.californium:californium-legal:2.7.2 paths to dependency are:
2022-09-14T07:34:24.8326810Z +-org.apache.camel.quarkus:camel-quarkus-coap:2.13.0-SNAPSHOT
2022-09-14T07:34:24.8327409Z   +-org.apache.camel:camel-coap:3.19.0-20220913.111253-62
2022-09-14T07:34:24.8327954Z     +-org.eclipse.californium:californium-core:2.7.2
2022-09-14T07:34:24.8328418Z       +-org.eclipse.californium:californium-legal:2.7.2
2022-09-14T07:34:24.8328734Z and
2022-09-14T07:34:24.8329134Z +-org.apache.camel.quarkus:camel-quarkus-coap:2.13.0-SNAPSHOT
2022-09-14T07:34:24.8329585Z   +-org.apache.camel:camel-coap:3.19.0-20220913.111253-62
2022-09-14T07:34:24.8330014Z     +-org.eclipse.californium:californium-core:2.7.2
2022-09-14T07:34:24.8330456Z       +-org.eclipse.californium:element-connector:2.7.2
2022-09-14T07:34:24.8330902Z         +-org.eclipse.californium:californium-legal:2.7.2
2022-09-14T07:34:24.8331209Z and
2022-09-14T07:34:24.8331597Z +-org.apache.camel.quarkus:camel-quarkus-coap:2.13.0-SNAPSHOT
2022-09-14T07:34:24.8332051Z   +-org.apache.camel:camel-coap:3.19.0-20220913.111253-62
2022-09-14T07:34:24.8332467Z     +-org.eclipse.californium:scandium:2.7.3
2022-09-14T07:34:24.8332906Z       +-org.eclipse.californium:californium-legal:2.7.3
2022-09-14T07:34:24.8333204Z and
2022-09-14T07:34:24.8333592Z +-org.apache.camel.quarkus:camel-quarkus-coap:2.13.0-SNAPSHOT
2022-09-14T07:34:24.8334030Z   +-org.apache.camel:camel-coap:3.19.0-20220913.111253-62
2022-09-14T07:34:24.8334476Z     +-org.eclipse.californium:element-connector-tcp-netty:2.7.2
2022-09-14T07:34:24.8334946Z       +-org.eclipse.californium:californium-legal:2.7.2
2022-09-14T07:34:24.8335189Z 
2022-09-14T07:34:24.8335402Z [WARNING] 
2022-09-14T07:34:24.8335890Z Dependency convergence error for org.eclipse.californium:element-connector:2.7.2 paths to dependency are:
2022-09-14T07:34:24.8336425Z +-org.apache.camel.quarkus:camel-quarkus-coap:2.13.0-SNAPSHOT
2022-09-14T07:34:24.8336868Z   +-org.apache.camel:camel-coap:3.19.0-20220913.111253-62
2022-09-14T07:34:24.8337522Z     +-org.eclipse.californium:californium-core:2.7.2
2022-09-14T07:34:24.8337984Z       +-org.eclipse.californium:element-connector:2.7.2
2022-09-14T07:34:24.8338286Z and
2022-09-14T07:34:24.8338680Z +-org.apache.camel.quarkus:camel-quarkus-coap:2.13.0-SNAPSHOT
2022-09-14T07:34:24.8339126Z   +-org.apache.camel:camel-coap:3.19.0-20220913.111253-62
2022-09-14T07:34:24.8339605Z     +-org.eclipse.californium:scandium:2.7.3
2022-09-14T07:34:24.8340053Z       +-org.eclipse.californium:element-connector:2.7.3
2022-09-14T07:34:24.8340338Z and
2022-09-14T07:34:24.8340717Z +-org.apache.camel.quarkus:camel-quarkus-coap:2.13.0-SNAPSHOT
2022-09-14T07:34:24.8341155Z   +-org.apache.camel:camel-coap:3.19.0-20220913.111253-62
2022-09-14T07:34:24.8341615Z     +-org.eclipse.californium:element-connector-tcp-netty:2.7.2
2022-09-14T07:34:24.8342089Z       +-org.eclipse.californium:element-connector:2.7.2 



Correct solution should be to move californium:element-connector and californium:californium-legal: to version 2.7.3",
0,CAMEL-18504,Sub-task,Minor,None,3.19.0,"
None
",Resolved,Fixed,3.19.0,Andrea Cosentino,Claus Ibsen,0,1,2022-09-13 15:49:02+00:00,2022-09-20 18:04:01+00:00,"We have for AWS here
https://github.com/apache/camel/blob/main/components/camel-aws/camel-aws-secrets-manager/src/main/java/org/apache/camel/component/aws/secretsmanager/SecretsDevConsole.java


We need similar for camel-google-secret-manager",
0,CAMEL-18503,New Feature,Major,3.18.2,"3.18.3, 3.19.0","
None
",Resolved,Fixed,"3.18.3, 3.19.0",Unassigned,Vincent Paturet,0,2,2022-09-13 12:07:27+00:00,2022-09-16 20:34:16+00:00,"In recent versions of the Google PubSub client library, the message ack deadline can be extended up to 1 hour by default before the message is marked as expired:
https://github.com/googleapis/java-pubsub/blob/9add53894981d862ac1348d0b641e472b3b3aa79/google-cloud-pubsub/src/main/java/com/google/cloud/pubsub/v1/Subscriber.java#L96
To prevent long-running operations (more than 1 hour) from being executed multiple times due to message redelivery, it is necessary to configure the max ack extension period to a higher value using Subscriber.Builder.setMaxAckExtensionPeriod()
Proposed new feature: add a per-route parameter to configure the max ack extension period:


google-pubsub:myProject:mySubscription?maxAckExtensionPeriod=14400


 


PR: https://github.com/apache/camel/pull/8363","davsclaus:1663062518:2022-09-13T17:48:38.207+0000:1663062518:2022-09-13T17:48:38.207+0000:Thanks for reporting and the PR
vpaturet:1663280653:2022-09-16T06:24:13.426+0000:1663280653:2022-09-16T06:24:13.426+0000:Would it be possible to have this backported to 3.18.x?
davsclaus:1663331656:2022-09-16T20:34:16.214+0000:1663331656:2022-09-16T20:34:16.214+0000:Yeah this is okay as it does not affect existing users"
0,CAMEL-18502,Sub-task,Major,None,None,"
None
",Resolved,Fixed,3.19.0,Andrea Cosentino,Andrea Cosentino,0,1,2022-09-13 10:13:19+00:00,2022-09-13 12:48:21+00:00,No Desc,
0,CAMEL-18501,Sub-task,Major,None,None,"
None
",Resolved,Fixed,3.19.0,Andrea Cosentino,Andrea Cosentino,0,1,2022-09-13 05:30:22+00:00,2022-09-13 12:48:29+00:00,No Desc,
0,CAMEL-18500,Improvement,Major,None,3.19.0,"
None
",Resolved,Fixed,3.19.0,Claus Ibsen,Claus Ibsen,0,1,2022-09-12 15:53:40+00:00,2022-09-12 16:00:02+00:00,No Desc,
0,CAMEL-18499,Dependency upgrade,Major,None,3.19.0,"
None
",Resolved,Fixed,3.19.0,James Netherton,Claus Ibsen,0,2,2022-09-12 11:09:05+00:00,2022-09-14 08:35:16+00:00,No Desc,"jamesnetherton:1663023534:2022-09-13T06:58:54.226+0000:1663023534:2022-09-13T06:58:54.226+0000:I can try to do this for 3.19.0. There's a quite a few breaking changes, so can't guarantee that I'll make the release cut-off in time."
0,CAMEL-18498,New Feature,Major,None,None,"
None
",Open,Unresolved,4.x,Andrea Cosentino,Andrea Cosentino,0,1,2022-09-12 09:50:33+00:00,2023-08-09 09:05:28+00:00,No Desc,
0,CAMEL-18497,New Feature,Major,None,"3.20.2, 3.21.0, 4.0-M1, 4.0.0","
None
",Resolved,Fixed,"3.20.2, 3.21.0, 4.0-M1, 4.0.0",Claus Ibsen,Pasquale Congiusti,0,5,2022-09-12 09:23:54+00:00,2023-02-02 15:08:02+00:00,"We can specify any Camel version when using the jbang CLI as documented in: https://camel.apache.org/manual/camel-jbang.html#_using_a_specific_camel_version


However, it would be nice to have the same feature when using directly camel CLI, in order to have the very same behavior.","davsclaus:1662946945:2022-09-12T09:42:25.150+0000:1662946945:2022-09-12T09:42:25.150+0000:Yeah its a bit tricky to do as jbang does not support ""apps"" to specify easily arguments to their ""main"" script, and hence the -D JVM system property is the current ""way of doing this"".
You can possible create an OS shell alias using the long command line where you set the version.

We also have idea of allowing to specify the version in a config file, so you can set it once - ala camel set-version x.y.z


davsclaus:1662946984:2022-09-12T09:43:04.359+0000:1662946984:2022-09-12T09:43:04.359+0000:We need to work with the JBang team to make this easier in JBang for ""apps"" then we can better do this
tadayosi:1669324669:2022-11-25T05:17:49.969+0000:1669324669:2022-11-25T05:17:49.969+0000:[~squakez] [~davsclaus] Actually, JBang already allows specifying a branch or tag when installing an app:
{code}
jbang app install <alias>@<user/org>(/repository)(/branch)(~path)
{code}
https://www.jbang.dev/documentation/guide/latest/alias_catalogs.html#implicit-alias-catalogs
so you can already do:
{code}
jbang app install camel@apache/camel/camel-3.18.3
{code}
to use a specific version of Camel.

The problem is, though, in Camel side, where the {{CamelJBang}} at the {{camel-3.18.3}} still points to {{3.18.2}}. 
https://github.com/apache/camel/blob/camel-3.18.3/dsl/camel-jbang/camel-jbang-main/dist/CamelJBang.java
To make this version switch really available, the Camel release process would need to first update the {{CamelJBang}} and then do a release.

FYI [~acosentino]
davsclaus:1669325544:2022-11-25T05:32:24.451+0000:1669325948:2022-11-25T05:39:08.272+0000:Yeah that is only a half solution as then the CLI would also be downgraded.
What we want is to separate the CLI and run (however this is also a bigger task).

After installing a given version you can edit the ~.jbang/cache/urls/f20491f9ebc0e16d2fca028eb3d4f03aafdf8cd62b8af1a9d1730bfe382d8165/CamelJBang.java

file and change the version there, the hash is the same, so you can also have a script that does this afterwards. Or a new command in camel jbang itself ;)
tadayosi:1669328271:2022-11-25T06:17:51.421+0000:1669328271:2022-11-25T06:17:51.421+0000:[~davsclaus] Yes, it's true about downgrading, and since {{camel-jbang-core}} is also parameterised with {{camel.jbang.version}} it's not so much different from using {{-Dcamel.jbang.version=3.18.3}}:
{code}
//DEPS org.apache.camel:camel-jbang-core:${camel.jbang.version:3.19.0}
{code}

So truly achieving parameterisation of Camel version with Camel JBang, {{camel-jbang-core}} and {{camel-jbang-main}} need to be combined and installed via JBang on the fly. I agree that this task is a bigger one.
davsclaus:1669334793:2022-11-25T08:06:33.333+0000:1669334793:2022-11-25T08:06:33.333+0000:However coming back to your original inspection. I think its a good first solution to make a Camel release have the correct version in the source file, so you can install it via jbang app and provide the version.

Maybe we can use a maven profile (release) so when a release is built this maven profile is activated and it does a version replacement, like maven does when it replaces all the pom.xml from -SNAPSHOT to the actual version.

And if we dont have time before 3.18.4, we can hardcode that version in the source today, so its correct when release.

davsclaus:1669340096:2022-11-25T09:34:56.153+0000:1669340096:2022-11-25T09:34:56.153+0000:So I hardcoded the next 3.18 LTS release
https://github.com/apache/camel/commit/651a23fe9400f32d2093d12ede5285f88050ff21

Then after this release we can look at to see if we can automate this via some maven plugin magic in a <profile> release way
davsclaus:1673168629:2023-01-08T17:03:49.402+0000:1673176704:2023-01-08T19:18:24.601+0000:You can now choose version

camel run foo.java --name=foo2 --camel-version=3.20.1
camel run foo.java --name=foo3 --camel-version=3.18.4

And you can also run in background

camel run foo.java --name=foo4 --camel-version=3.19.0 --background

davsclaus:1673169096:2023-01-08T17:11:36.793+0000:1673176457:2023-01-08T19:14:17.941+0000:TODO: update documentation *DONE*"
0,CAMEL-18496,Task,Major,None,None,"
None
",Resolved,Fixed,3.21.0,Otavio Rodolfo Piske,Otavio Rodolfo Piske,0,3,2022-09-09 16:09:56+00:00,2023-01-11 09:00:11+00:00,"camel-ahc: CAMEL-17667
camel-ahc-ws: CAMEL-17667
camel-dozer: CAMEL-18455
camel-cmis: https://issues.apache.org/jira/browse/CAMEL-18495","orpiske:1662711096:2022-09-09T16:11:36.036+0000:1662711096:2022-09-09T16:11:36.036+0000:[~acosentino]   [~davsclaus]: FYI ... for when we decide to remove these deprecated components. 

 

 
davsclaus:1662713831:2022-09-09T16:57:11.105+0000:1662713862:2022-09-09T16:57:42.218+0000:Yeah lets removed them after next LTS

The ahc could technically be removed sooner as they were deprecated before 3.18 LTS
davsclaus:1662713891:2022-09-09T16:58:11.273+0000:1662713891:2022-09-09T16:58:11.273+0000:And we should look for more components to deprecate
orpiske:1663649015:2022-09-20T12:43:35.222+0000:1663649015:2022-09-20T12:43:35.222+0000:[~davsclaus] I think I'll go ahead and send a PR removing AHC for 3.19. Any thoughts / objections?
davsclaus:1663649153:2022-09-20T12:45:53.999+0000:1663649153:2022-09-20T12:45:53.999+0000:+1
orpiske:1663826472:2022-09-22T14:01:12.279+0000:1663826472:2022-09-22T14:01:12.279+0000:I am trying to find information whether ViPR is still a thing (used by camel-atmos) is still a thing: [https://camel.apache.org/components/3.18.x/atmos-component.html]

 

The underlying project seems unmaintained since 2014. I think it could be removed, but I don't know much about storage technologies. Do you have any idea [~davsclaus] or [~acosentino] ?
orpiske:1663826585:2022-09-22T14:03:05.010+0000:1663826585:2022-09-22T14:03:05.010+0000:Oh, forgive me guys. It's actually a bug in the documentation: our page takes the users to something outdated ... the actual atmos-client is indeed maintained.
orpiske:1670375713:2022-12-07T09:15:13.215+0000:1670375713:2022-12-07T09:15:13.215+0000:I think we can proceed to remove these after we release 3.20 LTS [~davsclaus] [~acosentino] 
davsclaus:1670376886:2022-12-07T09:34:46.423+0000:1670376886:2022-12-07T09:34:46.423+0000:Yeah
acosentino:1670378111:2022-12-07T09:55:11.199+0000:1670378111:2022-12-07T09:55:11.199+0000:Yeah, +1
davsclaus:1672973323:2023-01-06T10:48:43.506+0000:1672973323:2023-01-06T10:48:43.506+0000:Remember to add in the 3.21 upgrade docs about these removed components
orpiske:1672975117:2023-01-06T11:18:37.107+0000:1672975117:2023-01-06T11:18:37.107+0000:They are already there: https://github.com/apache/camel/blob/main/docs/user-manual/modules/ROOT/pages/camel-3x-upgrade-guide-3_21.adoc
orpiske:1672993269:2023-01-06T16:21:09.272+0000:1672993269:2023-01-06T16:21:09.272+0000:The remaining deprecated components (cmis and dozer) were removed. Closing.
acosentino:1673397794:2023-01-11T08:43:14.143+0000:1673397794:2023-01-11T08:43:14.143+0000:Since we are switching to Camel 4 I'm going to open an issue to remove also Camel Zipkin.
orpiske:1673398799:2023-01-11T08:59:59.878+0000:1673398811:2023-01-11T09:00:11.270+0000:[~acosentino] oh, nice one!"
0,CAMEL-18495,Task,Major,None,3.19.0,"
None
",Resolved,Fixed,3.19.0,Otavio Rodolfo Piske,Otavio Rodolfo Piske,0,1,2022-09-09 15:48:16+00:00,2022-09-14 13:21:22+00:00,The project is retired and likely unmaintained: https://chemistry.apache.org/java/opencmis.html.,
0,CAMEL-18494,New Feature,Minor,3.18.2,"3.18.3, 3.19.0","
None
",Resolved,Fixed,"3.18.3, 3.19.0",Claus Ibsen,Joseph,0,2,2022-09-09 15:42:21+00:00,2022-09-23 09:34:19+00:00,"When payloads are known to be always larger that the hardcoded MIN_BUFFER_SIZE of 2048, this results in the resizing of the buffer.


https://github.com/apache/camel/blob/c4b5791237bbf27af7b54bbd0d14b7c6944dff1f/components/camel-mllp/src/main/java/org/apache/camel/component/mllp/internal/MllpSocketBuffer.java#L39


There is also the belief that when a gc event occurs, the buffer then returns to the default size of MIN_BUFFER_SIZE, which again results in another resizing of the buffer when larger than MIN_BUFFER_SIZE payloads arrive.


It is the hope that allowing for a customized MIN_BUFFER_SIZE would result in an overall faster sustained throughput when the payload size is known to be larger than MIN_BUFFER_SIZE (2048).",davsclaus:1662717813:2022-09-09T18:03:33.849+0000:1662717813:2022-09-09T18:03:33.849+0000:You are welcome to work on a PR that allows to configure this buffer size
0,CAMEL-18493,Improvement,Trivial,3.x,3.19.0,"
None
",Resolved,Fixed,3.19.0,Claus Ibsen,Michael Frankfurter,0,2,2022-09-09 14:15:58+00:00,2022-09-09 17:55:50+00:00,"Camel Netty HTTP has the option maxHeaderSize which goes down into  HttpServerInitializerFactory and is used at constructor HttpRequestDecoder.


The other two options maxInitialLineLength and maxChunkSize which might be necessary to be configured here are not exposed but would be good if so.


Patch is already available: https://github.com/micfra/camel/tree/camel-netty-http-ext-configuration - Pull request follows.","davsclaus:1662716340:2022-09-09T17:39:00.086+0000:1662716340:2022-09-09T17:39:00.086+0000:Thanks for reporting and the PR
micfra@micfra.net:1662717350:2022-09-09T17:55:50.324+0000:1662717350:2022-09-09T17:55:50.324+0000:Thanks for accepting. Can't wait for 3.19 then ;)"
0,CAMEL-18492,Improvement,Minor,3.0.0,3.19.0,"
None
",Resolved,Fixed,3.19.0,Claus Ibsen,Harish Annamalai,0,3,2022-09-09 11:54:23+00:00,2022-09-13 07:51:14+00:00,"Hi All, 


We use Camel-Saxon for one of our product. We use Saxon Enterprise Edition 9.9.1.6. 


We are migrating our product from camel 2.x to camel 3.x (2.24 to 3.15 to be exact). 


We use a paid feature of Saxon; Invoking External Java Functions in XSL Transformations.


We also Extension Functions, which we pass to camel-xslt-saxon component. 


What we have observed in camel 3.x versions and above, In class XsltSaxonEndpoint.java During the registration of extension functions, at line 202, registerSaxonExtensionFunctions method of XsltSaxonHelper.java is called. 


 


In XsltSaxonHelper.class, the method, registerSaxonExtensionFunctions, at line 55, sets a feature of XMLConstants.FEATURE_SECURE_PROCESSING.


Unfortunately, Setting this Feature disables the External Java Function calls. 


We checked in Camel 2.x versions, this Feature is not set and therefore the External Java Calls work fine. 


 


We see this as a bug - The Feature XMLConstants.FEATURE_SECURE_PROCESSING is being introduced in 3.x and breaks a paid/Enterprise feature of Saxon.


 


Sample Code to test:


import javax.xml.XMLConstants;
import javax.xml.transform.Transformer;
import javax.xml.transform.TransformerException;
import javax.xml.transform.TransformerFactory;
import javax.xml.transform.stream.StreamResult;
import javax.xml.transform.stream.StreamSource;
import java.io.File;


public class SaxonTransformationTester {


{{ public static void main(String[] args) throws TransformerException {}}


{{ String foo_xml = ""src/main/resources/in.xml""; // input xml}}
{{ String foo_xsl = ""src/main/resources/transf.xml""; // input xsl}}


{{ EnterpriseTransformerFactory eef = SaxonEEConsumerFactory.getEnterpriseTransformerFactoryInstance();}}
{{ eef.getConfiguration().getConfigurationProperty(Feature.ALLOW_EXTERNAL_FUNCTIONS);}}
{{ eef.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true); //This causes External Functions to break}}
{{ eef.getConfiguration().setConfigurationProperty(""http://saxon.sf.net/feature/trace-external-functions"", false);}}
{{ Transformer transformer = eef.newTransformer(new StreamSource(}}
{{ new File(foo_xsl)));}}
{{ transformer.transform(new StreamSource(new File(foo_xml)),}}
{{ new StreamResult(System.out));}}


{{ }}}
}","acosentino:1662696477:2022-09-09T12:07:57.027+0000:1662696491:2022-09-09T12:08:11.962+0000:It's a security best practice to the set FEATURE_SECURE_PROCESSING property to true. 
acosentino:1662696886:2022-09-09T12:14:46.641+0000:1662696886:2022-09-09T12:14:46.641+0000:As a side note even Michael Kay comments about this on Stack Overflow that this feature is widely misunderstood 
https://stackoverflow.com/questions/51378748/extension-functions-cannot-be-used-when-secure-feature-proccesing-is-set-to-true
acosentino:1662696976:2022-09-09T12:16:16.499+0000:1662696976:2022-09-09T12:16:16.499+0000:So maybe we should make it configurable and set to true by default. [~davsclaus]
davsclaus:1662764077:2022-09-10T06:54:37.686+0000:1662764077:2022-09-10T06:54:37.686+0000:Yeah we can add an option to xslt-saxon endpoint where you can configure this. And also on component so you can set it once globally for xslt-saxon
davsclaus:1663026674:2022-09-13T07:51:14.830+0000:1663026674:2022-09-13T07:51:14.830+0000:There is a new option you can set to turn off secure processing"
0,CAMEL-18491,Improvement,Minor,None,3.19.0,"
None
",Resolved,Fixed,3.19.0,Claus Ibsen,Claus Ibsen,0,1,2022-09-09 11:47:48+00:00,2022-09-12 14:40:55+00:00,I noticed in the aws secret reloader example that the bean introspector reports that reflection are used for configuring the vault options.,
0,CAMEL-18490,Bug,Minor,None,"3.14.6, 3.18.3, 3.19.0","
None
",Resolved,Fixed,"3.14.6, 3.18.3, 3.19.0",Claus Ibsen,Claus Ibsen,0,1,2022-09-09 11:39:19+00:00,2022-09-10 11:41:53+00:00,"PID   NAME  CAMEL            PLATFORM  READY  STATUS   RELOAD   AGE   ROUTE  MSG/S  TOTAL  FAIL  INFLIGHT  SINCE-LAST
 88183  foo   3.19.0-SNAPSHOT  JBang      1/1   Running       1  1m59s    1/1   7.97    538     0        -1     0s/0s/-",davsclaus:1662781313:2022-09-10T11:41:53.143+0000:1662781313:2022-09-10T11:41:53.143+0000:It was a general problem in JMX statistics in camel.
0,CAMEL-18489,Bug,Major,3.18.0,"3.18.3, 3.19.0","
None
",Resolved,Fixed,"3.18.3, 3.19.0",Claus Ibsen,Claus Ibsen,0,1,2022-09-09 11:23:02+00:00,2022-09-09 11:31:56+00:00,https://github.com/apache/camel/pull/8335,
0,CAMEL-18488,New Feature,Major,None,3.19.0,"
None
",Resolved,Fixed,3.19.0,Claus Ibsen,Claus Ibsen,0,1,2022-09-08 18:21:24+00:00,2022-09-09 08:17:57+00:00,"If you enable load average then we can also output the current msg/sec as throughput.


And maybe also calculate a sliding window of average throughput.",
0,CAMEL-18487,Sub-task,Major,None,3.19.0,"
None
",Resolved,Fixed,3.19.0,Andrea Cosentino,Andrea Cosentino,0,1,2022-09-08 12:44:41+00:00,2022-09-09 06:15:12+00:00,No Desc,
0,CAMEL-18486,Test,Minor,3.19.0,,"

help-wanted

",Open,Unresolved,None,Unassigned,Jiri Ondrusek,0,1,2022-09-08 11:31:55+00:00,2023-11-14 13:30:27+00:00,"During implementation of https://issues.apache.org/jira/browse/CAMEL-18484 I had a problem with the test AccountProducerTest#testFundingHistory.


Test works when using real account, but once I added a wiremock recording server to catch communication, I got 




org.knowm.xchange.exceptions.ExchangeException: API-key format invalid. (HTTP status code: 400) 



I'm not sure why this is happening. It would be nice to solve this problem and once it works, enable this test for the mocked testing (it is disabled with a comment now)",
0,CAMEL-18485,Improvement,Minor,3.18.1,3.19.0,"
None
",Resolved,Information Provided,3.19.0,Claus Ibsen,Raymond,0,2,2022-09-08 09:32:05+00:00,2022-09-12 19:27:26+00:00,"I'm loading a xml routetemplate as resource as follows:




loader = extendedCamelContext.getRoutesLoader();

Resource resource = IntegrationUtil.setResource(routetemplate);

log.info(""Loading routetemplate "" + routetemplate);

try{
   loader.loadRoutes(resource);
}catch(java.lang.IllegalArgumentException e){
   loader.updateRoutes(resource);
}
 



I however made a mistake and the resource was empty. The error message/stacktrace I received was:




Unable to parse resource: route.yaml        
at org.apache.camel.dsl.yaml.YamlRoutesBuilderLoaderSupport.lambda$doLoadRouteBuilder$1(YamlRoutesBuilderLoaderSupport.java:90)
        at java.base/java.util.Optional.orElseThrow(Optional.java:408)
        at org.apache.camel.dsl.yaml.YamlRoutesBuilderLoaderSupport.doLoadRouteBuilder(YamlRoutesBuilderLoaderSupport.java:90)
        at org.apache.camel.dsl.support.RouteBuilderLoaderSupport.loadRoutesBuilder(RouteBuilderLoaderSupport.java:104)
        at org.apache.camel.impl.engine.DefaultRoutesLoader.findRoutesBuilders(DefaultRoutesLoader.java:124)
        at org.apache.camel.spi.RoutesLoader.findRoutesBuilders(RoutesLoader.java:117)
        at org.apache.camel.spi.RoutesLoader.loadRoutes(RoutesLoader.java:72) 



I was a bit puzzled about this because I was thinking I was providing a XML. Maybe better in this case:




Unable to parse resource: empty resource 



The text also mentions 'route', but it can also be a routeConfiguration or a routeTemplate.


Three sidenotes (some things I noticed): 


1. In general one could check faulty input better. (is it a valid xml, yaml etc, or just some random text, empty or null). And for routetemplate are all the template parameters provide?
2. Notice in the example code I first need to create a resource before passing it to the routeloader. I have a string and would like to pass directly as a String to the routeloader.
3. When loading an existing route the routeloader may give an error (for example when the route already exist). I would like to loadOrUpdateRoute(String route) (this was possible in Camel 2).","davsclaus:1662962922:2022-09-12T14:08:42.603+0000:1662962922:2022-09-12T14:08:42.603+0000:Adding check for empty resource.

The API and terms are as-is. What you do is lower level and loading routes from custom code, and that is not the usual usage for normal Camel end users.


davsclaus:1662963073:2022-09-12T14:11:13.121+0000:1662964177:2022-09-12T14:29:37.149+0000:ad 1) empty resource error is reported now
ad 2) See ResourceHelper
ad 3) no (see route reload that has some of that functionality)
skin27:1662982046:2022-09-12T19:27:26.054+0000:1662982046:2022-09-12T19:27:26.054+0000:ad 1) Nice

ad 2/3) I actually looked at the route reload,  but there was something that I missed or didn't work as expected (Can't recall what exactly), so I wrote my own filewatch class and actually also use the ResourceHelper, but I was thinking maybe we can skip it all and just pass a string to loadOrUpdateRoute(String route) as a convenient method. Thus not a must have, but just something convenient. But like you said, this maybe a bit too far from normal use case to spend too much time on it."
0,CAMEL-18484,Test,Major,3.19.0,None,"
None
",Resolved,Fixed,3.19.0,Jiri Ondrusek,Jiri Ondrusek,0,1,2022-09-08 09:10:57+00:00,2022-09-10 06:51:02+00:00,"Tests in camel-xchange component are disabled by default (because of the need of the real credentials)




@EnabledIfSystemProperty(named = ""enable.xchange.itests"", matches = ""true"", disabledReason = ""Requires API credentials"") 



It would be much better if the functionality was covered by mocked junit tests. (For example wiremock could be used)



if enable.xchange.itests is set to true, not-mocked test would be used (as before)",
0,CAMEL-18483,Bug,Major,"3.18.1, 3.18.2","3.18.3, 3.19.0","
None
",Resolved,Fixed,"3.18.3, 3.19.0",James Netherton,James Netherton,0,1,2022-09-08 08:38:21+00:00,2022-09-08 16:29:04+00:00,"Some more detail here:


https://github.com/apache/camel-quarkus/issues/3989


Due to how CamelMicroProfileHealthCheckRegistry figures out whether it should register the HealthCheckRespository checks it misses ones for routes & consumers if SupervisingRouteController is in use.",
0,CAMEL-18482,Wish,Minor,None,4.4.0,"
None
",Resolved,Fixed,4.4.0,Claus Ibsen,Jacques Franken,0,2,2022-09-08 02:04:35+00:00,2023-12-22 18:14:48+00:00,"We are busy updating some of our deployments to the latest camel LTS, but found a change in behaviour in split on maps.  We've tracked it down to the following ticket as being a likely cause of the change. 


https://issues.apache.org/jira/browse/CAMEL-17101


So my wish item is: Please add an option to .split() to allow processing the map the ""old way"". 


This is not a ""bug"" - we all feel that the current behaviour is logically how the split EIP should work when splitting a single object in a complex map. 


Notwithstanding, the old behaviour was really elegant in cases where we had to split(""${body.Map}"").


In version 3.12 that allowed us to process the Map as a ""record"", pass the record to a bean, do a simpleJdbcinsert() and once the split ended, the body was restored for the next split().


I asked around Stackoverflow and in zulip for ideas, and we tried a few things - but eventually found the only way for is significant code modification.


This involves setting a header variable to the sub-map --> and call the bean to handle SQL insert. 


The bean also now has to do some logic.  if the header variable is set --> then it should use the header for insert value. if header is null - then do default behaviour. 


If you need me to provide code examples to illustrate - please let me know.


link to Zulip:


https://camel.zulipchat.com/#narrow/stream/257301-camel-spring-boot/topic/split.28.29.20change.20in.20behaviour.203.2E13.20onwards


link to Stack-overflow:


https://stackoverflow.com/questions/73615483/how-to-return-non-array-json-object-from-apache-camel-split


 


Sorry if this is not appropriate way to raise this request. I felt that it was worth raising officially as it does make for simpler code in some use-cases.","davsclaus:1703221427:2023-12-22T13:03:47.292+0000:1703221427:2023-12-22T13:03:47.292+0000:You can now use ""single"" as the delimiter value to force into single mode"
0,CAMEL-18481,New Feature,Minor,None,3.19.0,"
None
",Resolved,Fixed,3.19.0,Unassigned,Manuel Shenavai,0,1,2022-09-07 20:45:16+00:00,2022-10-05 10:09:58+00:00,The mail consumer is not able to process mail attachments that are empty or if no filename is set. Its also not possible to get all attachments of a mail if they have the same filename.,mash-sap:1662555547:2022-09-07T20:59:07.795+0000:1662555547:2022-09-07T20:59:07.795+0000:PR created: https://github.com/apache/camel/pull/8322
0,CAMEL-18480,New Feature,Major,None,3.19.0,"
None
",Resolved,Fixed,3.19.0,Claus Ibsen,Claus Ibsen,0,1,2022-09-07 18:10:48+00:00,2022-09-07 18:41:25+00:00,No Desc,
0,CAMEL-18479,Improvement,Major,None,3.19.0,"
None
",Resolved,Fixed,3.19.0,Claus Ibsen,Claus Ibsen,0,1,2022-09-07 15:16:34+00:00,2022-09-08 13:38:05+00:00,"The goal is to avoid need for declaring this
https://github.com/apache/camel-examples/blob/main/examples/aws/aws-secrets-manager-reloading/src/main/resources/application.properties#L30",
0,CAMEL-18478,Sub-task,Major,None,3.19.0,"
None
",Resolved,Fixed,3.19.0,Andrea Cosentino,Andrea Cosentino,0,1,2022-09-07 13:19:16+00:00,2022-09-13 10:12:49+00:00,No Desc,
0,CAMEL-18477,Bug,Major,3.18.1,"3.18.3, 3.19.0","
None
",Resolved,Information Provided,"3.18.3, 3.19.0",Zineb Bendhiba,Zineb Bendhiba,0,3,2022-09-07 12:43:59+00:00,2022-09-21 11:31:58+00:00,"Knative camel producer creates CloudEvents. To have a valid CloudEvent, there's the need to have a field named `source`.


The knative camel producer sets this value by putting the ""fromRouteId"" value. This value is set by DefaultConsumer when creating the extended exchange.


However, when using the knative producer via ProducerTemplate, we miss this value. And the event is rejected because source is required by knative.


Log :




{""level"":""warn"",""ts"":""2022-09-07T10:28:15.844Z"",""logger"":""mt_broker_ingress"",""caller"":""ingress/ingress_handler.go:145"",""msg"":""failed to validate extracted event"",""error"":""source: REQUIRED\n""} 



As a temporary fix, we could ask user to override the source value, as in this configuration example :




{
  ""type"": ""event"",
  ""name"": ""YOUR_NAME_EVENT"",
  ""url"": ""YOUR_LINK_TO_BROKER"",
  ""metadata"": {
    ""camel.endpoint.kind"": ""sink""
  },
  ""ceOverrides"": {
    ""ce-source"": ""YOUR_SOURCE_NAME""
  }
} 



However, it doesn't seem right to suppose in the code this value is coming necessarly from a Camel Consumer.","zbendhiba:1662525898:2022-09-07T12:44:58.400+0000:1662525898:2022-09-07T12:44:58.400+0000:[~lburgazzoli] Do you happen to have any opinion on this? I'd be happy to do the fix
davsclaus:1662526423:2022-09-07T12:53:43.235+0000:1662526423:2022-09-07T12:53:43.235+0000:Maybe you can make the code fallback and use camel context id as source if route id is empty
davsclaus:1662526564:2022-09-07T12:56:04.489+0000:1662526564:2022-09-07T12:56:04.489+0000:Also IMHO it should be possible to set a custom source, what if there is a Camel header set on the Exchange message with CamelCloudEventSource as the key?
lb:1662529736:2022-09-07T13:48:56.239+0000:1662529736:2022-09-07T13:48:56.239+0000:I'd say that it works as designed as the component tries to se some sensible defaults but some of the attributes are expected to be set the the user. This is particularly true for source and event type as those are business attributes an we cannot reliably compute/derive them.

The idea is that if you need to customize any attribute, then a user should set one of the CamelCloudEvent* header so with the ProducerTemplate tou should use sendBodyWithHeader or similar methods
zbendhiba:1662530551:2022-09-07T14:02:31.745+0000:1662530551:2022-09-07T14:02:31.745+0000:My mistake I missed the possibility to add those with header"
0,CAMEL-18476,Bug,Minor,"3.14.3, 3.18.1","3.18.3, 3.19.0","
None
",Resolved,Information Provided,"3.18.3, 3.19.0",Unassigned,Ramarajan R,0,3,2022-09-07 09:48:18+00:00,2022-11-11 21:21:15+00:00,"I have used https://github.com/apache/camel-examples/tree/main/examples/artemis-large-messages using AMQ 7.8.0 Broker 
Messages are getting processed but after processing the file is unable to delete from source location, tested in more than 1 windows systems facing the same


I am using Camel 3.14.3 and Spring boot 2.6.6 using JAVA DSL,


tested with Camel 3.18.1 and Spring boot 2.7.3 also
when running with Camel XML routes are fine but we want to use Java DSL , Kindly help.


Raising the concern in Zulip chat earlier.


https://camel.zulipchat.com/#narrow/stream/257298-camel/topic/camel-file.20artemis.20large.20message.20example.20failing.20in.20windows tion-poc/inbox0] o.a.c.c.file.GenericFileOnCompletion : Error during commit. Exchange[7D4CFE29E3F7515-0000000000000003]. Caused by: [org.apache.camel.component.file.GenericFileOperationFailedException - Error renaming file from C:\opt\file-transfer-solution-poc\inbox0\test.xlsx to C:\opt\file-transfer-solution-poc\inbox0\.camel\test.xlsx]org.apache.camel.component.file.GenericFileOperationFailedException: Error renaming file from C:\opt\file-transfer-solution-poc\inbox0\test.xlsx to C:\opt\file-transfer-solution-poc\inbox0\.camel\test.xlsx
at org.apache.camel.component.file.FileOperations.renameFile(FileOperations.java:93) ~[camel-file-3.14.3.jar:3.14.3]
at org.apache.camel.component.file.strategy.GenericFileProcessStrategySupport.renameFile(GenericFileProcessStrategySupport.java:145) ~[camel-file-3.14.3.jar:3.14.3]
at org.apache.camel.component.file.strategy.GenericFileRenameProcessStrategy.commit(GenericFileRenameProcessStrategy.java:121) ~[camel-file-3.14.3.jar:3.14.3]
at org.apache.camel.component.file.GenericFileOnCompletion.processStrategyCommit(GenericFileOnCompletion.java:134) ~[camel-file-3.14.3.jar:3.14.3]
at org.apache.camel.component.file.GenericFileOnCompletion.onCompletion(GenericFileOnCompletion.java:86) ~[camel-file-3.14.3.jar:3.14.3]
at org.apache.camel.component.file.GenericFileOnCompletion.onComplete(GenericFileOnCompletion.java:60) ~[camel-file-3.14.3.jar:3.14.3]
at org.apache.camel.support.UnitOfWorkHelper.doneSynchronization(UnitOfWorkHelper.java:104) ~[camel-support-3.14.3.jar:3.14.3]
at org.apache.camel.support.UnitOfWorkHelper.doneSynchronizations(UnitOfWorkHelper.java:93) ~[camel-support-3.14.3.jar:3.14.3]
at org.apache.camel.impl.engine.DefaultUnitOfWork.done(DefaultUnitOfWork.java:238) ~[camel-base-engine-3.14.3.jar:3.14.3]
at org.apache.camel.support.UnitOfWorkHelper.doneUow(UnitOfWorkHelper.java:61) ~[camel-support-3.14.3.jar:3.14.3]
at org.apache.camel.impl.engine.CamelInternalProcessor$UnitOfWorkProcessorAdvice.after(CamelInternalProcessor.java:777) ~[camel-base-engine-3.14.3.jar:3.14.3]
at org.apache.camel.impl.engine.CamelInternalProcessor$UnitOfWorkProcessorAdvice.after(CamelInternalProcessor.java:712) ~[camel-base-engine-3.14.3.jar:3.14.3]
at org.apache.camel.impl.engine.CamelInternalProcessor$AsyncAfterTask.done(CamelInternalProcessor.java:263) ~[camel-base-engine-3.14.3.jar:3.14.3]
at org.apache.camel.AsyncCallback.run(AsyncCallback.java:44) ~[camel-api-3.14.3.jar:3.14.3]
at org.apache.camel.impl.engine.DefaultReactiveExecutor$Worker.schedule(DefaultReactiveExecutor.java:193) ~[camel-base-engine-3.14.3.jar:3.14.3]
at org.apache.camel.impl.engine.DefaultReactiveExecutor.scheduleMain(DefaultReactiveExecutor.java:64) ~[camel-base-engine-3.14.3.jar:3.14.3]
at org.apache.camel.processor.Pipeline.process(Pipeline.java:184) ~[camel-core-processor-3.14.3.jar:3.14.3]
at org.apache.camel.impl.engine.CamelInternalProcessor.process(CamelInternalProcessor.java:398) ~[camel-base-engine-3.14.3.jar:3.14.3]
at org.apache.camel.component.file.GenericFileConsumer.processExchange(GenericFileConsumer.java:492) ~[camel-file-3.14.3.jar:3.14.3]
at org.apache.camel.component.file.GenericFileConsumer.processBatch(GenericFileConsumer.java:245) ~[camel-file-3.14.3.jar:3.14.3]
at org.apache.camel.component.file.GenericFileConsumer.poll(GenericFileConsumer.java:206) ~[camel-file-3.14.3.jar:3.14.3]
at org.apache.camel.support.ScheduledPollConsumer.doRun(ScheduledPollConsumer.java:202) ~[camel-support-3.14.3.jar:3.14.3]
at org.apache.camel.support.ScheduledPollConsumer.run(ScheduledPollConsumer.java:116) ~[camel-support-3.14.3.jar:3.14.3]
at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515) ~[na:na]
at java.base/java.util.concurrent.FutureTask.runAndReset(FutureTask.java:305) ~[na:na]
at java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305) ~[na:na]
at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) ~[na:na]
at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) ~[na:na]
at java.base/java.lang.Thread.run(Thread.java:834) ~[na:na]
Caused by: java.io.IOException: Renaming file from 'C:\opt\file-transfer-solution-poc\inbox0\test.xlsx' to 'C:\opt\file-transfer-solution-poc\inbox0\.camel\test.xlsx'
failed: Cannot delete file 'C:\opt\file-transfer-solution-poc\inbox0\test.xlsx' after copy succeeded
at org.apache.camel.util.FileUtil.renameFileUsingCopy(FileUtil.java:464) ~[camel-util-3.14.3.jar:3.14.3]
at org.apache.camel.component.file.FileOperations.renameFile(FileOperations.java:88) ~[camel-file-3.14.3.jar:3.14.3]
... 28 common frames omitted</code>","Ramarajan:1662597649:2022-09-08T08:40:49.528+0000:1662597649:2022-09-08T08:40:49.528+0000:Hi Team,

pls find the attached example with junits, I am facing the issue only when we have artemis-stream enabled for large message.
if you comment below lines from ConsumerBeanConfiguration the same test case passes.
coreConsumerComponent.setArtemisStreamingEnabled(true);
coreConsumerConnectionFactory.setMinLargeMessageSize(10240);
coreConsumerConnectionFactory.setCompressLargeMessage(true);

 

thanks,

R Ramarajan.
Ramarajan:1662692847:2022-09-09T11:07:27.756+0000:1662692847:2022-09-09T11:07:27.756+0000:Hi Team,

Adding JMS Message type as Stream solves the issue,
jms:queue:data{*}?jmsMessageType=Stream{*}

Tried with Bytes its not working

Thanks,

R Ramarajan.
Ramarajan:1662693508:2022-09-09T11:18:28.050+0000:1662693675:2022-09-09T11:21:15.880+0000:Hi [~davsclaus] 

In JmsBinding.class Input stream is not closed for bytes message type @ Line number 657 where as for type Stream input stream is closed.  @Line number 725

Thanks,

R Ramarajan.

 
davsclaus:1662764143:2022-09-10T06:55:43.388+0000:1662764143:2022-09-10T06:55:43.388+0000:You are welcome to send a github PR with closing the bytes
https://camel.apache.org/community/contributing/

Ramarajan:1662838485:2022-09-11T03:34:45.870+0000:1662839593:2022-09-11T03:53:13.151+0000:Hi [~davsclaus],

Adding Close stream causes another problem, artemis client library wants the Input stream to be open. we are getting java.io.IOException: Stream closed.

is = context.getTypeConverter().mandatoryConvertTo(InputStream.class, exchange, body);
message.setObjectProperty(""JMS_AMQ_InputStream"", is);            

finally

{             IOHelper.close(is);           }

 

w%20folder] o.a.c.c.f.GenericFileConsumer            : About to process file: GenericFile[C:\Softwares\New folder\test.txt] using exchange: Exchange[]
2022-09-11 08:17:09,677  INFO 3956 — [%5CNew%20folder] route1                                   : Sending file test.txt to Artemis
2022-09-11 08:17:09,680 DEBUG 3956 — [%5CNew%20folder] o.a.c.c.f.GenericFileConverter           : Read file C:\Softwares\New folder\test.txt (no charset)
2022-09-11 08:17:09,687 ERROR 3956 — [%5CNew%20folder] o.a.c.p.e.DefaultErrorHandler            : Failed delivery for (MessageId: A1D4FB4352A0804-0000000000000007 on ExchangeId: A1D4FB4352A0804-0000000000000007). Exhausted after delivery attempt: 1 caught: org.springframework.jms.UncategorizedJmsException: Uncategorized exception occurred during JMS processing; nested exception is javax.jms.JMSException: AMQ219026: Error reading the LargeMessageBody

Message History (complete message history is disabled)
---------------------------------------------------------------------------------------------------------------------------------------
RouteId              ProcessorId          Processor                                                                        Elapsed (ms)
[route1            ] [route1            ] [from[file://C:%5CSoftwares%5CNew%20folder?readLockCheckInterval=1&readLockTime|file:///C:/%5CSoftwares%5CNew%20folder?readLockCheckInterval=1&readLockTime] [        28]
    ...
[route1            ] [to1               ] [jms:queue:data                                                                ] [         0]

Stacktrace
---------------------------------------------------------------------------------------------------------------------------------------

org.springframework.jms.UncategorizedJmsException: Uncategorized exception occurred during JMS processing; nested exception is javax.jms.JMSException: AMQ219026: Error reading the LargeMessageBody
    at org.springframework.jms.support.JmsUtils.convertJmsAccessException(JmsUtils.java:311) ~[spring-jms-5.3.19.jar:5.3.19]
    at org.springframework.jms.support.JmsAccessor.convertJmsAccessException(JmsAccessor.java:185) ~[spring-jms-5.3.19.jar:5.3.19]
    at org.springframework.jms.core.JmsTemplate.execute(JmsTemplate.java:507) ~[spring-jms-5.3.19.jar:5.3.19]
    at org.apache.camel.component.jms.JmsConfiguration$CamelJmsTemplate.send(JmsConfiguration.java:565) ~[classes/:?]
    at org.apache.camel.component.jms.JmsProducer.doSend(JmsProducer.java:425) ~[classes/:?]
    at org.apache.camel.component.jms.JmsProducer.processInOnly(JmsProducer.java:392) ~[classes/:?]
    at org.apache.camel.component.jms.JmsProducer.process(JmsProducer.java:159) ~[classes/:?]
    at org.apache.camel.processor.SendProcessor.process(SendProcessor.java:172) ~[camel-core-processor-3.14.3.jar:3.14.3]
    at org.apache.camel.processor.errorhandler.RedeliveryErrorHandler$SimpleTask.run(RedeliveryErrorHandler.java:471) ~[camel-core-processor-3.14.3.jar:3.14.3]
    at org.apache.camel.impl.engine.DefaultReactiveExecutor$Worker.schedule(DefaultReactiveExecutor.java:193) ~[camel-base-engine-3.14.3.jar:3.14.3]
    at org.apache.camel.impl.engine.DefaultReactiveExecutor.scheduleMain(DefaultReactiveExecutor.java:64) ~[camel-base-engine-3.14.3.jar:3.14.3]
    at org.apache.camel.processor.Pipeline.process(Pipeline.java:184) ~[camel-core-processor-3.14.3.jar:3.14.3]
    at org.apache.camel.impl.engine.CamelInternalProcessor.process(CamelInternalProcessor.java:398) ~[camel-base-engine-3.14.3.jar:3.14.3]
    at org.apache.camel.component.file.GenericFileConsumer.processExchange(GenericFileConsumer.java:492) ~[camel-file-3.14.3.jar:3.14.3]
    at org.apache.camel.component.file.GenericFileConsumer.processBatch(GenericFileConsumer.java:245) ~[camel-file-3.14.3.jar:3.14.3]
    at org.apache.camel.component.file.GenericFileConsumer.poll(GenericFileConsumer.java:206) ~[camel-file-3.14.3.jar:3.14.3]
    at org.apache.camel.support.ScheduledPollConsumer.doRun(ScheduledPollConsumer.java:202) ~[camel-support-3.14.3.jar:3.14.3]
    at org.apache.camel.support.ScheduledPollConsumer.run(ScheduledPollConsumer.java:116) ~[camel-support-3.14.3.jar:3.14.3]
    at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515) ~[?:?]
    at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:305) ~[?:?]
    at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305) ~[?:?]
    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) ~[?:?]
    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) ~[?:?]
    at java.lang.Thread.run(Thread.java:834) ~[?:?]
Caused by: javax.jms.JMSException: AMQ219026: Error reading the LargeMessageBody
    at org.apache.activemq.artemis.core.client.impl.ClientProducerImpl.largeMessageSendStreamed(ClientProducerImpl.java:451) ~[artemis-core-client-2.22.0.jar:2.22.0]
    at org.apache.activemq.artemis.core.client.impl.ClientProducerImpl.largeMessageSend(ClientProducerImpl.java:329) ~[artemis-core-client-2.22.0.jar:2.22.0]
    at org.apache.activemq.artemis.core.client.impl.ClientProducerImpl.doSend(ClientProducerImpl.java:261) ~[artemis-core-client-2.22.0.jar:2.22.0]
    at org.apache.activemq.artemis.core.client.impl.ClientProducerImpl.send(ClientProducerImpl.java:140) ~[artemis-core-client-2.22.0.jar:2.22.0]
    at org.apache.activemq.artemis.core.client.impl.ClientProducerImpl.send(ClientProducerImpl.java:122) ~[artemis-core-client-2.22.0.jar:2.22.0]
    at org.apache.activemq.artemis.jms.client.ActiveMQMessageProducer.doSendx(ActiveMQMessageProducer.java:481) ~[artemis-jms-client-2.22.0.jar:2.22.0]
    at org.apache.activemq.artemis.jms.client.ActiveMQMessageProducer.send(ActiveMQMessageProducer.java:219) ~[artemis-jms-client-2.22.0.jar:2.22.0]
    at org.messaginghub.pooled.jms.JmsPoolMessageProducer.sendMessage(JmsPoolMessageProducer.java:194) ~[pooled-jms-2.0.4.jar:?]
    at org.messaginghub.pooled.jms.JmsPoolMessageProducer.send(JmsPoolMessageProducer.java:88) ~[pooled-jms-2.0.4.jar:?]
    at org.messaginghub.pooled.jms.JmsPoolMessageProducer.send(JmsPoolMessageProducer.java:77) ~[pooled-jms-2.0.4.jar:?]
    at org.springframework.jms.core.JmsTemplate.doSend(JmsTemplate.java:634) ~[spring-jms-5.3.19.jar:5.3.19]
    at org.apache.camel.component.jms.JmsConfiguration$CamelJmsTemplate.doSend(JmsConfiguration.java:670) ~[classes/:?]
    at org.apache.camel.component.jms.JmsConfiguration$CamelJmsTemplate.doSendToDestination(JmsConfiguration.java:610) ~[classes/:?]
    at org.apache.camel.component.jms.JmsConfiguration$CamelJmsTemplate.lambda$send$0(JmsConfiguration.java:567) ~[classes/:?]
    at org.springframework.jms.core.JmsTemplate.execute(JmsTemplate.java:504) ~[spring-jms-5.3.19.jar:5.3.19]
    ... 21 more
Caused by: org.apache.activemq.artemis.api.core.ActiveMQLargeMessageException: AMQ219026: Error reading the LargeMessageBody
    at org.apache.activemq.artemis.core.client.impl.ClientProducerImpl.largeMessageSendStreamed(ClientProducerImpl.java:451) ~[artemis-core-client-2.22.0.jar:2.22.0]
    at org.apache.activemq.artemis.core.client.impl.ClientProducerImpl.largeMessageSend(ClientProducerImpl.java:329) ~[artemis-core-client-2.22.0.jar:2.22.0]
    at org.apache.activemq.artemis.core.client.impl.ClientProducerImpl.doSend(ClientProducerImpl.java:261) ~[artemis-core-client-2.22.0.jar:2.22.0]
    at org.apache.activemq.artemis.core.client.impl.ClientProducerImpl.send(ClientProducerImpl.java:140) ~[artemis-core-client-2.22.0.jar:2.22.0]
    at org.apache.activemq.artemis.core.client.impl.ClientProducerImpl.send(ClientProducerImpl.java:122) ~[artemis-core-client-2.22.0.jar:2.22.0]
    at org.apache.activemq.artemis.jms.client.ActiveMQMessageProducer.doSendx(ActiveMQMessageProducer.java:481) ~[artemis-jms-client-2.22.0.jar:2.22.0]
    at org.apache.activemq.artemis.jms.client.ActiveMQMessageProducer.send(ActiveMQMessageProducer.java:219) ~[artemis-jms-client-2.22.0.jar:2.22.0]
    at org.messaginghub.pooled.jms.JmsPoolMessageProducer.sendMessage(JmsPoolMessageProducer.java:194) ~[pooled-jms-2.0.4.jar:?]
    at org.messaginghub.pooled.jms.JmsPoolMessageProducer.send(JmsPoolMessageProducer.java:88) ~[pooled-jms-2.0.4.jar:?]
    at org.messaginghub.pooled.jms.JmsPoolMessageProducer.send(JmsPoolMessageProducer.java:77) ~[pooled-jms-2.0.4.jar:?]
    at org.springframework.jms.core.JmsTemplate.doSend(JmsTemplate.java:634) ~[spring-jms-5.3.19.jar:5.3.19]
    at org.apache.camel.component.jms.JmsConfiguration$CamelJmsTemplate.doSend(JmsConfiguration.java:670) ~[classes/:?]
    at org.apache.camel.component.jms.JmsConfiguration$CamelJmsTemplate.doSendToDestination(JmsConfiguration.java:610) ~[classes/:?]
    at org.apache.camel.component.jms.JmsConfiguration$CamelJmsTemplate.lambda$send$0(JmsConfiguration.java:567) ~[classes/:?]
    at org.springframework.jms.core.JmsTemplate.execute(JmsTemplate.java:504) ~[spring-jms-5.3.19.jar:5.3.19]
    ... 21 more
Caused by: java.io.IOException: Stream closed
    at java.io.BufferedInputStream.getBufIfOpen(BufferedInputStream.java:176) ~[?:?]
    at java.io.BufferedInputStream.read(BufferedInputStream.java:342) ~[?:?]
    at java.io.FilterInputStream.read(FilterInputStream.java:107) ~[?:?]
    at org.apache.activemq.artemis.utils.DeflaterReader.read(DeflaterReader.java:86) ~[artemis-core-client-2.22.0.jar:?]
    at org.apache.activemq.artemis.core.client.impl.ClientProducerImpl.largeMessageSendStreamed(ClientProducerImpl.java:449) ~[artemis-core-client-2.22.0.jar:2.22.0]
    at org.apache.activemq.artemis.core.client.impl.ClientProducerImpl.largeMessageSend(ClientProducerImpl.java:329) ~[artemis-core-client-2.22.0.jar:2.22.0]
    at org.apache.activemq.artemis.core.client.impl.ClientProducerImpl.doSend(ClientProducerImpl.java:261) ~[artemis-core-client-2.22.0.jar:2.22.0]
    at org.apache.activemq.artemis.core.client.impl.ClientProducerImpl.send(ClientProducerImpl.java:140) ~[artemis-core-client-2.22.0.jar:2.22.0]
    at org.apache.activemq.artemis.core.client.impl.ClientProducerImpl.send(ClientProducerImpl.java:122) ~[artemis-core-client-2.22.0.jar:2.22.0]
    at org.apache.activemq.artemis.jms.client.ActiveMQMessageProducer.doSendx(ActiveMQMessageProducer.java:481) ~[artemis-jms-client-2.22.0.jar:2.22.0]
    at org.apache.activemq.artemis.jms.client.ActiveMQMessageProducer.send(ActiveMQMessageProducer.java:219) ~[artemis-jms-client-2.22.0.jar:2.22.0]
    at org.messaginghub.pooled.jms.JmsPoolMessageProducer.sendMessage(JmsPoolMessageProducer.java:194) ~[pooled-jms-2.0.4.jar:?]
    at org.messaginghub.pooled.jms.JmsPoolMessageProducer.send(JmsPoolMessageProducer.java:88) ~[pooled-jms-2.0.4.jar:?]
    at org.messaginghub.pooled.jms.JmsPoolMessageProducer.send(JmsPoolMessageProducer.java:77) ~[pooled-jms-2.0.4.jar:?]
    at org.springframework.jms.core.JmsTemplate.doSend(JmsTemplate.java:634) ~[spring-jms-5.3.19.jar:5.3.19]
    at org.apache.camel.component.jms.JmsConfiguration$CamelJmsTemplate.doSend(JmsConfiguration.java:670) ~[classes/:?]
    at org.apache.camel.component.jms.JmsConfiguration$CamelJmsTemplate.doSendToDestination(JmsConfiguration.java:610) ~[classes/:?]
    at org.apache.camel.component.jms.JmsConfiguration$CamelJmsTemplate.lambda$send$0(JmsConfiguration.java:567) ~[classes/:?]
    at org.springframework.jms.core.JmsTemplate.execute(JmsTemplate.java:504) ~[spring-jms-5.3.19.jar:5.3.19]
    ... 21 more

2022-09-11 08:17:09,688 DEBUG 3956 — [%5CNew%20folder] o.a.c.c.f.GenericFileOnCompletion        : Done processing file: GenericFile[C:\Softwares\New folder\test.txt] using exchange: Exchange[A1D4FB4352A0804-0000000000000007]
2022-09-11 08:17:09,688  WARN 3956 — [%5CNew%20folder] o.a.c.c.f.GenericFileOnCompletion        : Rollback file strategy: org.apache.camel.component.file.strategy.GenericFileRenameProcessStrategy@d8d092e for file: GenericFile[C:\Softwares\New folder\test.txt]

 
Ramarajan:1662839758:2022-09-11T03:55:58.936+0000:1662840846:2022-09-11T04:14:06.720+0000:Hi Claus,

Tried to close input stream at JMSConfiguration$JMSTemplate  class at doSendtoDestination method before closing Producer but this also not solving the issue. still the file is locked. and inputstream is null here.

finally {
                try {
                    InputStream is = (InputStream) message.getObjectProperty(""JMS_AMQ_InputStream"");
                    if (is != null)

{                         IOHelper.close(is);                     }

                } catch (Exception e)

{                     LOG.info(""Exception occured while closing inputStream."");                 }

                JmsUtils.closeMessageProducer(producer);
            }
klease78:1663653995:2022-09-20T14:06:35.637+0000:1663654085:2022-09-20T14:08:05.725+0000:[~Ramarajan] I believe the bug is not in Camel JMS but in ActiveMQ itself. In fact when the message is streamed and the compression flag is set, then the input stream is not closed.

The offending code is [here|https://github.com/apache/activemq-artemis/blob/1974ec528975350a03eb7b254664edc338ac4328/artemis-core-client/src/main/java/org/apache/activemq/artemis/core/client/impl/ClientProducerImpl.java#L479-L487].

In your test case, I changed this line in ConsumerBeanConfiguration.java to disable compression of large messages:
{code:java}
coreConsumerConnectionFactory.setCompressLargeMessage(false);{code}
I don't have a windows system for testing but I observe that in this case, the input stream in the message is closed so I assume that would solve your issue.
Ramarajan:1663657380:2022-09-20T15:03:00.023+0000:1663657380:2022-09-20T15:03:00.023+0000:Hi karen,

Agree with your comments.
Let me raise defect in Artemis.

Since compression is important especially when we work on large messages
setting it to false.

Thanks
R Ramarajan



davsclaus:1663730995:2022-09-21T11:29:55.156+0000:1663730995:2022-09-21T11:29:55.156+0000:Thanks for helping with this.

You are welcome to add a comment with a link for the Artemis bug report
Ramarajan:1667590568:2022-11-05T03:36:08.253+0000:1667590568:2022-11-05T03:36:08.253+0000:Raised ticket with Artemis team https://issues.apache.org/jira/browse/ARTEMIS-4083

Thanks,

R Ramarajan.
Ramarajan:1668109100:2022-11-11T03:38:20.694+0000:1668109156:2022-11-11T03:39:16.612+0000:[~davsclaus] [~klease78] Artemis team have fixed the bug in 2.28.0 version. 

Thanks,

R Ramarajan 
klease78:1668172875:2022-11-11T21:21:15.993+0000:1668172875:2022-11-11T21:21:15.993+0000:[~Ramarajan] Thanks for the notification. It seems 2.27.0 was just tagged and isn't officially released so we'll keep an eye on the following release."
0,CAMEL-18475,New Feature,Major,None,3.19.0,"
None
",Resolved,Fixed,3.19.0,Claus Ibsen,Claus Ibsen,0,1,2022-09-07 09:00:45+00:00,2022-09-07 11:49:20+00:00,"We need a plugin that allows to define smaller custom tasks that needs to run periodically and managed by camel context automatic.


We can use TimerListenerManager to trigger, and then we need the factory finder annotations to discover/load the plugins",davsclaus:1662522556:2022-09-07T11:49:16.889+0000:1662522556:2022-09-07T11:49:16.889+0000:PeriodTaskScheduler via extended camel context
0,CAMEL-18474,Improvement,Major,None,Future,"
None
",Open,Unresolved,Future,Unassigned,Claus Ibsen,0,1,2022-09-07 07:46:24+00:00,2023-08-09 09:05:33+00:00,"See CAMEL-18240


We can do



method signatures to show with each parameter in a new line, or how a code editor would format the code
only show alias table if there are alias
sort the parameters table according to index in the method signature (instead of a..z)",
0,CAMEL-18473,Bug,Major,3.18.1,"3.18.3, 3.19.0","
None
",Resolved,Fixed,"3.18.3, 3.19.0",Zineb Bendhiba,Zineb Bendhiba,0,1,2022-09-07 07:19:19+00:00,2022-09-07 12:47:08+00:00,"When trying camel knative component with InMemory channels, we can't see the bug because this one doesn't validate the event.


Outside of this use case when the event is validated on knative, it seems that the time has wrong DateFormat. 


For instance, if using the component with a broker, we can't produce an event with camel-knative, and this is the log in knative environment :


 




{""level"":""warn"",""ts"":""2022-09-06T14:35:10.587Z"",""logger"":""mt_broker_ingress"",""caller"":""ingress/ingress_handler.go:137"",""msg"":""failed to extract event from request"",""error"":""invalid value for time: \""22022-08-31T12:00:33.253+02:00\""""} 



This is the valid DateFormat, according to [CloudEvents spec|https://github.com/cloudevents/spec]


 




 ""time"" : ""2018-04-05T17:31:00Z"", 



This corresponds in the Java DateTimeFormatter class to ISO_INSTANT.


However, in camel-knative producer uses ISO_OFFSET_DATE_TIME",
0,CAMEL-18472,Improvement,Major,"3.7.7, 3.19.0",3.19.0,"
None
",Resolved,Fixed,3.19.0,Unassigned,Gerda Ilger,0,2,2022-09-06 15:30:30+00:00,2022-09-08 11:38:39+00:00,"As discussed on users@camel.apache.org, i am opening a Jira issue +


We ran into the following issue when dynamically adding and removing ftp routes, whose consumers sometimes take a longer time to start up:


Deadlock when concurrently adding and removing routes



Default/Abstract)CamelContext.addRoutes -> DefaultCamelContext.addRouteDefinitions locks DefaultModel first, and is then blocked trying to lock DefaultCamelContext




(Default/Abstract)CamelContext.removeRoute locks DefaultCamelContext first, and is then blocked trying to lock DefaultModel



Threaddump:


Found one Java-level deadlock:
=============================
""pool-2-thread-1"":
waiting to lock monitor 0x00007fd22000b0c0 (object 0x000000068c800170, a org.apache.camel.impl.DefaultModel),
which is held by ""pool-2-thread-3""""pool-2-thread-3"":
waiting to lock monitor 0x00007fd21404a130 (object 0x000000068c002a20, a org.apache.camel.impl.DefaultCamelContext),
which is held by ""pool-2-thread-2""""pool-2-thread-2"":
waiting to lock monitor 0x00007fd22000b0c0 (object 0x000000068c800170, a org.apache.camel.impl.DefaultModel),
which is held by ""pool-2-thread-3""Java stack information for the threads listed above:
===================================================
""pool-2-thread-1"":
at org.apache.camel.impl.DefaultModel.addRouteDefinitions(DefaultModel.java:163)



waiting to lock <0x000000068c800170> (a org.apache.camel.impl.DefaultModel)at org.apache.camel.impl.DefaultCamelContext.addRouteDefinitions(DefaultCamelContext.java:351)at org.apache.camel.builder.RouteBuilder.populateRoutes(RouteBuilder.java:723)at org.apache.camel.builder.RouteBuilder.addRoutesToCamelContext(RouteBuilder.java:569)at org.apache.camel.impl.engine.AbstractCamelContext.addRoutes(AbstractCamelContext.java:1186)at org.apache.camel.impl.DynamicallyConcurrentlyAddRoutesTest.lambda$1(DynamicallyConcurrentlyAddRoutesTest.java:64)at org.apache.camel.impl.DynamicallyConcurrentlyAddRoutesTest$$Lambda$487/0x00000008002c52d0.call(Unknown Source)at java.util.concurrent.FutureTask.run(java.base@17.0.3/FutureTask.java:264)at java.util.concurrent.ThreadPoolExecutor.runWorker(java.base@17.0.3/ThreadPoolExecutor.java:1136)at java.util.concurrent.ThreadPoolExecutor$Worker.run(java.base@17.0.3/ThreadPoolExecutor.java:635)at java.lang.Thread.run(java.base@17.0.3/Thread.java:833)""pool-2-thread-3"":at org.apache.camel.impl.engine.AbstractCamelContext.removeRoute(AbstractCamelContext.java:1400)
waiting to lock <0x000000068c002a20> (a org.apache.camel.impl.DefaultCamelContext)at org.apache.camel.impl.DefaultModel.removeRouteDefinition(DefaultModel.java:212)
locked <0x000000068c800170> (a org.apache.camel.impl.DefaultModel)at org.apache.camel.impl.DefaultModel.removeRouteDefinitions(DefaultModel.java:201)
locked <0x000000068c800170> (a org.apache.camel.impl.DefaultModel)at org.apache.camel.impl.DefaultModel.addRouteDefinitions(DefaultModel.java:179)
locked <0x000000068c800170> (a org.apache.camel.impl.DefaultModel)at org.apache.camel.impl.DefaultCamelContext.addRouteDefinitions(DefaultCamelContext.java:351)at org.apache.camel.builder.RouteBuilder.populateRoutes(RouteBuilder.java:723)at org.apache.camel.builder.RouteBuilder.addRoutesToCamelContext(RouteBuilder.java:569)at org.apache.camel.impl.engine.AbstractCamelContext.addRoutes(AbstractCamelContext.java:1186)at org.apache.camel.impl.DynamicallyConcurrentlyAddRoutesTest.lambda$1(DynamicallyConcurrentlyAddRoutesTest.java:64)at org.apache.camel.impl.DynamicallyConcurrentlyAddRoutesTest$$Lambda$487/0x00000008002c52d0.call(Unknown Source)at java.util.concurrent.FutureTask.run(java.base@17.0.3/FutureTask.java:264)at java.util.concurrent.ThreadPoolExecutor.runWorker(java.base@17.0.3/ThreadPoolExecutor.java:1136)at java.util.concurrent.ThreadPoolExecutor$Worker.run(java.base@17.0.3/ThreadPoolExecutor.java:635)at java.lang.Thread.run(java.base@17.0.3/Thread.java:833)""pool-2-thread-2"":at org.apache.camel.impl.DefaultModel.getRouteDefinition(DefaultModel.java:237)
waiting to lock <0x000000068c800170> (a org.apache.camel.impl.DefaultModel)at org.apache.camel.impl.DefaultCamelContext.getRouteDefinition(DefaultCamelContext.java:343)at org.apache.camel.impl.DefaultCamelContext.removeRoute(DefaultCamelContext.java:959)
locked <0x000000068c002a20> (a org.apache.camel.impl.DefaultCamelContext)at org.apache.camel.impl.engine.AbstractCamelContext.removeRoute(AbstractCamelContext.java:1400)
locked <0x000000068c002a20> (a org.apache.camel.impl.DefaultCamelContext)at org.apache.camel.impl.DynamicallyConcurrentlyAddRoutesTest.lambda$1(DynamicallyConcurrentlyAddRoutesTest.java:77)at org.apache.camel.impl.DynamicallyConcurrentlyAddRoutesTest$$Lambda$487/0x00000008002c52d0.call(Unknown Source)at java.util.concurrent.FutureTask.run(java.base@17.0.3/FutureTask.java:264)at java.util.concurrent.ThreadPoolExecutor.runWorker(java.base@17.0.3/ThreadPoolExecutor.java:1136)at java.util.concurrent.ThreadPoolExecutor$Worker.run(java.base@17.0.3/ThreadPoolExecutor.java:635)at java.lang.Thread.run(java.base@17.0.3/Thread.java:833)



Found 1 deadlock.


My JUnit test executed successfully when I changed DefaultCamelContext to obtain the lock on model before locking camelContext in removeRoute.",davsclaus:1662608319:2022-09-08T11:38:39.057+0000:1662608319:2022-09-08T11:38:39.057+0000:Thanks for reporting and the PR
0,CAMEL-18471,Task,Major,None,3.x,"
None
",Resolved,Fixed,3.x,Unassigned,Claus Ibsen,0,3,2022-09-06 12:18:47+00:00,2023-03-17 13:00:22+00:00,We should deprecate this component so users have time to migrate to camel-spring-rabbitmq. As we will drop this component in Camel v4,"skrrytch:1678970248:2023-03-16T20:37:28.960+0000:1678974333:2023-03-16T21:45:33.212+0000:We are using *Apache Camel* and *RabbitMQ* in our Karaf based project (OSGI). If *camel-rabbitmq* will be removed in *v4* then please make ""{*}camel-spring-rabbitmq{*}"" available for OSGI/Karaf (later when v4 is ready for Karaf)

 

Just a hint to not forget karaf users since spring-rabbit is currently not supported for Karaf in Camel v3.
acosentino:1678972642:2023-03-16T21:17:22.342+0000:1678972642:2023-03-16T21:17:22.342+0000:At this stage there won't be support for Camel 4 in OSGi/Karaf. It will be best effort and the community will need to help with the alignment and maintenance. "
0,CAMEL-18470,Bug,Minor,"3.17.0, 3.18.0, 3.18.1",3.17.0,"
None
",Resolved,Information Provided,3.17.0,Unassigned,Devansh Arora,0,2,2022-09-06 12:09:19+00:00,2022-09-21 06:42:20+00:00,"we are using camel-rabbitmq 
we upgraded to 3.18.1 from 3.14.2 recently.


to send a message to rabbitmq queue we using camel producer template.


In our endpoint uri for rabbitmq, we set skipQueueDeclare=true. by enabling this we donot need to declare queue name.


after upgrade  to 3.18.1 we are seeing below errors  while sending message to rabbitmq 


Caused by: com.rabbitmq.client.ShutdownSignalException: channel error; protocol method: #method<channel.close>(reply-code=404, reply-text=NOT_FOUND - no queue '1892359723' in vhost 'myvhost', class-id=50, method-id=10)


Ideally it should not take any queue name.


More trace.  in this trace we are seeing that it is trying to declare exchange and queue and then bind them. with skipQueueDeclare=true it should not happen i guess..


 


org.apache.camel.CamelExecutionException: Exception occurred during execution on the exchange: Exchange[]    at org.apache.camel.CamelExecutionException.wrapCamelExecutionException(CamelExecutionException.java:45)_    at org.apache.camel.support.ExchangeHelper.extractResultBody(ExchangeHelper.java:667)_    at org.apache.camel.impl.engine.DefaultProducerTemplate.extractResultBody(DefaultProducerTemplate.java:591)_    at org.apache.camel.impl.engine.DefaultProducerTemplate.extractResultBody(DefaultProducerTemplate.java:587)_    at org.apache.camel.impl.engine.DefaultProducerTemplate.sendBodyAndHeaders(DefaultProducerTemplate.java:313)_    at org.apache.camel.impl.engine.DefaultProducerTemplate.sendBodyAndHeaders(DefaultProducerTemplate.java:305)_    at com.myapp.myrabbitq.queue.route.MessageSender.routeMessageToTopicNoQueue_aroundBody20(MessageSender.java:211)_    at com.myapp.myrabbitq.queue.route.MessageSender$AjcClosure21.run(MessageSender.java:1)_    at org.aspectj.runtime.reflect.JoinPointImpl.proceed(JoinPointImpl.java:167)_    at com.myapp.myrabbitq.log.LogAspect.aroundInternal(LogAspect.java:67)_    at com.myapp.myrabbitq.log.LogAspect.ajc$inlineAccessMethod$com_digitate_ignio_log_LogAspect$com_digitate_ignio_log_LogAspect$aroundInternal(LogAspect.java:1)_    at com.myapp.myrabbitq.log.LogAspect.around1(LogAspect.java:44)_    at com.myapp.myrabbitq.queue.route.MessageSender.routeMessageToTopicNoQueue(MessageSender.java:207)_    at com.myapp.myrabbitq.platform.workitem.route.WorkitemManagerProducer.lambda$1_aroundBody6(WorkitemManagerProducer.java:53)_    at com.myapp.myrabbitq.platform.workitem.route.WorkitemManagerProducer$AjcClosure7.run(WorkitemManagerProducer.java:1)_    at org.aspectj.runtime.reflect.JoinPointImpl.proceed(JoinPointImpl.java:167)_    at com.myapp.myrabbitq.log.LogAspect.aroundInternal(LogAspect.java:67)_    at com.myapp.myrabbitq.log.LogAspect.ajc$inlineAccessMethod$com_digitate_ignio_log_LogAspect$com_digitate_ignio_log_LogAspect$aroundInternal(LogAspect.java:1)_    at com.myapp.myrabbitq.log.LogAspect.around1(LogAspect.java:44)_    at com.myapp.myrabbitq.platform.workitem.route.WorkitemManagerProducer.lambda$1(WorkitemManagerProducer.java:47)_    at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:183)_    at java.base/java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:177)_    at java.base/java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1655)_    at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:484)_    at java.base/java.util.stream.ForEachOps$ForEachTask.compute(ForEachOps.java:290)_    at java.base/java.util.concurrent.CountedCompleter.exec(CountedCompleter.java:746)_    at java.base/java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:290)_    at java.base/java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(ForkJoinPool.java:1020)_    at java.base/java.util.concurrent.ForkJoinPool.scan(ForkJoinPool.java:1656)_    at java.base/java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1594)_    at java.base/java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:183)Caused by: java.io.IOException: null    at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:129)_    at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:125)_    at com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:147)_    at com.rabbitmq.client.impl.ChannelN.queueDeclarePassive(ChannelN.java:1012)_    at com.rabbitmq.client.impl.recovery.AutorecoveringChannel.queueDeclarePassive(AutorecoveringChannel.java:366)_    at org.apache.camel.component.rabbitmq.RabbitMQDeclareSupport.passivelyDeclareExchangeAndQueueAndBindThem(RabbitMQDeclareSupport.java:165)_    at org.apache.camel.component.rabbitmq.RabbitMQDeclareSupport.declareAndBindExchangeWithQueue(RabbitMQDeclareSupport.java:63)_    at org.apache.camel.component.rabbitmq.RabbitMQDeclareSupport.declareAndBindExchangesAndQueuesUsing(RabbitMQDeclareSupport.java:36)_    at org.apache.camel.component.rabbitmq.RabbitMQEndpoint.declareExchangeAndQueue(RabbitMQEndpoint.java:257)_    at org.apache.camel.component.rabbitmq.RabbitMQProducer$1.doWithChannel(RabbitMQProducer.java:128)_    at org.apache.camel.component.rabbitmq.RabbitMQProducer$1.doWithChannel(RabbitMQProducer.java:125)_    at org.apache.camel.component.rabbitmq.RabbitMQProducer.execute(RabbitMQProducer.java:97)_    at org.apache.camel.component.rabbitmq.RabbitMQProducer.attemptDeclaration(RabbitMQProducer.java:125)_    at org.apache.camel.component.rabbitmq.RabbitMQProducer.execute(RabbitMQProducer.java:93)_    at org.apache.camel.component.rabbitmq.RabbitMQProducer.basicPublish(RabbitMQProducer.java:312)_    at org.apache.camel.component.rabbitmq.RabbitMQProducer.processInOnly(RabbitMQProducer.java:298)_    at org.apache.camel.component.rabbitmq.RabbitMQProducer.process(RabbitMQProducer.java:212)_    at org.apache.camel.impl.engine.SharedCamelInternalProcessor.process(SharedCamelInternalProcessor.java:214)_    at org.apache.camel.impl.engine.SharedCamelInternalProcessor$1.process(SharedCamelInternalProcessor.java:111)_    at org.apache.camel.impl.engine.DefaultAsyncProcessorAwaitManager.process(DefaultAsyncProcessorAwaitManager.java:83)_    at org.apache.camel.impl.engine.SharedCamelInternalProcessor.process(SharedCamelInternalProcessor.java:108)_    at org.apache.camel.support.cache.DefaultProducerCache.send(DefaultProducerCache.java:199)_    at org.apache.camel.impl.engine.DefaultProducerTemplate.send(DefaultProducerTemplate.java:176)_    at org.apache.camel.impl.engine.DefaultProducerTemplate.send(DefaultProducerTemplate.java:172)_    at org.apache.camel.impl.engine.DefaultProducerTemplate.send(DefaultProducerTemplate.java:153)_    at org.apache.camel.impl.engine.DefaultProducerTemplate.sendBodyAndHeaders(DefaultProducerTemplate.java:311)_    ... 26 common frames omitted_Caused by: com.rabbitmq.client.ShutdownSignalException: channel error; protocol method: #method<channel.close>(reply-code=404, reply-text=NOT_FOUND - no queue '1892359723' in vhost 'myvhost', class-id=50, method-id=10)","davsclaus:1662437852:2022-09-06T12:17:32.441+0000:1662437852:2022-09-06T12:17:32.441+0000:You should favour using camel-spring-rabbitmq as its a better component if you can
devansharora68@gmail.com:1662438086:2022-09-06T12:21:26.912+0000:1662438086:2022-09-06T12:21:26.912+0000:moving to camel-spring-rabbitmq is in our backlog. We faced some challenges while trying to shift to camel-spring-rabbitmq from camel-rabbitmq. 
so we are still on camel-rabbitmq for now. we plan to move in future surely.
davsclaus:1662440247:2022-09-06T12:57:27.947+0000:1662440247:2022-09-06T12:57:27.947+0000:I wonder if you can test on latest 3.14.x too?

As it would be good to narrow down which commits did the change to better understand why
devansharora68@gmail.com:1662441054:2022-09-06T13:10:54.602+0000:1662441054:2022-09-06T13:10:54.602+0000:ok will try
devansharora68@gmail.com:1662450821:2022-09-06T15:53:41.138+0000:1662450821:2022-09-06T15:53:41.138+0000:3.18.1 - not working
3.18.0 - not working
3.17.0 - not working
3.16.0 - working
3.15.0 - working
3.14.5 - working
3.14.2(our current in use version) - working
davsclaus:1662452332:2022-09-06T16:18:52.029+0000:1662452332:2022-09-06T16:18:52.029+0000:Thanks for testing all these releases
devansharora68@gmail.com:1662588819:2022-09-08T06:13:39.406+0000:1662588819:2022-09-08T06:13:39.406+0000:Hey Claus,
If you have already found  the cause/fix for the issue can you share that with us.
We can merge it in our local copy of camel-rabbitmq 3.18.1 and use it in our projects.
We want to be on latest camel versions as we are using multiple other components of camel.

Thanks & Regards
devansharora68@gmail.com:1662941027:2022-09-12T08:03:47.962+0000:1662941119:2022-09-12T08:05:19.362+0000:after changes from https://issues.apache.org/jira/browse/CAMEL-17892
need to add skipQueueBind=true in route to prevent this error
davsclaus:1662948875:2022-09-12T10:14:35.763+0000:1662948875:2022-09-12T10:14:35.763+0000:Okay we can add a note in the 3.17 upgrade guide
devansharora68@gmail.com:1663713740:2022-09-21T06:42:20.186+0000:1663713740:2022-09-21T06:42:20.186+0000:for reference
[Apache Camel 3.x Upgrade Guide :: Apache Camel|https://camel.apache.org/manual/camel-3x-upgrade-guide-3_17.html#_camel_rabbitmq]"
0,CAMEL-18469,Sub-task,Major,None,3.19.0,"
None
",Resolved,Fixed,3.19.0,Claus Ibsen,Claus Ibsen,0,1,2022-09-06 12:01:24+00:00,2022-09-09 08:48:07+00:00,"So you can turn this on|off and set some options on the secrets updated checker.
And be able to auto-detect it via classpath and setup into CamelContext",
0,CAMEL-18468,Sub-task,Major,None,None,"
None
",Resolved,Fixed,3.19.0,Andrea Cosentino,Andrea Cosentino,0,2,2022-09-05 16:07:53+00:00,2022-09-07 08:11:59+00:00,No Desc,"acosentino:1662415656:2022-09-06T06:07:36.298+0000:1662415656:2022-09-06T06:07:36.298+0000:[~davsclaus] it has been pushed, we could start from here to include the needed bits in the vault support.
davsclaus:1662436936:2022-09-06T12:02:16.475+0000:1662436936:2022-09-06T12:02:16.475+0000:Thanks Andrea

I created ticket CAMEL-18469 to look into that setup stuff and use your task - I think I have time tomorrow morning to build a prototype"
0,CAMEL-18467,Task,Minor,3.18.1,"3.18.3, 3.19.0","
None
",Resolved,Fixed,"3.18.3, 3.19.0",Unassigned,Lucia Drozdová,0,1,2022-09-05 12:50:12+00:00,2022-09-05 16:29:13+00:00,"The Email sample in velocity component documentation - there is velocity template sample, but the corresponding java code sample is missing:


https://camel.apache.org/components/3.18.x/velocity-component.html#_the_email_sample",
0,CAMEL-18466,Improvement,Major,None,3.19.0,"
None
",Resolved,Fixed,3.19.0,Andrea Cosentino,Andrea Cosentino,0,1,2022-09-05 12:25:07+00:00,2022-09-09 13:01:57+00:00,No Desc,
0,CAMEL-18465,Task,Minor,None,3.19.0,"
None
",Resolved,Fixed,3.19.0,Otavio Rodolfo Piske,Otavio Rodolfo Piske,0,1,2022-09-05 09:26:38+00:00,2022-09-05 13:59:14+00:00,"We have a few profiles named 'jigsaw' that become activated when building with Java 9+. However, since we support Java 11+, these can be removed.",orpiske:1662357554:2022-09-05T13:59:14.634+0000:1662357554:2022-09-05T13:59:14.634+0000:The profiles were removed. Closing the ticket now.
0,CAMEL-18464,Dependency upgrade,Minor,None,"3.18.3, 3.19.0","
None
",Resolved,Fixed,"3.18.3, 3.19.0",Unassigned,Claus Ibsen,0,1,2022-09-05 07:29:14+00:00,2022-09-05 15:17:56+00:00,No Desc,
0,CAMEL-18463,Dependency upgrade,Minor,None,"4.0-M3, 4.0.0","
None
",Resolved,Fixed,"4.0-M3, 4.0.0",James Netherton,Claus Ibsen,0,2,2022-09-04 09:33:02+00:00,2023-03-31 07:40:37+00:00,No Desc,"jamesnetherton:1680130749:2023-03-30T06:59:09.636+0000:1680130749:2023-03-30T06:59:09.636+0000:I'll take a look - 1.54.0 is the latest version, so lets target that. "
0,CAMEL-18462,Improvement,Trivial,None,,"
None
",Resolved,Abandoned,None,Unassigned,Sebb,0,1,2022-09-03 12:20:21+00:00,2023-11-22 20:08:00+00:00,"The individual release pages for LTS releases (e.g. [1]) don't give a release date or an EOL date. The release dates are mentioned on the release summary page [2], however there is no link to this page from the individual release pages.


It looks like the only documentation for the LTS dates is on the downloads page [3], but that is not at all obvious, and does not cover recently superseded releases. For example, what is the EOL for 3.8.0, released in July 2022?.


It should be easier to find out this information from the releases notes.
For example they could be documented here [2], with backlinks from [1] etc.


[1] https://camel.apache.org/releases/release-3.14.5/
[2] https://camel.apache.org/releases/
[3] https://camel.apache.org/download/",davsclaus:1662183020:2022-09-03T13:30:20.961+0000:1662183020:2022-09-03T13:30:20.961+0000:Only LTS releases has an EOL date. Any other release is EOL asap
0,CAMEL-18461,Improvement,Minor,None,"3.18.3, 3.19.0","
None
",Resolved,Fixed,"3.18.3, 3.19.0",Unassigned,Claus Ibsen,0,1,2022-09-03 06:40:06+00:00,2022-09-05 18:30:43+00:00,api_secret and api_key can be used by SaaS providers and we can add these as known keys so Camel will mask these in logging,
0,CAMEL-18430,Improvement,Major,None,3.x,"
None
",Resolved,Won't Fix,3.x,Unassigned,Claus Ibsen,0,1,2022-08-26 07:45:14+00:00,2023-07-17 10:51:31+00:00,"Can we make some easier way to use AggregationStrategy - one is to use lambda but then you have Exchange as inputs that is a bit cumbersome when you need to merge 2 bodies together or something.


There is the org.apache.camel.builder.AggregationStrategies that has convenient methods, but then you need to import this class and find out what method to call.


Maybe if we can have a lambda style where you have the message body or Message instance to work with. Or the bean type where camel adapts to a method signature.
https://camel.apache.org/components/3.18.x/eips/aggregate-eip.html#_aggregating_with_beans",
0,CAMEL-18429,Improvement,Minor,None,"3.18.2, 3.19.0","
None
",Resolved,Fixed,"3.18.2, 3.19.0",Claus Ibsen,Claus Ibsen,0,1,2022-08-25 13:24:42+00:00,2022-08-27 19:21:21+00:00,camel run is intended for development purposes so lets make the shutdown quicker in case there is a stuck message or something takes a long time. The default of 45 sec is a bit too long to wait.,
0,CAMEL-18428,Task,Trivial,3.18.1,"3.18.2, 3.19.0","

documentation

",Resolved,Fixed,"3.18.2, 3.19.0",Unassigned,Pedro,0,1,2022-08-24 23:10:35+00:00,2022-08-26 04:37:43+00:00,"Fhir component documentation describes the option/query parameter ""password"" as the ""Username to use for basic authentication."" instead of the ""Password to use for basic authentication.""",
0,CAMEL-18427,Bug,Minor,"3.13.0, 3.18.1","3.18.3, 3.19.0","
None
",Resolved,Fixed,"3.18.3, 3.19.0",Claus Ibsen,michael elbaz,0,2,2022-08-24 10:20:16+00:00,2022-12-01 13:18:49+00:00,"From camel 3.13.0 Camel Debezium simply not working is work perfectly with camel older than 3.13.0


(related to this ticket i think https://issues.apache.org/jira/browse/CAMEL-17135)


here the code




    @Override
    public void configure() throws Exception {
        String DATABASE_READER = ""debezium-postgres:localhost?""
                + ""databaseHostname=localhost""
                + ""&databasePort=5432""
                + ""&databaseUser=postgres""
                + ""&databasePassword=test""
                + ""&databaseDbname=test""
                + ""&databaseServerName=localhost""
                + ""&schemaWhitelist=public""
                + ""&tableWhitelist=public.*""
                + ""&offsetStorageFileName=/tmp/offset-file-1.dat""
                + ""&offsetFlushIntervalMs=10000""
                + ""&pluginName=pgoutput"";
        from(DATABASE_READER)
                .routeId(""debeziumPGRoute"")
                .log(""Response : ${body}"");
    }







I check this changelog



the pom file




<dependency>
    <groupId>org.apache.camel</groupId>
    <artifactId>camel-debezium-postgres</artifactId>
</dependency>
<dependency>
    <groupId>org.apache.camel.springboot</groupId>
    <artifactId>camel-debezium-postgres-starter</artifactId>
</dependency>","davsclaus:1662073336:2022-09-02T07:02:16.800+0000:1662073336:2022-09-02T07:02:16.800+0000:Can you put together a sample project as a .zip or put on github we can use to try this, thanks
michael992:1662084125:2022-09-02T10:02:05.178+0000:1662089222:2022-09-02T11:27:02.477+0000:[~davsclaus] Yeah it's happen we i add this dependency
{code:java}
<dependency>
<groupId>org.apache.camel.springboot</groupId>
<artifactId>camel-debezium-postgres-starter</artifactId>
<version>3.18.1</version>
</dependency> {code}
[^camel-debezium-postgres.zip]
michael992:1662089007:2022-09-02T11:23:27.047+0000:1662089028:2022-09-02T11:23:48.642+0000:[~davsclaus] there is also other bug this is not taken into account on the latest camel version
{code:java}
.append(""&timePrecisionMode=connect""){code}
davsclaus:1662413763:2022-09-06T05:36:03.641+0000:1662413763:2022-09-06T05:36:03.641+0000:The null is logged by DBZ itself and its not a very descriptive log what is wrong. At first try your sample project does configure DBZ engine with the values from the URI is that is correct.
davsclaus:1662413921:2022-09-06T05:38:41.304+0000:1662413921:2022-09-06T05:38:41.304+0000:java.lang.ClassNotFoundException: io.debezium.embedded.spi.OffsetCommitPolicy.PeriodicCommitOffsetPolicy
davsclaus:1662414346:2022-09-06T05:45:46.486+0000:1662414346:2022-09-06T05:45:46.486+0000:Okay so its a DBZ issue not reporting a better error why it fails
https://issues.redhat.com/browse/DBZ-5583

You need to add that class to the classpath, so its maybe some DBZ dependency to be added
davsclaus:1662420039:2022-09-06T07:20:39.500+0000:1662420039:2022-09-06T07:20:39.500+0000:You can make it work by setting

.append(""&offsetCommitPolicy=io.debezium.engine.spi.OffsetCommitPolicy$PeriodicCommitOffsetPolicy"")
davsclaus:1662420782:2022-09-06T07:33:02.383+0000:1662420782:2022-09-06T07:33:02.383+0000:Okay the class was moved so adjusting Camel
davsclaus:1662420904:2022-09-06T07:35:04.903+0000:1662420904:2022-09-06T07:35:04.903+0000:What do you mean by
.append(""&timePrecisionMode=connect"")


michael992:1662424245:2022-09-06T08:30:45.633+0000:1662424245:2022-09-06T08:30:45.633+0000:Hello [~davsclaus] i mean the parameter *timePrecisionMode*  is not taken into account on the latest camel version when i use it the timestamp still remain as timestamp instead of being formatted to date
davsclaus:1662430425:2022-09-06T10:13:45.266+0000:1662430425:2022-09-06T10:13:45.266+0000:The engine is configured with

2022-09-06 12:13:25.287  INFO 22746 --- [ebeziumConsumer] i.d.connector.common.BaseSourceTask      :    time.precision.mode = connect
michael992:1662504817:2022-09-07T06:53:37.283+0000:1662504817:2022-09-07T06:53:37.283+0000:Yeah maybe i don't known camel documentation don't say that  !image-2022-09-07-08-53-06-942.png|width=620,height=281!

By the way with previous camel version is was working not now"
0,CAMEL-18426,New Feature,Major,3.18.1,"3.18.2, 3.19.0","
None
",Resolved,Fixed,"3.18.2, 3.19.0",Claus Ibsen,Claus Ibsen,0,1,2022-08-24 09:37:40+00:00,2022-08-24 10:47:13+00:00,So we copy local kamelets when exporting.,
0,CAMEL-18425,New Feature,Major,None,3.19.0,"
None
",Resolved,Fixed,3.19.0,Claus Ibsen,Claus Ibsen,0,2,2022-08-24 09:30:23+00:00,2022-08-30 07:54:59+00:00,"The Camel CLI has commands to get status and start/stop camel applications, but its limited to camel-jbang based integrations.


We can look at having a camel-cli dependency that you can add to camel-spring-boot or camel-main etc when you want your app to be able to work with the Camel CLI.


This dependency should only be used for development purposes.


You could then have a mvn spring-boot:run app and then also a camel-jbang app that work together and you need to control them via the camel cli, to have a better UX.","vinod.pahuja@gmail.com:1661817299:2022-08-30T07:54:59.419+0000:1661817299:2022-08-30T07:54:59.419+0000:Is it wise to abstract camel-cli to a parent dependency having implementation using different runtime ?

like one we already have using jbang and another could be implemented using spring-boot-cli

I tried to run a standalone camel route using spring-boot-cli and it just works fine but still need some operational fine tuning.

https://github.com/apache/camel-spring-boot-examples/pull/79"
0,CAMEL-18424,Bug,Major,3.18.1,"3.18.2, 3.19.0","
None
",Resolved,Fixed,"3.18.2, 3.19.0",Claus Ibsen,Claus Ibsen,0,1,2022-08-24 09:21:02+00:00,2022-08-24 09:26:15+00:00,"This needed dependency is not added to the classpath
mvn:software.amazon.awssdk:utils:2.17.258


The issue is that jbang mistakenly see it as already on classpath",
0,CAMEL-18423,Improvement,Major,"3.18.0, 3.18.1","3.18.2, 3.19.0","
None
",Resolved,Fixed,"3.18.2, 3.19.0",James Netherton,James Netherton,0,1,2022-08-24 06:47:54+00:00,2022-08-25 07:10:49+00:00,"Extension of https://issues.apache.org/jira/browse/CAMEL-18233.


We need to handle NoSuchElementException in the loadProperties(Predicate<String> filter) variant of loadProperties in CamelMicroProfilePropertiesSource. I thought it was not required because the config does an optional lookup, but it seems even that can fail if config values are not resolvable.",
0,CAMEL-18422,Task,Major,None,None,"
None
",Resolved,Won't Fix,"3.18.2, 3.19.0",Andrea Cosentino,Andrea Cosentino,0,1,2022-08-24 05:43:25+00:00,2022-08-24 12:14:21+00:00,No Desc,acosentino:1661314461:2022-08-24T12:14:21.597+0000:1661314461:2022-08-24T12:14:21.597+0000:Superseded by CAMEL-18424
0,CAMEL-18421,Bug,Major,"3.14.5, 3.18.1","3.14.6, 3.18.2, 3.19.0","
None
",Resolved,Fixed,"3.14.6, 3.18.2, 3.19.0",Claus Ibsen,Claus Ibsen,0,1,2022-08-23 16:55:04+00:00,2022-10-20 09:10:47+00:00,"Reported on chat
https://camel.zulipchat.com/#narrow/stream/257298-camel/topic/Memory.20leak.20in.20DefaultCamelContext",
0,CAMEL-18420,Improvement,Minor,None,3.19.0,"
None
",Resolved,Fixed,3.19.0,Karen Lease,Karen Lease,0,1,2022-08-22 14:25:39+00:00,2022-08-29 20:42:00+00:00,"In Junit 5.9.0 the custom strategy for parallel test execution can specify a ""saturated"" predicate which is invoked when the maximum pool size is reached and a test is waiting for a thread. Returning true will cause the pool to wait until an existing thread has finished its task instead of throwing an exception. This allows use of a smaller maximum pool size. It also appears that this version of Junit uses fewer threads than the previous version.",
0,CAMEL-18419,Improvement,Minor,None,3.19.0,"
None
",Resolved,Fixed,3.19.0,Claus Ibsen,Claus Ibsen,0,1,2022-08-22 14:22:02+00:00,2022-08-22 17:10:38+00:00,"We have timestamp for last completed, but this is only when the exchange is done.


Users may want to easily know how long time since Camel last received an incoming exchange",
0,CAMEL-18418,Bug,Major,3.18.0,"3.18.2, 3.19.0","
None
",Resolved,Fixed,"3.18.2, 3.19.0",Unassigned,Bruno Meseguer,0,2,2022-08-22 11:26:43+00:00,2022-09-02 12:37:36+00:00,"The Kamelet `aws-s3-sink` returns 403 against a ceph based S3 service.


It seems to be related to the accessKey and secretKey parameters resolution.


A workaround that works is to edit the original Kamelet and hardcode the accessKey and secretKey in the aws2-s3 Camel component.","bruno.meseguer:1662023900:2022-09-01T17:18:20.778+0000:1662023900:2022-09-01T17:18:20.778+0000:This issue is important, it may affect other kamelets?

It doesn't seem to be S3 related... (sorry the title is unfortunate)

The default Kamelet's producer definition hits the problem, but the following workaround works well:
{code:java}
      # Temporary workaround that works is:
      - to:
          uri: ""aws2-s3:{{bucketNameOrArn}}?\
            accessKey={{?accessKey}}&\
            secretKey={{?secretKey}}&\
            region={{region}}&\
            autoCreateBucket={{autoCreateBucket}}&\
            uriEndpointOverride={{?uriEndpointOverride}}&\
            overrideEndpoint={{?overrideEndpoint}}&\
            keyName={{?keyName}}&\
            useDefaultCredentialsProvider={{useDefaultCredentialsProvider}}""{code}
davsclaus:1662073108:2022-09-02T06:58:28.586+0000:1662073108:2022-09-02T06:58:28.586+0000:Can you try with 3.19 SNAPSHOT
bruno.meseguer:1662079812:2022-09-02T08:50:12.468+0000:1662079812:2022-09-02T08:50:12.468+0000:Yes... I just tested now with Camel JBang using 3.19.0-SNAPSHOT and it seems it is behaving well... it accepted the accesskey/secretkey and completed the S3 operation as expected.

 

Thanks [~davsclaus] 
davsclaus:1662093448:2022-09-02T12:37:28.092+0000:1662093448:2022-09-02T12:37:28.092+0000:Great the RAW fix was backported for 3.18.2"
0,CAMEL-18417,Improvement,Minor,"3.14.5, 3.18.1",None,"
None
",Resolved,Fixed,3.19.0,Otavio Rodolfo Piske,Otavio Rodolfo Piske,0,2,2022-08-22 09:47:19+00:00,2023-12-11 08:45:54+00:00,"The StopWatch in camel-util is based on the System clock and uses it to calculate durations. However, the system clock is not an appropriate source for measuring durations because it can go back in time or have time leaps that do not reflect reality (ex.: when changing standard time to daylight saving and vice versa, when having micro adjustments due to NTP synchronization, when the date is manually changed, etc).


 


We should probably investigating replacing the source with Java's high resolution timer or (potentially) the Duration class.","davsclaus:1661134959:2022-08-22T10:22:39.902+0000:1661134959:2022-08-22T10:22:39.902+0000:The StopWatch was not designed to be a system clock - its for end users to see that X took 4.6 seconds etc.
If you need something very accurate then design a new class for that.
orpiske:1661135413:2022-08-22T10:30:13.013+0000:1661135413:2022-08-22T10:30:13.013+0000:[~davsclaus] yeah, I understand that. What I want to convey is that it can provide incorrect measurements under rare but still very likely possible circumstances. Although, indeed, not a big problem as it was not designed to be that accurate from the beginning, it can still cause confusion if it happens.
orpiske:1661822636:2022-08-30T09:23:56.656+0000:1661822636:2022-08-30T09:23:56.656+0000:Closing as it is fixed."
0,CAMEL-18416,Dependency upgrade,Major,None,"4.0-M1, 4.0.0","
None
",Resolved,Duplicate,"4.0-M1, 4.0.0",Ramu,Claus Ibsen,0,1,2022-08-22 04:32:10+00:00,2023-01-30 08:59:43+00:00,No Desc,
0,CAMEL-18415,Improvement,Minor,None,3.19.0,"
None
",Resolved,Fixed,3.19.0,Claus Ibsen,Claus Ibsen,0,1,2022-08-20 19:18:24+00:00,2022-08-22 07:32:08+00:00,To make it easy to turn on,
0,CAMEL-18414,Improvement,Minor,None,3.x,"
None
",Resolved,Implemented,3.x,Unassigned,Claus Ibsen,0,1,2022-08-19 17:09:45+00:00,2022-08-20 16:02:45+00:00,"If you have a a lot of routes then it may be nice to make it easy to group them (this is only a label) but tooling can use the group such as hawtio, karavan and camel-jbang.",davsclaus:1660982565:2022-08-20T16:02:45.411+0000:1660982565:2022-08-20T16:02:45.411+0000:This is already impelemented
0,CAMEL-18413,Improvement,Minor,3.18.1,3.19.0,"
None
",Resolved,Fixed,3.19.0,Karen Lease,Karen Lease,0,1,2022-08-19 13:49:12+00:00,2022-08-21 20:27:59+00:00,"The test LogBodyWithNewLineTest logs some messages from other tests in the main log file.


The class ConsumingAppender uses a deprecated API to create the LoggerConfig.",
0,CAMEL-18412,New Feature,Major,None,3.19.0,"
None
",Resolved,Fixed,3.19.0,Claus Ibsen,Claus Ibsen,0,1,2022-08-19 09:46:25+00:00,2022-08-20 16:01:05+00:00,Make it easy to connect to a camel jbang integration from hawtio,"davsclaus:1660911313:2022-08-19T20:15:13.180+0000:1660976021:2022-08-20T14:13:41.484+0000:TODO: attach by name as well as pid, if name is unique *DONE*
TODO: attach and start hawtio in a single command *DONE*"
0,CAMEL-18411,Bug,Minor,3.14.3,3.14.6,"
None
",Resolved,Fixed,3.14.6,Unassigned,Andre Weickel,0,3,2022-08-19 09:18:12+00:00,2022-08-23 04:44:52+00:00,"We are using Camel 3.14.x and get a MethodNotFoundException when we try to call a method via OSGi service reference. Exactly the same issue as described in https://issues.apache.org/jira/browse/CAMEL-15793.


 


It works with 3.7.0 and stopped working with 3.11.0 probably due to the following change: https://github.com/apache/camel/commit/164f63eae7f0364604f0e796764544467829e7a7


And works again with 3.17.0 probably due to the change for CAMEL-17844. Will this fix also be available for 3.14.x?","davsclaus:1660872280:2022-08-19T09:24:40.311+0000:1660872280:2022-08-19T09:24:40.311+0000:You are welcome to dive into and send a PR with a suggested fix for 3.14.x branch. 
AWeickel:1661156546:2022-08-22T16:22:26.805+0000:1661156546:2022-08-22T16:22:26.805+0000:[https://github.com/apache/camel/pull/8206]"
0,CAMEL-18410,Task,Major,None,4.0.0,"
None
",Resolved,Fixed,4.0.0,Unassigned,Claus Ibsen,0,1,2022-08-19 05:12:23+00:00,2023-03-22 15:43:51+00:00,"As we have ported to junit 5 tests in Camel projects itself, and that junit 4 has been deprecated for a longer time, we should at some stage remove them.",
0,CAMEL-18409,Dependency upgrade,Major,3.14.5,3.14.6,"
None
",Resolved,Fixed,3.14.6,Thomas Cunningham,Claus Ibsen,0,2,2022-08-19 05:02:21+00:00,2022-08-19 20:14:16+00:00,No Desc,"davsclaus:1660856575:2022-08-19T05:02:55.831+0000:1660856575:2022-08-19T05:02:55.831+0000:[~tcunning] you are welcome to help with this for the 3.14.x branch.
tcunning:1660896710:2022-08-19T16:11:50.013+0000:1660902894:2022-08-19T17:54:54.526+0000:[https://github.com/apache/camel-spring-boot/pull/611]

https://github.com/apache/camel/pull/8190"
0,CAMEL-18408,Improvement,Minor,None,3.19.0,"
None
",Resolved,Fixed,3.19.0,Claus Ibsen,Claus Ibsen,0,1,2022-08-18 20:47:54+00:00,2022-08-20 19:20:52+00:00,"We could consider if we can have the type converters categorized as if they were loaded as part of camel core itself, or as 3rd party then we can group the type converters.


End users may want to see which type converters may be custom",davsclaus:1660994452:2022-08-20T19:20:52.586+0000:1660994452:2022-08-20T19:20:52.586+0000:We can only show general information as TCs are loaded as bulk today where we dont have easy pair information
0,CAMEL-18407,Dependency upgrade,Major,None,"3.18.2, 3.19.0","
None
",Resolved,Fixed,"3.18.2, 3.19.0",Thomas Cunningham,Thomas Cunningham,0,1,2022-08-18 17:05:05+00:00,2022-08-19 16:54:10+00:00,https://github.com/spring-projects/spring-boot/releases/tag/v2.7.3,"tcunning:1660820171:2022-08-18T18:56:11.526+0000:1660820171:2022-08-18T18:56:11.526+0000:Can you assign to me?   I'll have PRs in a few minutes.
tcunning:1660821989:2022-08-18T19:26:29.595+0000:1660822028:2022-08-18T19:27:08.924+0000:[https://github.com/apache/camel/pull/8186]

https://github.com/apache/camel-spring-boot/pull/608"
0,CAMEL-18406,Improvement,Major,None,3.19.0,"
None
",Resolved,Fixed,3.19.0,Claus Ibsen,Claus Ibsen,0,1,2022-08-18 16:23:03+00:00,2022-08-30 11:12:59+00:00,"It would be good if we could



control routes such as start/stop/suspend/resume DONE
context statistics DONE
route statistics so you can see their state, number of messages processed etc DONE
show health check status as well in the get commands DONE
show camel and runtime version DONE
show memory usage DONE","davsclaus:1661489316:2022-08-26T12:48:36.085+0000:1661566641:2022-08-27T10:17:21.692+0000:- jbang *DONE*
- spring boot *DONE*
- quarkus (created ticket for an extension)
- main *DONE*
- mvn spring-boot run to grab main classname *DONE*
- spring boot to output status quicker on startup *DONE*
- camel stop PID for spring boot to terminate SB (it stops camel) *DONE*
davsclaus:1661771745:2022-08-29T19:15:45.167+0000:1661827091:2022-08-30T10:38:11.136+0000:- camel run * (name should be first founds DSL file) *DONE*
- camel run foo.java (name should be foo) *DONE*
- camel get (use name) *DONE*
- pattern to support comma (foo,bar) *DONE*
- camel cmd -all flag for all routes so you can quickly stop all of them, or start all of them *DONE*
- update documentation *DONE*

"
0,CAMEL-18405,Bug,Minor,3.18.1,None,"
None
",Resolved,Fixed,3.18.2,Claus Ibsen,TARTIERE,0,5,2022-08-18 12:51:04+00:00,2022-09-05 07:23:10+00:00,"Unable to start application with routes listening for files.


java.util.concurrent.ExecutionException: java.lang.NoClassDefFoundError: org/apache/camel/resume/ResumeAware
    at java.util.concurrent.FutureTask.report(FutureTask.java:122) ~[?:?]
    at java.util.concurrent.FutureTask.get(FutureTask.java:191) ~[?:?]
    at java.util.concurrent.AbstractExecutorService.doInvokeAny(AbstractExecutorService.java:199) ~[?:?]
    at java.util.concurrent.AbstractExecutorService.invokeAny(AbstractExecutorService.java:230) ~[?:?]
    at org.apache.aries.blueprint.utils.threading.ScheduledExecutorServiceWrapper$4.call(ScheduledExecutorServiceWrapper.java:185) ~[?:?]
    at org.apache.aries.blueprint.utils.threading.ScheduledExecutorServiceWrapper$15.call(ScheduledExecutorServiceWrapper.java:446) ~[?:?]
    at org.apache.aries.blueprint.utils.threading.RWLock.runReadOperation(RWLock.java:33) ~[?:?]
    at org.apache.aries.blueprint.utils.threading.ScheduledExecutorServiceWrapper.runUnlessShutdown(ScheduledExecutorServiceWrapper.java:443) ~[?:?]
    at org.apache.aries.blueprint.utils.threading.ScheduledExecutorServiceWrapper.invokeAny(ScheduledExecutorServiceWrapper.java:180) ~[?:?]
    at org.apache.aries.blueprint.container.BlueprintEventDispatcher.callListener(BlueprintEventDispatcher.java:195) ~[?:?]
    at org.apache.aries.blueprint.container.BlueprintEventDispatcher.callListeners(BlueprintEventDispatcher.java:178) ~[?:?]
    at org.apache.aries.blueprint.container.BlueprintEventDispatcher.blueprintEvent(BlueprintEventDispatcher.java:133) ~[?:?]
    at org.apache.aries.blueprint.container.BlueprintContainerImpl.doRun(BlueprintContainerImpl.java:447) ~[?:?]
    at org.apache.aries.blueprint.container.BlueprintContainerImpl.run(BlueprintContainerImpl.java:298) ~[?:?]
    at org.apache.aries.blueprint.container.BlueprintExtender.createContainer(BlueprintExtender.java:335) ~[?:?]
    at org.apache.aries.blueprint.container.BlueprintExtender.createContainer(BlueprintExtender.java:288) ~[?:?]
    at org.apache.aries.blueprint.container.BlueprintExtender.createContainer(BlueprintExtender.java:284) ~[?:?]
    at org.apache.aries.blueprint.container.BlueprintExtender.modifiedBundle(BlueprintExtender.java:274) ~[?:?]
    at org.apache.aries.util.tracker.hook.BundleHookBundleTracker$Tracked.customizerModified(BundleHookBundleTracker.java:500) ~[?:?]
    at org.apache.aries.util.tracker.hook.BundleHookBundleTracker$Tracked.customizerModified(BundleHookBundleTracker.java:433) ~[?:?]
    at org.apache.aries.util.tracker.hook.BundleHookBundleTracker$AbstractTracked.track(BundleHookBundleTracker.java:725) ~[?:?]
    at org.apache.aries.util.tracker.hook.BundleHookBundleTracker$Tracked.bundleChanged(BundleHookBundleTracker.java:463) ~[?:?]
    at org.apache.aries.util.tracker.hook.BundleHookBundleTracker$BundleEventHook.event(BundleHookBundleTracker.java:422) ~[?:?]
    at org.apache.felix.framework.util.SecureAction.invokeBundleEventHook(SecureAction.java:1180) ~[?:?]
    at org.apache.felix.framework.EventDispatcher.createWhitelistFromHooks(EventDispatcher.java:730) ~[?:?]
    at org.apache.felix.framework.EventDispatcher.fireBundleEvent(EventDispatcher.java:485) ~[?:?]
    at org.apache.felix.framework.Felix.fireBundleEvent(Felix.java:4817) ~[?:?]
    at org.apache.felix.framework.Felix.startBundle(Felix.java:2336) ~[?:?]
    at org.apache.felix.framework.BundleImpl.start(BundleImpl.java:998) ~[?:?]
    at org.apache.felix.framework.BundleImpl.start(BundleImpl.java:984) ~[?:?]
    at org.apache.karaf.features.internal.service.BundleInstallSupportImpl.startBundle(BundleInstallSupportImpl.java:165) ~[?:?]
    at org.apache.karaf.features.internal.service.FeaturesServiceImpl.startBundle(FeaturesServiceImpl.java:1160) ~[?:?]
    at org.apache.karaf.features.internal.service.Deployer.deploy(Deployer.java:1041) ~[?:?]
    at org.apache.karaf.features.internal.service.FeaturesServiceImpl.doProvision(FeaturesServiceImpl.java:1069) ~[?:?]
    at org.apache.karaf.features.internal.service.FeaturesServiceImpl.lambda$doProvisionInThread$13(FeaturesServiceImpl.java:1004) ~[?:?]
    at java.util.concurrent.FutureTask.run(FutureTask.java:264) [?:?]
    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]
    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]
    at java.lang.Thread.run(Thread.java:834) [?:?]
Caused by: java.lang.NoClassDefFoundError: org/apache/camel/resume/ResumeAware
    at java.lang.ClassLoader.defineClass1(Native Method) ~[?:?]
    at java.lang.ClassLoader.defineClass(ClassLoader.java:1016) ~[?:?]
    at org.apache.felix.framework.BundleWiringImpl$BundleClassLoader.defineClass(BundleWiringImpl.java:2312) ~[?:?]
    at org.apache.felix.framework.BundleWiringImpl$BundleClassLoader.defineClassParallel(BundleWiringImpl.java:2130) ~[?:?]
    at org.apache.felix.framework.BundleWiringImpl$BundleClassLoader.findClass(BundleWiringImpl.java:2064) ~[?:?]
    at org.apache.felix.framework.BundleWiringImpl.findClassOrResourceByDelegation(BundleWiringImpl.java:1533) ~[?:?]
    at org.apache.felix.framework.BundleWiringImpl.access$300(BundleWiringImpl.java:78) ~[?:?]
    at org.apache.felix.framework.BundleWiringImpl$BundleClassLoader.loadClass(BundleWiringImpl.java:1950) ~[?:?]
    at java.lang.ClassLoader.loadClass(ClassLoader.java:521) ~[?:?]
    at org.apache.camel.component.file.FileComponent.buildFileEndpoint(FileComponent.java:62) ~[?:?]
    at org.apache.camel.component.file.GenericFileComponent.createEndpoint(GenericFileComponent.java:58) ~[?:?]
    at org.apache.camel.component.file.GenericFileComponent.createEndpoint(GenericFileComponent.java:38) ~[?:?]
    at org.apache.camel.support.DefaultComponent.createEndpoint(DefaultComponent.java:171) ~[?:?]
    at org.apache.camel.impl.engine.AbstractCamelContext.doGetEndpoint(AbstractCamelContext.java:951) ~[?:?]
    at org.apache.camel.impl.engine.AbstractCamelContext.getEndpoint(AbstractCamelContext.java:867) ~[?:?]
    at org.apache.camel.support.CamelContextHelper.getMandatoryEndpoint(CamelContextHelper.java:58) ~[?:?]
    at org.apache.camel.reifier.AbstractReifier.resolveEndpoint(AbstractReifier.java:191) ~[?:?]
    at org.apache.camel.reifier.RouteReifier.doCreateRoute(RouteReifier.java:94) ~[?:?]
    at org.apache.camel.reifier.RouteReifier.createRoute(RouteReifier.java:74) ~[?:?]
    at org.apache.camel.impl.DefaultModelReifierFactory.createRoute(DefaultModelReifierFactory.java:49) ~[?:?]
    at org.apache.camel.impl.DefaultCamelContext.startRouteDefinitions(DefaultCamelContext.java:862) ~[?:?]
    at org.apache.camel.impl.DefaultCamelContext.startRouteDefinitions(DefaultCamelContext.java:750) ~[?:?]
    at org.apache.camel.impl.engine.AbstractCamelContext.doInit(AbstractCamelContext.java:2947) ~[?:?]
    at org.apache.camel.support.service.BaseService.init(BaseService.java:83) ~[?:?]
    at org.apache.camel.impl.engine.AbstractCamelContext.init(AbstractCamelContext.java:2630) ~[?:?]
    at org.apache.camel.support.service.BaseService.start(BaseService.java:111) ~[?:?]
    at org.apache.camel.impl.engine.AbstractCamelContext.start(AbstractCamelContext.java:2649) ~[?:?]
    at org.apache.camel.impl.DefaultCamelContext.start(DefaultCamelContext.java:262) ~[?:?]
    at org.apache.camel.blueprint.BlueprintCamelContext.start(BlueprintCamelContext.java:241) ~[?:?]
    at org.apache.camel.blueprint.BlueprintCamelContext.maybeStart(BlueprintCamelContext.java:283) ~[?:?]
    at org.apache.camel.blueprint.BlueprintCamelContext.blueprintEvent(BlueprintCamelContext.java:188) ~[?:?]
    at org.apache.aries.blueprint.container.BlueprintEventDispatcher$3.call(BlueprintEventDispatcher.java:197) ~[?:?]
    at org.apache.aries.blueprint.container.BlueprintEventDispatcher$3.call(BlueprintEventDispatcher.java:195) ~[?:?]
    at java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[?:?]
    at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515) ~[?:?]
    at java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[?:?]
    at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515) ~[?:?]
    at java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[?:?]
    at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:304) ~[?:?]
    ... 3 more
Caused by: java.lang.ClassNotFoundException: org.apache.camel.resume.ResumeAware not found by org.apache.camel.camel-file [81]
    at org.apache.felix.framework.BundleWiringImpl.findClassOrResourceByDelegation(BundleWiringImpl.java:1565) ~[?:?]
    at org.apache.felix.framework.BundleWiringImpl.access$300(BundleWiringImpl.java:78) ~[?:?]
    at org.apache.felix.framework.BundleWiringImpl$BundleClassLoader.loadClass(BundleWiringImpl.java:1950) ~[?:?]
    at java.lang.ClassLoader.loadClass(ClassLoader.java:521) ~[?:?]
    at java.lang.ClassLoader.defineClass1(Native Method) ~[?:?]
    at java.lang.ClassLoader.defineClass(ClassLoader.java:1016) ~[?:?]
    at org.apache.felix.framework.BundleWiringImpl$BundleClassLoader.defineClass(BundleWiringImpl.java:2312) ~[?:?]
    at org.apache.felix.framework.BundleWiringImpl$BundleClassLoader.defineClassParallel(BundleWiringImpl.java:2130) ~[?:?]
    at org.apache.felix.framework.BundleWiringImpl$BundleClassLoader.findClass(BundleWiringImpl.java:2064) ~[?:?]
    at org.apache.felix.framework.BundleWiringImpl.findClassOrResourceByDelegation(BundleWiringImpl.java:1533) ~[?:?]
    at org.apache.felix.framework.BundleWiringImpl.access$300(BundleWiringImpl.java:78) ~[?:?]
    at org.apache.felix.framework.BundleWiringImpl$BundleClassLoader.loadClass(BundleWiringImpl.java:1950) ~[?:?]
    at java.lang.ClassLoader.loadClass(ClassLoader.java:521) ~[?:?]
    at org.apache.camel.component.file.FileComponent.buildFileEndpoint(FileComponent.java:62) ~[?:?]
    at org.apache.camel.component.file.GenericFileComponent.createEndpoint(GenericFileComponent.java:58) ~[?:?]
    at org.apache.camel.component.file.GenericFileComponent.createEndpoint(GenericFileComponent.java:38) ~[?:?]
    at org.apache.camel.support.DefaultComponent.createEndpoint(DefaultComponent.java:171) ~[?:?]
    at org.apache.camel.impl.engine.AbstractCamelContext.doGetEndpoint(AbstractCamelContext.java:951) ~[?:?]
    at org.apache.camel.impl.engine.AbstractCamelContext.getEndpoint(AbstractCamelContext.java:867) ~[?:?]
    at org.apache.camel.support.CamelContextHelper.getMandatoryEndpoint(CamelContextHelper.java:58) ~[?:?]
    at org.apache.camel.reifier.AbstractReifier.resolveEndpoint(AbstractReifier.java:191) ~[?:?]
    at org.apache.camel.reifier.RouteReifier.doCreateRoute(RouteReifier.java:94) ~[?:?]
    at org.apache.camel.reifier.RouteReifier.createRoute(RouteReifier.java:74) ~[?:?]
    at org.apache.camel.impl.DefaultModelReifierFactory.createRoute(DefaultModelReifierFactory.java:49) ~[?:?]
    at org.apache.camel.impl.DefaultCamelContext.startRouteDefinitions(DefaultCamelContext.java:862) ~[?:?]
    at org.apache.camel.impl.DefaultCamelContext.startRouteDefinitions(DefaultCamelContext.java:750) ~[?:?]
    at org.apache.camel.impl.engine.AbstractCamelContext.doInit(AbstractCamelContext.java:2947) ~[?:?]
    at org.apache.camel.support.service.BaseService.init(BaseService.java:83) ~[?:?]
    at org.apache.camel.impl.engine.AbstractCamelContext.init(AbstractCamelContext.java:2630) ~[?:?]
    at org.apache.camel.support.service.BaseService.start(BaseService.java:111) ~[?:?]
    at org.apache.camel.impl.engine.AbstractCamelContext.start(AbstractCamelContext.java:2649) ~[?:?]
    at org.apache.camel.impl.DefaultCamelContext.start(DefaultCamelContext.java:262) ~[?:?]
    at org.apache.camel.blueprint.BlueprintCamelContext.start(BlueprintCamelContext.java:241) ~[?:?]
    at org.apache.camel.blueprint.BlueprintCamelContext.maybeStart(BlueprintCamelContext.java:283) ~[?:?]
    at org.apache.camel.blueprint.BlueprintCamelContext.blueprintEvent(BlueprintCamelContext.java:188) ~[?:?]
    at org.apache.aries.blueprint.container.BlueprintEventDispatcher$3.call(BlueprintEventDispatcher.java:197) ~[?:?]
    at org.apache.aries.blueprint.container.BlueprintEventDispatcher$3.call(BlueprintEventDispatcher.java:195) ~[?:?]
    at java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[?:?]
    at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515) ~[?:?]
    at java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[?:?]
    at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515) ~[?:?]
    at java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[?:?]
    at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:304) ~[?:?]
    ... 3 more","davsclaus:1660802518:2022-08-18T14:01:58.361+0000:1660802518:2022-08-18T14:01:58.361+0000:Could be some osgi bundle mixed version problems or what the f....

Can you do a clean empty karaf and install camel 3.8.1 only and try your camel app there.
jtt77777@gmail.com:1660914201:2022-08-19T21:03:21.625+0000:1660914201:2022-08-19T21:03:21.625+0000:I also see this with a clean install.

The manifest for the camel-file bundle has the below for import-package

It imports org.apache.camel.resume.cache and org.apache.camel.support.resume packages,  but not org.apache.camel.resume. Instead org.apache.camel.resume is in the manifest as Private-Package:

Import-Package: org.apache.camel;
version=""[3.18,3.19)"",org.apache.camel.cluster;
version=""[3.18,3.19)"",org.apache.camel.resume.cache;
version=""[3.18,3.19)"",org.apache.camel.spi;
version=""[3.18,3.19)"",org.apache.camel.spi.annotations;
version=""[3.18,3.19)"",org.apache.camel.support;
version=""[3.18,3.19)"",org.apache.camel.support.cluster;
version=""[3.18,3.19)"",org.apache.camel.support.component;
version=""[3.18,3.19)"",org.apache.camel.support.processor.idempotent;
version=""[3.18,3.19)"",org.apache.camel.support.resume;
version=""[3.18,3.19)"",org.apache.camel.support.service;
version=""[3.18,3.19)"",org.apache.camel.util;
version=""[3.18,3.19)"",java.io,java.lang,java.lang.invoke,java.net,java.nio,java.nio.channels,java.nio.charset,java.nio.file,java.nio.file.attribute,java.util,java.util.concurrent,java.util.concurrent.locks,java.util.function,java.util.regex,java.util.stream,org.slf4j;
version=""[1.7,2)""

Private-Package: org.apache.camel.resume
davsclaus:1660946920:2022-08-20T06:08:40.510+0000:1660946920:2022-08-20T06:08:40.510+0000:Are you sure you use 3.18.1 and not 3.18.0
jtt77777@gmail.com:1660965118:2022-08-20T11:11:58.106+0000:1660965118:2022-08-20T11:11:58.106+0000:Yes.

 

karaf@root()> list -t 0 org.apache.camel.* 
START LEVEL 100 , List Threshold: 0
 ID | State  | Lvl | Version | Name
----+--------+-----+---------+------------------------------------------------
202 | Active |  50 | 3.18.1  | camel-api
203 | Active |  50 | 3.18.1  | camel-attachments
204 | Active |  50 | 3.18.1  | camel-base
205 | Active |  50 | 3.18.1  | camel-base-engine
206 | Active |  50 | 3.18.1  | camel-bean
. . .
224 | Active |  50 | 3.18.1  | camel-directvm
225 | Active |  50 | 3.18.1  | camel-file
jtt77777@gmail.com:1660965714:2022-08-20T11:21:54.626+0000:1660965714:2022-08-20T11:21:54.626+0000:I'll point out that it works ( resolves classes in org.apache.camel.resume package)  by setting camel-file bundle to dynamic-import in karaf.

 

karaf@root()> dynamic-import org.apache.camel.camel-file
Enabling dynamic imports on bundle org.apache.camel.camel-file [225]
RemyT:1661133569:2022-08-22T09:59:29.188+0000:1661133569:2022-08-22T09:59:29.188+0000:karaf@root()> list -t 0 org.apache.camel.* 

 80 │ Active │  50 │ 3.18.1  │ camel-directvm
 81 │ Active │  50 │ 3.18.1  │ camel-file
 82 │ Active │  50 │ 3.18.1  │ camel-health
RemyT:1661133634:2022-08-22T10:00:34.144+0000:1661133634:2022-08-22T10:00:34.144+0000:karaf@root()> dynamic-import org.apache.camel.camel-file
Enabling dynamic imports on bundle org.apache.camel.camel-file [81]
RemyT:1661134924:2022-08-22T10:22:04.779+0000:1661134924:2022-08-22T10:22:04.779+0000:it seems to be good with dynamic
davsclaus:1661686112:2022-08-28T19:28:32.530+0000:1661686112:2022-08-28T19:28:32.530+0000:We have corrected this 3.19 onwards. So had to come up with a different fix in 3.18.x with a search/replace to fix the osgi manifest.mf file.
RemyT:1661810882:2022-08-30T06:08:02.010+0000:1661810882:2022-08-30T06:08:02.010+0000:So what can we do or modify to have a working version? 
RemyT:1662016497:2022-09-01T15:14:57.480+0000:1662016497:2022-09-01T15:14:57.480+0000:Hello,
We have changed the manifest file.

Our manifest in bundle contain the line as mentionned in [commit|https://github.com/apache/camel/commit/159beeb85c9fcc7547c15a41acd8386fc16c5e77#diff-e3281f84bec82da1a03295ec0dee2bfb4e28215a81f1d6a0cbc054c8b8079542]
""Private-Package: !*""

We have the same error:

Caused by: java.lang.ClassNotFoundException: org.apache.camel.resume.ResumeAware not found by org.apache.camel.camel-file [81] 
davsclaus:1662021737:2022-09-01T16:42:17.503+0000:1662021831:2022-09-01T16:43:51.343+0000:Wait for the release or use the dynamic thingy. Camel 3.19 has reworked the resume thingy so its loaded in a better way
RemyT:1662075387:2022-09-02T07:36:27.306+0000:1662075387:2022-09-02T07:36:27.306+0000: 
The fix on 3.18.2 seems not good.
 
3.19 is not LTS, we have to stay in 3.18.x
davsclaus:1662254959:2022-09-04T09:29:19.811+0000:1662254959:2022-09-04T09:29:19.811+0000:Okay it required one more fix
RemyT:1662331144:2022-09-05T06:39:04.630+0000:1662331144:2022-09-05T06:39:04.630+0000:So it's not fixed why did you close the issue and mark fixed?
What is the date of release?
We saw september for the release, can we have more details about the planning?
Can we have more details on the resolution of this issue?
Regards,
acosentino:1662331874:2022-09-05T06:51:14.710+0000:1662331874:2022-09-05T06:51:14.710+0000:It's resolved because the fix is in place. We don't wait for the release to come out for moving issues to resolved state. We resolve them before and we track the version containing the fix.
davsclaus:1662333790:2022-09-05T07:23:10.112+0000:1662333790:2022-09-05T07:23:10.112+0000:You can find details in all the commits, just look at github in the 3.18.x branch"
0,CAMEL-18404,Task,Minor,3.18.1,"3.18.2, 3.19.0","
None
",Resolved,Fixed,"3.18.2, 3.19.0",Claus Ibsen,José Bustamante,0,2,2022-08-18 12:25:49+00:00,2022-08-27 19:26:57+00:00,"While doing some resarch on camel stax I found that the XML example is missing in the documentation: https://camel.apache.org/components/next/stax-component.html#_the_previous_example_with_xml_dsl





I assume is going to be similar of what I've found in camel's github repo: https://github.com/apache/camel/blob/80b92e3624ae5db59a1a24a441f1b10b39eaa1a5/components/camel-stax/src/test/resources/org/apache/camel/component/stax/SpringStAXJAXBIteratorExpressionTest.xml


And if we want to disable namespace awareness of the component we just need to add a second parameter with false 





<constructor-arg index=""1"" value=""false""/>",davsclaus:1661599617:2022-08-27T19:26:57.362+0000:1661599617:2022-08-27T19:26:57.362+0000:Yes correct. Thanks for reporting and finding the example in the source.
0,CAMEL-18403,Task,Trivial,None,"3.18.2, 3.19.0","
None
",Resolved,Fixed,"3.18.2, 3.19.0",Unassigned,Lukas Lowinger,0,2,2022-08-18 07:30:33+00:00,2022-08-20 16:05:25+00:00,"Referring to  https://camel.apache.org/components/3.18.x/controlbus-component.html.



there is sentence `or use the event notifier which has an example here.`, but i don't see such example.
there is `camelContext.getRouteStatus('myRoute')` which should be `camelContext.getRouteController().getRouteStatus('myRoute')`","davsclaus:1660782902:2022-08-18T08:35:02.899+0000:1660782902:2022-08-18T08:35:02.899+0000:PR is welcome to help update the docs
llowinge:1660790723:2022-08-18T10:45:23.370+0000:1660790723:2022-08-18T10:45:23.370+0000:[~davsclaus] I would like to, but i don't have knowledge about the event notifier example. 
davsclaus:1660791901:2022-08-18T11:05:01.376+0000:1660791901:2022-08-18T11:05:01.376+0000:Okay you can then help with the other thing mentioned
llowinge:1660793085:2022-08-18T11:24:45.882+0000:1660793085:2022-08-18T11:24:45.882+0000:[~davsclaus] Done.
llowinge:1660793632:2022-08-18T11:33:52.127+0000:1660793632:2022-08-18T11:33:52.127+0000:[~davsclaus] Will it be automatically backported to 3.18 ? Or should i do it somehow ?"
0,CAMEL-18402,Improvement,Major,None,,"
None
",Open,Unresolved,None,Unassigned,Claus Ibsen,0,2,2022-08-17 07:37:48+00:00,2023-07-17 10:51:45+00:00,"The need for being able to export from a single integration file to a maven based spring boot or quarkus project is needed by others outside jbang.


We should look at making this generic, as jbang is essentially a CLI facade on top.


For example this can then be used by Camel K to let it able to better resolve dependencies, and build the container image as a standard quarkus project.",
0,CAMEL-18401,New Feature,Major,None,,"
None
",Open,Unresolved,None,Unassigned,Claus Ibsen,0,1,2022-08-17 05:29:11+00:00,2023-07-17 10:51:54+00:00,"It would be great if we can find a better UX for users to be able to take some sample data such as json files (maybe xml as well) and have jbang able to use the json/xml maven plugins to generate POJOs for that, and as well make it easier to get started with mapping these using MapStruct.


For example can we build this example starting with jbang
https://github.com/apache/camel-examples/tree/main/examples/mapstruct


And then we should also have the export command support this so it can setup the mapstruct compiler plugin etc.",
0,CAMEL-18400,Bug,Major,3.18.1,"3.18.2, 3.19.0","
None
",Resolved,Cannot Reproduce,"3.18.2, 3.19.0",Claus Ibsen,Marat Gubaidullin,0,2,2022-08-16 21:23:21+00:00,2022-09-01 05:14:14+00:00,"jbang does not use correct camel version. ex.


1. Execute command with camel 3.18.0, ex:




jbang -Dcamel.jbang.version=3.18.0 camel@apache/camel export  --directory=export --fresh




2. Then execute same command with camel 3.18.1




jbang -Dcamel.jbang.version=3.18.1 camel@apache/camel export  --directory=export --fresh




The generated result will be with the old version 3.18.0 (ex. application.properties generated with camelCase instead of kebab-case)","davsclaus:1660706811:2022-08-17T11:26:51.927+0000:1660706811:2022-08-17T11:26:51.927+0000:Yes it was fixed already for next release
marat.gubaidullin@gmail.com:1661251561:2022-08-23T18:46:01.119+0000:1661251561:2022-08-23T18:46:01.119+0000:1. I have removed jbang and maven caches
{code:java}
rm -rf ~/.jbang 
rm -rf ~/.m2/repository/org/apache/camel
{code}

2. I run the jbang with Camel 3.19.0-SNAPSHOT
{code:java}
jbang -Dcamel.jbang.version=3.19.0-SNAPSHOT camel@apache/camel run *
{code}

3. Then I run  jbang with Camel 3.18.1
{code:java}
jbang -Dcamel.jbang.version=3.18.1 camel@apache/camel run *
{code}

The result is that jbang uses the first Camel 3.19.0-SNAPSHOT
davsclaus:1661309894:2022-08-24T10:58:14.680+0000:1661309894:2022-08-24T10:58:14.680+0000:I cannot reproduce (I also removed jbang / m2)

{code}
~/workspace/deleteme ❯ jbang -Dcamel.jbang.version=3.19.0-SNAPSHOT camel@apache/camel run foo.yaml                                                                                     ✘ INT 9s
[jbang] https://github.com/apache/camel/blob/HEAD/dsl/camel-jbang/camel-jbang-main/dist/CamelJBang.java is not from a trusted source thus not running it automatically.

If you trust the url to be safe to run you can do one of the following

(1) Trust once: Add no trust, just download this time (can be run multiple times while cached)
(2) Trust limited url in future: https://github.com/apache/camel/
(3) Trust organization url in future: https://github.com/apache/
(0) Cancel

[jbang] Type in your choice and hit enter. Will automatically select option (0) after 30 seconds.
3
[jbang] Adding [https://github.com/apache/] to /Users/davsclaus/.jbang/trusted-sources.json
[jbang] Resolving dependencies...
[jbang] Artifacts used for dependency management:
         org.apache.camel:camel-bom:pom:3.19.0-SNAPSHOT
[jbang] org.apache.camel:camel-jbang-core:jar:3.19.0-SNAPSHOT
         org.apache.camel.kamelets:camel-kamelets:jar:0.8.1
         org.apache.camel.kamelets:camel-kamelets-utils:jar:0.8.1
Done
[jbang] Dependencies resolved
[jbang] Building jar...
2022-08-24 12:57:01.992  INFO 22684 --- [           main] org.apache.camel.main.MainSupport        : Apache Camel (JBang) 3.19.0-SNAPSHOT is starting
2022-08-24 12:57:02.031  INFO 22684 --- [           main] org.apache.camel.main.MainSupport        : Using Java 11.0.13 with PID 22684. Started by davsclaus in /Users/davsclaus/workspace/deleteme
2022-08-24 12:57:04.674  INFO 22684 --- [           main] .main.download.MavenDependencyDownloader : Downloaded:  org.apache.camel:camel-rest:3.19.0-SNAPSHOT (took: 2s463ms)
2022-08-24 12:57:04.793  INFO 22684 --- [           main] e.camel.impl.engine.AbstractCamelContext : Apache Camel 3.19.0-SNAPSHOT (CamelJBang) is starting
2022-08-24 12:57:04.872  INFO 22684 --- [           main] org.apache.camel.main.BaseMainSupport    : Property-placeholders summary
2022-08-24 12:57:04.872  INFO 22684 --- [           main] org.apache.camel.main.BaseMainSupport    :     [application.properties]       myName=Donald Duck
2022-08-24 12:57:04.873  INFO 22684 --- [           main] e.camel.impl.engine.AbstractCamelContext : Routes startup (started:1)
2022-08-24 12:57:04.873  INFO 22684 --- [           main] e.camel.impl.engine.AbstractCamelContext :     Started route1 (timer://yaml)
2022-08-24 12:57:04.873  INFO 22684 --- [           main] e.camel.impl.engine.AbstractCamelContext : Apache Camel 3.19.0-SNAPSHOT (CamelJBang) started in 227ms (build:68ms init:79ms start:80ms JVM-uptime:3s)
2022-08-24 12:57:05.894  INFO 22684 --- [ - timer://yaml] foo.yaml:9                               : Hi Donald Duck from yaml3
2022-08-24 12:57:07.884  INFO 22684 --- [ - timer://yaml] foo.yaml:9                               : Hi Donald Duck from yaml3
2022-08-24 12:57:09.888  INFO 22684 --- [ - timer://yaml] foo.yaml:9                               : Hi Donald Duck from yaml3
^C2022-08-24 12:57:10.379  INFO 22684 --- [           main] e.camel.impl.engine.AbstractCamelContext : Apache Camel 3.19.0-SNAPSHOT (CamelJBang) is shutting down (timeout:45s)
2022-08-24 12:57:10.390  INFO 22684 --- [           main] e.camel.impl.engine.AbstractCamelContext : Routes stopped (stopped:1)
2022-08-24 12:57:10.390  INFO 22684 --- [           main] e.camel.impl.engine.AbstractCamelContext :     Stopped route1 (timer://yaml)
2022-08-24 12:57:10.395  INFO 22684 --- [           main] e.camel.impl.engine.AbstractCamelContext : Apache Camel 3.19.0-SNAPSHOT (CamelJBang) shutdown in 16ms (uptime:5s JVM-uptime:9s)
2022-08-24 12:57:10.395  INFO 22684 --- [           main] org.apache.camel.main.MainSupport        : Apache Camel (JBang) 3.19.0-SNAPSHOT shutdown
~/workspace/deleteme ❯ jbang -Dcamel.jbang.version=3.18.1 camel@apache/camel run foo.yaml                                                                                             ✘ INT 48s
[jbang] Resolving dependencies...
[jbang] Artifacts used for dependency management:
         org.apache.camel:camel-bom:pom:3.18.1
[jbang] org.apache.camel:camel-jbang-core:jar:3.18.1
         org.apache.camel.kamelets:camel-kamelets:jar:0.8.1
         org.apache.camel.kamelets:camel-kamelets-utils:jar:0.8.1
Done
[jbang] Dependencies resolved
2022-08-24 12:57:32.454  INFO 22702 --- [           main] org.apache.camel.main.MainSupport        : Apache Camel (JBang) 3.18.1 is starting
2022-08-24 12:57:32.489  INFO 22702 --- [           main] org.apache.camel.main.MainSupport        : Using Java 11.0.13 with PID 22702. Started by davsclaus in /Users/davsclaus/workspace/deleteme
2022-08-24 12:57:33.740  INFO 22702 --- [           main] e.camel.impl.engine.AbstractCamelContext : Apache Camel 3.18.1 (CamelJBang) is starting
2022-08-24 12:57:33.814  INFO 22702 --- [           main] org.apache.camel.main.BaseMainSupport    : Property-placeholders summary
2022-08-24 12:57:33.814  INFO 22702 --- [           main] org.apache.camel.main.BaseMainSupport    :     [application.properties]       myName=Donald Duck
2022-08-24 12:57:33.815  INFO 22702 --- [           main] e.camel.impl.engine.AbstractCamelContext : Routes startup (started:1)
2022-08-24 12:57:33.815  INFO 22702 --- [           main] e.camel.impl.engine.AbstractCamelContext :     Started route1 (timer://yaml)
2022-08-24 12:57:33.815  INFO 22702 --- [           main] e.camel.impl.engine.AbstractCamelContext : Apache Camel 3.18.1 (CamelJBang) started in 214ms (build:66ms init:73ms start:75ms JVM-uptime:1s)
2022-08-24 12:57:34.834  INFO 22702 --- [ - timer://yaml] foo.yaml:9                               : Hi Donald Duck from yaml3
2022-08-24 12:57:36.822  INFO 22702 --- [ - timer://yaml] foo.yaml:9                               : Hi Donald Duck from yaml3
^C2022-08-24 12:57:37.207  INFO 22702 --- [           main] e.camel.impl.engine.AbstractCamelContext : Apache Camel 3.18.1 (CamelJBang) is shutting down (timeout:45s)
2022-08-24 12:57:37.217  INFO 22702 --- [           main] e.camel.impl.engine.AbstractCamelContext : Routes stopped (stopped:1)
2022-08-24 12:57:37.218  INFO 22702 --- [           main] e.camel.impl.engine.AbstractCamelContext :     Stopped route1 (timer://yaml)
2022-08-24 12:57:37.222  INFO 22702 --- [           main] e.camel.impl.engine.AbstractCamelContext : Apache Camel 3.18.1 (CamelJBang) shutdown in 14ms (uptime:3s JVM-uptime:5s)
2022-08-24 12:57:37.222  INFO 22702 --- [           main] org.apache.camel.main.MainSupport        : Apache Camel (JBang) 3.18.1 shutdown
{code}
davsclaus:1661313082:2022-08-24T11:51:22.209+0000:1661313082:2022-08-24T11:51:22.209+0000:I tried with --fresh too which worked

jbang --fresh -Dcamel.jbang.version=3.19.0-SNAPSHOT camel@apache/camel run *
jbang --fresh -Dcamel.jbang.version=3.18.1-SNAPSHOT camel@apache/camel run *
davsclaus:1661313461:2022-08-24T11:57:41.200+0000:1661313474:2022-08-24T11:57:54.155+0000:All the versions going back to 3.13.0 worked for me

~/workspace/deleteme/yellow ❯ jbang --fresh -Dcamel.jbang.version=3.13.0 camel@apache/camel run *                                                                                           
[jbang] Resolving dependencies...
[jbang] Artifacts used for dependency management:
         org.apache.camel:camel-bom:pom:3.13.0
[jbang] org.apache.camel:camel-jbang-core:jar:3.13.0
         org.apache.camel.kamelets:camel-kamelets:jar:0.8.1
         org.apache.camel.kamelets:camel-kamelets-utils:jar:0.8.1
Done
[jbang] Dependencies resolved
[jbang] Building jar...
Starting Camel JBang!
A new lock file was created on /Users/davsclaus/workspace/deleteme/yellow/./.run14454802692800644920.camel.lock. Delete this file to stop running
13:57:15.735 [main] INFO  org.apache.camel.main.BaseMainSupport - Auto-configuration summary
13:57:15.737 [main] INFO  org.apache.camel.main.BaseMainSupport -     camel.main.lightweight=true
13:57:15.737 [main] INFO  org.apache.camel.main.BaseMainSupport -     camel.main.routesIncludePattern=file:bar.yaml
13:57:15.737 [main] INFO  org.apache.camel.main.BaseMainSupport -     camel.main.name=CamelJBang
13:57:15.737 [main] INFO  org.apache.camel.main.BaseMainSupport -     camel.component.kamelet.location=classpath:/kamelets,github:apache:camel-kamelets
13:57:16.314 [main] INFO  org.apache.camel.impl.engine.AbstractCamelContext - Routes startup summary (total:2 started:2)
13:57:16.314 [main] INFO  org.apache.camel.impl.engine.AbstractCamelContext -     Started route1 (file-watch://.)
13:57:16.314 [main] INFO  org.apache.camel.impl.engine.AbstractCamelContext -     Started route2 (timer://yaml2)
13:57:16.314 [main] INFO  org.apache.camel.impl.engine.AbstractCamelContext - Apache Camel 3.13.0 (CamelJBang) started in 558ms (build:18ms init:35ms start:505ms)
13:57:16.314 [main] INFO  org.apache.camel.impl.engine.AbstractCamelContext - Lightweight mode enabled. Performing optimizations and memory reduction.
13:57:17.328 [Camel (CamelJBang) thread #3 - timer://yaml2] INFO  route2 - Hello Camel from yaml
13:57:18.324 [Camel (CamelJBang) thread #3 - timer://yaml2] INFO  route2 - Hello Camel from yaml
^C13:57:18.776 [main] INFO  org.apache.camel.impl.engine.AbstractCamelContext - Apache Camel 3.13.0 (CamelJBang) shutting down (timeout:45s)
13:57:18.785 [main] INFO  org.apache.camel.impl.engine.AbstractCamelContext - Routes shutdown summary (total:2 stopped:2)
13:57:18.785 [main] INFO  org.apache.camel.impl.engine.AbstractCamelContext -     Stopped route2 (timer://yaml2)
13:57:18.786 [main] INFO  org.apache.camel.impl.engine.AbstractCamelContext -     Stopped route1 (file-watch://.)
13:57:18.787 [main] INFO  org.apache.camel.impl.engine.AbstractCamelContext - Apache Camel 3.13.0 (CamelJBang) shutdown in 11ms (uptime:2s978ms)
~/workspace/deleteme/yellow ❯
davsclaus:1661599316:2022-08-27T19:21:56.587+0000:1661599316:2022-08-27T19:21:56.587+0000:I can still not reproduce this"
0,CAMEL-18399,Bug,Minor,None,"3.14.6, 3.18.2, 3.19.0","
None
",Resolved,Fixed,"3.14.6, 3.18.2, 3.19.0",Unassigned,ALEXANDRE DAVI ZANELATTO,0,2,2022-08-16 20:32:32+00:00,2022-08-17 07:35:26+00:00,"I'm using the SQL component to connect to my DBMaker database, but the DBMaker PreparedStatement return null on getParameterMetaData causing a nulllpointer




ava.lang.NullPointerException: null
    at org.apache.camel.component.sql.SqlProducer.populateStatement(SqlProducer.java:248)
    at org.apache.camel.component.sql.SqlProducer$1.doInPreparedStatement(SqlProducer.java:150)
    at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:651)
    at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:685)
    at org.apache.camel.component.sql.SqlProducer.processInternal(SqlProducer.java:145)
    at org.apache.camel.component.sql.SqlProducer.process(SqlProducer.java:132)
    at org.apache.camel.support.AsyncProcessorConverterHelper$ProcessorToAsyncProcessorBridge.process(AsyncProcessorConverterHelper.java:66)
    at org.apache.camel.processor.SendDynamicProcessor.lambda$process$0(SendDynamicProcessor.java:197)
    at org.apache.camel.support.cache.DefaultProducerCache.doInAsyncProducer(DefaultProducerCache.java:327)
    at org.apache.camel.processor.SendDynamicProcessor.process(SendDynamicProcessor.java:182)
    at org.apache.camel.processor.errorhandler.RedeliveryErrorHandler$RedeliveryTask.redeliver(RedeliveryErrorHandler.java:887)
    at org.apache.camel.impl.engine.DefaultReactiveExecutor$Worker.schedule(DefaultReactiveExecutor.java:189)
    at org.apache.camel.impl.engine.DefaultReactiveExecutor.scheduleMain(DefaultReactiveExecutor.java:61)
    at org.apache.camel.processor.Pipeline.process(Pipeline.java:184)
    at org.apache.camel.impl.engine.CamelInternalProcessor.process(CamelInternalProcessor.java:399)
    at org.apache.camel.impl.engine.DefaultAsyncProcessorAwaitManager.process(DefaultAsyncProcessorAwaitManager.java:83)
    at org.apache.camel.support.AsyncProcessorSupport.process(AsyncProcessorSupport.java:41)
    at org.apache.camel.http.common.CamelServlet.doExecute(CamelServlet.java:319)
    at org.apache.camel.http.common.CamelServlet.doService(CamelServlet.java:214)
    at org.apache.camel.http.common.CamelServlet.service(CamelServlet.java:130)
    at javax.servlet.http.HttpServlet.service(HttpServlet.java:764)
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:227)
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:162)
    at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:189)
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:162)
    at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:117)
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:189)
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:162)
    at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:117)
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:189)
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:162)
    at org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.doFilterInternal(WebMvcMetricsFilter.java:96)",davsclaus:1660692908:2022-08-17T07:35:08.676+0000:1660692908:2022-08-17T07:35:08.676+0000:Thanks for the PR
0,CAMEL-18398,New Feature,Major,None,,"
None
",Open,Unresolved,None,Unassigned,Claus Ibsen,0,1,2022-08-16 15:55:09+00:00,2023-07-17 10:52:14+00:00,"When users build integrations and run with jbang they do quick prototypes and they may make dsl mistakes, type a password wrong, or something that causes Camel to fail on startup and crash the app.


We should make it possible to capture this during startup and gather a nice error report to the user, where we can pinpoint to which DSL element (file name, line number) that potentially caused this.


And we should expose this error report also via dev-console so you can see this via /q/dev in both text and json style.


We can use the supervised route controller to avoid stopping Camel, or add some special in camel-kamelet-main or whatnot for this kind.",
0,CAMEL-18397,Bug,Major,3.18.1,,"
None
",Resolved,Information Provided,None,Unassigned,Marian,0,2,2022-08-15 19:12:14+00:00,2022-08-16 07:38:42+00:00,"I'm trying to make use of Camel's REST Component but it seems the official example from here is not working


 https://camel.apache.org/camel-quarkus/2.11.x/reference/extensions/rest.html","davsclaus:1660606691:2022-08-16T07:38:11.993+0000:1660606691:2022-08-16T07:38:11.993+0000:Thanks for reporting. I created a ticket about this in camel-quarkus ticket system
https://github.com/apache/camel-quarkus/issues/3995"
0,CAMEL-18396,Bug,Trivial,3.18.1,"3.18.2, 3.19.0","
None
",Resolved,Fixed,"3.18.2, 3.19.0",Claus Ibsen,Martin Frei,0,2,2022-08-15 11:36:25+00:00,2022-08-17 11:04:51+00:00,"Take the following test as example:


https://github.com/apache/camel/blob/camel-3.18.1/core/camel-core/src/test/java/org/apache/camel/builder/NotifyBuilderTest.java#L703


And change the line to:


mock.expectedBodiesReceivedInAnyOrder(""XXXXX"", ""Bye World"", ""Hi World"");


The test would still pass.","davsclaus:1660646192:2022-08-16T18:36:32.684+0000:1660646192:2022-08-16T18:36:32.684+0000:Its because its using the ...InAnyOrder which wont work with the notify builder. If you use the ones that are not inAnyOrder. then it works

This requires some extra work to trigger assertion checks at some other stages to make the matcher output its result correctly."
0,CAMEL-18395,Dependency upgrade,Major,3.14.4,3.14.5,"
None
",Resolved,Fixed,3.14.5,Claus Ibsen,Claus Ibsen,0,1,2022-08-15 11:18:13+00:00,2022-08-15 11:28:49+00:00,No Desc,
0,CAMEL-18394,Bug,Major,3.18.1,"3.18.2, 3.19.0","
None
",Resolved,Fixed,"3.18.2, 3.19.0",Freeman Yue Fang,Florian Wermelskirchen,0,3,2022-08-15 09:51:27+00:00,2022-08-15 17:05:02+00:00,"After upgrading from Camel 3.17.0 to 3.18.1
My SOAP CXF Webserivce doesn´t start.
It logs 
org.apache.cxf.endpoint.ServerImpl | Setting the server's publish address to be /goiSoap, but when I go to localhost:8080/services it says ""No services have been found.""
My Rest CXFRS Webservice are working


I´m using Spring Boot to run my Camel routes.","davsclaus:1660529839:2022-08-15T10:17:19.095+0000:1660529839:2022-08-15T10:17:19.095+0000:Can you put a sample project to reproduce this somewhere on github, or attach as zip to this ticket
devflo:1660535304:2022-08-15T11:48:24.497+0000:1660535304:2022-08-15T11:48:24.497+0000:I´ve created a sample project here: [https://github.com/DevFlorian/camel-cxf-springboot-example]
It works with Camel 3.17.0 but fails with Camel 3.18.1
davsclaus:1660538630:2022-08-15T12:43:50.131+0000:1660538630:2022-08-15T12:43:50.131+0000:Make sure you follow the 3.18 upgrade guide on camel-cxf changes
devflo:1660539254:2022-08-15T12:54:14.353+0000:1660539254:2022-08-15T12:54:14.353+0000:I did. I´ve switched from {{camel-cxf-starter}} to {{camel-cxf-soap-starter}}
davsclaus:1660547024:2022-08-15T15:03:44.600+0000:1660547024:2022-08-15T15:03:44.600+0000:[~ffang] I wonder if you have a moment sometime to look into this example
ffang:1660548351:2022-08-15T15:25:51.753+0000:1660548351:2022-08-15T15:25:51.753+0000:Sure [~davsclaus]"
0,CAMEL-18393,Bug,Major,"3.18.1, 3.19.0","3.18.2, 3.19.0","
None
",Resolved,Fixed,"3.18.2, 3.19.0",Jiri Ondrusek,Jiri Ondrusek,0,2,2022-08-15 09:07:53+00:00,2022-08-15 17:23:17+00:00,"Recent change of the component brought some  problems:



If select * from query is executed then it causes NPE.


	Caused by: java.lang.NullPointerException
		at org.apache.camel.component.google.bigquery.sql.GoogleBigQuerySQLProducer.executeSQL(GoogleBigQuerySQLProducer.java:111)
		at org.apache.camel.component.google.bigquery.sql.GoogleBigQuerySQLProducer.process(GoogleBigQuerySQLProducer.java:82)
		at org.apache.camel.support.AsyncProcessorConverterHelper$ProcessorToAsyncProcessorBridge.process(AsyncProcessorConverterHelper.java:66)



Another problem is that the result of the producer for `select` queries should be the totalRows from the result.



Code causing the troubles is https://github.com/apache/camel/commit/bdd495048da891a2e856a116355e9ca6b6f58c72#diff-fd3f8e800c602d7167e9cdbfb4d6af42e1e6223d05eae2242b9c5b14703862ffR111-R116",davsclaus:1660555397:2022-08-15T17:23:17.887+0000:1660555397:2022-08-15T17:23:17.887+0000:Thanks I backported to 3.18.x branch also
0,CAMEL-18392,Improvement,Minor,3.9.0,Future,"
None
",Open,Unresolved,Future,Jesse Gorzinski,Jesse Gorzinski,0,1,2022-08-13 21:21:56+00:00,2023-08-09 09:05:44+00:00,"A popular trend lately is to send UTF-8 JSON data through data queues on IBM i. 


Currently, the JT400 components has a `format` parameter that can be either ""binary"" or ""text"". This parameter affects how the component interprets both the data queue key as well as the data queue data. 


JSON is text, but unfortunately the CCSID (encoding) used for text mode assumes the CCSID of the connection, and IBM i does not support unicode connections!  


In order to properly read UTF-8 data from the queue, you need to use `format=binary` and then convert to String manually (for instance, with `.convertBodyTo(String.class, ""UTF-8"")`).


This isn't all-in-all horrible, but I've seen it catch a decent number of people. This should be addressed by either or both of:



Having a UTF-8 example in the doc
Providing a new `dataQueueCCSID` parameter that allows for the explicit declaration of CCSID read from the data independent from the connection CCSID",
0,CAMEL-18391,Bug,Major,"3.14.0, 3.18.0","3.14.5, 3.18.2, 3.19.0","
None
",Resolved,Fixed,"3.14.5, 3.18.2, 3.19.0",Claus Ibsen,Claus Ibsen,0,1,2022-08-13 18:57:35+00:00,2022-08-14 15:03:47+00:00,"Reported on chat and PR 
https://github.com/apache/camel/pull/8156",
0,CAMEL-18390,Improvement,Major,None,None,"
None
",Resolved,Fixed,3.19.0,Thomas Diesler,Thomas Diesler,0,1,2022-08-13 12:30:15+00:00,2022-08-16 10:00:35+00:00,No Desc,
0,CAMEL-18389,New Feature,Major,None,3.19.0,"
None
",Resolved,Fixed,3.19.0,Claus Ibsen,Claus Ibsen,0,1,2022-08-13 09:12:33+00:00,2022-08-18 16:23:08+00:00,"Make it easier to run multiple camel apps, and to have an easy way to start|stop|restart them etc


camel run foo.yaml
camel run bar.yaml


camel ps
camel stop foo
camel stop bar


This makes it easier to prototype integrations where you may have one camel send data to a system, and another camel consume etc.","davsclaus:1660810875:2022-08-18T16:21:15.418+0000:1660810887:2022-08-18T16:21:27.463+0000:camel ps *DONE* is like kamel get
camel stop *DONE* is like kamel delete where the app is terminated.

To start agin then use run"
0,CAMEL-18388,Improvement,Major,None,"3.18.2, 3.19.0","
None
",Resolved,Fixed,"3.18.2, 3.19.0",Claus Ibsen,Claus Ibsen,0,1,2022-08-13 07:50:03+00:00,2022-08-13 08:10:46+00:00,So you can save to another folder when using camel init foo.xml --directory=myproject,
0,CAMEL-18387,Bug,Minor,3.18.1,"3.14.6, 3.18.2, 3.19.0","
None
",Resolved,Fixed,"3.14.6, 3.18.2, 3.19.0",Unassigned,Christian Becker,0,2,2022-08-11 14:22:19+00:00,2022-08-16 09:44:11+00:00,"TarAggregationStrategy will skip empty messages, but if the first message is empty it will throw an error ""java.io.IOException: Cannot create temp file: "" on the next non-empty message.


I added a test case to reproduce this.","chbecker:1660199713:2022-08-11T14:35:13.109+0000:1660199713:2022-08-11T14:35:13.109+0000:PS: The behavior with only one empty message is also strange: In my test the aggregate will be an empty String object instead of an empty File.

 
chbecker:1660199798:2022-08-11T14:36:38.265+0000:1660199798:2022-08-11T14:36:38.265+0000:The following patch should fix the issue
{code:java}
diff --git a/components/camel-tarfile/src/main/java/org/apache/camel/processor/aggregate/tarfile/TarAggregationStrategy.java b/components/camel-tarfile/src/main/java/org/apache/camel/processor/aggregate/tarfile/TarAggregationStrategy.java
index 78c05bde6d8..3afc43b79ca 100644
--- a/components/camel-tarfile/src/main/java/org/apache/camel/processor/aggregate/tarfile/TarAggregationStrategy.java
+++ b/components/camel-tarfile/src/main/java/org/apache/camel/processor/aggregate/tarfile/TarAggregationStrategy.java
@@ -172,9 +172,6 @@ public class TarAggregationStrategy implements AggregationStrategy {
                             ? newExchange.getIn().getHeader(Exchange.FILE_NAME, String.class)
                             : newExchange.getIn().getMessageId();
                     addFileToTar(tarFile, appendFile, this.preserveFolderStructure ? entryName : null);
-                    GenericFile<File> genericFile = FileConsumer.asGenericFile(
-                            tarFile.getParent(), tarFile, Charset.defaultCharset().toString(), false);
-                    genericFile.bindToExchange(answer);
                 }
             } catch (Exception e) {
                 throw new GenericFileOperationFailedException(e.getMessage(), e);
@@ -189,14 +186,13 @@ public class TarAggregationStrategy implements AggregationStrategy {
                             ? newExchange.getIn().getHeader(Exchange.FILE_NAME, String.class)
                             : newExchange.getIn().getMessageId();
                     addEntryToTar(tarFile, entryName, buffer, buffer.length);
-                    GenericFile<File> genericFile = FileConsumer.asGenericFile(
-                            tarFile.getParent(), tarFile, Charset.defaultCharset().toString(), false);
-                    genericFile.bindToExchange(answer);
                 }
             } catch (Exception e) {
                 throw new GenericFileOperationFailedException(e.getMessage(), e);
             }
         }
+        GenericFile<File> genericFile = FileConsumer.asGenericFile(tarFile.getParent(), tarFile, Charset.defaultCharset().toString(), false);
+        genericFile.bindToExchange(answer);
         return answer;
     }
 {code}
davsclaus:1660200045:2022-08-11T14:40:45.374+0000:1660200045:2022-08-11T14:40:45.374+0000:You are welcome to send the patch as a PR
chbecker:1660605254:2022-08-16T07:14:14.718+0000:1660605254:2022-08-16T07:14:14.718+0000:Created pull request [https://github.com/apache/camel/pull/8166] for main branch
davsclaus:1660614164:2022-08-16T09:42:44.715+0000:1660614164:2022-08-16T09:42:44.715+0000:Thanks"
0,CAMEL-18386,Improvement,Minor,3.18.0,3.19.0,"
None
",Resolved,Fixed,3.19.0,Tomohisa Igarashi,Tomohisa Igarashi,0,1,2022-08-11 14:20:29+00:00,2022-08-11 16:07:12+00:00,Similar to CAMEL-18380 but for the Kafka Topic name overriding with the header kafka.OVERRIDE_TOPIC. This is useful for content based routing while things like jq could send a jackson TextNode.,
0,CAMEL-18385,Improvement,Major,None,4.0.0,"
None
",Resolved,Won't Fix,4.0.0,Unassigned,Claus Ibsen,0,1,2022-08-11 09:56:53+00:00,2023-07-17 10:52:50+00:00,"CAMEL-18370 is related to this because the kamelet parameters become URI parameters to the kamelet, which means that sensitive data such as username, passwords must be protected by RAW() style to allow special chars such as + to keep being +.


We could for yaml-dsl then build the uri parameters in a special way where we store this as a bean (Map) and then let camel-kamelet lookup this bean via an uuid, and then grab the data as-is to be used.


However this is a bit special when using yaml-dsl that can define endpoint parameters in a special map like way.",
0,CAMEL-18384,Bug,Minor,3.14.0,,"
None
",Open,Unresolved,None,Rhuan Rocha,Jerome Guilbaud,1,3,2022-08-11 09:14:18+00:00,2023-10-15 23:21:21+00:00,"I'll need the aggregate method to be run in parallel in my split so I activated parallelAggregate option but it doesn't work as I expected it.




@RunWith(SpringJUnit4ClassRunner.class)
public class SplitAggregationTest extends CamelTestSupport {
private final Logger LOGGER = LoggerFactory.getLogger(SplitAggregationTest.class);

@Override
protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder() {
        @Override
        public void configure() throws Exception {
            from(""direct:start"")
                    .split(body(), new AggregationStrategy() {
                        @Override
                        public Exchange aggregate(Exchange oldExchange, Exchange newExchange) {
                            try {
                                Thread.sleep(1000);
                            } catch (InterruptedException e) {
                                LOGGER.error(""InterruptedException: "", e);
                            }
                            return oldExchange == null ? newExchange : oldExchange;
                        }
                    }).streaming().parallelProcessing().parallelAggregate()
                        .log(LoggingLevel.INFO, LOGGER, ""Aggreg ${body}"")
                    .end();
        }
    };
}

@Test
public void test1() throws InterruptedException {
    Thread.sleep(5000);

    template.sendBody(""direct:start"", Arrays.asList(""A"", ""B"", ""C"", ""D""));

    Thread.sleep(5000);
} 



Aggregate methods (in purple) are not run in parallel, they are waiting each other to finish before:





Associated thread dump:




""Camel (camel-2) thread #17 - Split"" #36 daemon prio=5 os_prio=0   tid=0x000002317da51800 nid=0x149bc waiting on condition  [0x00000062a55fe000]
java.lang.Thread.State: WAITING (parking)
at sun.misc.Unsafe.park(Native Method)
- parking to wait for  <0x000000076e105c70> (a java.util.concurrent.locks.ReentrantLock$NonfairSync)
at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)
at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:836)
at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(AbstractQueuedSynchronizer.java:870)
at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1199)
at java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLock.java:209)
at java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:285)
at org.apache.camel.util.concurrent.AsyncCompletionService.complete(AsyncCompletionService.java:141)
at org.apache.camel.util.concurrent.AsyncCompletionService.access$200(AsyncCompletionService.java:30)
at org.apache.camel.util.concurrent.AsyncCompletionService$Task.accept(AsyncCompletionService.java:168)
at org.apache.camel.processor.MulticastProcessor$MulticastReactiveTask.lambda$null$0(MulticastProcessor.java:579)
at org.apache.camel.processor.MulticastProcessor$MulticastReactiveTask$$Lambda$519/1049021104.done(Unknown Source)
at org.apache.camel.AsyncCallback.run(AsyncCallback.java:44)
at org.apache.camel.impl.engine.DefaultReactiveExecutor$Worker.schedule(DefaultReactiveExecutor.java:187)
at org.apache.camel.impl.engine.DefaultReactiveExecutor.schedule(DefaultReactiveExecutor.java:59)
at org.apache.camel.processor.MulticastProcessor.lambda$schedule$1(MulticastProcessor.java:348)
at org.apache.camel.processor.MulticastProcessor$$Lambda$517/1626228981.run(Unknown Source)
at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
at java.util.concurrent.FutureTask.run(FutureTask.java:266)
at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
at java.lang.Thread.run(Thread.java:748)

Locked ownable synchronizers:
- <0x000000076f0ca838> (a java.util.concurrent.ThreadPoolExecutor$Worker)

""Camel (camel-2) thread #16 - Split"" #35 daemon prio=5 os_prio=0   tid=0x000002317da54000 nid=0x6a8 waiting on condition [0x00000062a54fe000]
java.lang.Thread.State: TIMED_WAITING (sleeping)
at java.lang.Thread.sleep(Native Method)
at com.mybatch.camel.processor.SplitAggregationTest$1$1.aggregate(SplitAggregationTest.java:34)
at org.apache.camel.AggregationStrategy.aggregate(AggregationStrategy.java:86)
at org.apache.camel.processor.MulticastProcessor.doAggregateInternal(MulticastProcessor.java:894)
at org.apache.camel.processor.MulticastProcessor.doAggregate(MulticastProcessor.java:858)
at org.apache.camel.processor.MulticastProcessor$MulticastTask.aggregate(MulticastProcessor.java:451)
at org.apache.camel.processor.MulticastProcessor$MulticastReactiveTask.lambda$null$0(MulticastProcessor.java:582)
at org.apache.camel.processor.MulticastProcessor$MulticastReactiveTask$$Lambda$519/1049021104.done(Unknown Source)
at org.apache.camel.AsyncCallback.run(AsyncCallback.java:44)
at org.apache.camel.impl.engine.DefaultReactiveExecutor$Worker.schedule(DefaultReactiveExecutor.java:187)
at org.apache.camel.impl.engine.DefaultReactiveExecutor.schedule(DefaultReactiveExecutor.java:59)
at org.apache.camel.processor.MulticastProcessor.lambda$schedule$1(MulticastProcessor.java:348)
at org.apache.camel.processor.MulticastProcessor$$Lambda$517/1626228981.run(Unknown Source)
at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
at java.util.concurrent.FutureTask.run(FutureTask.java:266)
at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
at java.lang.Thread.run(Thread.java:748)

Locked ownable synchronizers:
- <0x000000076e105c70> (a java.util.concurrent.locks.ReentrantLock$NonfairSync)
- <0x000000076ef115b0> (a java.util.concurrent.ThreadPoolExecutor$Worker)",
0,CAMEL-18383,Improvement,Major,None,4.x,"
None
",Open,Unresolved,4.x,James Netherton,James Netherton,0,1,2022-08-11 08:31:18+00:00,2023-08-09 09:05:51+00:00,"Some more information in this issue:


https://github.com/apache/camel-quarkus/issues/3888


There may be cases where you are not going to block the Vert.x event loop in the Camel routing. Therefore, it may be desirable to not do this 'execute blocking' logic:


https://github.com/apache/camel/blob/main/components/camel-platform-http-vertx/src/main/java/org/apache/camel/component/platform/http/vertx/VertxPlatformHttpConsumer.java#L168-L221


And instead run the AsyncProcessor as per normal on an IO thread.",
0,CAMEL-18382,Improvement,Minor,3.18.0,3.19.0,"
None
",Resolved,Fixed,3.19.0,Jiri Ondrusek,Jiri Ondrusek,0,2,2022-08-11 08:25:32+00:00,2022-08-27 05:03:01+00:00,"One of the ways of execution of sql via `google-bigquery` component is to pass values in header. Header values are passed into the sql request. Unfortunately each object is converted to String in this line


 


It would be nice, if the component could keep several types based on the type of the value  (like numeric, boolean)","davsclaus:1660619231:2022-08-16T11:07:11.726+0000:1660619231:2022-08-16T11:07:11.726+0000:Yes we should use the value as-is for the types that the google support as you suggest. A PR is much welcome
jondruse:1661395809:2022-08-25T10:50:09.704+0000:1661395809:2022-08-25T10:50:09.704+0000:Hi [~davsclaus] , as I'm thinking about it, I see one problem. If I change the detection to use different types (not only String), it will break back-compatibility.

 

Any user who is using current implementation would need to revisit scheme , potentially convert existing data.

 

I can imagine a solution with a configuration property (something like _dynamicSqlTypeDetetection_ with default value false) which enables to switch on this new feature. What do you think?
davsclaus:1661396046:2022-08-25T10:54:06.949+0000:1661396046:2022-08-25T10:54:06.949+0000:No its fine to do this change and document the change in the 3.19 upgrade guide.
jondruse:1661396208:2022-08-25T10:56:48.195+0000:1661396208:2022-08-25T10:56:48.195+0000:ok, thanks"
0,CAMEL-18381,Improvement,Major,None,4.x,"
None
",Open,Unresolved,4.x,Otavio Rodolfo Piske,Otavio Rodolfo Piske,0,1,2022-08-11 08:02:50+00:00,2023-09-23 11:40:26+00:00,Add support for more singleton services in test infra.,
0,CAMEL-18350,Bug,Minor,3.18.0,"3.14.6, 3.18.3, 3.20.0","
None
",Resolved,Fixed,"3.14.6, 3.18.3, 3.20.0",Karen Lease,Espen Andreassen,0,3,2022-08-04 13:04:41+00:00,2023-11-07 10:08:05+00:00,"Reproducing:



Configure camel kafka consumer with with ""breakOnFirstError"" = ""true""
Produce a series of records to kafka record consumed by application
Ensure offset is commited
Produce more records
Trigger an error when processing one of the records



Expected behavior:



Application should only reconsume records after the last committed offset



Actual behavior:



Application reconsumes all records on topic



Whether the erroneous behavior is triggered seem to be dependent on the offset the failing exchange has internally in the series of records in the poll. 


 


I've created a project on github with a failing test that reproduces the issue: https://github.com/espeandr/camel-kafka-incorrectly-reconsumes-entire-topic-demo. I haven't been able to find a pattern to which ""message offset"" in the poll causes the error. In the test I've reproduced the error by forcing a max poll size as this simplifies the test setup. The issue is also reproducible without overriding maxPollSize.


I suspect that offset = 0 is committed when breaking out in the erroneous cases.","eandre:1664242048:2022-09-27T09:27:28.439+0000:1664242048:2022-09-27T09:27:28.439+0000:I think this bug is somewhat critical. It renders the only technique I know of for approximating ""exactly once"" useless. As stated in the description, it will cause redelivery of all records on topics in case of an error, which probably is pretty critical for users who have applied an exactly once technique.

Here is a post on stackoverflow demonstrating that this technique probably is used by more than me:
[https://stackoverflow.com/questions/61621755/how-to-implement-exactly-once-kafka-consumer-using-apache-kafka]
davsclaus:1664319279:2022-09-28T06:54:39.709+0000:1664319279:2022-09-28T06:54:39.709+0000:thanks for the test case, you are welcome to try to find a fix and send a PR. What happens if you set maxPollRecords to > 1 ?
eandre:1664326397:2022-09-28T08:53:17.953+0000:1664326397:2022-09-28T08:53:17.953+0000:Just had an incident where this error occurred in a running application. We first tried increasing the ""maxPollRecords"" and then enabling autocomit, but the application still went back to the earliest offset each time an error occurred. I suspect that ""breakOnFirstError"" = ""true"" is all that is needed to trigger this behavior.

I'll see if I'm able to update the test case to reproduce this behavior and confirm my suspicion.
eandre:1664337570:2022-09-28T11:59:30.482+0000:1664337570:2022-09-28T11:59:30.482+0000:I've confirmed my suspicion. breakOnFirstError = true may cause this on its own. However, it also seems to be dependent on which offset in the series of polled records the error occurs. I've updated the issue title, description, and test to clarify.
klease78:1664341606:2022-09-28T13:06:46.483+0000:1664343142:2022-09-28T13:32:22.007+0000:I started to look into it and it appears that setting the autoCommit to false is forcing Camel to use a no-op commit manager (which is *not* what is written in the documentation) so in fact the offset is not correctly preserved:
{code:java}
2022-09-27 23:33:48.308 DEBUG   --- [mer[test_topic]] o.a.c.c.kafka.consumer.CommitManagers    : Allowing manual commit management
2022-09-27 23:33:48.308 DEBUG   --- [mer[test_topic]] o.a.c.c.kafka.consumer.CommitManagers    : Using an NO-OP commit manager for manual commit management{code}
So I tried explicitly setting a commit manager, like so:
{code:java}
.advanced()
 .kafkaManualCommitFactory(new org.apache.camel.component.kafka.consumer.DefaultKafkaManualCommitFactory())
{code}
After this it doesn't reconsume the messages before the failing one, but it seems only to consume the one after the failure. That's when using maxPollRecords(1). Without that, the test works, becaue the logs show that it is then seeking to offset 3 after the error and not -1.

So there is something strange with the offset handling, as you found  too.
eandre:1664342150:2022-09-28T13:15:50.365+0000:1664342198:2022-09-28T13:16:38.390+0000:Seems like you're onto somthing. To clarify, this happens regardless of autoCommit true or false. In my test case autoCommit is true/default (I updated this earlier today).
klease78:1664347907:2022-09-28T14:51:47.207+0000:1664347907:2022-09-28T14:51:47.207+0000:The problem is related to the number of messages polled at one time. In fact, the offset of the ""lastResult"" is always set to -1 on the first message in a batch of polled messages. If the error occurs on this message, then the offset for restarting is set to -1 which causes all messages to be reread.

As you observed in your test, using 1, 2 or 4 as the polling size will cause the fifth message to be the first in a set of polled message which causes the incorrect behavior.

As I'm not familiar with camel-kafka, I don't yet have a suggestion for setting the correct offset for ""lastResult"" in the method KafkaRecordProcessorFacade.processPolledRecords().
klease78:1664350852:2022-09-28T15:40:52.549+0000:1664350852:2022-09-28T15:40:52.549+0000:I proposed a solution which makes your test work and doesn't break any others; let's see what the team thinks.
eandre:1664403422:2022-09-29T06:17:02.779+0000:1664403422:2022-09-29T06:17:02.779+0000:Great, thank you! Hoping the fix is included in next release"
0,CAMEL-18349,Test,Minor,3.19.0,"3.18.1, 3.19.0","
None
",Resolved,Fixed,"3.18.1, 3.19.0",Jiri Ondrusek,Jiri Ondrusek,0,1,2022-08-04 12:04:29+00:00,2022-08-05 06:54:48+00:00,"In java 11.0.15, there is a security limitation for  ""the number of operators an XPath expression can contain. (see release notes) with default value 100.


Unfortunately the test XPathRouteConcurrentBigTest requires 101




Caused by: javax.xml.transform.TransformerException: JAXP0801002: the compiler encountered an XPath expression containing '101' operators that exceeds the '100' limit set by 'FEATURE_SECURE_PROCESSING'.




Solution would be to change a test little bit, to require <= 100 operations.",
0,CAMEL-18348,Improvement,Major,None,3.19.0,"
None
",Resolved,Fixed,3.19.0,Claus Ibsen,Claus Ibsen,0,1,2022-08-04 11:40:41+00:00,2022-08-04 11:48:24+00:00,Route templates can be named just `template` which is too generic name. They are named `routeTemplate` in the model and therefore we should align yaml-dsl to use this term also.,
0,CAMEL-18347,Bug,Major,"3.18.0, 3.19.0","3.18.2, 3.19.0","
None
",Resolved,Fixed,"3.18.2, 3.19.0",Otavio Rodolfo Piske,Otavio Rodolfo Piske,0,1,2022-08-04 09:22:09+00:00,2022-08-05 13:16:07+00:00,"Despite being advertised as singleton, the test infra still create multiple instances of the services. This can slow down test execution and use more resources than necessary.",orpiske:1659676567:2022-08-05T13:16:07.741+0000:1659676567:2022-08-05T13:16:07.741+0000:Fixed with the linked PRs.
0,CAMEL-18346,Task,Minor,None,"3.18.3, 3.19.0","
None
",Resolved,Fixed,"3.18.3, 3.19.0",Thomas Cunningham,PJ Fanning,0,3,2022-08-04 08:41:30+00:00,2022-10-05 11:31:46+00:00,"Xalan-J has an unfixed CVE. It is possible that this will be fixed in the future but Xalan-J has had only one release since 2008 (in 2014).


https://www.cvedetails.com/cve/CVE-2022-34169/


Java has built-in support for TransformerFactory and XPathFactory. This means most apps that use Xalan-J can readily switch away. Saxon-HE is another well maintained alternative.


Places where Camel still uses Xalan:



https://github.com/apache/camel/blob/9d6ad653b6faa16e3c09047da66cd3bca94783ee/components/camel-xmlsecurity/pom.xml
https://github.com/apache/camel/blob/9d6ad653b6faa16e3c09047da66cd3bca94783ee/tooling/maven/camel-eip-documentation-enricher-maven-plugin/pom.xml#L73



There are profiles for testing in a number of poms:
eg https://github.com/apache/camel/blob/main/core/camel-core-engine/pom.xml#L325","davsclaus:1659573927:2022-08-04T08:45:27.258+0000:1659573927:2022-08-04T08:45:27.258+0000:That is a profile that is never used, but allow to test with xalan. We test with woodstock by default as you can see further below.
davsclaus:1659573962:2022-08-04T08:46:02.835+0000:1659573962:2022-08-04T08:46:02.835+0000:You are welcome to send a PR that removes that profile
tcunning:1661941122:2022-08-31T18:18:42.723+0000:1661941122:2022-08-31T18:18:42.723+0000:https://github.com/apache/camel/pull/8247
davsclaus:1661943274:2022-08-31T18:54:34.123+0000:1661943274:2022-08-31T18:54:34.123+0000:[~tcunning] if you do git grep xalan you can find more stuff that potentially can be removed or improved.
tcunning:1661968872:2022-09-01T02:01:12.411+0000:1661968896:2022-09-01T02:01:36.238+0000:There's a number of dependency exclusions that probably need to stay, but I'll submit a PR to remove the couple instances of things like if (instanceof <xalan-class>) { code tomorrow
tcunning:1662023870:2022-09-01T17:17:50.002+0000:1662023870:2022-09-01T17:17:50.002+0000:https://github.com/apache/camel/pull/8254
tcunning:1662025346:2022-09-01T17:42:26.154+0000:1662025346:2022-09-01T17:42:26.154+0000:*Remaining xalan references after PR above* : 

camel-atom, camel-fop, camel-spring-ws : all dependency exclusions, still needed

XMLConverter.java, XMLConverterHelper.java : I think these are the JDK classes (com.sun.org.apache.xalan.internal) - I think these still apply.
{code:java}
components/camel-atom/pom.xml:                    <artifactId>xalan</artifactId>
components/camel-atom/pom.xml:                    <groupId>xalan</groupId>
components/camel-atom/pom.xml:                    <artifactId>xalan</artifactId>
components/camel-atom/pom.xml:                    <groupId>xalan</groupId>
components/camel-fop/pom.xml:                <!-- exclude the dependency of xalan to fix CAMEL-7737 -->
components/camel-fop/pom.xml:                    <groupId>xalan</groupId>
components/camel-fop/pom.xml:                    <artifactId>xalan</artifactId>
components/camel-spring-ws/pom.xml:                    <groupId>xalan</groupId>
components/camel-spring-ws/pom.xml:                    <artifactId>xalan</artifactId>
components/camel-xmlsecurity/src/main/java/org/apache/camel/component/xmlsecurity/api/XmlSignatureHelper.java:        // previously we used javax.xml.transform.Transformer, however the JDK xalan implementation did not work correctly with a specified encoding
components/camel-xslt-saxon/src/main/java/org/apache/camel/component/xslt/saxon/XsltSaxonBuilder.java:            //   (see com.sun.org.apache.xalan.internal.xsltc.trax.StAXStream2SAX).
components/camel-xslt-saxon/src/test/resources/org/apache/camel/component/xslt/transform_text.xsl: xmlns:date=""http://xml.apache.org/xalan/java/java.util.Date""
components/camel-xslt-saxon/src/test/resources/org/apache/camel/component/xslt/transform_text.xsl: xmlns:rt=""http://xml.apache.org/xalan/java/java.lang.Runtime""
components/camel-xslt-saxon/src/test/resources/org/apache/camel/component/xslt/transform_text.xsl: xmlns:str=""http://xml.apache.org/xalan/java/java.lang.String""
core/camel-core/src/test/resources/org/apache/camel/component/xslt/transformCallEcho.xsl:  xmlns:echo=""xalan://org.apache.camel.component.xslt.MyEcho""
core/camel-core/src/test/resources/org/apache/camel/component/xslt/transform_text.xsl:                xmlns:date=""http://xml.apache.org/xalan/java/java.util.Date""
core/camel-core/src/test/resources/org/apache/camel/component/xslt/transform_text.xsl:                xmlns:rt=""http://xml.apache.org/xalan/java/java.lang.Runtime""
core/camel-xml-jaxp/src/main/java/org/apache/camel/converter/jaxp/XmlConverter.java:            = ""com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl"";
core/camel-xml-jaxp/src/main/java/org/apache/camel/support/builder/xml/XMLConverterHelper.java:            = ""com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl"";
❯ {code}
 
davsclaus:1663026844:2022-09-13T07:54:04.088+0000:1663026844:2022-09-13T07:54:04.088+0000:Okay so I think this is as-far we can take this."
0,CAMEL-18345,Improvement,Major,3.3.0,"3.18.1, 3.19.0","
None
",Resolved,Fixed,"3.18.1, 3.19.0",Claus Ibsen,José Bustamante,0,2,2022-08-04 08:33:53+00:00,2022-08-08 07:27:34+00:00,"Jackson 2.12.x changed the default for the 'EMPTY_ELEMENT_AS_NULL' feature from true to false (see [here|https://github.com/FasterXML/jackson-dataformat-xml/issues/411]) and we can enable back this property using XMLMapper:


xmlMapper.configure(FromXmlParser.Feature.EMPTY_ELEMENT_AS_NULL, true);


However, there's no way to enable this behaviour in jaxonxml inside camel routes. In the documentation It's specified that we can enable or disable certain types of properties that are inside SerializationFeature, DeserializationFeature and MapperFeature but there's no way to enable EMPTY_ELEMENT_AS_NULL since is in another enum (FromXmlParser). We've tried enabling the feature ACCEPT_EMPTY_STRING_AS_NULL_OBJECT but that doesn't work either.


We've managed to implement a workaround by using <bean> instead of <jacksonxml> in our camel routes (we use Camel XML DSL), but that's not efficient as we would have to replace all <jacksonxml> references. So we need to have the possibility to enable back EMPTY_ELEMENT_AS_NULL from <jacksonxml> in camel XML DSL.","davsclaus:1659573749:2022-08-04T08:42:29.563+0000:1659573749:2022-08-04T08:42:29.563+0000:You are using a very old Camel version. Try with latest release also.
wayqui:1659577730:2022-08-04T09:48:50.110+0000:1659578177:2022-08-04T09:56:17.649+0000:Thanks for your reply. I  just tested with latest camel (3.18.0) and the latest jackson-dataformat-xml (2.13.3) and I'm having the same issue. I've created a basic project with the latest camel 3 and I've implemented a small unit test.

If I use this 
{quote}from(""direct:start"").unmarshal().jacksonXml(Header.class, true)
{quote}
I'm getting the empty object transformed (the difference in blue)

!image-2022-08-04-11-41-09-007.png|width=787,height=72!

But if I create a custom XMLMapper with the property manually enabled 
{quote}.unmarshal(createCustomJacksonXMLDataformat(Header.class))
{quote}
{{The property manually enabled (in bold)}}

_private JacksonXMLDataFormat createCustomJacksonXMLDataformat(Class<?> type){_      

      _JacksonXMLDataFormat dataFormat = new JacksonXMLDataFormat();_      

      _XmlMapper xmlMapper = new XmlMapper();_

      _*xmlMapper.configure(FromXmlParser.Feature.EMPTY_ELEMENT_AS_NULL, true);*_     

      _xmlMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);_    

      _dataFormat.setXmlMapper(xmlMapper);      dataFormat.setUnmarshalType(type);_    

      _return dataFormat;_ 

_}_

It works.

!image-2022-08-04-11-48-11-568.png|width=967,height=116!

What we need is to use jacksonXml with some configuration in order to enable this feature in our XML DSL routes, instead of creating the custom JacksonXMLDataformat with XMLMapper. In our project we use XML DLS so implementing this is more complex than doing it with Java DSL.

Thanks in  advnace for your help
davsclaus:1659596021:2022-08-04T14:53:41.651+0000:1659596021:2022-08-04T14:53:41.651+0000:You can now set those xml parser features as well the same way as the others.
wayqui:1659914854:2022-08-08T07:27:34.445+0000:1659914854:2022-08-08T07:27:34.445+0000:Thank you very much, [~davsclaus]!"
0,CAMEL-18344,Dependency upgrade,Minor,None,"3.18.2, 3.19.0","
None
",Resolved,Fixed,"3.18.2, 3.19.0",Nicolas Filotto,Denis Sergent,0,2,2022-08-04 08:18:05+00:00,2022-09-04 11:32:23+00:00,"There is no ""camel-google-pubsub"" and ""camel-grpc"" karaf features available anymore with Camel 3. It would be nice to have OSGi-ready features back for this version.


cc xldai","nfilotto:1660282466:2022-08-12T13:34:26.118+0000:1660282466:2022-08-12T13:34:26.118+0000:The PR in camel project https://github.com/apache/camel/pull/8157
nfilotto:1660283105:2022-08-12T13:45:05.539+0000:1660283105:2022-08-12T13:45:05.539+0000:The PR in camel-karaf project https://github.com/apache/camel-karaf/pull/180
nfilotto:1660720206:2022-08-17T15:10:06.853+0000:1660720206:2022-08-17T15:10:06.853+0000:The PR in camel project [https://github.com/apache/camel/pull/8167] (backport for 3.18)"
0,CAMEL-18343,Improvement,Major,3.18.0,"3.18.1, 3.19.0","
None
",Resolved,Fixed,"3.18.1, 3.19.0",Claus Ibsen,Claus Ibsen,0,1,2022-08-03 14:56:32+00:00,2022-08-03 14:59:58+00:00,So you can configure a custom route policy in yaml-dsl,
0,CAMEL-18342,New Feature,Major,None,4.x,"
None
",Resolved,Won't Fix,4.x,Unassigned,Claus Ibsen,0,2,2022-08-03 10:23:38+00:00,2023-11-15 14:33:42+00:00,"Either we add a special language for calling and endpoint, so you can use DSL today


<setHeader name=""foo"">
  <to uri=""xxxx""/>
 </setHeader 


However the name cannot be to as its already taken as a normal EIP. 


Or we could have a new EIP


<toHeader name=""foo"" uri=""xxx""/>


And the dynamic variant


<toDHeader name=""foo"" uri=""xxx?a=${header.bar}""/>


And we may need for exchange properties as well (that would mean 4 new EIPs in the model).","tanyu:1695507662:2023-09-24T06:21:02.633+0000:1695507662:2023-09-24T06:21:02.633+0000:Hi, Claus. My understanding is after calling the downstream endpoint, we should set the response to the exchange's header,right?
davsclaus:1695683455:2023-09-26T07:10:55.381+0000:1695683455:2023-09-26T07:10:55.381+0000:Yes but, this needs a bit more thought, as adding more EIPs is a bit more complex to do correct across all DSL implementations.
davsclaus:1700030022:2023-11-15T14:33:42.611+0000:1700030022:2023-11-15T14:33:42.611+0000:We should use variables instead"
0,CAMEL-18341,Dependency upgrade,Minor,3.18.0,None,"
None
",Resolved,Fixed,4.0.0,Nicolas Filotto,Aurélien Pupier,0,2,2022-08-03 09:55:36+00:00,2023-05-23 07:57:59+00:00,"Groovy 4.0.0 has been released at the beginning of 2022. it might be nice to move to the latest version.


There is a long list of features and bug fixes http://groovy-lang.org/changelogs/changelog-4.0.0.html


Maybe worth noticing it contains several fixes related to Java 17:



GROOVY-10391 - Default interface methods causing problems with java 17 and groovy 3.0.9
GROOVY-10405 - @AutoClone breaks in Java17 for File properties
GROOVY-10429 - StringBuilder misses setLength method in Java17



Based on https://groovy.apache.org/versioning.html 3.x will have oen or two bugfixxes release (in fact already 3 happened). So good chances that there will be only security release of 3.x soon.","davsclaus:1659492198:2022-08-03T10:03:18.224+0000:1659492198:2022-08-03T10:03:18.224+0000:spring boot / quarkus / needs to be upgraded to groovy 4.x as well.
apupier:1659586947:2022-08-04T12:22:27.061+0000:1659586947:2022-08-04T12:22:27.061+0000:it sounds that for Spring Boot it is better to wait Groovy upgrade in Spring Boot; Which is [done in 3.0.0-Mx|https://github.com/spring-projects/spring-boot/issues/31631]. The 3.0.0 is planned for [end of November|[https://github.com/spring-projects/spring-boot/milestone/240]].

For Quarkus, it seems that we should be able to nopt be aligned based [https://github.com/quarkusio/quarkus/issues/27111#issuecomment-1203974521] Quarkus is not planning to upgrade to Groovy 4.x due to performance regression  https://issues.apache.org/jira/browse/GROOVY-10307 "
0,CAMEL-18340,New Feature,Minor,None,None,"
None
",Resolved,Won't Fix,None,Unassigned,WangYan,0,2,2022-08-03 07:44:00+00:00,2022-08-03 08:01:42+00:00,"Hello Camel Riders


I am using many integrations between SAP ABAP  <->Camel/JAVA during my daily work


Therefore I want to implement camel-sapjcoserver  component (consumer only) which can recieve  SAP ABAP calls result and wrap it as exchange for next step","Y.W:1659483927:2022-08-03T07:45:27.587+0000:1659483927:2022-08-03T07:45:27.587+0000:Please assign the task to me, it seems i am not able to do that by myself :)
acosentino:1659484896:2022-08-03T08:01:36.455+0000:1659484896:2022-08-03T08:01:36.455+0000:It's not possible to add a component based on SAP libraries, they are not compatible with ASF license. The examples are different because we are not releasing them, so we could eventually add a provided dependency, but for released artifacts we cannot do it. So this cannot be done or assigned. If you want to work on 3rd party component with particular licenses you need to look at camel-extras https://github.com/camel-extra/camel-extra"
0,CAMEL-18339,Improvement,Major,None,"3.18.1, 3.19.0","
None
",Resolved,Fixed,"3.18.1, 3.19.0",Claus Ibsen,Claus Ibsen,0,1,2022-08-03 06:44:18+00:00,2022-08-03 10:01:48+00:00,"See CAMEL-18336


We can maybe for custom classes (not routes) let them be loadable via a special classloader that we then share on CamelContext and its class resolver, so that it can load these classes.


Otherwise you need to use BindToRegistry to share the class via bean ids.",
0,CAMEL-18338,Bug,Major,3.18.0,"3.18.1, 3.19.0","
None
",Resolved,Fixed,"3.18.1, 3.19.0",Claus Ibsen,Florian Fiby,0,2,2022-08-03 06:34:02+00:00,2022-08-08 08:09:48+00:00,"2022-08-03 02:57:31.059  WARN 1 — [Camel (ValuemationCustomerMailboxApplication) thread #7 - imaps://outlook.office365.com:993] o.a.camel.component.mail.MailConsumer    : Error opening mail folder due to GSI5 BAD User is authenticated but not connected.. Will re-create connection on next poll


This leads to disconnect(). disconnect sets folder to null, which leads to NullPointerExceptions afterwards:


2022-08-03 02:57:31.073 ERROR 1 — [Camel (ValuemationCustomerMailboxApplication) thread #7 - imaps://outlook.office365.com:993] o.a.c.p.e.DefaultErrorHandler            : Failed delivery for (MessageId: 61974526595AC2A-0000000000000006 on ExchangeId: 61974526595AC2A-0000000000000006). Exhausted after delivery attempt: 0 caught: null
Message History (source location and message history is disabled)---------------------------------------------------------------------------------------------------------------------------------------Source                                   ID                             Processor                                          Elapsed (ms)                                         Custom:XXX. from[imaps://outlook.office365.com:993?bridgeError            3        ...                                         Escalation Route/setHeader1    setHeader[EscalationSender]                               0
Stacktrace---------------------------------------------------------------------------------------------------------------------------------------
java.lang.NullPointerException: null        at org.apache.camel.component.mail.MailConsumer.poll(MailConsumer.java:162) ~[camel-mail-3.18.0.jar!/:3.18.0]        at org.apache.camel.support.ScheduledPollConsumer.doRun(ScheduledPollConsumer.java:202) ~[camel-support-3.18.0.jar!/:3.18.0]        at org.apache.camel.support.ScheduledPollConsumer.run(ScheduledPollConsumer.java:116) ~[camel-support-3.18.0.jar!/:3.18.0]        at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515) ~[na:na]        at java.base/java.util.concurrent.FutureTask.runAndReset(FutureTask.java:305) ~[na:na]        at java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305) ~[na:na]        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) ~[na:na]        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) ~[na:na]        at java.base/java.lang.Thread.run(Thread.java:829) ~[na:na]
2022-08-03 02:57:31.074 ERROR 1 — [Camel (ValuemationCustomerMailboxApplication) thread #7 - imaps://outlook.office365.com:993] o.a.c.p.FatalFallbackErrorHandler        : Exception occurred while trying to handle previously thrown exception on exchangeId: 61974526595AC2A-0000000000000006 using: [null].


 


2022-08-03 02:57:31.081 ERROR 1 — [Camel (ValuemationCustomerMailboxApplication) thread #7 - imaps://outlook.office365.com:993] o.a.c.p.e.DefaultErrorHandler            : Failed delivery for (MessageId: 61974526595AC2A-0000000000000007 on ExchangeId: 61974526595AC2A-0000000000000007). Exhausted after delivery attempt: 1 caught: java.lang.NullPointerException. Processed by failure processor: FatalFallbackErrorHandler[null]
Message History (source location and message history is disabled)---------------------------------------------------------------------------------------------------------------------------------------Source                                   ID                             Processor                                          Elapsed (ms)                                         Custom:TTITSupport@forstinger. from[imaps://outlook.office365.com:993?bridgeError            3
Stacktrace---------------------------------------------------------------------------------------------------------------------------------------
java.lang.NullPointerException: null        at org.apache.camel.component.mail.MailConsumer.poll(MailConsumer.java:189) ~[camel-mail-3.18.0.jar!/:3.18.0]        at org.apache.camel.support.ScheduledPollConsumer.doRun(ScheduledPollConsumer.java:202) ~[camel-support-3.18.0.jar!/:3.18.0]        at org.apache.camel.support.ScheduledPollConsumer.run(ScheduledPollConsumer.java:116) ~[camel-support-3.18.0.jar!/:3.18.0]        at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515) ~[na:na]        at java.base/java.util.concurrent.FutureTask.runAndReset(FutureTask.java:305) ~[na:na]        at java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305) ~[na:na]        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) ~[na:na]        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) ~[na:na]        at java.base/java.lang.Thread.run(Thread.java:829) ~[na:na]","fibyflo:1659480322:2022-08-03T06:45:22.547+0000:1659480322:2022-08-03T06:45:22.547+0000:[~davsclaus] issue is related with commit e02cb28f4b797561ce2b7580206ca26037dd86a7.

After disconnect folder is null and polling is done anyway which leads to NullPointerException.

I'm not sure whether the intention was to re-create the connection in this catch or to exit poll and reopen connection with next poll (comment vs logging).

{{        try {}}
{{            if (!folder.isOpen()) {}}
{{                folder.open(Folder.READ_WRITE);}}
{{            }}}
{{        } catch (MessagingException e) {}}
{{            // some kind of connectivity error, so lets re-create connection}}
{{            String msg = ""Error opening mail folder due to "" + e.getMessage() + "". Will re-create connection on next poll."";}}
{{            LOG.warn(msg);}}
{{            if (LOG.isDebugEnabled()) {}}
{{                LOG.debug(msg, e);}}
{{            }}}
{{            disconnect();}}
{{        }}}
davsclaus:1659480326:2022-08-03T06:45:26.117+0000:1659480326:2022-08-03T06:45:26.117+0000:Are you working on a fix as a PR ?
fibyflo:1659484830:2022-08-03T08:00:30.895+0000:1659484830:2022-08-03T08:00:30.895+0000:No, I'm not having enough knowledge about the camel architecture
davsclaus:1659492774:2022-08-03T10:12:54.867+0000:1659492774:2022-08-03T10:12:54.867+0000:Thanks for reporting
fibyflo:1659916539:2022-08-08T07:55:39.269+0000:1659916539:2022-08-08T07:55:39.269+0000:Is there a release date for 3.18.1?
davsclaus:1659917388:2022-08-08T08:09:48.243+0000:1659917388:2022-08-08T08:09:48.243+0000:its on VOTE so end of this week / start of next"
0,CAMEL-18337,Improvement,Major,None,None,"
None
",Resolved,Fixed,3.19.0,Thomas Diesler,Thomas Diesler,0,1,2022-08-02 19:47:50+00:00,2022-08-03 07:59:31+00:00,No Desc,"tdiesler:1659441700:2022-08-02T20:01:40.490+0000:1659441700:2022-08-02T20:01:40.490+0000:PR: https://github.com/apache/camel/pull/8099
tdiesler:1659484771:2022-08-03T07:59:31.634+0000:1659484771:2022-08-03T07:59:31.634+0000:Done"
0,CAMEL-18336,Bug,Minor,3.18.0,"3.18.1, 3.19.0","
None
",Resolved,Information Provided,"3.18.1, 3.19.0",Claus Ibsen,Darren Coleman,0,2,2022-08-02 14:50:27+00:00,2022-08-03 09:47:20+00:00,"When running a YAML route using camel-jbang, it fails to find the class for a Java bean in the same directory. However, the equivalent route written in Java DSL runs the route without errors.


The attached tarball contains a simple bean and equivalent routes in Java and YAML.


To see the failures, run the YAML route:




$ camel run HelloBean.java hello.yaml
java.lang.RuntimeException: java.lang.ClassNotFoundException: HelloBean
	at org.apache.camel.dsl.yaml.deserializers.BeansDeserializer$1.configure(BeansDeserializer.java:67)
	at org.apache.camel.dsl.yaml.common.YamlSupport$1.configure(YamlSupport.java:121)
	at org.apache.camel.dsl.yaml.YamlRoutesBuilderLoader$1.doConfigure(YamlRoutesBuilderLoader.java:166)
	at org.apache.camel.dsl.yaml.YamlRoutesBuilderLoader$1.configure(YamlRoutesBuilderLoader.java:140)
	at org.apache.camel.builder.RouteBuilder.checkInitialized(RouteBuilder.java:672)
	at org.apache.camel.builder.RouteBuilder.configureRoutes(RouteBuilder.java:618)
	at org.apache.camel.builder.RouteBuilder.addRoutesToCamelContext(RouteBuilder.java:554)
	at org.apache.camel.impl.engine.AbstractCamelContext.addRoutes(AbstractCamelContext.java:1178)
	at org.apache.camel.main.RoutesConfigurer.addDiscoveredRoutes(RoutesConfigurer.java:237)
	at org.apache.camel.main.RoutesConfigurer.configureRoutes(RoutesConfigurer.java:212)
	at org.apache.camel.main.BaseMainSupport.configureRoutes(BaseMainSupport.java:582)
	at org.apache.camel.main.BaseMainSupport.postProcessCamelContext(BaseMainSupport.java:637)
	at org.apache.camel.main.MainSupport.initCamelContext(MainSupport.java:403)
	at org.apache.camel.main.KameletMain.doInit(KameletMain.java:227)
	at org.apache.camel.support.service.BaseService.init(BaseService.java:83)
	at org.apache.camel.support.service.BaseService.start(BaseService.java:111)
	at org.apache.camel.dsl.jbang.core.commands.Run.run(Run.java:560)
	at org.apache.camel.dsl.jbang.core.commands.Run.call(Run.java:199)
	at org.apache.camel.dsl.jbang.core.commands.Run.call(Run.java:72)
	at picocli.CommandLine.executeUserObject(CommandLine.java:1953)
	at picocli.CommandLine.access$1300(CommandLine.java:145)
	at picocli.CommandLine$RunLast.executeUserObjectOfLastSubcommandWithSameParent(CommandLine.java:2358)
	at picocli.CommandLine$RunLast.handle(CommandLine.java:2352)
	at picocli.CommandLine$RunLast.handle(CommandLine.java:2314)
	at picocli.CommandLine$AbstractParseResultHandler.execute(CommandLine.java:2179)
	at picocli.CommandLine$RunLast.execute(CommandLine.java:2316)
	at picocli.CommandLine.execute(CommandLine.java:2078)
	at org.apache.camel.dsl.jbang.core.commands.CamelJBangMain.run(CamelJBangMain.java:51)
	at main.CamelJBang.main(CamelJBang.java:37)
Caused by: java.lang.ClassNotFoundException: HelloBean
	at org.apache.camel.impl.engine.DefaultClassResolver.resolveMandatoryClass(DefaultClassResolver.java:87)
	at org.apache.camel.support.PropertyBindingSupport.resolveBean(PropertyBindingSupport.java:1519)
	at org.apache.camel.dsl.yaml.deserializers.NamedBeanDefinition.newInstance(NamedBeanDefinition.java:64)
	at org.apache.camel.dsl.yaml.deserializers.BeansDeserializer$1.configure(BeansDeserializer.java:65)
	... 28 more




However, the Java route runs without errors:




$ camel run HelloBean.java HelloRoute.javaJ","davsclaus:1659475554:2022-08-03T05:25:54.529+0000:1659475554:2022-08-03T05:25:54.529+0000:For beans you need to bind them to the registry to be shared and available in Camel

{code}
@org.apache.camel.BindToRegistry(""helloBean"")
public class HelloBean {

    public String greeting() {
	return ""Hello!"";
    }
}
{code}

Then you can use it from other DSLs such as yaml

{code}
# camel-k: language=yaml

# Write your routes here, for example:
- from:
    uri: ""timer:yaml""
    parameters:
      period: ""1000""
    steps:
      - bean: ""helloBean""
      - log: ""${body}""
{code}
davsclaus:1659476051:2022-08-03T05:34:11.862+0000:1659476051:2022-08-03T05:34:11.862+0000:I updated the camel-jbang documentation about this
davsclaus:1659491240:2022-08-03T09:47:20.368+0000:1659491240:2022-08-03T09:47:20.368+0000:I found a way to improve camel joor (java dsl) to make classloading available outside as well, so your example runs OOTB in next releases
https://issues.apache.org/jira/browse/CAMEL-18339"
0,CAMEL-18335,New Feature,Major,None,,"
None
",Open,Unresolved,None,Unassigned,Claus Ibsen,0,1,2022-08-02 08:08:09+00:00,2023-07-17 10:54:18+00:00,"We have the --open-api operation today that can take a open-api spec and generate camel routes templates for this.


We need something similar for WS SOAP, where you have a wsdl file, and want to expose this as a service and let Camel routes service each SOAP operation.


For starters we can use RAW/PAYLOAD mode where data are in XML. Later we can look at if we can generate POJO classes via the apache cxf maven plugin.",
0,CAMEL-18334,Improvement,Minor,None,Future,"
None
",Open,Unresolved,Future,Unassigned,Claus Ibsen,0,1,2022-08-02 07:52:54+00:00,2023-08-09 09:06:10+00:00,"With camel-cxf split into smaller JARs then we can look at if we can do a platform-http adapter for CXF HTTP Transport, so we can use what comes from the runtime platform such as vertx-http when using quarkus / jbang / camel-k.",
0,CAMEL-18333,Improvement,Minor,3.18.0,"3.18.1, 3.19.0","
None
",Resolved,Fixed,"3.18.1, 3.19.0",Unassigned,Rinaldo Pitzer Júnior,0,1,2022-08-01 18:01:43+00:00,2022-08-03 04:20:55+00:00,"The message from the root exception is currently not added to the Health Check, which results in errors like ""KafkaConsumer is not ready"" without any more additional information.


We could extract the message from the root cause, which includes details on why the KafkaConsumer is not ready, like an unreachable bootstrap url, or an invalid port number.


Also, in cases where pollExceptionStrategy was not able to be set, a NPE is thrown during the health check, which results in a bad message.",
0,CAMEL-18332,Dependency upgrade,Major,None,None,"
None
",Resolved,Fixed,3.19.0,Thomas Diesler,Thomas Diesler,0,1,2022-08-01 15:19:41+00:00,2022-08-02 07:01:22+00:00,No Desc,"tdiesler:1659347140:2022-08-01T17:45:40.048+0000:1659347140:2022-08-01T17:45:40.048+0000:PR: https://github.com/apache/camel/pull/8088
tdiesler:1659394882:2022-08-02T07:01:22.250+0000:1659394882:2022-08-02T07:01:22.250+0000:Done"
0,CAMEL-18331,Bug,Minor,"3.14.4, 3.18.0, 3.19.0","3.14.5, 3.18.1, 3.19.0","
None
",Resolved,Fixed,"3.14.5, 3.18.1, 3.19.0",Luigi De Masi,Federico Mariani,0,2,2022-08-01 13:01:22+00:00,2022-08-03 05:04:34+00:00,"By declaring an endpoint inside a camel context and using it via the ref: component. 
The application attached does not run and fail with the following error:




***************************
APPLICATION FAILED TO START
***************************

Description:

The bean 'foo' could not be registered. A bean with that name has already been defined and overriding is disabled.

Action:

Consider renaming one of the beans or enabling overriding by setting spring.main.allow-bean-definition-overriding=true 



I noticed that
https://github.com/apache/camel/blob/05595854aadb81ccb408c1ca8c3c28c4dc835ec3/components/camel-spring-xml/src/main/java/org/apache/camel/spring/xml/handler/CamelNamespaceHandler.java#L748 <- adds the bean into the camel-context


and https://github.com/apache/camel/blob/05595854aadb81ccb408c1ca8c3c28c4dc835ec3/components/camel-spring-xml/src/main/java/org/apache/camel/spring/xml/handler/CamelNamespaceHandler.java#L757 <- add the bean again into the camel-context, therefore the duplicate bean",davsclaus:1659474274:2022-08-03T05:04:34.737+0000:1659474274:2022-08-03T05:04:34.737+0000:Thanks for reporting and the PR
0,CAMEL-18330,Bug,Minor,3.18.0,None,"
None
",Resolved,Cannot Reproduce,3.19.0,Unassigned,Raymond,0,2,2022-07-31 20:11:13+00:00,2022-08-04 07:36:08+00:00,"I'm not sure in how far this issue is related to (https://issues.apache.org/jira/browse/CAMEL-18328), but I report it anyway to be sure:


I have to following template:




routeTemplate(""myTemplate"")
.templateParameter(""uri"")
.templateParameter(""in"")
.templateParameter(""out"")
.from(""{{in}}"")
.to(""{{uri}}"")
.to(""{{out}}"");



I can call this template with various uri's without issues. However when using a kamelet as uri templateparameter then after that it says it can find the out parameter (though it's in the creation of the template):


 




<?xml version=""1.0"" encoding=""UTF-8""?>
<templatedRoutes xmlns=""http://camel.apache.org/schema/spring"">
   <templatedRoute routeId=""105-3"" routeTemplateRef=""myTemplate"">
      <parameter name=""uri"" value=""kamelet:delay-action?milliseconds=10000""/>
      <parameter name=""out"" value=""direct:105-4""/>
      <parameter name=""in"" value=""direct:105-3""/>
   </templatedRoute>
</templatedRoutes>
 




This is the stacktrace/error:




org.apache.camel.FailedToCreateRouteException: Failed to create route 105-3 at: >>> To[{{out}}] <<< in route: Route(105-3)[From[{{in}}] -> [To[{{uri}}], To[{{out}}]]] because of Failed to resolve endpoint: {{out}} due to: Property with key [out] not found in properties from text: {{out}}
        at org.apache.camel.reifier.RouteReifier.doCreateRoute(RouteReifier.java:240)
        at org.apache.camel.reifier.RouteReifier.createRoute(RouteReifier.java:74)
        at org.apache.camel.impl.DefaultModelReifierFactory.createRoute(DefaultModelReifierFactory.java:49)
        at org.apache.camel.impl.DefaultCamelContext.startRouteDefinitions(DefaultCamelContext.java:862)
        at org.apache.camel.impl.DefaultModel.addRouteDefinitions(DefaultModel.java:188)
        at org.apache.camel.impl.DefaultModel.addRouteDefinition(DefaultModel.java:194)
        at org.apache.camel.impl.DefaultModel.addRouteFromTemplate(DefaultModel.java:418)
        at org.apache.camel.impl.DefaultModel.addRouteFromTemplatedRoute(DefaultModel.java:684)
        at org.apache.camel.impl.DefaultCamelContext.addRouteFromTemplatedRoute(DefaultCamelContext.java:466)
        at org.apache.camel.model.Model.addRouteFromTemplatedRoutes(Model.java:241)
        at org.apache.camel.builder.RouteBuilder.populateTemplatedRoutes(RouteBuilder.java:691)
        at org.apache.camel.builder.RouteBuilder.addRoutesToCamelContext(RouteBuilder.java:562)
        at org.apache.camel.impl.engine.AbstractCamelContext.addRoutes(AbstractCamelContext.java:1178)
        at org.apache.camel.spi.RoutesLoader.loadRoutes(RoutesLoader.java:80)","davsclaus:1659569768:2022-08-04T07:36:08.911+0000:1659569768:2022-08-04T07:36:08.911+0000:We may have fixed this with other changes
https://github.com/apache/camel/commit/a5be5fdce7309391ee9727af91e2ec3f55042790"
0,CAMEL-18329,Bug,Minor,3.18.0,"3.18.1, 3.19.0","
None
",Resolved,Not A Bug,"3.18.1, 3.19.0",Claus Ibsen,Raymond,0,2,2022-07-31 13:53:54+00:00,2022-08-04 07:20:02+00:00,"I have a routetemplate:




routeTemplate(""appendtobody"")
  .templateParameter(""append"")
  .templateParameter(""in"")
  .templateParameter(""out"")
.from(""{{in}}"")
.transform(body().append(""{{append}}""))
.to(""{{out}}"");



 


I create the route from template like this:




<templatedRoutes xmlns=""http://camel.apache.org/schema/spring"">
   <templatedRoute routeId=""100-2"" routeTemplateRef=""appendtobody"">
      <parameter name=""append"" value=""appendvalue""/>
      <parameter name=""out"" value=""file://C/messages/in""/>
      <parameter name=""in"" value=""file://C/messages/out""/>
   </templatedRoute>
</templatedRoutes>



I call it with a file that contains: ""value"" in the body.


Expected output:




valueappendvalue




Actual output:




value{{append}}




Tested this scenario with 3.18.0 and 3.19.0-SNAPSHOT","davsclaus:1659568717:2022-08-04T07:18:37.449+0000:1659568738:2022-08-04T07:18:58.915+0000:You need to use an expression language to have it dynamic

{code}
.transform(simple(""${body}{{append}}""))
{code}

The body().append(xxx) works as a constant value - it would also not replace in regular Camel route (without route templates).
davsclaus:1659568802:2022-08-04T07:20:02.679+0000:1659568802:2022-08-04T07:20:02.679+0000:See
https://github.com/apache/camel/commit/e127e287a7182b8ddbfc304a379ca0fae4554819"
0,CAMEL-18328,Bug,Minor,3.18.0,"3.18.2, 3.19.0","
None
",Resolved,Fixed,"3.18.2, 3.19.0",Rhuan Rocha,Raymond,0,3,2022-07-31 11:59:40+00:00,2022-08-08 14:23:29+00:00,"I have loaded a routeConfiguration:




<routeConfiguration id=""myError"">
            <onException>
               <exception>java.lang.Exception</exception>
               <handled>
                  <constant>true</constant>
               </handled>
               <redeliveryPolicy maximumRedeliveries=""0"" redeliveryDelay=""5000""/>
               <setExchangePattern pattern=""InOnly""/>
               <to uri=""log:myError?showAll=true&amp;multiline=true""/>
            </onException>
         </routeConfiguration>



I have a RouteTemplate:




         routeTemplate(""myTemplate"")
                 .templateParameter(""in"")
                 .templateParameter(""out"")
                 .from(""{{in}}"")
                     .routeConfigurationId(""myError"")
                     .to(""{{out}}"");



But this routeConfigurationId doesn't seem to take effect. When calling the routeConfigurationId directly from a route is works.


Can you reproduce this?


BTW: What I try to achieve:




         routeTemplate(""myTemplate"")
                 .templateParameter(""routeconfiguration_id"",""defaultErrorHandler"")
                 .templateParameter(""in"")
                 .templateParameter(""out"")
                 .from(""{{in}}"")
                     .routeConfigurationId(""{{routeconfiguration_id}}"")
                     .to(""{{out}}"");



Thus adding the routeConfigurationID through a templateParameter.","davsclaus:1659242717:2022-07-31T12:45:17.111+0000:1659242717:2022-07-31T12:45:17.111+0000:I think there was a ticket about this and fixed for next release(s)
skin27:1659242742:2022-07-31T12:45:42.031+0000:1659242963:2022-07-31T12:49:23.927+0000:Some additional information:

1) I load everything (routes / routetemplates / routeconfiguration) with the roadLoader.

2) I have camel-xml-io on my classpath

3) Test parameters creating the route from template

""in"" parameter is [file://C:/messages/in|file:///C:/messages/in?autoCreate=false&directoryMustExist=true]
""out"" parameter is [file://C:/messages/directorydoesnotexist?autoCreate=false&amp;directoryMustExist=true|file:///C:/messages/directorydoesnotexist?autoCreate=false&directoryMustExist=true]

As a sidenote:

The routeConfiguration works when referencing the routeConfiguration from a normal route (not a route template). This however also only works as long as I don't have camel-xml-jaxb on my classpath (See https://issues.apache.org/jira/browse/CAMEL-17953).

Unfortunately because I need to remove the camel-xml-jaxb the route XML dumper doesn't work anymore. (See https://issues.apache.org/jira/browse/CAMEL-18305)

 
davsclaus:1659242833:2022-07-31T12:47:13.688+0000:1659242833:2022-07-31T12:47:13.688+0000:You can test and try the 3.18.1-SNAPSHOT from ASF snapshot repo
https://repository.apache.org/snapshots/
skin27:1659242862:2022-07-31T12:47:42.259+0000:1659242906:2022-07-31T12:48:26.537+0000:Nice, will it also be in the LTS release (3.18.1)? Couldn't find that, do you accidently know the ticketnumber?

 

[Edit]Thanks you were faster
davsclaus:1659242958:2022-07-31T12:49:18.111+0000:1659242958:2022-07-31T12:49:18.111+0000:Ah we have a problem with publishing 3.18.1 SNAPSHOTS so you can either build from source or try 3.19.0-SNAPSHOT.

We are working on getting 3.18.1 SNAPSHOT to be published too, but that may take a while to get sorted. There is a mail on dev mailing list about it
skin27:1659245664:2022-07-31T13:34:24.079+0000:1659245664:2022-07-31T13:34:24.079+0000:I tested it with 3.19.0-SNAPSHOT

1) I can confirm that it works when routeConfiguration is hardcoded:
{code:java}
routeTemplate(""myTemplate"")
.templateParameter(""in"")
.templateParameter(""out"")
.from(""{{in}}"")
.routeConfigurationId(""myErrorHandler"")
.to(""{{out}}"");
{code}
 

 

2) I doesn't however work from a templateParameter:
{code:java}
routeTemplate(""myTemplate"") 
   .templateParameter(""in"") 
   .templateParameter(""out"")
   .templateParameter(""myErrorHandlerID"")
   .from(""{{in}}"")
   .routeConfigurationId(""{{myErrorHandlerID}}"")
   .to(""{{out}}"");

{code}

The second use case is what I like to do, because I have several routeConfigurations and they are chosen by the user.

BTW: The same counts for ""routeId"". It doesn't work with a templateParameter. There of course you can workaround it by setting the routeId together with the templateId. I thought however that both use cases would work. (both for routeId and routeConfigurationId).
rhuanrcoha:1659246662:2022-07-31T13:51:02.293+0000:1659246662:2022-07-31T13:51:02.293+0000:Hi, I`m checking it. 
rhuanrcoha:1659248639:2022-07-31T14:23:59.544+0000:1659248639:2022-07-31T14:23:59.544+0000:Yes, I`m able to reproduce it. The Template is not translating the parameter and the RouteDefinition is created with the wrong value. I`ll work on it.
skin27:1659252980:2022-07-31T15:36:20.286+0000:1659313554:2022-08-01T08:25:54.627+0000:Nice, when it's in the 3.19.0-SNAPSHOT I will retest it.

Note: I'll be on holiday from 02/08
rhuanrcoha:1659649479:2022-08-05T05:44:39.867+0000:1659649479:2022-08-05T05:44:39.867+0000:Hi, I`ll send a PR soon. 
davsclaus:1659914499:2022-08-08T07:21:39.407+0000:1659914499:2022-08-08T07:21:39.407+0000:[~rhuanrcoha] thanks for the help I have granted your jira user karma to self assign tickets
rhuanrcoha:1659939809:2022-08-08T14:23:29.195+0000:1659939809:2022-08-08T14:23:29.195+0000:Thank you [~davsclaus] "
0,CAMEL-18327,Task,Major,3.17.0,"3.18.3, 3.20.0","
None
",Resolved,Fixed,"3.18.3, 3.20.0",Otavio Rodolfo Piske,rupam,0,2,2022-07-31 03:31:43+00:00,2022-10-19 16:26:30+00:00,"In the startPolling() method, if the consumer is suspending, then the unsubscribe method is called which permanently closes the consumer


 




    Duration pollDuration = Duration.ofMillis(pollTimeoutMs);
    while (isKafkaConsumerRunnable() && isConnected() && pollExceptionStrategy.canContinue()) {
        ConsumerRecords<Object, Object> allRecords = consumer.poll(pollDuration);
        if (consumerListener != null) {
            if (!consumerListener.afterConsume(consumer)) {
                continue;
            }
        }

        ProcessingResult result = recordProcessorFacade.processPolledRecords(allRecords);

        if (result.isBreakOnErrorHit()) {
            LOG.debug(""We hit an error ... setting flags to force reconnect"");
            // force re-connect
            setReconnect(true);
            setConnected(false);
        }

        updateTaskState();
    }

    if (!isConnected()) {
        LOG.debug(""Not reconnecting, check whether to auto-commit or not ..."");
        commitManager.commit();
    }

    safeUnsubscribe();
} catch (InterruptException e) {","geek.rupam:1659520171:2022-08-03T17:49:31.873+0000:1659520171:2022-08-03T17:49:31.873+0000:Issue is not resolved as at line number 310, isKafkaRunnable method will return false and at line number 335 safeUnsubscribe method will be called to kill the Kafka consumer
geek.rupam:1659520348:2022-08-03T17:52:28.888+0000:1659520348:2022-08-03T17:52:28.888+0000:Issue is not resolved as at line number 310, isKafkaRunnable method will return false and at line number 335 safeUnsubscribe method will be called to kill the Kafka consumer
orpiske:1659563998:2022-08-04T05:59:58.157+0000:1659563998:2022-08-04T05:59:58.157+0000:Indeed. I think that one can be removed too. I'll send a PR soon.
orpiske:1659566767:2022-08-04T06:46:07.934+0000:1659566767:2022-08-04T06:46:07.934+0000:Upon closer inspection: we cannot simply remove that one without side effects. It breaks quite a good number of test cases. 

So, let's keep that one in and let's keep this ticket open for now. I'll have to investigate more carefully about the proper way to handle this.
orpiske:1659566865:2022-08-04T06:47:45.450+0000:1659566865:2022-08-04T06:47:45.450+0000:c/c: [~davsclaus] let's keep this one open for now. There's still a few more things to do (I removed it from the Fix Version 3.18.1 as I will need to investigate more).
geek.rupam:1662579095:2022-09-08T03:31:35.469+0000:1662579095:2022-09-08T03:31:35.469+0000:The method isKafkaConsumerRunnable() in do while loop should  not  check if it is in any suspended or suspending state. That will allow the consumer to continue try polling for messages, but since the consumer has been paused, the poll will return empty messages
orpiske:1662589944:2022-09-08T06:32:24.103+0000:1662589944:2022-09-08T06:32:24.103+0000:[~geek.rupam] would you mind sending a PR with your proposed change, please?
orpiske:1662955945:2022-09-12T12:12:25.312+0000:1662955945:2022-09-12T12:12:25.312+0000:Merged and back-ported, therefore closing.
geek.rupam:1663513979:2022-09-18T23:12:59.103+0000:1663513979:2022-09-18T23:12:59.103+0000:The consumer.resume method resumes from the next available offset and doesn't attempt to send a message at the current offset
orpiske:1665179772:2022-10-08T05:56:12.901+0000:1665179772:2022-10-08T05:56:12.901+0000:We need to backport this one, so keeping it open until Monday, when I'll do it.
orpiske:1665562803:2022-10-12T16:20:03.763+0000:1665562803:2022-10-12T16:20:03.763+0000:Closing as they should have been fixed now."
0,CAMEL-18326,Improvement,Minor,3.16.0,4.0.0,"

camel-core
google

",Resolved,Fixed,4.0.0,Claus Ibsen,Jérôme GARCIA,0,2,2022-07-29 16:22:40+00:00,2023-07-26 07:17:37+00:00,"Hello,


 


In google-mail-stream component, the mail body is displayed as plain text and is not easy to manipulate the data.


The component should add the possibility to change this behavior and displayed a standardize object (JSON or other).


 




// code placeholder
from('google-mail-stream:index?' +
  'applicationName={{camel-app-name}}&' +
  'accessToken={{gmail.client.access.token}}&' +
  'refreshToken={{gmail.client.access.refresh.token}}&' +
  'clientId={{gmail.client.id}}&' +
  'query=is:unread&' +
  'clientSecret={{gmail.client.secret}}')
  .log('body: ${body}') 



 


Here is the format received by google-mail component for example:


 




// code placeholder
{
  ""historyId"": """",
  ""id"": """",
  ""internalDate"": """",
  ""labelIds"": [  ],
  ""payload"": {
    ""body"": {
      ""size"": 0
    },
    ""filename"": """",
    ""headers"": [
      {
        ""name"": """",
        ""value"": """"
      }
    ],
    ""mimeType"": """",
    ""partId"": """",
    ""parts"": [
      {
        ""body"": {
          ""data"": """",
          ""size"": 241
        },
        ""filename"": """",
        ""headers"": [
          {
            ""name"": """",
            ""value"": """"
          }
        ],
        ""mimeType"": """",
        ""partId"": """"
      },
      {
        ""body"": {
          ""data"": """",
          ""size"": 2519
        },
        ""filename"": """",
        ""headers"": [
          {
            ""name"": """",
            ""value"": """"
          }
        ],
        ""mimeType"": """",
        ""partId"": """"
      }
    ]
  },
  ""sizeEstimate"": 3513,
  ""snippet"": """",
  ""threadId"": """"
}
 



 


What do you think?","acosentino:1659083239:2022-07-29T16:27:19.746+0000:1659083239:2022-07-29T16:27:19.746+0000:I think you could use any dataformat immediately after consuming and transform the body in the format you want to display or consume. There is no advantages in adding an option to choose the output, because what you would do in the component, it is what the dataformat would do immediately after consuming the message.
Sybernatus:1659083724:2022-07-29T16:35:24.024+0000:1659083724:2022-07-29T16:35:24.024+0000:Sure but today the data format as a plain text cannot be transform at all, it should be a standard and not an already formatted data.

 

Here is an example of the actual data provided by the component : 
{code:java}
// code placeholder
body: test
[1] [image: Bashroom] <https://xxxxx>
[1] * Jérôme xxxxx *
[1] Bashroom's R&D Engineer & Software Architect
[1] 
 {code}
It's not usable to manipulate it."
0,CAMEL-18325,Improvement,Major,None,None,"
None
",Resolved,Fixed,3.19.0,Thomas Diesler,Thomas Diesler,0,1,2022-07-29 12:39:48+00:00,2022-07-30 09:10:03+00:00,No Desc,"tdiesler:1659071820:2022-07-29T13:17:00.431+0000:1659071820:2022-07-29T13:17:00.431+0000:PR: https://github.com/apache/camel/pull/8078
tdiesler:1659143403:2022-07-30T09:10:03.617+0000:1659143403:2022-07-30T09:10:03.617+0000:Done"
0,CAMEL-18324,Bug,Major,"3.14.4, 3.18.0","3.14.5, 3.18.1, 3.19.0","
None
",Resolved,Fixed,"3.14.5, 3.18.1, 3.19.0",Claus Ibsen,Claus Ibsen,0,2,2022-07-29 08:07:22+00:00,2022-07-29 09:03:34+00:00,Reported in CAMEL-18270 but this is a general problem in the routing engine.,
0,CAMEL-18323,Improvement,Major,None,"3.18.1, 3.19.0","
None
",Resolved,Fixed,"3.18.1, 3.19.0",Zheng Feng,Zheng Feng,0,1,2022-07-29 03:32:18+00:00,2022-09-02 03:44:43+00:00,"Currently camel-jpa depends on spring transaction template to run the operations in the transaction, I'd like to introduce a new option with TransactionStrategy which could be used to replace the spring transaction template. And for example, camel-quarkus could leverage on TX APIs provided by quarkus-narayana-jta",
0,CAMEL-18322,Bug,Major,3.18.0,"3.18.1, 3.19.0","
None
",Resolved,Fixed,"3.18.1, 3.19.0",Claus Ibsen,Marat Gubaidullin,0,1,2022-07-28 15:59:11+00:00,2022-07-30 08:23:22+00:00,"jbang -Dcamel.jbang.version=3.18.0 camel@apache/camel export


for application.properties




camel.jbang.project-id=use-case-1
camel.jbang.project-name=use-case-1
camel.jbang.project-description=Salesforce  to ServiceNow
camel.jbang.gav=org.camel.karavan.demo:use-case-1:1.0.0
camel.jbang.runtime=quarkus
camel.jbang.quarkusVersion=2.11.1.Final
camel.jbang.dependencies=mvn:io.quarkus:quarkus-container-image-jib,mvn:org.apache.camel.quarkus:camel-quarkus-microprofile-health,mvn:io.quarkus:quarkus-openshift,mvn:org.apache.camel:camel-salesforce:3.18.0
camel.health.enabled=true
camel.health.exposure-level=full
quarkus.kubernetes-client.trust-certs=true
quarkus.container-image.builder=jib
quarkus.container-image.group=karavan
quarkus.container-image.name=use-case-1
quarkus.openshift.route.expose=false
quarkus.openshift.part-of=use-case-1
quarkus.openshift.replicas=1




creates quarkus project with the following application.properties




camel.health.enabled=true
camel.health.exposureLevel=full
quarkus.kubernetesClient.trustCerts=true
quarkus.containerImage.builder=jib
quarkus.containerImage.group=karavan
quarkus.containerImage.name=use-case-1
quarkus.openshift.route.expose=false
quarkus.openshift.partOf=use-case-1
quarkus.openshift.replicas=1
camel.main.sourceLocationEnabled=true
camel.main.tracing=false




Some properties are missing and some of them converted from kebab based to camel based and this not supported by Quarkus",
0,CAMEL-18321,Bug,Major,"3.14.4, 3.18.0","3.14.5, 3.18.1, 3.19.0","
None
",Resolved,Fixed,"3.14.5, 3.18.1, 3.19.0",Claus Ibsen,Claus Ibsen,0,1,2022-07-28 15:18:46+00:00,2022-07-28 15:24:17+00:00,"This used to work in 2.x.


Reported in user mailing list",
0,CAMEL-18320,Improvement,Minor,None,3.19.0,"
None
",Resolved,Fixed,3.19.0,Claus Ibsen,Claus Ibsen,0,1,2022-07-28 15:03:53+00:00,2022-09-05 12:49:25+00:00,"This language needs a StAX parser that is not out of the box in the JDK that works, instead you need to use woostock which we provide via camel-stax.


So lets move the language there so it will work OOTB for everyone.


CEQ has a special note about this at:
https://camel.apache.org/camel-quarkus/2.11.x/reference/extensions/xml-jaxp.html#_usage","davsclaus:1662339686:2022-09-05T09:01:26.247+0000:1662339686:2022-09-05T09:01:26.247+0000:Requires a bit of work since xtokenize was in ""core"" and so need to move tests, and some stuff for catalog/main etc."
0,CAMEL-18319,Bug,Major,"3.14.4, 3.18.0","3.14.5, 3.18.1, 3.19.0","
None
",Resolved,Fixed,"3.14.5, 3.18.1, 3.19.0",Claus Ibsen,Claus Ibsen,0,1,2022-07-28 13:47:18+00:00,2022-07-28 14:43:53+00:00,When using supervised route controller then Camel should not warmup routes during its normal startup procedure. They need to be under control by the supervising so any errors there is controlled and can be rescheduled to try again.,
0,CAMEL-18318,Improvement,Minor,None,"3.14.5, 3.18.1, 3.19.0","
None
",Resolved,Fixed,"3.14.5, 3.18.1, 3.19.0",Claus Ibsen,Prasanth Ganesh Rao,0,2,2022-07-28 06:15:34+00:00,2022-08-01 10:17:39+00:00,"We have integration scenarios with muliple quartz from endpoints in a single camel context deployed as osgi bundles. We observe that if one of the quartz configuration has no more schedules and if the bundle were to get restarted, the entire context fails to start thereby preventing future execution of other routes. Error seen in the stacktrace


Caused by: org.apache.camel.RuntimeCamelException: org.quartz.SchedulerException: Based on configured schedule, the given trigger 'myGroup.expired' will never fire.
    at org.apache.camel.RuntimeCamelException.wrapRuntimeException(RuntimeCamelException.java:66)


The issue is becoming a blocker for our scenarios with multiple custom future schedules. Updating the quartz configuration each time we encounter the error is becoming difficult. Hence requesting your quick insights and a resoultion.


I am enclosing a junit to help you recreate the issue. quartz-error.zip The scenario has two routes expiredScheduleRoute and recurringScheduleRoute. The expectation is that the context starts and recurringScheduleRoute continues to run every 2 seconds. I believe we may need a parameter to the quartz endpoint to skip the validation for expiredScheduleRoute","davsclaus:1658962270:2022-07-28T06:51:10.607+0000:1658962270:2022-07-28T06:51:10.607+0000:You can look at the supervising route controller
https://camel.apache.org/manual/route-controller.html
pgrao:1658963907:2022-07-28T07:18:27.314+0000:1658966877:2022-07-28T08:07:57.898+0000:[~davsclaus] Thanks for the suggestion. How can I skip the route upon the exception? Would you have an example for the same?
davsclaus:1658966789:2022-07-28T08:06:29.607+0000:1658966789:2022-07-28T08:06:29.607+0000:That link above has information how to enable supervising route controller, give that a try first
pgrao:1658966962:2022-07-28T08:09:22.401+0000:1658966962:2022-07-28T08:09:22.401+0000:I tried the below snippet with no luck. Am I missing something?

 
{code:java}
package org.apache.camel.quartz.test;

import org.apache.camel.builder.RouteBuilder;
import org.apache.camel.component.mock.MockEndpoint;
import org.apache.camel.spi.SupervisingRouteController;
import org.apache.camel.test.junit4.CamelTestSupport;
import org.junit.Test;

public class ExpiredScheduleTest extends CamelTestSupport {

    @Override
    public boolean isUseRouteBuilder() {
        return false;
    }

    @Test
    public void testRouteController() throws Exception {

        // Has an expired schedule
        RouteBuilder expiredScheduleRoute = new RouteBuilder() {

            @Override
            public void configure() throws Exception {
                // Expired schedule. Uncomment to reproduce the error
                String quartz = ""quartz://myGroup/expired?cron=0+0+0+1+JAN+?+2020"";
                from(quartz).to(""mock:result"");
            }
        };
        context.addRoutes(expiredScheduleRoute);
        // Has a valid recurring schedule
        RouteBuilder recurringScheduleRoute = new RouteBuilder() {

            @Override
            public void configure() throws Exception {
                from(""quartz://myGroup/myTimerName?cron=0/2+*+*+*+*+?"").to(""mock:result"");
            }
        };
        context.addRoutes(recurringScheduleRoute);

        SupervisingRouteController src = context.getRouteController().supervising();
        src.setBackOffDelay(25);
        src.setInitialDelay(100);
        src.setThreadPoolSize(2);

        MockEndpoint mock = getMockEndpoint(""mock:result"");
        context.start();

        Thread.sleep(5 * 1000);
        mock.expectedMinimumMessageCount(1);
        assertMockEndpointsSatisfied();
        context.stop();

    }
    
} {code}
 

 
davsclaus:1658979956:2022-07-28T11:45:56.535+0000:1658979956:2022-07-28T11:45:56.535+0000:I had a look, so the supervising route controller is kicked in later, as camel is warming up the routes prior to that, which unfortunately camel-quartz does this check at the endpoint level instead of doing it at the consumer level.


davsclaus:1658987569:2022-07-28T13:52:49.451+0000:1658987569:2022-07-28T13:52:49.451+0000:Okay there was a bug in the supervising CAMEL-18319 which after fixed then makes your unit test work.

The quartz scheduler is throwing that exception if its in the past.

What is your use-case for having a quartz cron that are set to a specific day, meaning that in the future it will always fail like this?
Usually when using quartz you set it to run every X minute / hour, or maybe MON-FRI to skip weekend etc. 

Its the first time I hear a case for a specific day only.
pgrao:1658989836:2022-07-28T14:30:36.452+0000:1658989836:2022-07-28T14:30:36.452+0000:The use case targets to handle cases when an event happens on a set of days without a recurrence pattern. Examples could be running campaigns to align to local holiday calendars; updating Government filings of Specific compliance reports or taxes. Typically in these scenarios, the calendar of events is published annually. The integrations are configured and deployed to run on the published dates using multiple quartz routes. The problem occurs when one of these schedules have executed, and the server restarts. The user must again refer to the calendar of events and realign the schedules to correct the issue.
davsclaus:1658990624:2022-07-28T14:43:44.066+0000:1658990624:2022-07-28T14:43:44.066+0000:There is a new option ignoreExpiredNextFireTime you can set = true on component/endpoint which then logs a WARN in this sitatuon.
pgrao:1659315009:2022-08-01T08:50:09.586+0000:1659315009:2022-08-01T08:50:09.586+0000:Thanks [~davsclaus] I forgot to mention we are on Java 8. Can you please consider including this change to 3.14?
davsclaus:1659320259:2022-08-01T10:17:39.351+0000:1659320259:2022-08-01T10:17:39.351+0000:Yeah I backported"
0,CAMEL-18317,Improvement,Major,None,3.19.0,"
None
",Resolved,Fixed,3.19.0,Jeremy Ross,Claus Ibsen,0,2,2022-07-28 05:16:36+00:00,2022-08-07 18:58:08+00:00,"Today both the operationName and topicName are marked as optional - which makes the logic to parse the uri complex. 


A rule in Camel is that only one path parameter can be optional.


It would be better to make operationName mandatory and add an operation for the consumer (what would be a good name, listen, consume, onMessage?), so you would do


from(""salesforce:listen:cheese"")


And in the uri for the producer uses the operationName already, where topicName is not in use.


to(""salesforce:updateSObject"")","davsclaus:1658956639:2022-07-28T05:17:19.730+0000:1658956639:2022-07-28T05:17:19.730+0000:This fixes the problem with salesforce using an invalid uri syntax and also makes it Camel standard and tooling friendly.
jeremyross:1659276519:2022-07-31T22:08:39.606+0000:1659276519:2022-07-31T22:08:39.606+0000:Yeah, this has always been a little wonky to me. 

I like ""subscribe"". It aligns with salesforce terminology.
davsclaus:1659386766:2022-08-02T04:46:06.026+0000:1659386766:2022-08-02T04:46:06.026+0000:Thanks subscribe is a good name - lets use that"
0,CAMEL-18316,Dependency upgrade,Major,3.18.0,,"
None
",Resolved,Information Provided,None,Unassigned,Soumik Das,0,2,2022-07-27 22:25:27+00:00,2022-09-07 19:17:13+00:00,We are upgrading from JAF 1.2 to Jakarta Activation (JAF 2.0) for JDK 17. It turns out camel 3.18 does not support jakarta.activation. When can we expect an upgrade?,"davsclaus:1662192727:2022-09-03T16:12:07.674+0000:1662192727:2022-09-03T16:12:07.674+0000:Camel 4 is where we do all the JEE10 and javax -> jakarta migration
soumikdas:1662469376:2022-09-06T21:02:56.562+0000:1662469376:2022-09-06T21:02:56.562+0000:[~davsclaus] Thank you for the update. Is there any tentative date by which Camel 4 will be available?
davsclaus:1662500915:2022-09-07T05:48:35.821+0000:1662500915:2022-09-07T05:48:35.821+0000:Q1 or Q2 next year
soumikdas:1662549433:2022-09-07T19:17:13.360+0000:1662549433:2022-09-07T19:17:13.360+0000:[~davsclaus] Thanks for the update."
0,CAMEL-18315,New Feature,Major,None,None,"
None
",Resolved,Fixed,3.19.0,Thomas Diesler,Thomas Diesler,0,1,2022-07-27 14:07:36+00:00,2022-07-28 12:06:42+00:00,"This change uses the 'admin' wallet as a synonym for the already existing single tenancy base wallet. It also adds support for ...



/connections/accept-invitation
/connections/get-single","tdiesler:1658902307:2022-07-27T14:11:47.868+0000:1658902307:2022-07-27T14:11:47.868+0000:PR: https://github.com/apache/camel/pull/8059
tdiesler:1658981202:2022-07-28T12:06:42.058+0000:1658981202:2022-07-28T12:06:42.058+0000:done"
0,CAMEL-18314,New Feature,Major,None,4.x,"
None
",Open,Unresolved,4.x,Unassigned,Claus Ibsen,0,2,2022-07-27 13:23:48+00:00,2023-08-09 09:06:14+00:00,"When using vault/secrets then you have to specify aws, azure, ... currently. But you may want to use a generic term `vault` that then delegates to a provider at runtime, so you can run the same route on aws, azure, local, etc.
https://camel.apache.org/blog/2022/07/secrets-properties-functions-part-2/","davsclaus:1658899454:2022-07-27T13:24:14.606+0000:1658899454:2022-07-27T13:24:14.606+0000:We can add a `vault` as general term that you can use, that then delegates to what we can find at runtime as a provider.
davsclaus:1658899553:2022-07-27T13:25:53.462+0000:1658899553:2022-07-27T13:25:53.462+0000:cc [~lburgazzoli] [~acosentino]"
0,CAMEL-18313,Bug,Major,None,,"
None
",Resolved,Invalid,None,Unassigned,Ruben Romero Montes,0,2,2022-07-27 12:29:21+00:00,2022-07-27 12:35:32+00:00,"When using the Owner Trait to propagate annotations to the owned resources, such annotations are not propagated to the Kubernetes Services.


 




# camel-k: language=yaml
# camel-k: trait=owner.enabled=true
# camel-k: trait=owner.target-annotations=[example]



 


The deployment shows the annotation but the service doesn't.


Is this the expected behaviour?","ruromero:1658896213:2022-07-27T12:30:13.306+0000:1658896213:2022-07-27T12:30:13.306+0000:FYI [~pcongiusti] 
acosentino:1658896532:2022-07-27T12:35:32.872+0000:1658896532:2022-07-27T12:35:32.872+0000:Open the issue in camel-k github repository in the issues section. Thanks."
0,CAMEL-18312,Bug,Major,3.17.0,,"
None
",Resolved,Duplicate,None,Unassigned,Ashish Gidh,0,2,2022-07-27 11:19:37+00:00,2022-07-27 13:41:49+00:00,"The DoTry and DoCatch block does not work and this is an important feature for us to catch errors and process. 


 Is there an existing example which works ? Not sure if the syntax is missing anything but its not working as per specs. 


Any working example or logic will help analyze. This may relate to the same issue as below. 


    https://github.com/apache/camel-karavan/issues/401


Example Snippet which does not work under Quarkus and Spring Boot is as follows. We are using Karavan for citizen development. 


                - doTry:
                    steps:
                      - to:
                          uri: rest:post:example:startProcess
                          parameters:
                            host: localhost:8081
                            bindingMode: auto
                            producerComponentName: http
                    doCatch:
                      - steps:
                          - log:
                              message: Exception while calling the process \n${body}
                              loggingLevel: ERROR
                        exception:
                          - java.lang.Exception.class
                          - Exception.class
 


Please  help.","davsclaus:1658892941:2022-07-27T11:35:41.767+0000:1658892941:2022-07-27T11:35:41.767+0000:There is already a ticket
ashishgidh:1658897596:2022-07-27T12:53:16.081+0000:1658897596:2022-07-27T12:53:16.081+0000:Oh thanks. Please let us know or any help will be appreciated. 
davsclaus:1658900509:2022-07-27T13:41:49.916+0000:1658900509:2022-07-27T13:41:49.916+0000:Thanks for reporting - its been fixed for upcoming releases."
0,CAMEL-18311,Improvement,Major,None,"3.18.1, 3.19.0","
None
",Resolved,Fixed,"3.18.1, 3.19.0",Claus Ibsen,Claus Ibsen,0,1,2022-07-27 10:07:17+00:00,2022-07-27 11:51:48+00:00,"In case you mistakenly attempt to run the same file twice


camel run foo.yaml --deps=xxxxx foo.yaml


If you have args and many things on the CLI then it may slip that the same file is listed twice. And then we fail on starting due to duplicte routes with an error that can be hard to understand its due to same file loaded twice.",
0,CAMEL-18310,Bug,Major,3.18.0,"3.18.1, 3.19.0","
None
",Resolved,Fixed,"3.18.1, 3.19.0",Claus Ibsen,Ralf Steppacher,0,1,2022-07-27 09:15:49+00:00,2022-07-27 14:28:27+00:00,"When setting the property camel.component.http.use-global-ssl-context-parameters=true all plaintext http connection attempts fail because a SSLConnectionSocketFactory is used. E.g. this will fail:




to(http(""localhost:9090/test""))




with the following stacktrace:



javax.net.ssl.SSLException: Unsupported or unrecognized SSL message
    at java.base/sun.security.ssl.SSLSocketInputRecord.handleUnknownRecord(SSLSocketInputRecord.java:451) ~[na:na]
    at java.base/sun.security.ssl.SSLSocketInputRecord.decode(SSLSocketInputRecord.java:175) ~[na:na]
    at java.base/sun.security.ssl.SSLTransport.decode(SSLTransport.java:110) ~[na:na]
    at java.base/sun.security.ssl.SSLSocketImpl.decode(SSLSocketImpl.java:1369) ~[na:na]
    at java.base/sun.security.ssl.SSLSocketImpl.readHandshakeRecord(SSLSocketImpl.java:1278) ~[na:na]
    at java.base/sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:401) ~[na:na]
    at java.base/sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:373) ~[na:na]
    at org.apache.http.conn.ssl.SSLConnectionSocketFactory.createLayeredSocket(SSLConnectionSocketFactory.java:436) ~[httpclient-4.5.13.jar:4.5.13]
    at org.apache.http.conn.ssl.SSLConnectionSocketFactory.connectSocket(SSLConnectionSocketFactory.java:384) ~[httpclient-4.5.13.jar:4.5.13]
    at org.apache.http.impl.conn.DefaultHttpClientConnectionOperator.connect(DefaultHttpClientConnectionOperator.java:142) ~[httpclient-4.5.13.jar:4.5.13]
    at org.apache.http.impl.conn.PoolingHttpClientConnectionManager.connect(PoolingHttpClientConnectionManager.java:376) ~[httpclient-4.5.13.jar:4.5.13]
    at org.apache.http.impl.execchain.MainClientExec.establishRoute(MainClientExec.java:393) ~[httpclient-4.5.13.jar:4.5.13]
    at org.apache.http.impl.execchain.MainClientExec.execute(MainClientExec.java:236) ~[httpclient-4.5.13.jar:4.5.13]
    at org.apache.http.impl.execchain.ProtocolExec.execute(ProtocolExec.java:186) ~[httpclient-4.5.13.jar:4.5.13]
    at org.apache.http.impl.execchain.RetryExec.execute(RetryExec.java:89) ~[httpclient-4.5.13.jar:4.5.13]
    at org.apache.http.impl.execchain.RedirectExec.execute(RedirectExec.java:110) ~[httpclient-4.5.13.jar:4.5.13]
    at org.apache.http.impl.client.InternalHttpClient.doExecute(InternalHttpClient.java:185) ~[httpclient-4.5.13.jar:4.5.13]
    at org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:72) ~[httpclient-4.5.13.jar:4.5.13]
    at org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:56) ~[httpclient-4.5.13.jar:4.5.13]
    at org.apache.camel.component.http.HttpProducer.executeMethod(HttpProducer.java:445) ~[camel-http-3.18.0.jar:3.18.0]
    at org.apache.camel.component.http.HttpProducer.process(HttpProducer.java:273) ~[camel-http-3.18.0.jar:3.18.0]
    at org.apache.camel.support.AsyncProcessorConverterHelper$ProcessorToAsyncProcessorBridge.process(AsyncProcessorConverterHelper.java:66) ~[camel-support-3.18.0.jar:3.18.0]
    at org.apache.camel.processor.SendDynamicProcessor.lambda$process$0(SendDynamicProcessor.java:197) ~[camel-core-processor-3.18.0.jar:3.18.0]
    at org.apache.camel.support.cache.DefaultProducerCache.doInAsyncProducer(DefaultProducerCache.java:327) ~[camel-support-3.18.0.jar:3.18.0]
    at org.apache.camel.processor.SendDynamicProcessor.process(SendDynamicProcessor.java:182) ~[camel-core-processor-3.18.0.jar:3.18.0]
    at org.apache.camel.processor.errorhandler.RedeliveryErrorHandler$RedeliveryTask.doRun(RedeliveryErrorHandler.java:812) ~[camel-core-processor-3.18.0.jar:3.18.0]
    at org.apache.camel.processor.errorhandler.RedeliveryErrorHandler$RedeliveryTask.run(RedeliveryErrorHandler.java:720) ~[camel-core-processor-3.18.0.jar:3.18.0]
    at org.apache.camel.impl.engine.DefaultReactiveExecutor$Worker.schedule(DefaultReactiveExecutor.java:189) ~[camel-base-engine-3.18.0.jar:3.18.0]
    at org.apache.camel.impl.engine.DefaultReactiveExecutor.scheduleMain(DefaultReactiveExecutor.java:61) ~[camel-base-engine-3.18.0.jar:3.18.0]
    at org.apache.camel.processor.Pipeline.process(Pipeline.java:184) ~[camel-core-processor-3.18.0.jar:3.18.0]
    at org.apache.camel.impl.engine.CamelInternalProcessor.process(CamelInternalProcessor.java:399) ~[camel-base-engine-3.18.0.jar:3.18.0]




SSL settings should only apply to endpoints using the https protocol scheme, not to endpoints using the http protocol scheme.",
0,CAMEL-18309,New Feature,Minor,3.18.0,3.x,"
None
",Resolved,Won't Fix,3.x,Unassigned,Aurélien Pupier,0,1,2022-07-27 08:31:02+00:00,2023-07-17 10:55:33+00:00,"When debugging a Camel test, it would be convenient to be able to disable timeouts.


Similar feature specific to JUnit test https://junit.org/junit5/docs/current/user-guide/#writing-tests-declarative-timeouts-mode


I spotted NotifyBuilder which is used in test that has timeouts. Need to lookup if there are other ways to have timeouts in test


I think there would 2 main categories:



when Java debugging is used. In this case, maybe can reuse same heurisitic than for JUnit
when Camel debugging. In this case, the heuristic to detect the debug must be different.



maybe a configuration parameter camel.test.execution.timeout.mode can be provided. With potential values enabled, disabled, disabled_on_debug.


The default mode for JUnit is enabled. So I guess we should use it too. Maybe worth defaulting to disabled_on_debug when camel-debug is on classpath.",
0,CAMEL-18308,Task,Major,None,3.19.0,"
None
",Resolved,Fixed,3.19.0,Otavio Rodolfo Piske,Otavio Rodolfo Piske,0,2,2022-07-27 07:52:08+00:00,2022-08-02 16:34:46+00:00,"Camel Spring Boot Daily



This is duplicated copy of Camel Spring Boot JDK 11. 



 


https://ci-builds.apache.org/job/Camel/job/Camel-Spring-Boot%20Daily/","davsclaus:1658966132:2022-07-28T07:55:32.622+0000:1658966132:2022-07-28T07:55:32.622+0000:Is this not resolved?
orpiske:1658966678:2022-07-28T08:04:38.671+0000:1658966703:2022-07-28T08:05:03.483+0000:[~davsclaus] I am waiting a few days just in case anyone on the community has data in those jobs. I will remove it tomorrow COB.
orpiske:1659429286:2022-08-02T16:34:46.242+0000:1659429286:2022-08-02T16:34:46.242+0000:Removed."
0,CAMEL-18307,Improvement,Major,3.18.0,None,"
None
",Resolved,Fixed,"3.18.1, 3.19.0",Claus Ibsen,Claus Ibsen,0,1,2022-07-27 07:31:04+00:00,2022-07-27 07:32:43+00:00,"This is needed to be able to stub any component where the component may be auto configured which then would cause the generated configurer to return false for unknown options not on the stub component itself.


We need to generate special configurers that are lenient.",
0,CAMEL-18306,Improvement,Major,None,"3.18.1, 3.19.0","
None
",Resolved,Fixed,"3.18.1, 3.19.0",Claus Ibsen,Claus Ibsen,0,1,2022-07-26 10:49:07+00:00,2022-07-26 11:25:23+00:00,"So you can specify the open-api spec file from the configuration file, and not need to declared it as CLI argument","davsclaus:1658804162:2022-07-26T10:56:02.618+0000:1658805857:2022-07-26T11:24:17.193+0000:You can now set 

camel.jbang.openApi"
0,CAMEL-18305,Wish,Minor,3.18.0,4.0-M2,"
None
",Resolved,Fixed,4.0-M2,Guillaume Nodet,Raymond,0,2,2022-07-26 10:26:49+00:00,2023-02-08 18:20:42+00:00,"I use the XML Dumper. But now in 3.18.0 it says:


Cannot find ModelToXMLDumper on classpath. Add camel-xml-jaxb to classpath.


It's true that I don't have camel-xml-jaxb on the classpath. I do however have:


camel-xml-io


On my classpath. Would be nice if ModelToXMLDumper would work with the camel-xml-io dependency also.


:Cannot find ModelToXMLDumper on classpath. Add camel-xml-jaxb to classpath.","gnodet:1675749252:2023-02-07T13:54:12.130+0000:1675749252:2023-02-07T13:54:12.130+0000:First PR available at https://github.com/apache/camel/pull/9295
I'll work on writing a new xml dumper based on that and will push other commits to this PR."
0,CAMEL-18304,New Feature,Major,None,3.x,"

kafka
sslContextParameters

",Resolved,Cannot Reproduce,3.x,Unassigned,Aniket Jadhav,0,2,2022-07-26 07:23:00+00:00,2023-07-26 05:14:28+00:00,"Kafka component does have the provision to provide bean of org.apache.camel.support.jsse.SSLContextParameters as a sslContextParameters property.


But it does not support parsing the value for Keystore and TrustStore like path , password etc also not loads it from classpath like in HttpComponent.


Camel Version- 3.14.3


Example - I have created bean of sslContextParameter and passing it to Kafka Component as below 




<camel:sslContextParameters id=""sslContextParameters"">
        <camel:keyManagers keyPassword=""keystore.key.password"">
            <camel:keyStore resource=""keystore/keystore.jks"" password=""{{keystore.password}}"" />
        </camel:keyManagers>
        <camel:trustManagers>
            <camel:keyStore resource=""truststore/truststore.jks"" password=""{{truststore.password}}"" />
        </camel:trustManagers>
    </camel:sslContextParameters>    <camelContext xmlns=""http://camel.apache.org/schema/blueprint"" id=""ctx""     streamCache=""true"" useMDCLogging=""true"">
               
        <propertyPlaceholder id=""placeholder"" location=""classpath:config_${ENV}.properties,classpath:config.properties""    ignoreMissingLocation=""true"" propertiesParserRef=""jasypt"" />
        
        <endpoint id=""kafkaConsumerEndpoint"" uri=""{kafka.topic}}"">
            <property key=""brokers"" value=""kafka.brokers"" />
            <property key=""sslContextParameters"" value=""#sslContextParameters"" />
            <property key=""groupId"" value=""xyz"" />
            <property key=""securityProtocol"" value=""SSL"" />
            <property key=""reconnectBackoffMs"" value=""120000"" />
            <property key=""sslEndpointAlgorithm"" value="""" />
            <property key=""allowManualCommit"" value=""true"" />
            <property key=""autoCommitEnable"" value=""false"" />
        </endpoint>
    </camelContext> 



As It does not support to load Keystore and Truststore from classpath and not parsing properties we can't use property placeholder and classpath resources. 


We should invoke below method to load Keystore from class path and to use property place holders for passing password.


https://github.com/apache/camel/blob/main/core/camel-api/src/main/java/org/apache/camel/support/jsse/KeyStoreParameters.java#L159","davsclaus:1690319668:2023-07-26T05:14:28.984+0000:1690319668:2023-07-26T05:14:28.984+0000:This should work as it uses ResourceLoader to load the resource, so you can prefix with classpath: or file: etc to load."
0,CAMEL-18303,Task,Major,3.14.4,None,"
None
",Resolved,Fixed,3.14.6,Unassigned,Claus Ibsen,0,1,2022-07-26 06:00:30+00:00,2022-08-22 09:46:20+00:00,"https://camel.apache.org/schema/spring/


The last is 3.14.3, we need to upload the 3.14.4 schema files. Also for blueprint and whatnot",
0,CAMEL-18302,Bug,Minor,3.6.0,,"
None
",Resolved,Not A Bug,None,Unassigned,Srikhar Venumbaka,0,2,2022-07-26 05:03:11+00:00,2022-07-26 05:56:19+00:00,"The Rest service connectivity is failing using the camel HTTP component when the REST service password has a special character like %. e.g. ""test%hello"". It seems the camel HTTP component API internally converting the special characters in the password to URL encoded characters and in the conversion, it is incorrectly converting the % character to %2525. In the example, as given above, it is converting the password to ""test%2525hello"".


We are using camel version 3.6.0.","davsclaus:1658783218:2022-07-26T05:06:58.988+0000:1658783218:2022-07-26T05:06:58.988+0000:See this FAQ
https://camel.apache.org/manual/faq/how-do-i-configure-password-options-on-camel-endpoints-without-the-value-being-encoded.html"
0,CAMEL-18301,New Feature,Minor,None,None,"

features

",Open,Unresolved,Future,Unassigned,Adrien SALES,0,2,2022-07-25 22:41:12+00:00,2022-09-03 16:09:07+00:00,"Context


 


more and more users store data in Sharepoint LIsts on sharepointOnline. The tricky part comes when we are asked to perform integrations with these DATAs.


They are served as REST APIs, OIDC and oAUth options are available but you be awesome to be able to grab these datas as easily as we can with the JDBC component for example.


 


Our main usecase by the way is to copy data from SharepointLists to JDBC data sources... or Kafka topics.


 


Feature request


 



Add the Microsoft Sharepoint List component to core components","acosentino:1659603861:2022-08-04T17:04:21.804+0000:1659603861:2022-08-04T17:04:21.804+0000:As far as I see there is not an sdk to deal with Sharepoint.
acosentino:1659603908:2022-08-04T17:05:08.942+0000:1659603908:2022-08-04T17:05:08.942+0000:So this would require an http component dealing with their REST Api.
adriensales:1659620392:2022-08-04T21:39:52.423+0000:1659620392:2022-08-04T21:39:52.423+0000:Hmmn thanks a lot for the comments Andrea.

 

There is a SDK called ""Microsoft Graph SDK "" : [https://docs.microsoft.com/en-us/graph/sdks/sdks-overview]

 

... that wraps on top of the API : [https://docs.microsoft.com/en-us/graph/api/list-get?view=graph-rest-1.0&tabs=http]

 

And the REST service [https://docs.microsoft.com/en-us/sharepoint/dev/sp-add-ins/working-with-lists-and-list-items-with-rest]

 

I gues, using the REST API would be the best choice."
